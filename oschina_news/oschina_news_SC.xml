<?xml version="1.0" encoding="UTF-8"?>
<rss
    xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"


>
    <channel>
        <title>
            <![CDATA[开源中国-最新资讯]]>
        </title>
        <link>https://www.oschina.net/news/project</link>
        <atom:link href="https://rsshub.app/oschina/news" rel="self" type="application/rss+xml" />
        <description>
            <![CDATA[开源中国-最新资讯 - Made with love by RSSHub(https://github.com/DIYgod/RSSHub)]]>
        </description>
        <generator>RSSHub</generator>
        <webMaster>i@diygod.me (DIYgod)</webMaster>
        <language>zh-cn</language>
        <lastBuildDate>Mon, 18 Dec 2023 23:44:14 GMT</lastBuildDate>
        <ttl>120</ttl>
        <item>
            <title>
                <![CDATA[.NET 8 AOT 与 LLVM 什么关系？]]>
            </title>
            <description>
                <![CDATA[<div class="content"><p style="color:#4a4a4a; margin-left:0; margin-right:0; text-align:center"><span><strong><span style="color:#3c70c6">前言</span></strong></span></p><p style="color:#4a4a4a; margin-left:0; margin-right:0; text-align:left">.NET8 的 AOT 为了支持各个平台，比如 MacOS,Linux 等平台，ILC(AOT Compiler) 的目标文件用的是 LLVM 生成的。本篇看下。</p><p style="color:#4a4a4a; margin-left:0; margin-right:0; text-align:left">原文:<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzg5NDYwNjU4MA%3D%3D%26mid%3D2247485778%26idx%3D1%26sn%3Dc7fce583f2eadab39b626aaf6ca7c6c6%26chksm%3Dc01c44c9f76bcddf7fae3828297699e1252e7b97c1e84b5d2b09502732e9ccb6fd5fa1d69335%26token%3D2009208964%26lang%3Dzh_CN%23rd" rel="nofollow" target="_blank"><u><strong>.NET8 AOT 与 LLVM 什么关系?</strong></u></a></p><p style="color:#4a4a4a; margin-left:0px; margin-right:0px; text-align:center">公众号:jianghuht，欢迎关注</p><p style="color:#4a4a4a; margin-left:0px; margin-right:0px; text-align:center"><u><strong><img alt="" height="430" src="https://oscimg.oschina.net/oscnet/up-736ea9cda29ab0849e37b740d5b255ea7bc.png" width="430" referrerpolicy="no-referrer"></strong></u></p><p style="color:#4a4a4a; margin-left:0; margin-right:0; text-align:center"><span><strong><span style="color:#3c70c6">详述</span></strong></span></p><p style="color:#4a4a4a; margin-left:0; margin-right:0; text-align:left"><span>为了更为细致的让大家了解 LLVM 在 AOT 里面的作用，这里用一个例子演示下。以下以最新版的.NET8.0/windows11 为蓝本演示。</span></p><p style="color:#4a4a4a; margin-left:0; margin-right:0; text-align:left"><strong><span>第一步:</span></strong><span>在 nuget 上面下载一个 ILC 组件,名称:runtime.win-x64.Microsoft.DotNet.ILCompiler</span></p><p style="color:#4a4a4a; margin-left:0; margin-right:0; text-align:left"><strong>第二步:</strong>找到这个包在你当前电脑的路径，一般为如下，这个路径有个 objwriter.dll:</p><pre><code><span><span style="color:#ca7d37">C</span>:\<span style="color:#ca7d37">Users</span>\<span style="color:#ca7d37">Administrator</span>\<span>.nuget</span>\<span style="color:#ca7d37">packages</span>\<span style="color:#ca7d37">runtime</span><span>.win-x64</span><span>.microsoft</span><span>.dotnet</span><span>.ilcompiler</span>\8<span>.0</span><span>.0</span>\<span style="color:#ca7d37">tools</span></span></code></pre><p style="color:#4a4a4a; margin-left:0; margin-right:0; text-align:left"><strong><span>第三步:</span></strong>操作 objwriter.dll</p><p style="color:#4a4a4a; margin-left:0; margin-right:0; text-align:left"><span style="background-color:#ffffff">新建一个.NET8 控制枱应用程序，把这个 objwriter.dll 放入到控制枱</span><span style="background-color:#ffffff">bin/x64/debug/net8.0 目录下。</span><span style="background-color:#ffffff">Main 写入如下代码：</span></p><pre><code><span>  [<span style="color:#afafaf">DllImport(<span>"objwriter.dll"</span>)</span>]</span></code><code><span><span><span style="color:#ca7d37">private</span><span style="color:#ca7d37">static</span><span style="color:#ca7d37">extern</span> IntPtr <span style="color:#dd1144">InitObjWriter</span>(<span>[MarshalAs(UnmanagedType.LPUTF8Str</span>)] <span style="color:#ca7d37">string</span> objectFilePath, <span style="color:#ca7d37">string</span> triple</span> = <span style="color:#0e9ce5">null</span>);</span></code><code><span>  [<span style="color:#afafaf">DllImport(<span>"objwriter.dll"</span>)</span>]</span></code><code><span><span><span style="color:#ca7d37">private</span><span style="color:#ca7d37">static</span><span style="color:#ca7d37">extern</span><span style="color:#ca7d37">void</span><span style="color:#dd1144">FinishObjWriter</span>(<span>IntPtr objWriter</span>)</span>;</span></code><code><span>  [<span style="color:#afafaf">DllImport(<span>"objwriter.dll"</span>)</span>]</span></code><code><span><span><span style="color:#ca7d37">private</span><span style="color:#ca7d37">static</span><span style="color:#ca7d37">extern</span><span style="color:#ca7d37">void</span><span style="color:#dd1144">EmitIntValue</span>(<span>IntPtr objWriter, <span style="color:#ca7d37">ulong</span><span style="color:#ca7d37">value</span>, <span style="color:#ca7d37">int</span> size</span>)</span>;</span></code><code><span><span style="color:#ca7d37">private</span> IntPtr _nativeObjectWriter = IntPtr.Zero;</span></code><code><span><span><span style="color:#ca7d37">static</span><span style="color:#ca7d37">void</span><span style="color:#dd1144">Main</span>(<span><span style="color:#ca7d37">string</span>[] args</span>)</span></span></code><code><span>  {</span></code><code><span>      IntPtr objectWriter = InitObjWriter(<span style="color:#dd1144">"Demo.obj"</span>, <span style="color:#dd1144">"x86_64-pc-win32-windows"</span>);</span></code><code><span>      EmitIntValue(objectWriter, <span style="color:#0e9ce5">0x10</span>, <span style="color:#0e9ce5">4</span>);</span></code><code><span>      FinishObjWriter(objectWriter);</span></code><code><span>  }</span></code></pre><p style="color:#4a4a4a; margin-left:0; margin-right:0; text-align:left"><span style="background-color:#ffffff; color:#4a4a4a">objwriter.dll 通过 LLVM_Project 项目构建，应用于.NET8 ILC AOT 里面。</span></p><p style="color:#4a4a4a; margin-left:0; margin-right:0; text-align:left">以上代码运行之后，就会在控制枱的 bin/x64/debug/net8.0 目录下面看到生成的目标文件 Demo.obj。这个就是 ILC 调用 LLVM 生成的当前 Windows 平台 (InitObjWriter 的参数:x86_64-pc-win32-windows 表示的是 Windows 目标文件) 上面的目标文件，此后通过引导程序 BootStrap(关于.NET8 AOT 引导程序参考:<a href="https://www.oschina.net/action/GoToLink?url=http%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzg5NDYwNjU4MA%3D%3D%26mid%3D2247484953%26idx%3D1%26sn%3D3d9e15f17fe5ccbfd3f36ff64a0e25c4%26chksm%3Dc01c4b82f76bc294ed18a3db625c379281f61da3e35e84ed68072aed51e92125f416468d3efb%26scene%3D21%23wechat_redirect" target="_blank" rel="nofollow"><u><strong>.Net8 的 AOT 引导程序 BootStrap</strong></u></a><span>) 链接下，即可生成独立的可执行文件。</span></p><p style="color:#4a4a4a; margin-left:0; margin-right:0; text-align:left">以上就是 LLVM 在.NET8 AOT 里面的简单应用。</p><p style="color:#4a4a4a; margin-left:0; margin-right:0; text-align:center"><span><strong><span style="color:#3c70c6">题外话</span></strong></span></p><p style="color:#4a4a4a; margin-left:0; margin-right:0; text-align:left">微软从.NET7.0 开始，就有意识的分离.NET 里面的各个耦合度极高的组件。举个例子，比如说在.NET Framework 里面 GC 和 CLR 分离是不可想象的，但是在.NET8.0 里面，GC 不仅和 CLR 分离，JIT 也可以和 CLR 分离。进行独自定制。这些.NET 核心组件通过动态链接库，也即是 DLL 的形式分发出来，可以让开发人员进行自由定制。</p><p style="color:#4a4a4a; margin-left:0; margin-right:0; text-align:left">这里稍微列举下:</p><p style="color:#4a4a4a; margin-left:0; margin-right:0; text-align:left"><strong>1.</strong>ILC 的可移植性目标文件组件:objwriter.dll(本文所述)</p><p style="color:#4a4a4a; margin-left:0; margin-right:0; text-align:left"><strong>2.</strong>分离的可定制 GC 组件:clrgc.dll(参考:<a href="https://www.oschina.net/action/GoToLink?url=http%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzg5NDYwNjU4MA%3D%3D%26mid%3D2247485315%26idx%3D1%26sn%3Db964e0860d799e3b01cc99e258f10ef6%26chksm%3Dc01c4a18f76bc30e6cb78c731df1c2389e9ced771f710c455bfe9fe45e131a89f0d18ad49e4a%26scene%3D21%23wechat_redirect" target="_blank" rel="nofollow"><u><strong>自定义 GC 垃圾回收</strong></u></a>)</p><p style="color:#4a4a4a; margin-left:0; margin-right:0; text-align:left"><strong>3.</strong><span>分离的可定制 JIT 组件:</span>c<span>lrjit.dll（参考:</span><a href="https://www.oschina.net/action/GoToLink?url=http%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzg5NDYwNjU4MA%3D%3D%26mid%3D2247485395%26idx%3D1%26sn%3Db640a5e447083dc7312effe3dc28dfe9%26chksm%3Dc01c4a48f76bc35ecec1f6aa4559d8fcf8686cec2e4d489afe35f1f021cd9a8c8e436fcd5afa%26scene%3D21%23wechat_redirect" target="_blank" rel="nofollow"><u><strong>自定义 JIT 即时编译</strong></u></a><span>）</span></p><p style="color:#4a4a4a; margin-left:0; margin-right:0; text-align:left"><strong>4.</strong>分离的可定制 CLR 组件:coreclr.dll（参考:目前空白）</p><p style="color:#4a4a4a; margin-left:0; margin-right:0; text-align:left"><strong>5.</strong>可自定义的运行时宿主组件<span>:hostfxr.dll(参考:</span><u><strong>自定义</strong></u><a href="https://www.oschina.net/action/GoToLink?url=http%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzg5NDYwNjU4MA%3D%3D%26mid%3D2247484930%26idx%3D1%26sn%3D3c9e3dc9f97fff2339db202122993991%26chksm%3Dc01c4b99f76bc28fa9cc60ff3e2ee6f32b28e76ba3e9a188bdec8160eba5c3b92a4a198ef6e5%26scene%3D21%23wechat_redirect" target="_blank" rel="nofollow"><strong><span>宿主组件</span></strong></a><span>)</span></p><p style="color:#4a4a4a; margin-left:0; margin-right:0; text-align:left">以上都可以进行自由定制，你在各个平台上 (MacOS/Linux) 看到的动态链接库 DLL，都是有自定制进行各种平台的自由分发，比如国内外大热的 Risc-V 支持的新平台，比如国内的 Arm64 指令集平台等。</p></div>
                                    ]]>
            </description>
            <pubDate>Mon, 18 Dec 2023 03:21:00 GMT</pubDate>
            <guid isPermaLink="false">https://my.oschina.net/u/5407571/blog/10322112</guid>
            <link>https://my.oschina.net/u/5407571/blog/10322112</link>
            <author>
                <![CDATA[原创]]>
            </author>
        </item>
        <item>
            <title>
                <![CDATA[国芯科技推出全国产 RAID 卡解决方案 CCUSR8116]]>
            </title>
            <description>
                <![CDATA[<div class="content"><p>苏州国芯科技<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FRYHsS9suYQrzlvlcsCRxjw" target="_blank">官微</a>消息称，近期，苏州国芯科技股份有限公司的全资子公司广州领芯科技有限公司，基于自研 RAID 芯片 CCRD3316 正式推出全国产 RAID 卡解决方案 CCUSR8116。</p><p>全国产 RAID 卡解决方案 CCUSR8116 面向服务器应用场景，可以为客户提供可靠的大容量存储阵列管理，可根据客户需求定制整体解决方案。方案基于自研 RAID 主控芯片 CCRD3316，有以下特点：主控芯片全自研，全国产 BOM 物料，具有完善的配套驱动和工具，具备全面的 RAID 数据保护机制，支持 RAID0/1/5/6/10/50/60/JBOD 模式。</p><p><img alt="" height="307" src="https://oscimg.oschina.net/oscnet/up-90b8576d519c92abcea375d81931483fc54.png" width="500" referrerpolicy="no-referrer"></p><h4 style="margin-left:0px; margin-right:0px; text-align:justify"><strong><span>CCUSR8116</span></strong><strong><span>技术规格</span></strong><strong><span>：</span></strong></h4><table cellpadding="0" cellspacing="0" style="-webkit-text-stroke-width:0px; background-color:#ffffff; border-collapse:collapse; box-sizing:border-box !important; color:rgba(0, 0, 0, 0.9); display:table; font-family:system-ui,-apple-system,BlinkMacSystemFont,&quot;Helvetica Neue&quot;,&quot;PingFang SC&quot;,&quot;Hiragino Sans GB&quot;,&quot;Microsoft YaHei UI&quot;,&quot;Microsoft YaHei&quot;,Arial,sans-serif; font-size:17px; font-style:normal; font-variant-caps:normal; font-variant-ligatures:normal; font-weight:400; letter-spacing:0.544px; margin:0px 0px 10px; max-width:100%; orphans:2; outline:0px; overflow-wrap:break-word !important; padding:0px; text-align:justify; text-decoration-color:initial; text-decoration-style:initial; text-decoration-thickness:initial; text-transform:none; white-space:normal; widows:2; width:676.991px; word-spacing:0px"><tbody><tr><td style="border-color:black; border-style:solid; border-width:1pt; height:32.55pt"><p style="margin-left:0; margin-right:0; text-align:center"><strong><span>主机接口</span></strong></p></td><td style="border-bottom:1pt solid windowtext; border-image:initial; border-left:none; border-right:1pt solid windowtext; border-top:1pt solid windowtext; height:32.55pt"><p style="margin-left:0; margin-right:0; text-align:center"><span>PCIe Gen &nbsp;3.0 x8 （8Gb/s）</span></p></td><td style="border-bottom:1pt solid windowtext; border-image:initial; border-left:none; border-right:1pt solid windowtext; border-top:1pt solid windowtext; height:32.55pt"><p style="margin-left:0; margin-right:0; text-align:center"><strong><span>硬盘接口</span></strong></p></td><td style="border-bottom:1pt solid windowtext; border-image:initial; border-left:none; border-right:1pt solid windowtext; border-top:1pt solid windowtext; height:32.55pt"><p style="margin-left:0; margin-right:0; text-align:center"><span>x16 &nbsp;SATA3.0（6Gb/s）</span></p></td></tr><tr><td style="border-bottom:1pt solid windowtext; border-image:initial; border-left:1pt solid windowtext; border-right:1pt solid windowtext; border-top:none"><p style="margin-left:0; margin-right:0; text-align:center"><strong><span>接口类型</span></strong></p></td><td style="border-bottom:1pt solid windowtext; border-image:initial; border-left:none; border-right:1pt solid windowtext; border-top:none"><p style="margin-left:0; margin-right:0; text-align:center"><span>x4 SFF-8643 mini-SAS</span></p><p style="margin-left:0; margin-right:0; text-align:center"><span>（水平安装）</span></p></td><td style="border-bottom:1pt solid windowtext; border-image:initial; border-left:none; border-right:1pt solid windowtext; border-top:none"><p style="margin-left:0; margin-right:0; text-align:center"><strong><span>机柜管理</span></strong></p></td><td style="border-bottom:1pt solid windowtext; border-image:initial; border-left:none; border-right:1pt solid windowtext; border-top:none"><p style="margin-left:0; margin-right:0; text-align:center"><span>SGPIO</span></p></td></tr><tr><td style="border-bottom:1pt solid windowtext; border-image:initial; border-left:1pt solid windowtext; border-right:1pt solid windowtext; border-top:none"><p style="margin-left:0; margin-right:0; text-align:center"><strong><span>数据缓存</span></strong></p></td><td style="border-bottom:1pt solid windowtext; border-image:initial; border-left:none; border-right:1pt solid windowtext; border-top:none"><p style="margin-left:0; margin-right:0; text-align:center"><span>2 GB DDR3</span></p></td><td style="border-bottom:1pt solid windowtext; border-image:initial; border-left:none; border-right:1pt solid windowtext; border-top:none"><p style="margin-left:0; margin-right:0; text-align:center"><strong><span>缓存保护</span></strong></p></td><td style="border-bottom:1pt solid windowtext; border-image:initial; border-left:none; border-right:1pt solid windowtext; border-top:none"><p style="margin-left:0; margin-right:0; text-align:center"><span>eMMC+超级电容</span></p></td></tr><tr><td style="border-bottom:1pt solid windowtext; border-image:initial; border-left:1pt solid windowtext; border-right:1pt solid windowtext; border-top:none"><p style="margin-left:0; margin-right:0; text-align:center"><strong><span>RAID</span></strong><strong><span>模式</span></strong></p></td><td style="border-bottom:1pt solid windowtext; border-image:initial; border-left:none; border-right:1pt solid windowtext; border-top:none"><p style="margin-left:0; margin-right:0; text-align:center"><span>0/1/5/6/10/50/60/JBOD</span></p></td><td style="border-bottom:1pt solid windowtext; border-image:initial; border-left:none; border-right:1pt solid windowtext; border-top:none"><p style="margin-left:0; margin-right:0; text-align:center"><strong><span>最大功耗</span></strong></p></td><td style="border-bottom:1pt solid windowtext; border-image:initial; border-left:none; border-right:1pt solid windowtext; border-top:none"><p style="margin-left:0; margin-right:0; text-align:center"><span>9 瓦</span></p></td></tr><tr><td style="border-bottom:1pt solid windowtext; border-image:initial; border-left:1pt solid windowtext; border-right:1pt solid windowtext; border-top:none"><p style="margin-left:0; margin-right:0; text-align:center"><strong><span>外形尺寸</span></strong></p></td><td style="border-bottom:1pt solid windowtext; border-image:initial; border-left:none; border-right:1pt solid windowtext; border-top:none"><p style="margin-left:0; margin-right:0; text-align:center"><span>标准半高卡</span></p></td><td style="border-bottom:1pt solid windowtext; border-image:initial; border-left:none; border-right:1pt solid windowtext; border-top:none"><p style="margin-left:0; margin-right:0; text-align:center"><strong><span>工作温度</span></strong></p></td><td style="border-bottom:1pt solid windowtext; border-image:initial; border-left:none; border-right:1pt solid windowtext; border-top:none"><p style="margin-left:0; margin-right:0; text-align:center"><span>-25℃--85℃</span></p></td></tr></tbody></table><h4 style="margin-left:0px; margin-right:0px; text-align:justify"><strong><span>CCUSR8116</span></strong><strong><span>配套软件</span></strong><strong><span>：</span></strong></h4><p style="color:rgba(0, 0, 0, 0.9); margin-left:0; margin-right:0; text-align:justify"><span>管理软件套件主要包含 BIOS、操作系统、BMC 三个环境下驱动和软件。</span></p><p style="color:rgba(0, 0, 0, 0.9); margin-left:0; margin-right:0; text-align:justify"><span><strong><span>BIOS</span></strong><strong><span>：</span></strong><span>BIOS 固件升级工具、BIOS 命令行配置工具、BIOS UEFI 人机界面工具。</span></span></p><p style="color:rgba(0, 0, 0, 0.9); margin-left:0; margin-right:0; text-align:justify"><span><strong><span>操作系统：</span></strong><span>驱动软件、命令行界面阵列管理工具、基于 Web 的图形化阵列管理工具。</span></span></p><p style="color:rgba(0, 0, 0, 0.9); margin-left:0; margin-right:0; text-align:justify"><span><strong><span>BMC</span></strong><strong><span>：</span></strong><span>查询和配置 API。</span></span></p><p style="color:rgba(0, 0, 0, 0.9); margin-left:0; margin-right:0; text-align:justify"><img alt="" height="211" src="https://oscimg.oschina.net/oscnet/up-d80c654f89929a5968d6e23453490c0ae4d.png" width="500" referrerpolicy="no-referrer"></p><p><span>目前整套方案已经适配测试的国产服务器主机平台有海光、龙芯、飞腾、申威、兆芯等；国产操作系统有麒麟、UOS；国产 BIOS 有昆仑、百敖。</span></p><p><span>公告称，「公司上述产品方案的推出实现了同类产品的全国产化替代，可广泛应用于海量数据存储、AI 计算加速、企业关键应用、边缘计算、视频流媒体和网络应用等服务器产品，特别是信创领域相关服务器产品。」</span></p></div>
                                    ]]>
            </description>
            <pubDate>Sun, 17 Dec 2023 10:45:00 GMT</pubDate>
            <guid isPermaLink="false">https://www.oschina.net/news/271622</guid>
            <link>https://www.oschina.net/news/271622</link>
            <author>
                <![CDATA[来源: 投稿]]>
            </author>
        </item>
        <item>
            <title>
                <![CDATA[腾讯云捐赠 OpenTenBase 数据库软件，共建国产基础软件新生态]]>
            </title>
            <description>
                <![CDATA[<div class="content"><p style="text-align:justify"><span><span><span><span><span style="color:#333333"><span><span><span><span style="color:#000000">12 月 16 日，在 2023 开放原子开发者大会上，腾讯云宣布将企业级分布式数据库 TDSQL 的社区发行版 OpenTenBase 捐赠给开放原子基金会，通过开源共创的方式，与上下游产业链以及开发者共同打造繁荣数据库技术生态。</span></span></span></span></span></span></span></span></span></p><p style="text-align:justify"><span><span><span><span><span style="color:#333333"><span><span><span><span style="color:#000000">OpenTenBase 目前已在腾讯社交、游戏、广告、金融等内部业务及外部商用场景下打磨 10 年以上，可完美适用于拥有海量数据、高并发、高 HTAP，以及分布式事务能力的应用场景。</span></span></span></span></span></span></span></span></span></p><p style="text-align:justify"><span><span><span><span><span style="color:#333333"><span><span><span><span style="color:#000000">据了解，这是继编译器软件 OpenKona JDK，以及全链路自主演进的操作系统 OpenCloudOS 之后，腾讯捐赠的又一重磅基础软件项目。</span></span></span></span></span></span></span></span></span></p><p style="text-align:center"><img height="227" src="https://oscimg.oschina.net/oscnet/up-6e8f6de3ceea50b20299f7571c2c3e08b52.png" width="600" referrerpolicy="no-referrer"></p><p style="text-align:justify"><span><span><span><span><span style="color:#333333"><span><span><span><span style="color:#000000">开放原子开源基金会秘书长冯冠霖表示：「很高兴看到腾讯能够把多年研发打磨、通过海量业务场景考验的基础软件数据库项目 OpenTenBase 开源并捐赠到基金会，未来，基金会将秉持中立开放的态度，与业界一起将 OpenTenBase 打造成为具有全球影响力的优秀开源项目。」</span></span></span></span></span></span></span></span></span></p><p style="text-align:justify"><span><span><span><span><span style="color:#333333"><span><span><span><span style="color:#000000">数据库作为计算机三大基础软件之一,向下可充分发挥硬件算力,向上支撑上层的应用需求,是信息系统高效运行的关键基础。腾讯云数据库研发总经理潘安群表示，OpenTenBase 数据库在技术上填补了业内基于 PostgreSQL 的开源分布式 OLTP 系统空白，并且集 HTAP 双引擎、分布式事务一致性、高 SQL 兼容度、复杂查询等技术能力于一身，能够为企业数字化转型提供强有力支撑。</span></span></span></span></span></span></span></span></span></p><p style="text-align:justify"><span><span><span><span><span style="color:#333333"><span><span><span><span style="color:#000000">比如，在引擎方面，OpenTenBase 同时支持 OLTP（在线交易处理）和 OLAP（在线分析处理）能力，能够有效降低业务架构复杂度和成本；在事务一致性方面，引入全局事务管理节点来管理分布式事务，通过分布式事务一致性技术来保证在全分布式环境下的事务一致性；在兼容性方面，高度兼容 PostgreSQL 版本和 Oracle 版本；在查询方面则全新开发分布式查询优化器，可将复杂查询的性能提升十倍以上。</span></span></span></span></span></span></span></span></span></p><p style="text-align:justify"><span><span><span><span><span style="color:#333333"><span><span><span><span style="color:#000000">腾讯云数据库 TDSQL 近年来在多个领域取得重要突破，在性能上，今年 3 月刷新 TPC-C 世界记录，每分钟事务处理数达到 8.14 亿；在最新的 IDC 报告中，位居中国分布式关系型数据库「领导者」类别，并在市场份额上取得国内第一的成绩。</span></span></span></span></span></span></span></span></span></p><p style="text-align:justify"><span><span><span><span><span style="color:#333333"><span><span><span><span style="color:#000000">腾讯云数据库总经理王义成介绍，TDSQL 已涵盖金融级分布式、云原生、分析型等多引擎融合的完整数据库产品体系，提供业界领先的金融级高可用、存算分离、数据仓库、企业级安全等能力。未来会持续投入和突破数据库核心技术，打造更加健康可持续发展的数据库生态和开源社区，为企业数字化转型提供长久动力。</span></span></span></span></span></span></span></span></span></p><p style="text-align:justify"><span><span><span><span><span style="color:#333333"><span><span><span><span style="color:#000000">腾讯是开源技术的坚定推进者和建设者，多年来一直不断推动更底层更重磅的技术对外开放。截至目前，腾讯已经对外开源了 170 余个项目，在全球企业开源榜位居前十，获得了超过 47 万的开发者关注和点赞。在本次峰会上，腾讯获颁「开放原子校源行杰出合作伙伴」「白金捐赠人」「三年杰出贡献人」「开源安全委员会年度贡献单位」等多项大奖，并参与开源人才教育、操作系统创新、AI 数据存储、木兰峰会等多个分论坛。</span></span></span></span></span></span></span></span></span></p><p style="text-align:justify"><span><span><span><span><span style="color:#333333"><span><span><span><span style="color:#000000">未来，腾讯云将秉持开放、开源战略，持续打磨技术能力，携手开放原子开源基金会、广大开发者和各行业合作伙伴，推动我国关键数字基础设施加速突破。</span></span></span></span></span></span></span></span></span></p></div>
                                    ]]>
            </description>
            <pubDate>Sun, 17 Dec 2023 08:44:00 GMT</pubDate>
            <guid isPermaLink="false">https://my.oschina.net/u/3859945/blog/10322307</guid>
            <link>https://my.oschina.net/u/3859945/blog/10322307</link>
            <author>
                <![CDATA[原创]]>
            </author>
        </item>
        <item>
            <title>
                <![CDATA[浅谈 Socket.D 与响应式编程]]>
            </title>
            <description>
                <![CDATA[<div class="content"><h2>一、Socket.D 的主要特性</h2><p style="color:#24292e; text-align:start">首先，<a href="https://gitee.com/noear/socketd">Scoket.D</a><span>&nbsp;</span>是高效一个二进制的网络通讯协议（官方的讲法是：基于事件和语义消息流的网络应用协议），能够满足很多场景下使用。其次，Scoket.D 是温和的响应式（采用回调风格）。</p><h3>1、三种通讯模式</h3><ul><li>send 只是发送（发送后不管了）</li></ul><p style="color:#24292e; text-align:start">发送一个请求，无需为这个请求发送答复报文。适用于监控埋点，日志上报等，这种场景下无需回执，丢失几个请求无伤大雅。</p><ul><li>sendAndRequest（发送并请求，要求一个「答复」）</li></ul><p style="color:#24292e; text-align:start">发送一条请求消息，响应方收到后发回一个答复消息。传统的 HTTP 就是典型的 sendAndRequest。</p><ul><li>sendAndSubscribe（发送并订阅，可接收 N 个「答复」）</li></ul><p style="color:#24292e; text-align:start">发送一个订阅消息，响应方收到后发回 N 个答复报文。传统的 MQ 是典型的 sendAndSubscribe。</p><h3>2、双向监听双向会话</h3><p style="color:#24292e; text-align:start">Server 可以监听 Client 发来的消息；Client 也可以监听 Server 发来的消息。形成的 Session，更是可以相互对发消息。</p><h3>3、其它</h3><ul><li>二进制协议，紧凑高效</li><li>有语议、有事件</li><li>多路复用</li><li>灵活的传输层切换: TCP/UDP/WebSocket 等</li><li>支持自动分等高级特性</li></ul><h3>4、与其它协议对比</h3><p style="color:#24292e; text-align:start">感观上像是各协议的优点提纯。简单且强大，非常有未来感！</p><table cellspacing="0" style="-webkit-text-stroke-width:0px; background-color:#ffffff; border-collapse:collapse; border-spacing:0px; box-sizing:border-box; color:#24292e; display:block; font-family:-apple-system,&quot;system-ui&quot;,&quot;Segoe UI&quot;,Helvetica,Arial,sans-serif,&quot;Apple Color Emoji&quot;,&quot;Segoe UI Emoji&quot;,&quot;Segoe UI Symbol&quot;; font-size:16px; font-style:normal; font-variant-caps:normal; font-variant-ligatures:normal; font-weight:400; letter-spacing:normal; margin-bottom:16px; margin-top:0px; orphans:2; overflow:auto; text-align:start; text-decoration-color:initial; text-decoration-style:initial; text-decoration-thickness:initial; text-transform:none; white-space:normal; widows:2; width:960px; word-spacing:0px"><tbody><tr><th>对比项目</th><th>socket.d</th><th>http</th><th>websocket</th><th>rsocket</th><th>socket.io</th></tr></tbody><tbody><tr><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">发消息（Qos0）</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">有</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">无</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">有</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">有</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">有</td></tr><tr><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">发送并请求（Qos1）</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">有</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">有</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">无</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">有</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">无</td></tr><tr><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">发送并订阅</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">有</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">无</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">无</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">有</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">无</td></tr><tr><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">答复或响应</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">有</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">有</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">无</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">有</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">无</td></tr><tr><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">单连接双向通讯</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">有</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">无</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">有 (不便)</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">有</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">有 (不便)</td></tr><tr><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">数据分片</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">有</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">/</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">无</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">有</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">有</td></tr><tr><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">断线自动重连</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">有</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">/</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">无</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">有</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">有</td></tr><tr><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">有元信息</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">有</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">有</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">无</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">有</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">无</td></tr><tr><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">有事件（或路径）</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">有</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">有</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">无</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">无</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">有</td></tr><tr><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">有流（或消息关联性）</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">有</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">无</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">无</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">有</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">无</td></tr><tr><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">Broker 模式集群</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">有</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">无</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">无</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">有</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">无</td></tr><tr><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">异步</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">异步</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">同步</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">异步</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">异步</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">异步</td></tr><tr><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">接口体验</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">经典</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">经典</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">经典</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">响应式 (复杂)</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">经典</td></tr><tr><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">基础传输协议</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">tcp, udp, ws</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">tcp</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">http</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">tcp, udp, ws</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">ws</td></tr></tbody></table><h2>二、Socket.D 的内部实现</h2><h3>1、帧的设计</h3><p style="color:#24292e; text-align:start">socket.d 是以帧为单位进行传输。大的帧还会自动分片成小帧进行传输（超过 16MB 自动分裂重组，大小可配置），到达接收端后再自动聚合。</p><ul><li>帧的逻辑结构</li></ul><pre><code class="language-css">frame: {flag, message: {sid, event, entity: { metaString, data}}}
</code></pre><p style="color:#24292e; text-align:start">帧的数据逻辑结构：帧里有标志和消息；消息里有流标识、事件、实体；实体里有元信息字符串和数据。</p><ul><li>完整的标准帧码</li></ul><pre><code class="language-css"><span style="color:#986801">[len:int]</span><span style="color:#986801">[flag:int]</span><span style="color:#986801">[sid:str(&lt;64)]</span><span style="color:#986801">[\n]</span><span style="color:#986801">[event:str(&lt;512)]</span><span style="color:#986801">[\n]</span><span style="color:#986801">[metaString:str(&lt;4k)]</span><span style="color:#986801">[\n]</span><span style="color:#986801">[data:byte(&lt;16m)]</span></code></pre><table cellspacing="0" style="-webkit-text-stroke-width:0px; background-color:#ffffff; border-collapse:collapse; border-spacing:0px; box-sizing:border-box; color:#24292e; display:block; font-family:-apple-system,&quot;system-ui&quot;,&quot;Segoe UI&quot;,Helvetica,Arial,sans-serif,&quot;Apple Color Emoji&quot;,&quot;Segoe UI Emoji&quot;,&quot;Segoe UI Symbol&quot;; font-size:16px; font-style:normal; font-variant-caps:normal; font-variant-ligatures:normal; font-weight:400; letter-spacing:normal; margin-bottom:16px; margin-top:0px; orphans:2; overflow:auto; text-align:start; text-decoration-color:initial; text-decoration-style:initial; text-decoration-thickness:initial; text-transform:none; white-space:normal; widows:2; width:960px; word-spacing:0px"><tbody><tr><th>字段</th><th>类型</th><th>大小</th><th>说明</th></tr></tbody><tbody><tr><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">len</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">int</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">4 字节</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">帧长度（包括它自己的 4 字节占位）</td></tr><tr><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">flag</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">int</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">4 字节</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">标志（相当于协议指令）</td></tr><tr><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">sid</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">String</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">64 字节以内</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">流标识。<code>格式为： guid</code></td></tr><tr><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">event</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">String</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">512 字节以内</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">事件。<code>格式为：可见字符 string</code></td></tr><tr><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">metaString</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">String</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">4Kb 以内</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">元信息字符串。<code>格式为：通用的 uri queryString</code></td></tr><tr><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">data</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">byte[]</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">16Mb 以内</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">数据。<code>格式为： byte[]</code></td></tr></tbody></table><p style="color:#24292e; text-align:start">注意：当使用 udp 传输时，帧长度不能超过 2k （听说，实际不能超过 1.4k ）</p><ul><li>简化的辅助帧码（Ping, Pong, Close），取消了 message 部分</li></ul><pre><code class="language-python">[<span style="color:#c18401">len</span>:<span style="color:#c18401">int</span>][flag:<span style="color:#c18401">int</span>]
</code></pre><h3>2、数据实体——Entity</h3><p style="color:#24292e; text-align:start">基于帧之上，一般开发者接触到的是 Entity, 它类似一个 HTTP 报文，可以是一个 Request，也可以是一个 Response。由两个部分组成：</p><ul><li>MetaString 元信息字符串，类似 HTTP 的 header。格式：字符串</li><li>Data 数据，类似 HTTP 的 body。格式：二进制</li></ul><h3>3、玩法</h3><p style="color:#24292e; text-align:start">Socket.D 有很多玩法，传统的 RPC 自然不在话下，用来做 IM 也未尝不可，开发 MQ 也很简单（<a href="https://gitee.com/noear/folkmq">FolkMQ</a><span>&nbsp;</span>就是用它开发的）。某些特性也可以用来做代理或者网络穿透。 IoT 的场景，比如小明的家里有个智能空调，小明想在外面通过手机 APP 来控制空调开关，如何优雅地描述这个控制问题？最精炼的解决方案就是"小明调用空调上开关的 API"。</p><p style="color:#24292e; text-align:start">另外最经典的玩法就是 Broker 了，Broker 类似一种「软路由」的方案，可以让服务的发布访问变得简单。发布服务只要连接到 Broker，调用方通过反向请求的方式来让 Broker 透明转发即可，摒弃了传统的注册中心，端口管理等常见的服务治理手段。</p><h3>4、关于 Socket.D Broker</h3><p style="color:#24292e; text-align:start">Broker 有很多优势，发布服务不需要监听端口，无需 Sidecar，服务注册变得简单，无需 zk、etcd 之类，LoadBalance 变得简单，也更安全，没监听端口后很难攻击。也有很多劣势，网络上多了一跳，性能是有一定损耗的，Broker 是中心化设计，类似我们平时全局的 Nginx 一样，但是 Broker 的优雅启停显然更加复杂，受限于整个 Broker 集群的瓶颈等等。上帝为你关闭了一扇门，就一定会为你打开一扇窗。</p><h2>三、响应式编程，难吗？</h2><p style="color:#24292e; text-align:start">响应式编程是个老话题了，它早已无处不在，甚至你在 Excel 里 SUM 求和，本质上也是种响应式的思维。响应式本质上就是响应变化的数据流。Socket.D 这个协议本身就是以响应式之名，将其扩展到网络层面。</p><p style="color:#24292e; text-align:start">但是，响应式接口对一般程序员，不太友好。Socket.D 是响应式，但采用"经典的回调界面"。</p><h2>四、总结</h2><p style="color:#24292e; text-align:start">Socket.D 是个很有趣的网络协议，未来应该会普及流行。它解决问题的思路和设计很令人耳目一新。如果大家有兴趣，可以去它的官网了解下。</p></div>
                                    ]]>
            </description>
            <pubDate>Sun, 17 Dec 2023 07:12:00 GMT</pubDate>
            <guid isPermaLink="false">https://www.oschina.net/news/271572</guid>
            <link>https://www.oschina.net/news/271572</link>
            <author>
                <![CDATA[来源: 投稿]]>
            </author>
        </item>
        <item>
            <title>
                <![CDATA[HashiCorp 联合创始人离职，准备涉足新领域]]>
            </title>
            <description>
                <![CDATA[<div class="content"><p><span style="color:#000000">在&nbsp;HashiCorp 成立十一周年之际，公司联合创始人 Mitchell Hashimoto 面向全体职员及社区发送了一封<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fwww.hashicorp.com%2Fblog%2Fmitchell-reflects-as-he-departs-hashicorp" target="_blank">告别信</a>，宣布他将从 HashiCorp 离职。</span></p><p><span style="color:#000000">「我最近刚庆祝了 HashiCorp 成立 11 周年，回顾过去的十年，我觉得没有比这更好的方式来度过我的这一段人生了。」</span></p><p><span style="color:#000000">HashiCorp 由 Hashimoto 和 Armon Dadgar（现任首席技术官）于 2012 年创立。现任首席执行官是于 2016 年加入公司的 Dave McJannet，此前曾在 Hortonworks、VMware 和微软任职。</span></p><p><span style="color:#000000"><img alt="" height="332" src="https://oscimg.oschina.net/oscnet/up-18a06853b25d3cf15c7d5439600cbec5df6.webp" width="500" referrerpolicy="no-referrer"></span></p><p><em><span style="color:#737578">Armon、Mitchell 和 Dave</span></em></p><p><span style="color:#000000">Hashimoto 透露，离开 HashiCorp 是他长期以来一直在思考和计划的事情。他一直以来的愿景就是建立一家不需要自己负责日常运营、且能够有其他领导者接任的公司。因此，他在 2016 年辞去了首席执行官一职，并于 2021 年离开领导团队和董事会。</span></p><p><span style="color:#000000">今年 9 月份，他迎来了他的第一个孩子，也正是这一契机促使他做出离开&nbsp;HashiCorp 的决定。「云自动化和基础设施工具的世界仍然充满机遇和增长，但在专门从事这一领域的工具工作近 15 年之后，我已经准备好涉足新的领域。」</span></p><p><span style="color:#000000">Hashimoto 回顾了 HashiCorp 一路走来的经历，并向&nbsp;<span style="background-color:#ffffff">McJannet 和 Dadgar 表示了敬意。GitHub 2023 年 Octoverse 状态报告指出，HashiCorp 配置语言的采用率持续增长，同比增长 36%。</span></span></p><p><span style="color:#000000"><span style="background-color:#ffffff">外界对&nbsp;</span>Hashimoto 的离开各有猜测。近段时间，该公司因变更许可协议的事情引起了诸多纷争。一位业内人士认为，公司创始人的名字是公司品牌的一部分，他的离开很少会预示着一些正向的发展。HashiCorp 则拒绝对此发表评论。</span></p><p><strong><span style="color:#000000">相关阅读：</span></strong></p><ul><li><a href="https://www.oschina.net/news/253275/hashicorp-adopts-business-source-license" target="news">HashiCorp 核心产品变更开源协议，未来将采用 BSL</a></li><li><a href="https://www.oschina.net/news/255700/opentf-fork-terraform" target="news">HashiCorp 采用 BSL 后，社区创建 Terraform 分支 OpenTF</a></li><li><a href="https://www.oschina.net/news/270477/hashicorp-vault-openbao-fork" target="news">HashiCorp 采用 BSL 后续，Linux 基金会孵化 Vault 开源替代品</a></li></ul></div>
                                    ]]>
            </description>
            <pubDate>Sun, 17 Dec 2023 07:01:00 GMT</pubDate>
            <guid isPermaLink="false">https://www.oschina.net/news/271569/hashimoto-departs-hashicorp</guid>
            <link>https://www.oschina.net/news/271569/hashimoto-departs-hashicorp</link>
            <author>
                <![CDATA[来源: OSCHINA]]>
            </author>
        </item>
        <item>
            <title>
                <![CDATA[🔥周热点 | 商汤科技创始人汤晓鸥离世；C#有望成为年度编程语言..........]]>
            </title>
            <description>
                <![CDATA[回顾一周热门资讯。2023.12.11-2023.12.17]]>
            </description>
            <pubDate>Sun, 17 Dec 2023 07:01:00 GMT</pubDate>
            <guid isPermaLink="false">https://mp.weixin.qq.com/s?__biz=MzA4OTI5NjUwOA==&#38;mid=2649094056&#38;idx=1&#38;sn=57418822bd640c45ac54ed573c95699c&#38;chksm=880c4cbbbf7bc5ad23ac2df6cfe74b4f06bb7f47b1428060246e36d8dffce0dad7e26fddef61&#38;token=1144454168&#38;lang=zh_CN#rd</guid>
            <link>https://mp.weixin.qq.com/s?__biz=MzA4OTI5NjUwOA==&#38;mid=2649094056&#38;idx=1&#38;sn=57418822bd640c45ac54ed573c95699c&#38;chksm=880c4cbbbf7bc5ad23ac2df6cfe74b4f06bb7f47b1428060246e36d8dffce0dad7e26fddef61&#38;token=1144454168&#38;lang=zh_CN#rd</link>
        </item>
        <item>
            <title>
                <![CDATA[要解锁小米手机 BL？先做一份 Java 程序员面试题]]>
            </title>
            <description>
                <![CDATA[<div class="content"><p>小米最近启用了新的解锁 Bootloader 流程，除了要去小米社区获取经验（要求社区等级达到 5），还需要参与答题。</p><p>答题要求：</p><blockquote><ol><li>答题开放时间为：工作日上午 10 点 - 下午 18 点（法定节假日为答题系统维护时间，请参阅」近期答题系统维护时间」），还请合理安排答题时间。 [近期答题系统维护时间：2023 年 12 月 16 日 - 17 日、2023 年 12 月 23 - 24 日、2023 年 12 月 30 日 - 2024 年 1 月 1 日]</li><li>答题成绩每周三上午 10:59 失效，如答题通过，请务必在周三中午 11 点前完成申请，避免成绩失效影响申请</li><li>用户即使满足解锁申请条件，如在社交媒介（包括但不限于各论坛、微博、微信、QQ 群等）对小米有过恶意诋毁、谩骂、造谣等情况，申请不予通过</li><li>用户即使满足解锁申请条件，如在申请时不填写申请理由、或使用 AI 生成申请理由、或申请理由出现过辱骂威胁等内容，申请不予通过</li><li>用户即使满足解锁申请条件，但出现被判定为作弊的行为（包括但不限于找人「代答」、使用脚本或工具达到申请条件等），或有其他违反小米账号使用协议的相关情形，申请不予通过</li></ol></blockquote><p>可以看到，答题有时间限制，而且随着时间推移小米不停地更新问题库。新问题甚至加上了排列组合速算：</p><p><img alt="" src="https://oscimg.oschina.net/oscnet/up-45e03e2ab55ddf67fdbd42f7b1b5b02becd.png" referrerpolicy="no-referrer"></p><p>下面这种题目的难度确定不是雷总招 Java 程序员用的面试题吗？JVM 垃圾回收机制都整上了……</p><p><img src="https://oscimg.oschina.net/oscnet/up-33b487bb3fc7e05ce34ab6bed8fabaf2b4a.png" referrerpolicy="no-referrer"><img height="1484" src="https://oscimg.oschina.net/oscnet/up-246ac5dd82b0862a70fe3d11a7cda949a3d.png" width="892" referrerpolicy="no-referrer"><img src="https://oscimg.oschina.net/oscnet/up-fa8da0795c61974da6d4f0554fabd9010a9.png" referrerpolicy="no-referrer"></p><p>据了解，小米官方在 11 月<u><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fweb.vip.miui.com%2Fpage%2Finfo%2Fmio%2Fmio%2Fdetail%3FpostId%3D41559680" target="_blank">宣布 Bootloader 解锁权限变更</a></u>：</p><blockquote><p><img src="https://oscimg.oschina.net/oscnet/up-4f489c01770aa3a174774f20cafe2abdb6b.png" referrerpolicy="no-referrer"></p></blockquote><p>总结下来就是：</p><ul><li>小米社区的等级为 5 级</li><li>完成实名验证</li><li>参与答题</li><li>每年最多只能解锁 3 台小米设备的 Bootloader</li><li>引导加载程序解锁仅在解锁之日起一年内有效，之后您必须为该特定小米设备重新解锁引导加载程序一年</li><li>申请解锁​​Bootloader 权限时，72 小时内不能使用该设备</li><li>如果引导加载程序解锁，HyperOS 设备将不会收到更新（这一特定更新也适用于全球用户）</li></ul><p><img height="1660" src="https://oscimg.oschina.net/oscnet/up-adb61862206cae6b8a931759672e13280d0.png" width="776" referrerpolicy="no-referrer"><img src="https://oscimg.oschina.net/oscnet/up-893e84a9c2497eb96f8e7a3c32142572cbe.png" referrerpolicy="no-referrer"></p></div>
                                    ]]>
            </description>
            <pubDate>Sun, 17 Dec 2023 05:52:00 GMT</pubDate>
            <guid isPermaLink="false">https://www.oschina.net/news/271547</guid>
            <link>https://www.oschina.net/news/271547</link>
            <author>
                <![CDATA[来源: OSCHINA]]>
            </author>
        </item>
        <item>
            <title>
                <![CDATA[开源软件无法通过「更低价」获取市场]]>
            </title>
            <description>
                <![CDATA[<div class="content"><p>Lago 是一个用于基于计量和使用量的开源计费工具，提供了开源（自己本地部署）和 SaaS 版本。Lago 是专门针对处理复杂计费逻辑场景打造的低代码工具，用户可以直接使用 UI 或 API，来创建计费指标和计划。</p><blockquote><p><img src="https://oscimg.oschina.net/oscnet/up-e25d1d8220a67a57066c2312fa80bdc6ff4.png" referrerpolicy="no-referrer"></p><p>来源：<em><u><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fgithub.com%2Fgetlago%2Flago%2Fwiki%2FOpen-Source-does-not-win-by-being-cheaper" target="_blank">https://github.com/getlago/lago/wiki/Open-Source-does-not-win-by-being-cheaper</a></u></em></p></blockquote><p>Lago 联合创始人发表文章《<u><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fgithub.com%2Fgetlago%2Flago%2Fwiki%2FOpen-Source-does-not-win-by-being-cheaper" target="_blank"><em>Open Source does not win by being cheaper</em></a></u>》探讨了开源软件的竞争优势。正如标题所言，她认为<strong>开源软件无法通过「更低价」取胜</strong>——迎合价格敏感的人反而是一种失败。</p><p>因为开源软件优势在<strong>于灵活性、透明度、安全性、数据可移植性以及持续性</strong>。</p><ul><li>开源软件使得组织能够快速整合新技术到其技术栈中，相比传统方法，团队可以更快地将开源软件连接到他们每天使用的其他工具上。这种灵活性使得开发团队能够根据需要构建完美的工具，而不是被迫改变他们的工作方式以适应不灵活的专有工具。</li><li>开源软件使得组织能够掌控自己的安全性，因为所有人都可以彻底检查源代码，这样漏洞就能更快地得到修复，从而不断增强软件的安全性。在远程工作的时代，开源软件也能够促进高信任的远程协作，保护敏感数据的安全。</li><li>开源软件能够避免供应商锁定，使得数据可移植。相比专有软件，开源软件提供了避免供应商锁定的自由和灵活，使得组织能够自由地携带数据到任何他们想去的地方。 &nbsp;</li><li>开源软件还具有可持续性。相比专有软件可能会因为公司破产或者推出新产品而停止更新，开源软件由一个庞大的社区支持，因此不太可能停止维护。即使社区停止维护，你也有自由访问和修改源代码的权利。</li></ul></div>
                                    ]]>
            </description>
            <pubDate>Sun, 17 Dec 2023 04:15:00 GMT</pubDate>
            <guid isPermaLink="false">https://www.oschina.net/news/271534</guid>
            <link>https://www.oschina.net/news/271534</link>
            <author>
                <![CDATA[来源: 投稿]]>
            </author>
        </item>
        <item>
            <title>
                <![CDATA[State of PostgreSQL 2023 报告解读]]>
            </title>
            <description>
                <![CDATA[<div class="content"><div class="rich_media_content js_underline_content
                       autoTypeSetting24psection
            " id="js_content"><section style="margin-right: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;"><span style="outline: 0px;font-size: 16px;letter-spacing: 0.5px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">基于 PostgreSQL 内核的时序数据库厂商 Timescale 发布了一年一度的 State of Postgres 2023 报告。</span><br style="outline: 0px;"></section><section style="margin-right: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><img class="rich_pages wxw-img" data-height="491" data-imgfileid="100028228" data-ratio="0.43796296296296294" data-type="png" data-w="1080" data-width="1122" src="https://oscimg.oschina.net/oscnet/cd5af3fa-a9bf-434f-83f2-c05037fe9543.png" style="outline: 0px;width: 677px !important;visibility: visible !important;" referrerpolicy="no-referrer"></section><h1 style="margin-right: 8px;margin-bottom: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><strong style="outline: 0px;"><span style="outline: 0px;letter-spacing: 0.5px;font-size: 20px;"><img class="rich_pages wxw-img" data-imgfileid="100028227" data-ratio="0.10925925925925926" data-s="300,640" data-type="png" data-w="1080" src="https://oscimg.oschina.net/oscnet/501f9254-8909-4823-ab73-fc5268cf32eb.png" style="outline: 0px;letter-spacing: 0.578px;width: 677px !important;visibility: visible !important;" referrerpolicy="no-referrer"></span></strong></h1><span id="OSC_h1_1"></span><h1 style="margin-right: 8px;margin-bottom: 16px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><strong style="outline: 0px;"><span style="outline: 0px;letter-spacing: 0.5px;font-size: 20px;">Timescale 介绍</span></strong></h1><section style="margin-right: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><span style="outline: 0px;font-size: 16px;letter-spacing: 0.5px;">简单先介绍一下 Timescale 这家公司的历史。它最早是提供了一个 PG 的插件，引入了 Hypertable 这个概念，来高效地处理时序数据，后来提供了托管的云服务。今年又紧跟潮流陆续引入了 Serverless 和 Vector。</span></section><section style="margin-right: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><img class="rich_pages wxw-img" data-height="426" data-imgfileid="100028231" data-ratio="0.287962962962963" data-type="png" data-w="1080" data-width="1478" src="https://oscimg.oschina.net/oscnet/a7d587c3-0b0e-4aab-baa3-951ed19898a2.png" style="outline: 0px;width: 677px !important;visibility: visible !important;" referrerpolicy="no-referrer"></section><section style="margin-right: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><span style="outline: 0px;font-size: 16px;letter-spacing: 0.5px;">Timescale 也在今年做了一次品牌升级，笔者觉得是比较成功的。Logo 有辨识度且含义贴切，整体的风格也契合公司的阶段。在商业能力这块，Timescale 应该是目前 Postgres 阵营里最成熟的。不过 Timescale 本身做的是基于 Postgres 的时序数据库而不是 Postgres 通用数据库，所以它也要面临其他专门做时序数据库的竞争。</span></section><section style="margin-right: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><img class="rich_pages wxw-img" data-height="511" data-imgfileid="100028230" data-ratio="0.5273477812177503" data-type="png" data-w="969" data-width="969" src="https://oscimg.oschina.net/oscnet/1f9e8c6a-72d2-464e-a6ab-35cd8c64987d.png" style="outline: 0px;width: 677px !important;visibility: visible !important;" referrerpolicy="no-referrer"></section><section style="margin-right: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><span style="outline: 0px;font-size: 16px;letter-spacing: 0.5px;">Wiki 上显示的发布时间应该是错误的，2017 年笔者在 Google Cloud SQL 负责 Postgres 时, Timescale 团队就接触过我们希望可以引入他们的插件。当时从成熟度的考虑，并没有接纳。不过有点意外的是，现在 Google Cloud SQL 上仍然没有上架 Timescale 插件。</span></section><section style="margin-right: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><img class="rich_pages wxw-img" data-height="192" data-imgfileid="100028229" data-ratio="0.24" data-type="png" data-w="800" data-width="800" src="https://oscimg.oschina.net/oscnet/0fd31385-064f-4dc5-a1d1-bba6ce8e6b3c.png" style="outline: 0px;width: 677px !important;visibility: visible !important;" referrerpolicy="no-referrer"></section><h1 style="margin-right: 8px;margin-bottom: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><span style="outline: 0px;letter-spacing: 0.5px;"><img class="rich_pages wxw-img" data-imgfileid="100028236" data-ratio="0.10925925925925926" data-s="300,640" data-type="png" data-w="1080" src="https://oscimg.oschina.net/oscnet/ad316e21-e120-445c-8d6f-6ef5bd28e852.png" style="outline: 0px;letter-spacing: 0.578px;width: 677px !important;visibility: visible !important;" referrerpolicy="no-referrer"></span></h1><span id="OSC_h1_2"></span><h1 style="margin-right: 8px;margin-bottom: 16px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><span style="outline: 0px;letter-spacing: 0.5px;font-size: 20px;"><strong style="outline: 0px;">报告整体</strong></span></h1><section style="margin-right: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><span style="outline: 0px;font-size: 16px;letter-spacing: 0.5px;">首先这是一份相对有偏向性的报告，本身 Timescale 的立场就使得报告的受众群体会是 Postgres 的使用者。比如说下面这个问题的答案。</span></section><section style="margin-right: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><img class="rich_pages wxw-img" data-height="431" data-imgfileid="100028234" data-ratio="0.49032992036405004" data-type="png" data-w="879" data-width="879" src="https://oscimg.oschina.net/oscnet/a668922b-94d7-430c-a764-3493f797369a.png" style="outline: 0px;width: 677px !important;visibility: visible !important;" referrerpolicy="no-referrer"></section><section style="margin-right: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><span style="outline: 0px;font-size: 16px;letter-spacing: 0.5px;">Timescale 从 2019 开始做 State of PostgreSQL，今年的调研持续 6 周，报告结果从 888 份问卷中汇总而成。</span></section><section style="margin-right: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><img class="rich_pages wxw-img" data-height="54" data-imgfileid="100028232" data-ratio="0.0819423368740516" data-type="png" data-w="659" data-width="659" src="https://oscimg.oschina.net/oscnet/1e0c2b22-819c-45af-abaa-34d7b547f49d.png" style="outline: 0px;width: 659px !important;visibility: visible !important;" referrerpolicy="no-referrer"></section><section style="margin-right: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><span style="outline: 0px;font-size: 16px;letter-spacing: 0.5px;">相比于我们之前做过的<a target="_blank" href="https://www.oschina.net/action/GoToLink?url=http%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzkzMjI2MDY5OQ%3D%3D%26mid%3D2247506004%26idx%3D1%26sn%3Dc6eb5cb91a61e78ddd4d2d3948b94e28%26chksm%3Dc25ce660f52b6f76de08b19c4e3d032b9733d65efb9dfe26072ff29d87b2b2e5a254d1c59d2f%26scene%3D21%23wechat_redirect" textvalue="谷歌 DORA" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1" style="outline: 0px;color: var(--weui-LINK);-webkit-user-drag: none;cursor: pointer;">谷歌 DORA</a>&nbsp;以及&nbsp;<a target="_blank" href="https://www.oschina.net/action/GoToLink?url=http%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzkzMjI2MDY5OQ%3D%3D%26mid%3D2247506451%26idx%3D1%26sn%3D04b3b6f6313f1243eb43fb90a70c1205%26chksm%3Dc25ce427f52b6d31fee26c69a9e5e86d064aeead057165bae50ef1747bd2dfcd2be85e5bcda3%26scene%3D21%23wechat_redirect" textvalue="JetBrains 开发者报告" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1" style="outline: 0px;color: var(--weui-LINK);-webkit-user-drag: none;cursor: pointer;">JetBrains 开发者报告</a>，Timescale 报告样本数要小许多，一是因为 Timescale 还没有那么大的影响力，二是 PostgreSQL 只是整个开发者群体下的数据库领域下的一个垂直领域。</span></section><h1 style="margin-right: 8px;margin-bottom: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><span style="outline: 0px;letter-spacing: 0.5px;"><img class="rich_pages wxw-img" data-imgfileid="100028233" data-ratio="0.10925925925925926" data-s="300,640" data-type="png" data-w="1080" src="https://oscimg.oschina.net/oscnet/3366c12e-fe40-426c-85c4-1ddd4eab39a3.png" style="outline: 0px;letter-spacing: 0.578px;width: 677px !important;visibility: visible !important;" referrerpolicy="no-referrer"></span></h1><span id="OSC_h1_3"></span><h1 style="margin-right: 8px;margin-bottom: 16px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><span style="outline: 0px;letter-spacing: 0.5px;font-size: 20px;"><strong style="outline: 0px;">调研人群</strong></span></h1><section style="margin-right: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><img class="rich_pages wxw-img" data-height="1074" data-imgfileid="100028235" data-ratio="1.2740213523131672" data-type="png" data-w="843" data-width="843" src="https://oscimg.oschina.net/oscnet/85c8e1e0-f192-4498-8f2e-c092d4442c4c.png" style="outline: 0px;width: 677px !important;visibility: visible !important;" referrerpolicy="no-referrer"></section><section style="margin-right: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><span style="outline: 0px;font-size: 16px;letter-spacing: 0.5px;">没有再细分到国家。工作经验分布比较平均，有点意外的，尤其是 10 年以上占了 2/3。</span></section><section style="margin-right: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;"><img class="rich_pages wxw-img" data-galleryid="" data-imgfileid="100028240" data-ratio="0.48703703703703705" data-s="300,640" data-type="png" data-w="1080" src="https://oscimg.oschina.net/oscnet/fdd18ffc-3bc8-4a08-96f2-644460c06f16.png" style="outline: 0px;width: 677px !important;visibility: visible !important;" referrerpolicy="no-referrer"></section><section style="margin-right: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><span style="outline: 0px;font-size: 16px;letter-spacing: 0.5px;">Postgres 基本盘还是后端开发人员。</span></section><h1 style="margin-right: 8px;margin-bottom: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><span style="outline: 0px;letter-spacing: 0.5px;"><img class="rich_pages wxw-img" data-imgfileid="100028237" data-ratio="0.10925925925925926" data-s="300,640" data-type="png" data-w="1080" src="https://oscimg.oschina.net/oscnet/a36affdd-f583-4a4a-8d93-c94650b59189.png" style="outline: 0px;letter-spacing: 0.578px;width: 677px !important;visibility: visible !important;" referrerpolicy="no-referrer"></span></h1><span id="OSC_h1_4"></span><h1 style="margin-right: 8px;margin-bottom: 16px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><span style="outline: 0px;letter-spacing: 0.5px;font-size: 20px;"><strong style="outline: 0px;">选择 PostgreSQL 的原因</strong></span></h1><section style="margin-right: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><img class="rich_pages wxw-img" data-height="639" data-imgfileid="100028238" data-ratio="0.8374836173001311" data-type="png" data-w="763" data-width="763" src="https://oscimg.oschina.net/oscnet/0ed0e918-8ace-42ae-96f5-d0d9c862025d.png" style="outline: 0px;width: 677px !important;visibility: visible !important;" referrerpolicy="no-referrer"></section><section style="margin-right: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><span style="outline: 0px;font-size: 16px;letter-spacing: 0.5px;">开源证书是最大的优势。但这里没有说清楚是相比于使用不同开源证书的 MySQL，还是相比于闭源的数据库。丰富的的功能另一个显著的优势。相对来说选择 Extension 的人没有预想的多。这里最有意思的是 15+ 工作经验的，排序是证书 &gt; 稳定性 &gt; 功能 &gt; ACID。大道至简，返璞归真。</span></section><h1 style="margin-right: 8px;margin-bottom: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><span style="outline: 0px;letter-spacing: 0.5px;"><img class="rich_pages wxw-img" data-imgfileid="100028239" data-ratio="0.10947368421052632" data-s="300,640" data-type="png" data-w="950" src="https://oscimg.oschina.net/oscnet/68d055a2-cd96-46f0-9198-67e3632ded36.png" style="outline: 0px;letter-spacing: 0.578px;width: 677px !important;visibility: visible !important;" referrerpolicy="no-referrer"></span></h1><span id="OSC_h1_5"></span><h1 style="margin-right: 8px;margin-bottom: 16px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><span style="outline: 0px;letter-spacing: 0.5px;font-size: 20px;"><strong style="outline: 0px;">PostgreSQL 的上手体验</strong></span></h1><section style="margin-right: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><img class="rich_pages wxw-img" data-height="799" data-imgfileid="100028241" data-ratio="0.9913151364764268" data-type="png" data-w="806" data-width="806" src="https://oscimg.oschina.net/oscnet/b93f20a5-0e01-44bc-97a0-d1addc9ca49b.png" style="outline: 0px;width: 677px !important;visibility: visible !important;" referrerpolicy="no-referrer"></section><section style="margin-right: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><span style="outline: 0px;font-size: 16px;letter-spacing: 0.5px;">平均水平以上，但谈不上很优秀。PostgreSQL 强大功能的另一面就是上手更有门槛。比如说 Database / Schema / Table 三层以及对应的权限系统，适合大型项目，对小型开发就显得臃肿了。</span></section><h1 style="margin-right: 8px;margin-bottom: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><span style="outline: 0px;letter-spacing: 0.5px;"><img class="rich_pages wxw-img" data-imgfileid="100028242" data-ratio="0.10947368421052632" data-s="300,640" data-type="png" data-w="950" src="https://oscimg.oschina.net/oscnet/c98ae2aa-f829-4205-8b0b-fb214af265b7.png" style="outline: 0px;letter-spacing: 0.578px;width: 677px !important;visibility: visible !important;" referrerpolicy="no-referrer"></span></h1><span id="OSC_h1_6"></span><h1 style="margin-right: 8px;margin-bottom: 16px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><span style="outline: 0px;letter-spacing: 0.5px;font-size: 20px;"><strong style="outline: 0px;">生态和工具</strong></span></h1><section style="margin-right: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><img class="rich_pages wxw-img" data-height="499" data-imgfileid="100028244" data-ratio="0.5802325581395349" data-type="png" data-w="860" data-width="860" src="https://oscimg.oschina.net/oscnet/824110b9-ef61-4c32-876a-0332684230c7.png" style="outline: 0px;width: 677px !important;visibility: visible !important;" referrerpolicy="no-referrer"></section><section style="margin-right: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><span style="outline: 0px;font-size: 16px;letter-spacing: 0.5px;">这个插件的问题有点狡猾，把 favorite 和 most frequently 并在了一起，结果东道主的 timescaledb 就力压 pg_stat_statements 了🤔。</span></section><section style="margin-right: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><img class="rich_pages wxw-img" data-height="555" data-imgfileid="100028243" data-ratio="0.69375" data-type="png" data-w="800" data-width="800" src="https://oscimg.oschina.net/oscnet/f8247ef4-d129-48ed-a4cc-3c28e338a0ae.png" style="outline: 0px;width: 677px !important;visibility: visible !important;" referrerpolicy="no-referrer"></section><section style="margin-right: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><span style="outline: 0px;font-size: 16px;letter-spacing: 0.5px;">DBeaver 在通用数据库客户端里遥遥领先。</span></section><section style="margin-right: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;"><img class="rich_pages wxw-img" data-galleryid="" data-imgfileid="100028245" data-ratio="0.3675925925925926" data-s="300,640" data-type="png" data-w="1080" src="https://oscimg.oschina.net/oscnet/6e69c23e-2d83-4ebb-b659-fc9376670d41.png" style="outline: 0px;width: 677px !important;visibility: visible !important;" referrerpolicy="no-referrer"></section><section style="margin-right: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><span style="outline: 0px;font-size: 16px;letter-spacing: 0.5px;">pgBouncer 依然是最流行的工具，不用连接池的话，很容易造成连接打满。第二常用的就是可视化查询计划工具 Depesz，这个工具也存在好久了，也是开源的，Bytebase 也在 SQL Editor 中集成了。</span></section><section style="margin-right: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><img class="rich_pages wxw-img" data-height="613" data-imgfileid="100028246" data-ratio="0.706221198156682" data-type="png" data-w="868" data-width="868" src="https://oscimg.oschina.net/oscnet/f8dfc64a-fbc1-4842-a091-2d879484363a.png" style="outline: 0px;width: 677px !important;visibility: visible !important;" referrerpolicy="no-referrer"></section><section style="margin-right: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><span style="outline: 0px;font-size: 16px;letter-spacing: 0.5px;">版本分布情况。</span></section><section style="margin-right: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><img class="rich_pages wxw-img" data-height="944" data-imgfileid="100028250" data-ratio="1.1919191919191918" data-type="png" data-w="792" data-width="792" src="https://oscimg.oschina.net/oscnet/74982ce9-c6ca-4c25-866a-314109c0aad0.png" style="outline: 0px;width: 677px !important;visibility: visible !important;" referrerpolicy="no-referrer"></section><section style="margin-right: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><span style="outline: 0px;font-size: 16px;letter-spacing: 0.5px;">使用上的挑战。果然是把 VACUUM 单独拎出来吊打了。</span></section><section style="margin-right: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><img class="rich_pages wxw-img" data-height="1054" data-imgfileid="100028251" data-ratio="1.2031963470319635" data-type="png" data-w="876" data-width="876" src="https://oscimg.oschina.net/oscnet/aa0683c7-95a8-4143-81d3-3b0c3886da09.png" style="outline: 0px;width: 677px !important;visibility: visible !important;" referrerpolicy="no-referrer"></section><section style="margin-right: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><span style="outline: 0px;font-size: 16px;letter-spacing: 0.5px;">部署的方式，这个图没有太看懂，如果大家都跌了，那应该有人大涨才对？不过当年最早做 Postgres 托管的 Heroku 也快要退出历史舞台了。</span></section><section style="margin-right: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><img class="rich_pages wxw-img" data-height="573" data-imgfileid="100028249" data-ratio="0.7234848484848485" data-type="png" data-w="792" data-width="792" src="https://oscimg.oschina.net/oscnet/ff3168f9-d1e4-4d0f-a2b8-98f6e6603aea.png" style="outline: 0px;width: 677px !important;visibility: visible !important;" referrerpolicy="no-referrer"></section><section style="margin-right: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><span style="outline: 0px;font-size: 16px;letter-spacing: 0.5px;">在 Kubernetes 上部署 PG 的方式，CloudNativePG 和 Helm 并驾齐驱。国内用前者的应该不多。</span></section><section style="margin-right: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><img class="rich_pages wxw-img" data-height="784" data-imgfileid="100028248" data-ratio="1.0509383378016086" data-type="png" data-w="746" data-width="746" src="https://oscimg.oschina.net/oscnet/386daa0d-8dbe-4d35-9561-199894922ea3.png" style="outline: 0px;width: 677px !important;visibility: visible !important;" referrerpolicy="no-referrer"></section><section style="margin-right: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><span style="outline: 0px;font-size: 16px;letter-spacing: 0.5px;">使用的功能点，这些都算是高级功能，也体现了 PostgreSQL 高级能力的实用性。</span></section><section style="margin-right: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><img class="rich_pages wxw-img" data-height="862" data-imgfileid="100028247" data-ratio="1.0883838383838385" data-type="png" data-w="792" data-width="792" src="https://oscimg.oschina.net/oscnet/996c4cd7-8946-4f74-8385-d4cc9cef449c.png" style="outline: 0px;width: 677px !important;visibility: visible !important;" referrerpolicy="no-referrer"></section><section style="margin-right: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><span style="outline: 0px;font-size: 16px;letter-spacing: 0.5px;">JSON 还是很香。</span></section><section style="margin-right: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><img class="rich_pages wxw-img" data-height="865" data-imgfileid="100028252" data-ratio="1.1248374512353707" data-type="png" data-w="769" data-width="769" src="https://oscimg.oschina.net/oscnet/d1c9661b-ebb7-4cd3-8e88-2d2ff2f2e967.png" style="outline: 0px;width: 677px !important;visibility: visible !important;" referrerpolicy="no-referrer"></section><section style="margin-right: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><span style="outline: 0px;font-size: 16px;letter-spacing: 0.5px;">阿里云在全球市场份额和 GCP 比较接近。但这个报告主要面向海外，所以阿里云就相对靠后了。也可以从侧面看出光中国是一个多么巨大的市场。</span></section><section style="margin-right: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><img class="rich_pages wxw-img" data-height="616" data-imgfileid="100028256" data-ratio="0.7897435897435897" data-type="png" data-w="780" data-width="780" src="https://oscimg.oschina.net/oscnet/70a24bc6-76f4-45ab-b71c-b6b2184a64a8.png" style="outline: 0px;width: 677px !important;visibility: visible !important;" referrerpolicy="no-referrer"></section><section style="margin-right: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><span style="outline: 0px;font-size: 16px;letter-spacing: 0.5px;">除了 PG 外使用的其它数据库，也可以侧面反映其他数据库的流行度，和 DB-Engines 排名是有些区别的。</span></section><section style="margin-right: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><img class="rich_pages wxw-img" data-height="542" data-imgfileid="100028254" data-ratio="0.5425425425425425" data-type="png" data-w="999" data-width="999" src="https://oscimg.oschina.net/oscnet/a8573963-5970-4b4a-93a9-2617f06a730d.png" style="outline: 0px;width: 677px !important;visibility: visible !important;" referrerpolicy="no-referrer"></section><section style="margin-right: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><img class="rich_pages wxw-img" data-height="554" data-imgfileid="100028255" data-ratio="0.7194805194805195" data-type="png" data-w="770" data-width="770" src="https://oscimg.oschina.net/oscnet/03d8af15-c980-47fe-a5c8-a03f4fb0c3cd.png" style="outline: 0px;width: 677px !important;visibility: visible !important;" referrerpolicy="no-referrer"></section><section style="margin-right: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><span style="outline: 0px;font-size: 16px;letter-spacing: 0.5px;">PG 实例数据量大小，相当符合正态分布。</span></section><h1 style="margin-right: 8px;margin-bottom: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><strong style="outline: 0px;"><span style="outline: 0px;letter-spacing: 0.5px;"><img class="rich_pages wxw-img" data-imgfileid="100028253" data-ratio="0.10947368421052632" data-s="300,640" data-type="png" data-w="950" src="https://oscimg.oschina.net/oscnet/8b2a9189-22b1-445a-b57b-d27970f040d3.png" style="outline: 0px;letter-spacing: 0.578px;width: 677px !important;visibility: visible !important;" referrerpolicy="no-referrer"></span></strong></h1><span id="OSC_h1_7"></span><h1 style="margin-right: 8px;margin-bottom: 16px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><span style="outline: 0px;font-size: 20px;"><strong style="outline: 0px;"><span style="outline: 0px;letter-spacing: 0.5px;">社区</span></strong></span></h1><section style="margin-right: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><span style="outline: 0px;font-size: 16px;letter-spacing: 0.5px;">可以给做社区的同行一些参考。</span></section><section style="margin-right: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><img class="rich_pages wxw-img" data-height="630" data-imgfileid="100028257" data-ratio="0.7134767836919592" data-type="png" data-w="883" data-width="883" src="https://oscimg.oschina.net/oscnet/60877cea-77d9-410f-8be6-c67dece7fe15.png" style="outline: 0px;width: 677px !important;visibility: visible !important;" referrerpolicy="no-referrer"></section><section style="margin-right: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;"><img class="rich_pages wxw-img" data-galleryid="" data-imgfileid="100028260" data-ratio="0.45555555555555555" data-s="300,640" data-type="png" data-w="1080" src="https://oscimg.oschina.net/oscnet/034de392-ecd8-4ba0-98ae-a0810e7ffddc.png" style="outline: 0px;width: 677px !important;visibility: visible !important;" referrerpolicy="no-referrer"></section><section style="margin-right: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><span style="outline: 0px;font-size: 16px;letter-spacing: 0.5px;">Postgres Weekly Newsletter 比较有影响力。不过它这次也给报告带了货，所以也会造成偏向性。</span></section><section style="margin-right: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><img class="rich_pages wxw-img" data-height="1071" data-imgfileid="100028259" data-ratio="1.3205918618988903" data-type="png" data-w="811" data-width="811" src="https://oscimg.oschina.net/oscnet/1b0a0f17-913a-424f-96eb-77d1f3db4739.png" style="outline: 0px;width: 677px !important;visibility: visible !important;" referrerpolicy="no-referrer"></section><section style="margin-right: 8px;margin-bottom: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><span style="outline: 0px;font-size: 16px;letter-spacing: 0.5px;">一些希望社区改进的地方。其中几点笔者也有感触：</span></section><ol start="1" class="list-paddingleft-1" style="margin-right: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);"><li style="outline: 0px;font-size: 16px;letter-spacing: 0.5px;"><p style="margin-bottom: 8px;outline: 0px;text-align: left;line-height: 1.75em;"><span style="outline: 0px;">PG 的官方文档已经很详尽了，不过如果配些示例图的话，会更容易吸收。</span></p></li><li style="outline: 0px;font-size: 16px;letter-spacing: 0.5px;"><p style="margin-bottom: 8px;outline: 0px;text-align: left;line-height: 1.75em;"><span style="outline: 0px;">邮件列表的问答形式比较过时，找帖子，翻帖子真的有点累。</span></p></li><li style="outline: 0px;font-size: 16px;letter-spacing: 0.5px;"><p style="margin-bottom: 24px;outline: 0px;text-align: left;line-height: 1.75em;"><span style="outline: 0px;">需要更多面向应用开发者以及研发流程 DevOps 的内容，而不是仅仅针对 DBA 和数据库内核开发者的内容。</span></p></li></ol><h1 style="margin-right: 8px;margin-bottom: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><span style="outline: 0px;letter-spacing: 0.5px;"><img class="rich_pages wxw-img" data-imgfileid="100028261" data-ratio="0.10947368421052632" data-s="300,640" data-type="png" data-w="950" src="https://oscimg.oschina.net/oscnet/6e944c0d-405f-487a-8843-286af419526b.png" style="outline: 0px;letter-spacing: 0.578px;width: 677px !important;visibility: visible !important;" referrerpolicy="no-referrer"></span></h1><span id="OSC_h1_8"></span><h1 style="margin-right: 8px;margin-bottom: 16px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><span style="outline: 0px;letter-spacing: 0.5px;font-size: 20px;"><strong style="outline: 0px;">AI</strong></span></h1><section style="margin-right: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><span style="outline: 0px;font-size: 16px;letter-spacing: 0.5px;">今年报告里自然不能免俗的会有 AI 问题。</span></section><section style="margin-right: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><img class="rich_pages wxw-img" data-height="527" data-imgfileid="100028258" data-ratio="0.6185446009389671" data-type="png" data-w="852" data-width="852" src="https://oscimg.oschina.net/oscnet/18cd5bca-5ace-4986-9b8f-79a414cf4730.png" style="outline: 0px;width: 677px !important;visibility: visible !important;" referrerpolicy="no-referrer"></section><section style="margin-right: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><span style="outline: 0px;font-size: 16px;letter-spacing: 0.5px;">大多数人还是持观望态度。</span></section><section style="margin-right: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><img class="rich_pages wxw-img" data-height="745" data-imgfileid="100028262" data-ratio="0.8602771362586605" src="https://oscimg.oschina.net/oscnet/564482fa-4e4d-4a60-a4d8-71e6b5f5996c.png" data-type="png" data-w="866" data-width="866" style="outline: 0px;width: 677px !important;visibility: visible !important;" referrerpolicy="no-referrer"></section><section style="margin-right: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><span style="outline: 0px;font-size: 16px;letter-spacing: 0.5px;">让向量处理和关系型数据处理在同一个数据库是 PG 最大的优势。一专多能，传统艺能。</span></section><hr style="outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);border-style: solid;border-right-width: 0px;border-bottom-width: 0px;border-left-width: 0px;border-color: rgba(0, 0, 0, 0.1);transform-origin: 0px 0px;transform: scale(1, 0.5);"><p style="margin-top: 16px;margin-right: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><span style="outline: 0px;font-size: 16px;letter-spacing: 0.5px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">就这些啦，这里只选取了部分报告摘要，也建议去阅读原文&nbsp;</span><span style="outline: 0px;font-size: 16px;letter-spacing: 0.5px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;color: rgb(79, 70, 229);">https://www.timescale.com/blog/announcing-the-new-timescale/</span><span style="outline: 0px;font-size: 16px;letter-spacing: 0.5px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">。</span></p><p style="margin-top: 16px;margin-right: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><span style="outline: 0px;font-size: 16px;letter-spacing: 0.5px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;"><br></span></p><p style="margin-top: 16px;margin-right: 8px;margin-left: 8px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><span style="outline: 0px;font-size: 16px;letter-spacing: 0.5px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;"><strong style="outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;font-size: 15px;color: rgb(34, 34, 34);text-align: start;text-indent: 36.8px;background-color: rgb(255, 255, 255);"><img class="rich_pages wxw-img" data-backh="331" data-backw="562" data-imgfileid="100028263" data-ratio="0.5881188118811881" data-s="300,640" src="https://oscimg.oschina.net/oscnet/472df27d-7aa5-4400-94e4-c618daac1eed.png" data-type="png" data-w="1010" style="outline: 0px;letter-spacing: 0.544px;color: rgb(51, 51, 51);width: 100%;visibility: visible !important;height: auto;" referrerpolicy="no-referrer"><img class="rich_pages wxw-img" data-backh="262" data-backw="562" data-cropselx1="0" data-cropselx2="578" data-cropsely1="0" data-cropsely2="269" data-imgfileid="100028264" data-ratio="0.46574074074074073" data-s="300,640" src="https://oscimg.oschina.net/oscnet/985ed68d-c3d1-4cef-8cd8-54e0c6bb2f8c.png" data-type="png" data-w="1080" style="outline: 0px;letter-spacing: 0.544px;color: rgb(51, 51, 51);border-radius: 8px;width: 100%;background-size: 16px !important;visibility: visible !important;height: auto;" referrerpolicy="no-referrer"></strong></span></p><p style="display: none;"><mp-style-type data-value="3"></mp-style-type></p></div><p style="color: #858585; font-size: 13px;">本文分享自微信公众号 - 开源软件联盟 PostgreSQL 分会（kaiyuanlianmeng）。<br>如有侵权，请联系 support@oschina.cn 删除。<br>本文参与「<a href="https://www.oschina.net/sharing-plan" target="_blank">OSC 源创计划</a>」，欢迎正在阅读的你也加入，一起分享。</p></div>
                                    ]]>
            </description>
            <pubDate>Sun, 17 Dec 2023 03:47:00 GMT</pubDate>
            <guid isPermaLink="false">https://my.oschina.net/postgresqlchina/blog/10322198</guid>
            <link>https://my.oschina.net/postgresqlchina/blog/10322198</link>
            <author>
                <![CDATA[PostgreSQLChina]]>
            </author>
        </item>
        <item>
            <title>
                <![CDATA[React Native 0.73 稳定版]]>
            </title>
            <description>
                <![CDATA[<div class="content"><p>React Native 最新稳定版 0.73<u><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fgithub.com%2Ffacebook%2Freact-native%2Freleases%2Ftag%2Fv0.73.0" target="_blank"> 已发布</a></u>。此版本主要变化包括增加了对使用 Hermes 进行调试的改进、符号链接支持 (symlink) 进入稳定阶段、Android 14 支持以及新的实验性功能。此外还弃用了旧版调试功能，并发布了新架构的下一个支柱：<strong>无桥接模式 (Bridgeless Mode)</strong>。</p><ul><li><strong>Hermes 支持查看控制枱历史</strong></li></ul><p><code>console.log()</code>是开发者快速调试 JavaScript 代码的主流方法。在以前的版本中，在连接调试器之前，不会记录 React Native 应用程序中的控制枱日志。这使得观察应用程序加载早期发生的日志变得困难。</p><p>React Native 0.73 解决了这个问题。 Hermes 现在会在后台捕获所有&nbsp;<code>console.log()</code>&nbsp;调用，这些调用将在首次连接调试器时发送到控制枱选项卡 — 与 Web 浏览器中的调试体验相匹配。新特性适用于 Flipper、连接到 Hermes 的 Chrome DevTools 以及实验性的 New Debugger。</p><ul><li><strong>更新调试文档</strong></li></ul><p><img alt="" src="https://oscimg.oschina.net/oscnet/up-bd62abb0cb33479ed1b38184f22ce355f7c.png" referrerpolicy="no-referrer"></p><ul><li><strong>新的实验性调试器</strong></li></ul><p><img alt="" src="https://oscimg.oschina.net/oscnet/up-8a6d3d0d1a1e52514f576b21e6b81c25f09.png" referrerpolicy="no-referrer"></p><ul><li><strong>支持使用 Kotlin 编写 Android 应用</strong></li></ul><p>从 0.73 开始，Kotlin 已成为使用 React Native 构建 Android 应用程序的推荐语言。这遵循了 Android 生态系统多年来的发展方向，并允许开发者使用现代编程语言编写应用程序。</p><p>此版本更新了 Android 上的 React Native 模板，以使用 Kotlin 而不是 Java。新的<code>MainActivity.kt</code>和<code>MainApplication.kt</code>文件大小减小了 36%。</p><p>详情：<u><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Freactnative.dev%2Fblog%2F2023%2F12%2F06%2F0.73-debugging-improvements-stable-symlinks" target="_blank">https://reactnative.dev/blog</a></u></p></div>
                                    ]]>
            </description>
            <pubDate>Sun, 17 Dec 2023 03:41:00 GMT</pubDate>
            <guid isPermaLink="false">https://www.oschina.net/news/271523/reactnative-0-73-stable</guid>
            <link>https://www.oschina.net/news/271523/reactnative-0-73-stable</link>
            <author>
                <![CDATA[来源: OSCHINA]]>
            </author>
        </item>
        <item>
            <title>
                <![CDATA[一个 38 岁程序员，在技术圈自由游曳]]>
            </title>
            <description>
                <![CDATA[<div class="content"><p>程超，一个 38 岁的程序员，面对互联网世界的暗流涌动，显得游刃有余。</p><p>最近，他正在忙着研究生毕业答辩，不过其生活节奏仍然非常规律：每天早上六点起床，跑步五到十公里；然后学英语背单词，已经坚持了七百六十多天；接着送孩子上学，再去上班，上班路上看技术文档或是练听力；晚上回去看看书，直到零点。</p><p>从事互联网行业 16 年，程超深耕支付、交易、订单等业务，颇擅长 DevOps、AIOps、基础架构、稳定性建设、高并发等技术。因此，热衷于分享知识的他，在技术圈留下了不少足迹，除了用「小程故事多」的网名发布了诸多的技术博文之外，还主导了《高可用可伸缩微服务架构》一书，并合著有《深入分布式缓存——从原理到实践》，此外还翻译了《Spring5 设计模式》。</p><p>此外程超还被多个技术社区所认可，获得过「腾讯云 TVP」「阿里云 MVP 成员」「云智慧最有价值专家」等称号。</p><p>我们很想知道：在忙碌的工作之外，程超是如何达成这许多成就的；在职业生涯转折点，他的选择是什么；关于写作、出书、翻译，他有哪些心得可以分享；面对 AI 等新技术的到来，他又做了什么。为此，我们采访了程超，看看他如何在技术圈自由游曳。</p><p style="text-align:center"><img height="624" src="https://oscimg.oschina.net/oscnet/up-0d2b69c27c7ab1e6eedcc1ae4168e55b94e.png" width="500" referrerpolicy="no-referrer"></p><p style="text-align:center"><strong>程超，高级</strong><strong>研发管理</strong><strong>专家</strong></p><span id="OSC_h4_1"></span><h4>一、能否介绍一下您当前的工作方向？</h4><p>主要有两个：一是 DevOps 平台建设，二是 AI 工程建设。之前我一直负责公司的稳定性建设，以及 DevOps、AIOps 的体系建设，今年年初开始研究 AI 相关，建设公司的 AI 工程，目前已经上线一个平台支持公司的智能客服业务。</p><span id="OSC_h4_2"></span><h4>二、从事互联网行业 16 年，最引以为傲的成就是什么？</h4><p>职业生涯挺长，有很多收获与感悟，总结下来：</p><p>在公司层面：</p><ul><li><p>在目前公司主导了 DevOps 和 AiOps 相关的工作，推动了多云架构的设计与研发，同时也负责团队管理。你的工作在公司内部得到了认可，获得了 2022 年度最佳领导奖和最佳技术团队奖。</p></li><li><p>松果出行阶段，负责了多个业务线的核心工作，尤其是订单中台和用户中心的设计和架构工作。通过性能优化和微服务体系建设，你成功将服务性能从 500qps 提升到 3000qps。此外我设计和开发了多个关键系统，如订单重试中心、超时控制中心等。</p></li><li><p>在易宝支付，我主要聚焦在支付平台和实时统计方面。在优化和重构支付平台的过程中，你将性能从 50TPS 提升到 200TPS，并且实现了可扩展性，这为公司带来了巨大的收益。同时获得了公司的年度"工匠提名奖"和"开放分享奖"。</p></li></ul><p>在个人层面：</p><p>负责书籍的撰写和翻译工作，包括《高可用可伸缩微服务架构》的主导、合著书籍《深入分布式缓存——从原理到实践》以及翻译《Spring5 设计模式》。此外我还担任过极客时间的讲师，贡献过每日一课等视频课程。</p><span id="OSC_h4_3"></span><h4>三、您在过去的工作中，遇到最具挑战性的项目是什么？ 对您而言，在该项目中的最大收获是什么？</h4><p>最具挑战的项目是支付交易平台，不仅需要平台提供高并发能力，同时也要保障系统的资金安全，与钱有关的项目往往都需要特别谨慎。</p><p>最大的收获是对自己的技术体系做了重新梳理，做项目要三思而后行，稳定性保障的多种技术方案和手段。</p><span id="OSC_h4_4"></span><h4>四、能否跟我们聊一下一路以来您的职业发展路径？在技术方向这块经历了什么样的变化？</h4><p>个人坚持的理念是一专多能。首先是要专，从毕业到现在，我一直坚持 Java 技术方向，然而 Java 发展很快，从我刚接触的 Jdk1.5 一直发展到今天的 Java21，已经经历了非常多的版本，而我一直在坚持学习，虽然到目前还谈不上极为精通，但至少已经积累了大量工作经验。</p><p>其次是多能， 目前在市面上除了 Java 这个老牌开发语言，还有非常多其他类语言，比如 Go、Python、Rust 等等，每种语言的出现一定有它的优势和使用场景，因此需要根据项目情况、使用场景，适当选择最合适的语言来对项目进行整体提高。</p><span id="OSC_h4_5"></span><h4>五、在技术方向抉择的过程中，您是主动选择还是被动接受的？</h4><p>从心理学的角度来讲，技术方向的主动选择会给人带来更多的自主感觉，主动选择自己熟悉的技术方向，更容易产生成就感，而成就感会带给人以责任感，也将伴随的是积极的态度与行动。</p><p>当然这个世界本来就是多样性，有主动的技术选择，就一定会存在被动的情况，当在某一场景下，自己无法把握技术方向，而只能变为被动选择的时候，应该选择接受，从整体上分析现状，改变自己的格局和视野，变化角度来看问题，积极调整心态，化被动为主动。</p><span id="OSC_h4_6"></span><h4>六、您是什么时候开始有自己明确的职业规划的？当工作方向跟职业规划发生冲突时，您是如何选择的？</h4><p>我是工作到第五年的时候，开始认真思考自己的职业规则。</p><p>有一个网上看到的冷笑话。很多程序员每天都在写代码，每天都很忙，当面试官问他，你的职业规划是什么？程序员回答说：「没有「。那么，如果你必须选择一个角色，你会选择什么？例如，技术总监。程序员回答说：「CEO」......</p><p>很多程序员在刚毕业工作的时候，往往前几年都是想多学习技术，多积累经验，当工作到一定时间，就会遇到职业瓶颈，这就需要认真思考自己未来应该如何规划，这往往也是程序员未来选择的分水岭。是一直做技术，做架构师、高级架构师、首席架构师，还是从事技术管理，做经理、总监、CTO ？还是有可能会转型，做产品、销前，或是创业？是要一直在一个领域深耕，还是会变换方向和领域，做个多面手？这里面应该如何选择呢？我们了解自己吗？自己是内向，还是外向，喜欢沟通，还是喜欢安静，这都是决定未来方向的衡量指标。</p><p>当工作方向与职业规划冲突的时候，不要轻易立刻下决定，要先思考：</p><ul><li><p>方向</p></li></ul><p>假如你自己的职业规划目标是做架构师，那么现在公司决定让人做经理，那么管理性质的岗位就与架构师的目标不匹配，按常理来说应该止损，重新选择架构师的技术方向。但是重新选择的前提是，你之前制定的规划是合理的。为什么这样说的呢？我遇到一些朋友，他们也有自己的职业规划，结果深入沟通后才现，他们的职业规划并不十分合理，既不符合自身的优势或性格，也不符合现实情况。</p><ul><li><p>平台</p></li></ul><p>其实方向不能抛开平台而存在，我们要考虑目前所处的平台如何。这里会涉及到公司与部门，假如公司走下坡路了，公司也没有明确的发展方向，无法让你在新的工作方向上提升自己的竞争力，那么当工作方向与规划冲突的时候，那这样的平台有可能会消耗自己的时间。</p><span id="OSC_h4_7"></span><h4>七、您先后在京东、360 和易宝支付等公司工作过。想知道在不同公司，您的工作方式和风格有何不同？</h4><p>其实每家公司都有自己的特点与优点，但可以根据所处的行业，来匹配不同的工作方式。</p><p><strong>京东：</strong> 因为公司规模非常大和人员非常多，所以沟通和协作可能需要更多的层级，并需要更多的协调工作来确保项目顺利推进。另外作为一个大型电商平台，京东可能更注重创新和用户体验，可能更倾向于尝试新技术和创新解决方案。</p><p><strong>360：</strong> 安全领域可能更注重团队间的严格合规和保密性，可能有更多的审查和验证程序，以确保代码的安全性和质量，注重稳定性和已有的可靠技术。</p><p><strong>易宝支付：</strong> 在金融领域，可能更加注重细节和合规性，以及资金安全性。可能有更严格的流程和规范，以确保系统的稳定性和安全性，做事风格是三思而后行，要充分考虑，认真考虑各种可能存在的情况，要能给客户带来稳定性和可靠性的体验。</p><span id="OSC_h4_8"></span><h4>八、不同公司对您的职业发展有何影响？在不同公司，您学到的最宝贵的经验是什么？</h4><ul><li><p>在京东更多的是学习到了电商与互联网经验，学到了高并发场景的应用，收获了很多技术的最佳实践，以及在大公司与不同部门如何高效协作。</p></li><li><p>在易宝支付我收获了如何建设稳定性的平台，如何站在用户角度去思考，如何带领一支大团队来高效协同，共同完成目标。此外公司还为我培训了大量管理方面的课程，让我的管理经验从野路子变成具有方法论的系统性实践。</p></li><li><p>在现在公司，收获的更多是建立产品化思维，让我的想法不再仅是基于技术思维，要以产品角度来思考，让自己做的产品如何得到更好的用户体验，如何更快更高效地响应用户的需求与问题。</p></li></ul><p>可以看到我的职业发展是一条从底层逐步向上层的过程，从底层技术思维到管理思维，再到产品思维。</p><span id="OSC_h4_9"></span><h4>九、互联网技术变化相当之快，您是如何应对挑战和变化的？</h4><ul><li><p>需要持续学习，积极参加各种培训、讲座、研讨会等活动，学习最新的科技发展动态和应用技巧。</p></li><li><p>培养团队协作能力，团队合作可以集思广益，共同面对挑战，解决难题。</p></li><li><p>多关注信息来源，不断涌现的新技术和信息意味着需要更多的时间和精力去跟上这些变化。</p></li><li><p>接受改变，应该以积极的心态去拥抱和适应，不能去抵制他们。</p></li></ul><span id="OSC_h4_10"></span><h4>十、面对技术的快速变化，跟十年前的自己相比，心态有什么不一样吗？</h4><p>十年前，自己更愿意在熟悉的领域深耕，如今自己心态更开放，更愿意接触不同的技术和方向，这中间有职位的变化导致，也有经过十年的技术沉淀后，技术视野需要变得宽广，不管是哪个方式，我始终持续学习。</p><span id="OSC_h4_11"></span><h4>十一、您当前关注互联网行业的哪些热点领域？将如何平衡个人发展和行业发展的关系？</h4><p>当前最热的领域无非就是 AIGC 了，我一直在持续关注，不过幸运的是，我目前正在做这一相关的工作。</p><p>对于许多人来说，个人发展和职业发展是两个重要的方面，但却经常会出现平衡问题。有时候，我们会专注于一方面而忽视另一方面。如果我们只关注行业发展而不注重个人发展，我们可能会陷入职业倦怠。反之，如果我们仅关注个人发展而不注重行业发展，我们可能会错过许多职业机会。</p><p>其实我认为这两者完全可以做到相辅相成，行业发展代表的是趋势，个人发展只能代表自己某一场景下制定的目标。个人发展只是能过去发展的梳理，然后对未来的展望，当新的行业发展到来时，这将会对个人发展带来冲击和变动，我们将接受这一切，如果认为新的行业发展带来的是机遇和机会，那么可以适当调整个人的发展，将新行业发展与个人发展进行适当结合与融入，让个人发展变得与时俱进，始终保持竞争力才是根本。</p><span id="OSC_h4_12"></span><h4>十二、DevOps、AIOps 的概念近几年在国内颇为盛行，您是什么时候开始接触这方面的？有什么机缘巧合吗？</h4><p>我是在 2014 开始正式接触并产生浓厚兴趣的，但当时我在负责业务线的部门，发现业务团队与运维团队协作并不是非常顺畅，存在着业务开发端，测试端和运维端的信息鸿沟，所以我想推动解决这个事，发现 DevOps 的核心更是解决这三者的关系的，打通软件交付过程中的 IT 工具链，使各个团队减少时间损耗，更高效地协作。于是我从国内外网站上看了几百篇相关文章，在社区里与相关朋友讨论 DevOps 的推动与发展，与公司高层沟通我的想法，与运维团队紧密沟通配合，开始推动 DevOps 在公司的落地。</p><span id="OSC_h4_13"></span><h4>十三、从了解 DevOps、AIOps 等概念到实际落地，您经历了怎样的一个过程，能够否结合案例聊一聊？实践 DevOps、AIOps 其中的难点是什么？</h4><p>先谈谈其中的难点。</p><p><strong>DevOps：</strong></p><p>文化变革： DevOps 不仅仅是工具和流程，更是一种文化变革。最大的挑战之一是将团队从传统的瀑布式开发模式转变为迭代、自动化和协作的方式。这需要时间和领导层的支持。</p><p>自动化： 自动化是 DevOps 的核心，但建立自动化流程需要投入大量时间和资源。自动化测试、部署和监控等方面的工具选择和集成是挑战之一。</p><p>工具链整合： 在 DevOps 中，使用多种工具来实现自动化流程，但这些工具的整合和互操作性可能会带来复杂性和困难。</p><p>团队沟通与协作： 从传统的团队结构转变为跨职能团队需要更多的沟通和协作。团队成员可能需要适应新的工作方式和角色。</p><p>文化变革和接受度： 引入 DevOps 文化可能会遇到团队成员的抵制或不适应。确保他们理解变革的重要性并逐步接受需要耐心和教育。</p><p>持续学习与改进： DevOps 是一个持续改进的过程。持续学习新技术和最佳实践，以及不断改进工作流程是非常重要的。</p><p><strong>AIOps</strong><strong>：</strong></p><p>数据质量和整合： AIOps 依赖于大量数据来进行分析和预测。确保数据的质量、完整性以及不同数据源的整合是挑战之一。</p><p>算法和模型选择： 选择合适的机器学习算法和模型来应对特定的运维挑战需要一定的专业知识。在实践中，不同情况可能需要不同的算法，因此选择和调整模型是一个挑战。</p><p>解释性和透明性： 对于许多业务场景来说，AI 模型的决策必须可解释和透明。这意味着需要找到平衡，确保模型的预测不仅仅是准确的，而且还能解释其背后的原因。</p><p>逐步采用： 对于一些组织来说，接受和信任 AI 在运维中的作用可能需要时间。逐步展示 AI 在提高效率和准确性方面的成果是至关重要的。</p><p>团队技能提升： 引入 AIOps 可能需要团队成员具备一定的机器学习和数据分析知识。这可能需要培训和技能提升计划。</p><p>监管和合规性考虑： 在某些行业，AI 的使用可能受到监管和合规性要求的限制。确保 AI 系统符合相关法规是挑战之一。</p><p>我目前公司正是经历了这一阵痛，在前期依然是依靠传统运维的方式，导致生产和上线效率极低，因为变更导致的故障频出。而 DevOps 平台推出后，从研发生产域（需求管理、迭代管理、开发和测试），持续交付与布署（研发资源、发布管理、运行时管理、分析大盘、系统管理等），到产线运行域（aPaaS、bPaaS、tPaaS、dPaaS 以及多云管理平台、CMDB)， SRE 域（智能分析与告警平台、排班中心、统一数据采集平台、技术中间件统一管理平台）等多领域进行统一自助管理，实现一站式全生命周期管理。</p><span id="OSC_h4_14"></span><h4>十四、大模型技术的发展，给 AIOps 带来了什么样的影响？ 面对大模型对 AIOps 技术带来的巨大影响，身处其中，您的感受是什么？</h4><p>主要有四个方面的影响：</p><ul><li><p>智能决策支持： 大模型技术能够处理更多更复杂的数据，使 AIOps 系统能够提供更智能的决策支持。</p></li><li><p>异常检测和预测能力： 大模型能够提供更准确和高效的异常检测和预测。通过分析历史数据和实时流数据，AIOps 系统可以更好地识别潜在的故障和异常模式，甚至在问题发生之前预测到可能出现的问题。</p></li><li><p>自动化运维： 借助大模型技术，AIOps 系统可以更好地实现自动化运维。这意味着系统能够自主识别问题并尝试自动修复，减少对人工干预的需求，提高运维效率。</p></li><li><p>精细化的问题定位： 有助于提供更精准的问题定位。通过对复杂数据的分析，AIOps 系统可以更准确地定位问题所在，提供更具针对性的解决方案。</p></li></ul><p>大模型技术对 AIOps 的影响是革命性的。对我而言，身处这个变革中让我感到兴奋和充满挑战。这种变革为 AIOps 注入了更多可能性，让我们能够更全面、更智能地处理运维问题。这种感受就像站在技术的前沿，目睹着未来的可能性一样。同时，也带来了新的学习和适应等方面的挑战，但这也是促使自己不断进步和学习的机会。</p><span id="OSC_h4_15"></span><h4>十五、您先后参写了两本《高可用可伸缩微服务架构》、《深入分布式缓存》著作，又翻译《Spring5 设计模式》一书，想问您写作/翻译的初衷和动机是什么？</h4><p>我之前在 CSDN 上写了二百多篇技术博客，其中包括微服务相关的，也包括缓存相关的，当时写作的初衷就是想把自己积累下来的博客文章能够以书籍的方式做个系统性梳理，这样不仅便于知识的系统化，同时也能更好地和读者进行交流。</p><p>而翻译的想法来源于我持续的英语学习，在翻译《Spring5 设计模式》书之前，我已经持续学习英语五年，深知学习英语的重要性，这是打开与世界交流的窗口，所以正好有朋友约我翻译这本书，所以我想做尝试，也是对自己多年英语学习的一个检验。</p><span id="OSC_h4_16"></span><h4>十六、这些创作给您的工作和生活有带来了什么变化？</h4><p>首先这些创作本质上是会给自己带来技术影响力的提升，增加更多与同行交流的的机会，其次这也是一种深度学习和整理知识的过程，需要将复杂的技术概念转化为易于理解的内容，这种能力可以让我更好地将技术知识分享给其他人，同时也加深了自己对技术领域的理解。</p><span id="OSC_h4_17"></span><h4>十七、您在写作过程中的创作经验和心得可以分享吗？</h4><p>写书本身是一件持续性的体力与脑力劳动，需要对自己的主题做出针对性的内容建设，同时也会占用大量的业余时间来写，我记得当时我每天早上六点起床开始写，写到八点然后赶快去上班，晚上下班回来经常写到零点左右，而且周末也会减少陪伴家人的时间。当然家人在这个过程中也给与我很大的支持和鼓励。</p><p>写作的过程往往是漫长的，很多时候遇到一些写作瓶颈后容易产生放弃的情绪，遇到这种情况，首先想到的一定是正向能量的输入，就是坚持，还有与出版社编辑或是朋友进行相关沟通，找到解决问题的办法，不能轻言放弃。</p><p><strong>下面聊一下写书的过程：</strong></p><ul><li><p>首先要考虑书籍的选题，如何确定选题，是选一个稀缺的书籍题目，还是在众多重复的主题之间想一个标新立异的。</p></li><li><p>第二要考虑受众群体，其实越偏入门的书，越容易产生销售，越有深度的书，受众群体的层级就越高，写作难度也就越大。</p></li><li><p>第三就是写作资料的收集，我们是否之前已经积累了大量与主题相关的材料，这点挺重要的。这决定你的写作速度，如果之前从来没有收集和创作过与主题相关的材料，那写作过程将是漫长的。</p></li><li><p>第四就是要充分考虑写作大纲，大纲是书籍的灵魂，大纲的成功与否，将在一定程度上决定书籍的销量是否成功。</p></li><li><p>第五是写作计划，什么时候开始写？什么时候写完？每个月的进度是多少？每个星期的进度要多少？每天都写多少？要做好统筹规划。</p></li><li><p>第六就是真正写作了，在写作的过程中，你的自律能力会不断地提高，让你感觉到了一种机械的状态，而这种状态，会让你忘记掉时间，这就是心流。而自律依赖于目标，依赖于你的欲望。自律刚开始会打破你原有的习惯，会让你感觉是一件痛苦的事，但坚持一段时间后，就觉得，这其实没什么。</p></li><li><p>第七是写作的时候，要考虑借助哪些工具。有些出版社采用的是在线 markdown，有一些出版社则接收的是 Word。所以，在你采用工具之前，先了解一下最后的格式。而我建议使用可以分布式协作的版本管理平台，诸如于 GitHub 或者云共享平台等。这样可以高效地进行协同。</p></li><li><p>第八是要考虑，这本书是一个人写，还是多个人写，一个人写就是进度会慢，但更加聚焦，进度自己能把控。多人写作的话就需要团队管理能力，每个人的情况不一样，对于知识的掌握情况也不一样，他们目前的忙闲程度也不一样，如何更好地管控每个人的进度，就需要与大家一起讨论，制定每周例会沟通进度与遇到的问题，大家一起想办法解决，而不至于让其个作者太过落后，影响整体书籍进度的编写。</p></li></ul><span id="OSC_h4_18"></span><h4>十八、听说您目前正在写一本稳定性建设相关的书，能否跟我们聊一聊这本书？为什么会选择这一方向？当前进展如何？</h4><p>目前确实是在写一本关于稳定性建设的书，原因就是想把多年积累下来的经验做个总结分享给大家，这本书的构想囊括了从稳定性建设的总论到技术组件的建设，每个章节都涵盖了不同方面的主题，例如微服务带来的挑战、故障发现与定位、故障的快速解决，分布式事务、服务限流和熔断等等。为读者提供了系统稳定性建设的全面视角，从概念到实践都有所涉及。每章都有明确的目标，介绍了相关技术领域的知识点，并提供了实际场景下的解决方案。</p><p>当前这本书已经完成三分之一，相信明年上半年会写完出版。</p><span id="OSC_h4_19"></span><h4>十九、您获得过「腾讯云 TVP」「阿里云 MVP」「云智慧最有价值专家」等称号，能否结合自身案例谈一下，社区对个人成长和行业发展的重要性？</h4><p>以我参与的，腾讯云 TVP 团队倾力打造的 TVP 第六期吐槽大会为例，由 6 位，腾讯云 TVP 专家与 Cloud Studio 产品及技术掌舵人强强碰撞，直面产品问题，共同为 Cloud Studio 产品指明提升方向，为 AI 时代云端 IDE 的未来发展探索更多可能。</p><p>技术的发展少不了 issue 区的反馈，产品的进步免不了用户的吐槽。腾讯云将产品使用开放出来，倾听业界专家与用户心声，持续打磨升级技术和产品能力，为用户提供更极致的产品体验。个人的成长也能够通过与社区专家的多次碰撞得到极大的提高与视野的开阔。</p><span id="OSC_h4_20"></span><h4>二十、您对个人未来发展有何期待？</h4><p>目前正在从事 AIGC 相关的研究和研发，是我的兴趣点，也希望未来能够在这方面不断深耕与发展。</p><div>
  &nbsp; 
</div></div>
                                    ]]>
            </description>
            <pubDate>Sun, 17 Dec 2023 03:02:00 GMT</pubDate>
            <guid isPermaLink="false">https://my.oschina.net/u/3859945/blog/10322167</guid>
            <link>https://my.oschina.net/u/3859945/blog/10322167</link>
            <author>
                <![CDATA[原创]]>
            </author>
        </item>
        <item>
            <title>
                <![CDATA[Debian 将停止支持 i386 架构]]>
            </title>
            <description>
                <![CDATA[<div class="content"><p>Debian GNU/Linux 团队在最近的 DebConf 会议上<u><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Flists.debian.org%2Fdebian-devel-announce%2F1997%2F12%2Fthreads.html" target="_blank">决定</a></u>，<strong>其 Linux 内核、Debian 安装器和 Debian 镜像团队未来将不再支持 i386 架构</strong>。这意味着用户需要考虑将系统迁移到更现代的架构，以确保系统的长期支持和兼容性。</p><blockquote><p>i386 架构是英特尔的 32 位微处理器，最初被称为 80386，后来更名为 i386。它是 x86 架构的一部分，是早期个人电脑和工作站的中央处理单元（CPU）。i386 架构具有 32 位数据宽度和 32 位地址宽度，支持实模式、保护模式和虚拟模式。</p><p>虽然 i386 架构已经过时，但它对后来的 x86 处理器设计产生了深远影响。i386 的后继产品包括 i486 和 P5 Pentium 系列处理器，这些处理器都是基于 i386 设计的后代产品。</p></blockquote><p>此后用户可以<u><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fwww.phoronix.com%2Fnews%2FDebian-Plans-Cease-i386" target="_blank">通过两种方式</a></u>来运行 i386：</p><ul><li>作为 amd64 系统上的多架构选项</li><li>作为其他架构系统上的 i386 chroot</li></ul><p><img alt="" src="https://oscimg.oschina.net/oscnet/up-1aa45d2c70d5a540253652db272c69ff530.png" referrerpolicy="no-referrer"></p><p>Debian 并不打算像 Ubuntu 那样将 i386 作为部分架构，arch:any 仍将包含 i386，因此一切都将默认构建。希望放弃 i386 支持的维护者可以在与软件包的反向（构建）依赖关系协调后放弃 i386 支持，就像放弃对其他架构的支持一样。Debian 方面指出，并不反对在出现这些变更时对基线进行修改。</p><p>考虑到其他 Linux 发行版多年来一直在放弃 i386，一些 Linux 发行版甚至提高了它们的 x86-64 微架构基线，看到 Debian 也最终也决定停止支持 i386，尤其是在 Debian 13 大约两年后发布之前，这并不太令人惊讶。</p></div>
                                    ]]>
            </description>
            <pubDate>Sun, 17 Dec 2023 02:50:00 GMT</pubDate>
            <guid isPermaLink="false">https://www.oschina.net/news/271507/debian-plans-cease-i386</guid>
            <link>https://www.oschina.net/news/271507/debian-plans-cease-i386</link>
            <author>
                <![CDATA[来源: OSCHINA]]>
            </author>
        </item>
        <item>
            <title>
                <![CDATA[字节跳动被 OpenAI 「封号」事件始末]]>
            </title>
            <description>
                <![CDATA[<div class="content"><p>12 月 16 日，The Verge 根据获得的内部文件<u><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fwww.theverge.com%2F2023%2F12%2F15%2F24003151%2Fbytedance-china-openai-microsoft-competitor-llm" target="_blank">报道称</a></u>，字节跳动曾秘密使用 OpenAI 的技术来开发自己的大语言模型，在代号为 Project Seed 的项目各阶段，都使用了 Azure 上的 OpenAI API 进行模型的训练和评估，<strong>并且频繁触及 API 的最大限额</strong>。</p><blockquote><p><img src="https://oscimg.oschina.net/oscnet/up-cfbc41a7285880aacc51983647d94705836.png" referrerpolicy="no-referrer"></p><p>来源：<em><u><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fwww.theverge.com%2F2023%2F12%2F15%2F24003151%2Fbytedance-china-openai-microsoft-competitor-llm" target="_blank">https://www.theverge.com/2023/12/15/24003151/bytedance-china-openai-microsoft-competitor-llm</a></u></em></p></blockquote><p>报道还称，相关员工知悉这种做法违反 OpenAI 使用政策，并在内部 Lark 上的对话中提及了「数据脱敏」等说法。但几个月前，字节命令团队在「模型开发的任何阶段」停止使用 GPT 生成的文本。同期，字节的「豆包」服务在国内获批并上线。据称，字节的内部目标是年底达到 GPT-3.5 的水平，明年中达到 GPT-4 的水平。</p><p><img alt="" src="https://oscimg.oschina.net/oscnet/up-2998d77fbdf3ed444a1ad273512c149fd5d.png" referrerpolicy="no-referrer"></p><p>该报道发出后，<u><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fwww.theverge.com%2F2023%2F12%2F15%2F24003542%2Fopenai-suspends-bytedances-account-after-it-used-gpt-to-train-its-own-ai-model" target="_blank">OpenAI 声明称</a></u>，字节的 API 用量很少，但已将其账户暂停使用并做进一步调查。如发现违反使用政策，将要求纠正或关停账户。微软在声明中重述了 Azure OpenAI 服务的政策，但未对报道事实或后续措施置评。</p><p><img src="https://oscimg.oschina.net/oscnet/up-e9398156152491a1ed3203047b0cf781449.png" referrerpolicy="no-referrer"></p><blockquote><p>OpenAI 发言人 Niko Felix 确认字节跳动的账户已被暂停，并说道：「所有 API 客户都必须遵守我们的使用政策，以确保我们的技术得到良好利用。虽然字节跳动对我们 API 的使用很少，但我们在进一步调查期间已暂停了他们的帐户。如果我们发现他们的使用不遵守这些政策，我们将要求他们进行必要的更改或终止其帐户。」</p></blockquote><p>就此，字节国外发言人于 16 日对 The Verge 表示，GPT 生成的数据在 Project Seed 项目开发的早期就被用于注释模型，并在今年年中左右从字节跳动的训练数据中删除。GPT 仅在中国以外市场的产品和功能中使用，豆包则是基于自行开发的模型，且仅在中国可用。</p><p>字节相关负责人则于 17 日回应媒体称，<strong>仅在年初有部分工程师将 OpenAI 服务用于较小模型的实验性项目研究</strong>；随着公司在 4 月引入 GPT API 调用规范检查，这种做法已经停止；9 月，内部又进行了一轮检查并采取进一步规范措施；在未来几天里会再次全面检查，以确保严格遵守相关服务的使用条款。</p><p>对于 OpenAI 禁止用其服务训练竞争模型的政策，历来存在不同看法。支持的观点认为，OpenAI 为训练模型做了大量前期投入，借助其服务「抄近道」是不正当的。反对的观点则认为，OpenAI 的训练过程得益于当时对 AI 训练无戒备的外部环境，在其之后的模型已不再能轻易获得到同样规模的训练数据，阻止其他公司调用其模型相当于建立事实上的垄断。</p></div>
                                    ]]>
            </description>
            <pubDate>Sun, 17 Dec 2023 02:28:00 GMT</pubDate>
            <guid isPermaLink="false">https://www.oschina.net/news/271501/bytedance-china-openai-microsoft-competitor-llm</guid>
            <link>https://www.oschina.net/news/271501/bytedance-china-openai-microsoft-competitor-llm</link>
            <author>
                <![CDATA[来源: 投稿]]>
            </author>
        </item>
        <item>
            <title>
                <![CDATA[12.23 源创会·上海站，聊聊 LLM 基础设施]]>
            </title>
            <description>
                <![CDATA[12.23 源创会·上海站，聊聊 LLM 基础设施]]>
            </description>
            <pubDate>Sat, 16 Dec 2023 16:57:00 GMT</pubDate>
            <guid isPermaLink="false">https://www.oschina.net/event/2331502</guid>
            <link>https://www.oschina.net/event/2331502</link>
        </item>
        <item>
            <title>
                <![CDATA[商汤科技创始人汤晓鸥离世，享年 55 岁]]>
            </title>
            <description>
                <![CDATA[<div class="content"><p>12 月 16 日，腾讯新闻报道称，商汤科技董事长、人工智能科学家汤晓鸥于 12 月 15 日在睡梦中不幸离世，享年 55 岁。</p><p>汤晓鸥主要从事计算机视觉相关领域的研究，包括多媒体、计算机视觉、模式识别及视频处理，是全球人脸识别技术的「开拓者」和「探路者」。</p><blockquote><p><img height="1272" src="https://static.oschina.net/uploads/space/2023/1216/153402_su2B_2720166.png" width="1442" referrerpolicy="no-referrer"></p><p>来源：<em><u><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fview.inews.qq.com%2Fa%2F20231216A051VT00" target="_blank"><span style="background-color:rgba(0, 0, 0, 0); color:inherit">https://</span>view.inews.qq.com/a/20231216A051<span style="background-color:rgba(0, 0, 0, 0); color:inherit">VT00</span></a></u></em></p></blockquote><p>最早的网传消息：</p><blockquote><p><img src="https://static.oschina.net/uploads/space/2023/1216/153606_97lp_2720166.png" referrerpolicy="no-referrer"></p><p>来源：<em><u><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fweibo.com%2F1644054135%2FNxokl6vOQ%3Fpagetype%3Dprofilefeed" target="_blank">https://weibo.com/1644054135/Nxokl6vOQ</a></u></em></p></blockquote><p>公开信息显示，汤晓鸥 1968 年出生于辽宁鞍山，香港中文大学信息工程学系教授、工程学院杰出学人。汤晓鸥于 1990 年从中国科学技术大学毕业；1991 年获得美国罗切斯特大学硕士学位；1996 年获得麻省理工学院博士学位，之后进入香港中文大学工作；2001 年创立了香港中文大学多媒体实验室；2005 年至 2007 年在微软亚洲研究院工作，担任视觉计算组主任；2008 年在深圳先进技术研究院多媒体集成技术研究室工作，担任主任和研究员。</p><p><img height="457" src="https://oscimg.oschina.net/oscnet/up-a417892a92b7c38cf49b69a36526d033f48.png" width="300" referrerpolicy="no-referrer"></p><p><span style="background-color:#ffffff; color:#333333">汤晓鸥指导的博士生何恺明是深度残差网络 (ResNets) 的主要开发者。深度残差网络</span>使神经网络能够达到前所未有的深度，获得以前难以实现的能力，促成了多个突破性的成果——包括 AlphaGo、AlphaFold 和 ChatGPT，为人工智能做出了基础性贡献。</p></div>
                                    ]]>
            </description>
            <pubDate>Sat, 16 Dec 2023 07:34:00 GMT</pubDate>
            <guid isPermaLink="false">https://www.oschina.net/news/271336</guid>
            <link>https://www.oschina.net/news/271336</link>
            <author>
                <![CDATA[来源: OSCHINA]]>
            </author>
        </item>
        <item>
            <title>
                <![CDATA[Chrome 测试限制跨站点跟踪功能，以逐步淘汰第三方 Cookie]]>
            </title>
            <description>
                <![CDATA[<div class="content"><p><span style="color:#000000">谷歌 Chrome 浏览器正在测试 Tracking Protection，一项可限制<span style="background-color:#ffffff">跨站点跟踪的新功能</span>。</span></p><p><span style="color:#000000">这项新功能是谷歌"</span><span style="background-color:#ffffff; color:#202124">Privacy Sandbox</span><span style="color:#000000">"计划的一部分，该计划旨在以负责任的方式在 2024 年下半年逐步淘汰第三方 cookie，其中包括为网站创建新的工具来实现基本功能，并给予开发人员适应的时间。</span></p><p><span style="color:#000000">Tracking Protection&nbsp;<span style="background-color:#ffffff">的引入将首先从一小部分 Chrome 用户开始，公告透露，</span>他们将于 2024 年 1 月 4 日开始测试 Tracking Protection 功能，面向全球 1% 的 Chrome 浏览器用户推出。</span></p><p><span style="color:#000000">近三十年来，第三方 cookie 一直是网络的基本组成部分。它们可用于跟踪网站活动，但网站同时也在使用它们来支持一系列在线体验，例如帮助用户登录或展示相关广告。</span></p><blockquote><p><span style="color:#000000">「通过 Privacy Sandbox，我们正在采取负责任的方式逐步淘汰 Chrome 中的第三方 Cookie。我们为网站构建了新工具，支持关键用例，并为开发人员提供了过渡时间。我们将从一小部分 Chrome 用户开始引入 Tracking Protection，以便开发者可以测试他们对没有第三方 Cookie 的网络的准备情况。」</span></p></blockquote><p>参与&nbsp;<span style="color:#000000">Tracking Protection 功能试用的用户将随机抽取。被选中的用户在</span><span style="background-color:#ffffff; color:#202124">打开 Chrome 浏览器时，会收到相关通知。启用该功能后，用户在浏览网页时，默认情况下第三方 cookie 将受到限制，从而限制在不同网站上跟踪的能力。</span></p><p><span style="background-color:#ffffff; color:#202124"><img alt="" height="344" src="https://oscimg.oschina.net/oscnet/up-57f1c84f1b3c261331013a59a537fd1aae8.webp" width="500" referrerpolicy="no-referrer"></span></p><p><span style="background-color:#ffffff; color:#202124">如果某个网站在没有第三方 cookie 的情况下无法运行，而 Chrome 浏览器又发现用户遇到了该问题（比如进行了多次页面刷新），就会在地址栏右侧的眼睛图标上提示用户暂时重新启用该网站的第三方 cookie。</span></p><p><span style="background-color:#ffffff; color:#202124"><img alt="" height="300" src="https://oscimg.oschina.net/oscnet/up-7dfa96f75c4d4ba43aa7ade9fd6ab653d77.gif" width="300" referrerpolicy="no-referrer"></span></p><p><span style="color:#000000">此前，谷歌方面已经发布一系列 Privacy Sandbox 更新。 譬如 8 月推出了 Project Flight，该项目包含一系列示例应用程序，共同展示了 Privacy Sandbox API 在真实用户体验中的实际应用。</span></p><p><span style="color:#000000">更多详情可<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fblog.google%2Fproducts%2Fchrome%2Fprivacy-sandbox-tracking-protection%2F" target="_blank">查看官方博客</a>。</span></p><p><strong><span style="color:#000000">相关阅读：</span></strong></p><ul><li><a href="https://www.oschina.net/news/204434/google-delays-third-party-cookies" target="_blank">2022、2023 再到 2024，谷歌再次推迟 Cookies 淘汰时间</a></li></ul></div>
                                    ]]>
            </description>
            <pubDate>Sat, 16 Dec 2023 04:18:00 GMT</pubDate>
            <guid isPermaLink="false">https://www.oschina.net/news/271417/google-chrome-tracking-protection</guid>
            <link>https://www.oschina.net/news/271417/google-chrome-tracking-protection</link>
            <author>
                <![CDATA[来源: OSCHINA]]>
            </author>
        </item>
        <item>
            <title>
                <![CDATA[ONF 解散，将所有业务转移到 Linux 基金会]]>
            </title>
            <description>
                <![CDATA[<div class="content"><p>Open Networking Foundation (ONF) <a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fwww.linuxfoundation.org%2Fpress%2Fonf-merges-market-leading-portfolio-of-networking-projects-into-linux-foundation" target="_blank">宣布</a>，其涵盖接入、边缘和云解决方案的领先开源网络项目组合将毕业成为 Linux 基金会下的独立项目。「此举为三个主要项目领域（Broadband，Aether 和 P4）创造了独立的、由社区领导的治理，并为项目的广泛协作和采用奠定了基础。」</p><p><img alt="" height="281" src="https://oscimg.oschina.net/oscnet/up-7377a8aba31c8b7c4d29de527f9310b8382.webp" width="500" referrerpolicy="no-referrer"></p><p>由于此次合并，ONF 将解散，将所有业务转移到 Linux 基金会。Linux 基金会将创建三个新的项目指导基金，以支持技术项目的工作，包括：</p><ul><li>LF Broadband Directed Fund - 支持一系列改变宽带网络和被动光纤网络（Passive Optical Network，PON）行业的项目。该组合包括用于构建开放宽带网络的 SEBA 参考设计和用于虚拟化多厂商 PON 系统的 VOLTHA 开源项目。这些项目已在德国电信、Jio、Türk Telekom 等世界各地部署。</li><li>Aether Directed Fund - 支持一系列 5G 移动网络项目，包括 Aether（私有 5G 和边缘计算）、SD-Core（开放 5G 移动核心）和 SD-RAN（开放 RAN）。电信、商业和研究部署依赖于这些项目，并且刚刚获得了 200 万美元的美国政府研究拨款，以推动 5G 网络的节能和可持续性。</li><li>P4 Directed Fund - 支持一系列工作，实现网络数据平面的可编程性，包括 P4 体系结构、语言、API、应用和平台。其中包括可编程网络 Fabric 的开源编译器和堆栈实现（SD-Fabric、Stratum），在从云到数据中心和运营商边缘网络（如 Comcast、Google、SKT、腾讯和巴西的空中交通管制系统）的各种部署中。</li></ul><p>公告称，ONF 与 LF 的合并反映了项目治理的变化，但保留了基于社区合作的技术项目的演进过程，以适应市场需求的变化。</p><p>ONF 现有的技术指导团队<span style="color:#000000">将继续指导技术工作</span>。但成立了新的管理委员会，以领导每个新指导基金，使社区完全拥有项目的方向和 ONF 为指导基金提供的约 500 万美元资金的应用权。这些资金将用于有选择地为项目提供工程人员的支持。</p><p>&nbsp;详情可<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fwww.linuxfoundation.org%2Fpress%2Fonf-merges-market-leading-portfolio-of-networking-projects-into-linux-foundation" target="_blank">查看官方公告</a>。</p></div>
                                    ]]>
            </description>
            <pubDate>Sat, 16 Dec 2023 03:31:00 GMT</pubDate>
            <guid isPermaLink="false">https://www.oschina.net/news/271412/onf-linux-foundation</guid>
            <link>https://www.oschina.net/news/271412/onf-linux-foundation</link>
            <author>
                <![CDATA[来源: OSCHINA]]>
            </author>
        </item>
        <item>
            <title>
                <![CDATA[HTTPie Desktop —— 跨平台 API 测试客户端]]>
            </title>
            <description>
                <![CDATA[<div class="content"><p>HTTPie for Web &amp; Desktop，跨平台 API 测试客户端，轻松测试 REST、GraphQL 和 HTTP API。目前已发布了适用于 Mac、Windows 和 Linux 的 HTTPie for Desktop 版本。初次安装后，应用程序会持续自动更新。</p><p><strong>特点：</strong></p><ul style="margin-left:0; margin-right:0"><li><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span style="color:rgb(209 209 207/var(--tw-text-opacity))"><span><span><span><span>与 API 轻松交互</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></li><li><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span style="color:rgb(209 209 207/var(--tw-text-opacity))"><span><span><span><span>利用人工智能辅助工作的力量</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></li><li><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span style="color:rgb(209 209 207/var(--tw-text-opacity))"><span><span><span><span>在空间、集合和选项卡中组织您的工作</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></li><li><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span style="color:rgb(209 209 207/var(--tw-text-opacity))"><span><span><span><span>使用变量和环境参数化请求</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></li><li><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span style="color:rgb(209 209 207/var(--tw-text-opacity))"><span><span><span><span>通过自动保存和实时同步跨设备工作</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></li><li><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span style="color:rgb(209 209 207/var(--tw-text-opacity))"><span><span><span><span>构建并预览请求而不发送请求</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></li><li><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span style="color:rgb(209 209 207/var(--tw-text-opacity))"><span><span><span><span>无需帐户即可离线使用该应用程序</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></li></ul><p><img alt="" height="307" src="https://static.oschina.net/uploads/space/2023/1009/155957_SR87_4252687.png" width="500" referrerpolicy="no-referrer"></p></div>
                                                                ]]>
            </description>
            <pubDate>Sat, 16 Dec 2023 03:20:00 GMT</pubDate>
            <guid isPermaLink="false">https://www.oschina.net/p/httpie-desktop</guid>
            <link>https://www.oschina.net/p/httpie-desktop</link>
        </item>
        <item>
            <title>
                <![CDATA[Gitee 推荐 | 基于 eBPF 的 Linux 审计观测工具 safeguard]]>
            </title>
            <description>
                <![CDATA[<h1><a id="user-content-safeguard-linux-security-audit-control-and-behavior-analysis-tools-based-on-krsiebpflsm" class="anchor" href="https://gitee.com/openeuler/safeguard#safeguard-linux-security-audit-control-and-behavior-analysis-tools-based-on-krsiebpflsm"></a>safeguard: Linux security audit, control, and behavior analysis tools based on KRSI(eBPF+LSM)</h1><p>针对操作系统、内核安全，safeguard 是一个基于 eBPF 的 Linux 审计观测工具，可以实现安全操作的拦截及审计记录。项目采用 libbpfgo 库，使用 go 语言实现顶层控制</p><h1><a id="user-content-特性" class="anchor" href="https://gitee.com/openeuler/safeguard#%E7%89%B9%E6%80%A7"></a>特性</h1><ul><li>审计：日志记录配置范围内的行为</li><li>控制：针对文件，进程，网络的安全访问控制</li><li>行为分析：收集信息，进行资源，热点，异常等分析</li><li>主机管理：从安全角度自动化构建细粒度资产信息</li><li>风险管理：精准发现内部风险，快速定位问题并有效解决安全风险</li><li>入侵检测：提供多锚点的检测能力，能够实时、准确的感知入侵事件，发现失陷主机，并提供对入侵事件的响应手段。</li></ul><p><img src="https://gitee.com/openeuler/safeguard/raw/master/docs/architecture.png" alt="architecture" referrerpolicy="no-referrer"></p><h1><a id="user-content-编译" class="anchor" href="https://gitee.com/openeuler/safeguard#%E7%BC%96%E8%AF%91"></a>编译</h1><div class="white"><div class="highlight markdown-code-block"><pre><span id="LC1" class="line"><span class="nv">$ </span>git clone <span class="nt">--recursive</span> https://gitee.com/openeuler/safeguard.git <span class="o">&amp;&amp;</span><span class="nb">cd </span>safeguard</span><span id="LC2" class="line"><span class="c"># $ vagrant up &amp;&amp; vagrant reload</span></span><span id="LC3" class="line"><span class="c"># $ vagrant ssh</span></span><span id="LC4" class="line"></span><span id="LC5" class="line"><span class="nv">$ </span>make libbpf-static</span><span id="LC6" class="line"><span class="nv">$ </span>make build</span><span id="LC7" class="line"></span><span id="LC8" class="line"><span class="nv">$ </span><span class="nb">sudo</span> ./build/safeguard <span class="nt">--config</span> config/safeguard.yml <span class="c">#|grep BLOCK</span></span></pre><div class="markdown-code-block-copy-btn"></div></div></div><h1><a id="user-content-项目功能部分位于开发阶段" class="anchor" href="https://gitee.com/openeuler/safeguard#%E9%A1%B9%E7%9B%AE%E5%8A%9F%E8%83%BD%E9%83%A8%E5%88%86%E4%BD%8D%E4%BA%8E%E5%BC%80%E5%8F%91%E9%98%B6%E6%AE%B5"></a>项目功能 (部分位于开发阶段)</h1><h3><a id="user-content-审计控制" class="anchor" href="https://gitee.com/openeuler/safeguard#%E5%AE%A1%E8%AE%A1%E6%8E%A7%E5%88%B6"></a>审计控制</h3><p>文件：</p><ul><li>追踪文件系统的活动，包括文件的打开、关闭、读写、删除等。</li><li>修改文件系统的行为，例如拦截某些文件操作，或者实现自定义的<strong>安全策略</strong>。
安全策略：
<ol><li>拦截或重定向某些文件操作，使用 eBPF 来拦截对敏感文件的读写操作，或者重定向对某些文件的访问到其他位置。</li><li>实现自定义的访问控制，使用 eBPF 来检查对文件的访问者的身份、权限、环境等信息，然后根据一些规则来允许或拒绝访问。</li><li>实现自定义的审计和监控，使用 eBPF 来记录对某些文件的操作的详细信息，如操作者、时间、内容等，并将这些信息输出到日志。</li></ol></li></ul><p>进程：</p><ul><li>追踪进程的生命周期，例如进程的创建、终止、调度、上下文切换等。</li><li>修改进程的行为，例如注入或修改某些系统调用，或者实现自定义的调度策略。</li></ul><p>网络：</p><ul><li>追踪网络的活动，例如网络包的发送、接收、转发、丢弃等。</li><li>修改网络的行为，例如过滤或重写某些网络包，或者实现自定义的路由策略。</li></ul><h3><a id="user-content-行为分析" class="anchor" href="https://gitee.com/openeuler/safeguard#%E8%A1%8C%E4%B8%BA%E5%88%86%E6%9E%90"></a>行为分析</h3><ul><li><p>收集并分析文件系统的性能、热点、异常等。（选择合适的 eBPF 程序类型和挂载点，例如，使用 kprobes 或 tracepoints 来追踪文件系统相关的内核函数或事件，如 vfs_read, vfs_write, ext4_sync_file 等。）</p></li><li><p>收集信息来分析进程的资源消耗、状态变化、依赖关系等（do_fork, do_exit, schedule 等）。</p></li><li><p>收集信息，分析网络的流量、延迟、丢包率、拥塞等（使用 tc 或 xdp 来追踪网络包的发送、接收、转发、丢弃等事件）。</p></li></ul><h3><a id="user-content-主机管理" class="anchor" href="https://gitee.com/openeuler/safeguard#%E4%B8%BB%E6%9C%BA%E7%AE%A1%E7%90%86"></a>主机管理</h3><p>从安全角度自动化构建细粒度资产信息，支持对业务层资产精准识别和动态感知，让保护对象清晰可见。</p><ul><li>账号展示</li><li>端口列表</li><li>进程列表</li></ul><h3><a id="user-content-风险管理" class="anchor" href="https://gitee.com/openeuler/safeguard#%E9%A3%8E%E9%99%A9%E7%AE%A1%E7%90%86"></a>风险管理</h3><p>精准发现内部风险，快速定位问题并有效解决安全风险，提供详细的资产信息、风险信息以供分析和响应。</p><ul><li>漏洞检测</li><li>安全补丁</li><li>弱密码</li><li>系统风险</li><li>账号风险</li></ul><h3><a id="user-content-入侵检测" class="anchor" href="https://gitee.com/openeuler/safeguard#%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B"></a>入侵检测</h3><p>提供多锚点的检测能力，能够实时、准确的感知入侵事件，发现失陷主机，并提供对入侵事件的响应手段。</p><ul><li>暴力破解</li><li>异常登录</li><li>反弹 shell</li><li>本地提权</li><li>后门检测，Web 后门</li></ul><h1><a id="user-content-开发路线" class="anchor" href="https://gitee.com/openeuler/safeguard#%E5%BC%80%E5%8F%91%E8%B7%AF%E7%BA%BF"></a>开发路线</h1><table><thead><tr><th></th><th></th><th align="center">23.12（22.03 LTS SP3）</th><th align="center">24.03 LTS</th><th align="center">24.09 创新版本</th><th align="center">24.09（24.03 LTS SP1）</th><th align="center">已实现</th></tr></thead><tbody><tr><td>控制-主机规则设置</td><td>文件操作拦截</td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center">✓</td></tr><tr><td></td><td>进程拦截（采用 path hook）</td><td align="center">✓</td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td></td><td>网络拦截</td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center">✓</td></tr><tr><td>主机管理</td><td>账号</td><td align="center">✓</td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td></td><td>端口</td><td align="center">✓</td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td></td><td>进程</td><td align="center">✓</td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td>风险管理</td><td>漏洞检测</td><td align="center"></td><td align="center"></td><td align="center">✓</td><td align="center"></td><td align="center"></td></tr><tr><td></td><td>安全补丁</td><td align="center"></td><td align="center"></td><td align="center">✓</td><td align="center"></td><td align="center"></td></tr><tr><td></td><td>弱密码</td><td align="center"></td><td align="center"></td><td align="center">✓</td><td align="center"></td><td align="center"></td></tr><tr><td></td><td>系统风险</td><td align="center"></td><td align="center"></td><td align="center">✓</td><td align="center"></td><td align="center"></td></tr><tr><td></td><td>账号风险</td><td align="center"></td><td align="center"></td><td align="center">✓</td><td align="center"></td><td align="center"></td></tr><tr><td>入侵检测</td><td>暴力破解</td><td align="center"></td><td align="center">✓</td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td></td><td>异常登录</td><td align="center"></td><td align="center">✓</td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td></td><td>反弹 shell</td><td align="center"></td><td align="center"></td><td align="center">✓</td><td align="center"></td><td align="center"></td></tr><tr><td></td><td>本地提权</td><td align="center"></td><td align="center">✓</td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td></td><td>后门检测，Web 后门</td><td align="center"></td><td align="center"></td><td align="center">✓</td><td align="center"></td><td align="center"></td></tr><tr><td>安全日志</td><td>审计日志：文件 hook 拦截方式由路径更改为 inode</td><td align="center">✓</td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center">✓</td></tr><tr><td></td><td>登录日志</td><td align="center">✓</td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td></td><td>账户变更日志</td><td align="center"></td><td align="center">✓</td><td align="center"></td><td align="center"></td><td align="center"></td></tr></tbody></table><h1><a id="user-content-license" class="anchor" href="https://gitee.com/openeuler/safeguard#license"></a>LICENSE</h1><p>safeguard's userspace program is licensed under Apache License 2.0 License.<br>
eBPF programs inside <a href="https://gitee.com/openeuler/safeguard/blob/master/pkg/bpf">pkg/bpf directory</a> are licensed under <a href="https://gitee.com/openeuler/safeguard/blob/master/pkg/bpf/LICENSE.md">GNU General Public License version 2</a>.</p>]]>
            </description>
            <pubDate>Sat, 16 Dec 2023 03:14:00 GMT</pubDate>
            <guid isPermaLink="false">https://gitee.com/openeuler/safeguard</guid>
            <link>https://gitee.com/openeuler/safeguard</link>
        </item>
        <item>
            <title>
                <![CDATA[每日一博 | PWA 离线方案研究报告]]>
            </title>
            <description>
                <![CDATA[<div class="content"><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><span><span><span>本文并不是介绍如何将一个网页配置成离线应用并支持安装下载的。研究 PWA 的目的仅仅是为了保证用户的资源可以直接从本地加载，来忽略全国或者全球网络质量对页面加载速度造成影响。当然，如果页面上所需的资源，除了资源文件外并不需要任何的网络请求，那它除了不支持</span></span></span><span><span><strong><span>安装到桌面</span></strong></span></span><span><span><span>，已经算是一个离线应用了。</span></span></span></p><span id="OSC_h1_1"></span><h1><span><span><span>什么是 PWA</span></span></span></h1><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><span><span><span>PWA（Progressive Web App）是一种结合了网页和原生应用程序功能的新型应用程序开发方法。PWA 通过使用现代 Web 技术，例如 Service Worker 和 Web App Manifest，为用户提供了类似原生应用的体验。</span></span></span></p><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><strong><span><span><span>从用户角度来看，PWA 具有以下特点：</span></span></span></strong></p><div><span>1.</span><span><span><span><span>可离线访问：PWA 可以在离线状态下加载和使用，使用户能够在没有网络连接的情况下继续浏览应用；</span></span></span></span></div><div><span>2.</span><span><span><span><span>可安装：用户可以将 PWA 添加到主屏幕，就像安装原生应用一样，方便快捷地访问；</span></span></span></span></div><div><span>3.</span><span><span><span><span>推送通知：PWA 支持推送通知功能，可以向用户发送实时更新和提醒；</span></span></span></span></div><div><span>4.</span><span><span><span><span>响应式布局：PWA 可以适应不同设备和屏幕大小，提供一致的用户体验。</span></span></span></span></div><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><strong><span><span><span>从开发者角度来看，PWA 具有以下优势：</span></span></span></strong></p><div><span>1.</span><span><span><span><span>跨平台开发：PWA 可以在多个平台上运行，无需单独开发不同的应用程序；</span></span></span></span></div><div><span>2.</span><span><span><span><span>更新便捷：PWA 的更新可以通过服务器端更新 Service Worker 来实现，用户无需手动更新应用；</span></span></span></span></div><div><span>3.</span><span><span><span><span>可发现性：PWA 可以通过搜索引擎进行索引，增加应用的可发现性；</span></span></span></span></div><div><span>4.</span><span><span><span><span>安全性：PWA 使用 HTTPS 协议传输数据，提供更高的安全性。</span></span></span></span></div><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><span><span><span>总之，PWA 是一种具有离线访问、可安装、推送通知和响应式布局等特点的新型应用开发方法，为用户提供更好的体验，为开发者带来更高的效率。</span></span></span></p><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><span><span><span>我们从 PWA 的各种能力中，聚焦下其</span></span></span><span><span><strong><span>可离线访问</span></strong></span></span><span><span><span>的能力。</span></span></span></p><span id="OSC_h1_2"></span><h1><span><span><span>Service Worker</span></span></span></h1><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><span><span><span>离线加载本质上是页面所需的各种</span></span></span><span><span><code><span>js</span></code></span></span><span><span><span>、</span></span></span><span><span><code><span>css</span></code></span></span><span><span><span>以及页面本身的</span></span></span><span><span><code><span>html</span></code></span></span><span><span><span>，都可以缓存到本地，不再从网络上请求。这个能力是通过</span></span></span><span><span><code><span>Service Worker</span></code></span></span><span><span><span>来实现的。</span></span></span></p><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><span><span><span>Service Worker 是一种在浏览器背后运行的脚本，用于处理网络请求和缓存数据。它可以拦截和处理网页请求，使得网页能够在离线状态下加载和运行。Service Worker 可以缓存资源，包括 HTML、CSS、JavaScript 和图像等，从而提供更快的加载速度和离线访问能力。它还可以实现推送通知和后台同步等功能，为 Web 应用带来更强大的功能和用户体验。</span></span></span></p><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><span><span><span>某些情况下，Service Worker 和浏览器插件的 background 很相似，但在功能和使用方式上有一些区别：</span></span></span></p><ul><li><span><span><span><strong><span>功能差异：</span></strong></span></span><span><span><span> Service Worker 主要用于处理网络请求和缓存数据，可以拦截和处理网页请求，实现离线访问和资源缓存等功能。而浏览器插件的 background 主要用于扩展浏览器功能，例如修改页面、拦截请求、操作 DOM 等。</span></span></span></span></li><li><span><span><span><strong><span>运行环境：</span></strong></span></span><span><span><span> Service Worker 运行在浏览器的后台，独立于网页运行。它可以在网页关闭后继续运行，并且可以在多个页面之间共享状态。而浏览器插件的 background 也在后台运行，但是它的生命周期与浏览器窗口相关，关闭浏览器窗口后插件也会被终止。</span></span></span></span></li><li><span><span><span><strong><span>权限限制：</span></strong></span></span><span><span><span> 由于安全考虑，Service Worker 受到一定的限制，无法直接访问 DOM，只能通过 postMessage() 方法与网页进行通信。而浏览器插件的 background 可以直接操作 DOM，对页面有更高的控制权。</span></span></span></span></li></ul><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><span><span><span>总的来说，Service Worker 更适合用于处理网络请求和缓存数据，提供离线访问和推送通知等功能；而浏览器插件的 background 则更适合用于扩展浏览器功能，操作页面 DOM，拦截请求等。</span></span></span></p><span id="OSC_h1_3"></span><h1><span><span><span>注册</span></span></span></h1><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><span><span><span>注册一个 Service Worker 其实是非常简单的，下面举个简单的例子</span></span></span></p><pre><code><span><span><span style="color:#708090">&lt;!-- index.html --&gt;</span></span><span><span></span></span><span><span style="color:#708090">&lt;!DOCTYPE html&gt;</span></span><span><span></span></span><span><span style="color:#990055">&lt;html&gt;</span></span><span><span></span></span><span><span style="color:#990055">&lt;head&gt;</span></span><span><span></span></span><span><span style="color:#990055">&lt;title&gt;</span></span><span><span>Service Worker 示例</span></span><span><span style="color:#990055">&lt;/title&gt;</span></span><span><span></span></span><span><span style="color:#990055">&lt;/head&gt;</span></span><span><span></span></span><span><span style="color:#990055">&lt;body&gt;</span></span><span><span></span></span><span><span style="color:#990055">&lt;script&gt;</span></span><span><span>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function() {
        navigator.serviceWorker.register('/service-worker.js')
          .then(function(registration) {
            console.log('Service Worker 注册成功:', registration.scope);
          })
          .catch(function(error) {
            console.log('Service Worker 注册失败:', error);
          });
      });
    }
  </span></span><span><span style="color:#990055">&lt;/script&gt;</span></span><span><span></span></span><span><span style="color:#990055">&lt;/body&gt;</span></span><span><span></span></span><span><span style="color:#990055">&lt;/html&gt;</span></span><span><span></span></span></span></code></pre><pre><code><span><span><span style="color:#708090">// service-worker.js</span></span><span><span></span></span><span><span style="color:#708090">// 定义需要预缓存的文件列表</span></span><span><span></span></span><span><span style="color:#0077aa">const</span></span><span><span> filesToCache </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=</span></span><span><span></span></span><span><span style="color:#999999">[</span></span><span><span></span></span><span><span style="color:#669900">'/'</span></span><span><span style="color:#999999">,</span></span><span><span></span></span><span><span style="color:#669900">'/index.html'</span></span><span><span style="color:#999999">,</span></span><span><span></span></span><span><span style="color:#669900">'/styles.css'</span></span><span><span style="color:#999999">,</span></span><span><span></span></span><span><span style="color:#669900">'/script.js'</span></span><span><span style="color:#999999">,</span></span><span><span></span></span><span><span style="color:#669900">'/image.jpg'</span></span><span><span></span></span><span><span style="color:#999999">]</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#708090">// 安装 Service Worker 时进行预缓存</span></span><span><span>
self</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">addEventListener</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#669900">'install'</span></span><span><span style="color:#999999">,</span></span><span><span></span></span><span><span style="color:#0077aa">function</span></span><span><span style="color:#999999">(</span></span><span><span>event</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span>
  event</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">waitUntil</span></span><span><span style="color:#999999">(</span></span><span><span>
    caches</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">open</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#669900">'my-cache'</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">then</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#0077aa">function</span></span><span><span style="color:#999999">(</span></span><span><span>cache</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span></span></span><span><span style="color:#0077aa">return</span></span><span><span> cache</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">addAll</span></span><span><span style="color:#999999">(</span></span><span><span>filesToCache</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#708090">// 激活 Service Worker</span></span><span><span>
self</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">addEventListener</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#669900">'activate'</span></span><span><span style="color:#999999">,</span></span><span><span></span></span><span><span style="color:#0077aa">function</span></span><span><span style="color:#999999">(</span></span><span><span>event</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span>
  event</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">waitUntil</span></span><span><span style="color:#999999">(</span></span><span><span>
    caches</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">keys</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">then</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#0077aa">function</span></span><span><span style="color:#999999">(</span></span><span><span>cacheNames</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span></span></span><span><span style="color:#0077aa">return</span></span><span><span> Promise</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">all</span></span><span><span style="color:#999999">(</span></span><span><span>
        cacheNames</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">filter</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#0077aa">function</span></span><span><span style="color:#999999">(</span></span><span><span>cacheName</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span></span></span><span><span style="color:#0077aa">return</span></span><span><span> cacheName </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">!==</span></span><span><span></span></span><span><span style="color:#669900">'my-cache'</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">map</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#0077aa">function</span></span><span><span style="color:#999999">(</span></span><span><span>cacheName</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span></span></span><span><span style="color:#0077aa">return</span></span><span><span> caches</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">delete</span></span><span><span style="color:#999999">(</span></span><span><span>cacheName</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#708090">// 拦截 fetch 事件并从缓存中返回响应</span></span><span><span>
self</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">addEventListener</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#669900">'fetch'</span></span><span><span style="color:#999999">,</span></span><span><span></span></span><span><span style="color:#0077aa">function</span></span><span><span style="color:#999999">(</span></span><span><span>event</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span>
  event</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">respondWith</span></span><span><span style="color:#999999">(</span></span><span><span>
    caches</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">match</span></span><span><span style="color:#999999">(</span></span><span><span>event</span></span><span><span style="color:#999999">.</span></span><span><span>request</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">then</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#0077aa">function</span></span><span><span style="color:#999999">(</span></span><span><span>response</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span></span></span><span><span style="color:#0077aa">return</span></span><span><span> response </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">||</span></span><span><span></span></span><span><span style="color:#dd4a68">fetch</span></span><span><span style="color:#999999">(</span></span><span><span>event</span></span><span><span style="color:#999999">.</span></span><span><span>request</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span></span></code></pre><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><span><span><span>上述示例中，注册 Service Worker 的逻辑包含在 HTML 文件的</span></span></span><span><span><code><span>&lt;script&gt;</span></code></span></span><span><span><span>标签中。当浏览器加载页面时，会检查是否支持 Service Worker，如果支持，则注册 Service Worker 文件</span></span></span><span><span><code><span>/service-worker.js</span></code></span></span><span><span><span>。</span></span></span></p><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><span><span><span>Service Worker 文件中，首先定义了需要预缓存的文件列表</span></span></span><span><span><code><span>filesToCache</span></code></span></span><span><span><span>。在</span></span></span><span><span><code><span>install</span></code></span></span><span><span><span>事件中，将这些文件添加到缓存中。在</span></span></span><span><span><code><span>activate</span></code></span></span><span><span><span>事件中，删除旧缓存。在</span></span></span><span><span><code><span>fetch</span></code></span></span><span><span><span>事件中，拦截请求并从缓存中返回响应。</span></span></span></p><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><span><span><span>Service Worker 文件</span></span></span><span><span><code><span>service-worker.js</span></code></span></span><span><span><span>需要放置在页面的主域名下。在调用</span></span></span><span><span><code><span>navigator.serviceWorker.register('/service-worker.js')</span></code></span></span><span><span><span>时，可以在第二个参数中设置</span></span></span><span><span><code><span>scope</span></code></span></span><span><span><span>，用来确定 Service Worker 的影响范围，默认是 sw 文件所在 path 的作用域。</span></span></span></p><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><span><span><span>需要注意的是，如果 sw 文件被放置在</span></span></span><span><span><code><span>/a</span></code></span></span><span><span><span>目录下，是不能设置作用域为</span></span></span><span><span><code><span>/</span></code></span></span><span><span><span>的。因为文件本身路径的级别小于根路径。</span></span></span></p><span id="OSC_h1_4"></span><h1><span><span><span>使用</span></span></span></h1><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><span><span><span>当我们按照上面的示例，配置好了</span></span></span><span><span><code><span>html</span></code></span></span><span><span><span>及对应的</span></span></span><span><span><code><span>sw.js</span></code></span></span><span><span><span>后，启动服务并刷新页面，应该就能看到控制枱打印出了</span></span></span><span><span><code><span>Service Worker 注册成功</span></code></span></span><span><span><span>的日志。</span></span></span></p><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><span><span><span>如果在 chrome 浏览器中，可以打开控制枱，切换到应用 Tab，就能看到我们刚注册好的应用了。 </span></span></span></p><div><img alt="" src="https://s3.cn-north-1.jdcloud-oss.com/shendengbucket1/2023-12-02-17-022Ah2qfo8NupBJK8.png" referrerpolicy="no-referrer"></div><p><span style="color:transparent"><span><span><span>﻿</span></span></span></span><span><span><span>﻿</span></span></span></p><p><span><span><span>此时在浏览器的缓存空间中，也能发现我们开辟的缓存</span></span></span><span><span><code><span>my-cache</span></code></span></span><span><span><span>，内部存储着我们指定的预缓存文件</span></span></span><span><span><code><span>index.html</span></code></span></span><span><span><span>。由于我的项目只有根页面，所以只有一个条目。</span></span></span></p><div><img alt="" src="https://s3.cn-north-1.jdcloud-oss.com/shendengbucket1/2023-12-02-17-02z9Numw0dw0WYJTS.png" referrerpolicy="no-referrer"></div><p><span style="color:transparent"><span><span><span>﻿</span></span></span></span><span><span><span>﻿</span></span></span></p><p><span><span><span>此时如果页面所需的所有文件都被缓存了，即使将浏览器设置成断网模式，刷新页面也是能打开的。本文的目的并不是创建离线应用，下面我们讲讲上面方式会面临的问题。</span></span></span></p><span id="OSC_h3_5"></span><h3><span><span><span>如何确定预缓存范围</span></span></span></h3><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><span><span><span>如果我们的项目只有一个仓库，可以使用一些</span></span></span><span><span><code><span>webpack</span></code></span></span><span><span><span>插件，可以直接帮我们生成</span></span></span><span><span><code><span>sw</span></code></span></span><span><span><span>文件。每次重新构建都会生成新的文件，这样就不用担心多存或者少存文件了。同时，在下一章节的删除旧缓存中，每次更新版本号就好了。</span></span></span></p><blockquote><span><span><span>﻿</span></span></span><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdevelopers.google.com%2Fweb%2Ftools%2Fworkbox" target="_blank" rel="nofollow"><span><span><span>Workbox</span></span></span></a><span><span><span>是一个用于创建离线优先的网络应用程序的 JavaScript 库。它提供了一套工具和功能，帮助开发人员创建可靠的离线体验，并使网页应用程序能够在网络连接不稳定或断开的情况下正常工作。Workbox 可以用于缓存和提供离线资源，实现离线页面导航，处理后台同步和推送通知等功能。它能够简化离线应用程序的开发过程，并提供强大的缓存管理和资源加载能力。</span></span></span></blockquote><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><span><span><span>对于有统一配置后台的微前端项目，这个问题有些棘手。</span></span></span></p><div><span>1.</span><span><span><span><span>由于有后台管理，更新某个模块的文件很常见，但并不想每次都更新</span></span></span><span><span><code><span>sw.js</span></code></span></span><span><span><span>。</span></span></span></span></div><div><span>2.</span><span><span><span><span>由于资源的不确定性，无法在</span></span></span><span><span><code><span>precache</span></code></span></span><span><span><span>中列举出所有的资源列表，即使列举出了，可能用户永远也不会用到某个文件，造成缓存浪费或溢出。</span></span></span></span></div><div><span>3.</span><span><span><span><span>出于第 1、2 条缘由，更新</span></span></span><span><span><code><span>sw</span></code></span></span><span><span><span>文件后，无法确定如何删除旧缓存。</span></span></span></span></div><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><span><span><span>对于这个问题，首先确定的是，先在</span></span></span><span><span><code><span>precache</span></code></span></span><span><span><span>中列举出所有的基础底座的资源文件，并单独占用一个</span></span></span><span><span><code><span>cacheName</span></code></span></span><span><span><span>。</span></span></span></p><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><span><span><span>对于剩下的不确定性的业务文件，可以使用动态缓存的方式，这个会在后面具体讲解，也是本文要研究的重点。</span></span></span></p><span id="OSC_h3_6"></span><h3><span><span><span>资源更新</span></span></span></h3><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><span><span><span>由于刷新页面后，所有资源都从缓存中获取，此时修改</span></span></span><span><span><code><span>html</span></code></span></span><span><span><span>后，再刷新浏览器，页面并没有更新。</span></span></span></p><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><span><span><span>这个问题其实不用太担心，虽然我们的资源都被缓存了，但是</span></span></span><span><span><code><span>sw.js</span></code></span></span><span><span><span>本身是不会被缓存的。即使我们在下一次更新中，删除了页面上注册 Service Worker 的代码，已经注册的 Service Worker 也会一直激活，直到我们主动的删除它。</span></span></span></p><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><span><span><span>对于一般的 SPA 项目，上线后资源一般是不变的，如果我们希望更新页面，只需要更新</span></span></span><span><span><code><span>sw.js</span></code></span></span><span><span><span>就好。当注册的 Service Worker 文件发生变化时，浏览器会自动下载新的 Service Worker 文件，并在下一次访问页面时激活新的 Service Worker。</span></span></span></p><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><span><span><span>更新文件需要注意几个问题：</span></span></span></p><div><span>1.</span><span><span><span><strong><span>删除旧缓存：</span></strong></span></span></span></div><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><span><span><span>示例代码中，在</span></span></span><span><span><code><span>activate</span></code></span></span><span><span><span>阶段，我们执行了删除缓存的逻辑。真实环境中，一般会将</span></span></span><span><span><code><span>cacheName</span></code></span></span><span><span><span>带上版本号，每次更新</span></span></span><span><span><code><span>sw</span></code></span></span><span><span><span>都更新下版本号。这样每次都会将旧缓存删掉，并重新开辟新版本的缓存。各浏览器对于缓存超出后的处理是不同的，例如</span></span></span><span><span><code><span>chrome</span></code></span></span><span><span><span>就是缓存逐出策略。及时的清理缓存，可以防止出现一些奇怪的问题。</span></span></span></p><pre><code><span><span><span style="color:#0077aa">const</span></span><span><span> version </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=</span></span><span><span></span></span><span><span style="color:#669900">'v1'</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#0077aa">const</span></span><span><span> preCacheName </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=</span></span><span><span></span></span><span><span style="color:#669900">'pre-cache-'</span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">+</span></span><span><span> version</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#708090">// 将后文调用的 ’my-cache‘的位置替换为 preCacheName</span></span><span><span></span></span></span></code></pre><div><span>2.</span><span><span><span><strong><span>Service Worker 更新不及时：</span></strong></span></span></span></div><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><span><span><span>同一个域下，只能有一个 Service Worker 被激活，只有所有该域下的页面都关闭了，下一个注册的 Service Worker 才能被激活并取代上一个。对于某些用户来说，这个时间太长了。</span></span></span></p><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><span><span><span>因此，我们需要在</span></span></span><span><span><code><span>install</span></code></span></span><span><span><span>事件中，等待</span></span></span><span><span><code><span>precache</span></code></span></span><span><span><span>环节结束后，调用</span></span></span><span><span><code><span>self.skipWaiting();</span></code></span></span><span><span><span>来立即激活新的 Service Worker，但并不会立即接管控制所有客户端（即浏览器标签页）。这意味着旧的 Service Worker 仍然会处理当前打开的页面，直到这些页面被关闭或重新加载。</span></span></span></p><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><span><span><span>为了确保新的 Service Worker 可以立即接管所有客户端，在</span></span></span><span><span><code><span>activate</span></code></span></span><span><span><span>事件中调用</span></span></span><span><span><code><span>clients.claim()</span></code></span></span><span><span><span>方法。这个方法会在新的 Service Worker 激活后，立即接管所有已打开的页面，而不需要等待这些页面重新加载。这样可以确保新的 Service Worker 能够立即生效，提供更新的功能和服务。</span></span></span></p><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><span><span><span>更改完后的代码如下，这样修改后，</span></span></span><span><span><code><span>skipWaiting()</span></code></span></span><span><span><span>和</span></span></span><span><span><code><span>clients.claim()</span></code></span></span><span><span><span>方法会在异步操作完成后被调用，确保新的 Service Worker 在安装完成后立即激活并接管所有客户端。</span></span></span></p><pre><code><span><span><span style="color:#708090">// 安装 Service Worker 时进行预缓存</span></span><span><span>
self</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">addEventListener</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#669900">'install'</span></span><span><span style="color:#999999">,</span></span><span><span></span></span><span><span style="color:#0077aa">function</span></span><span><span></span></span><span><span style="color:#999999">(</span></span><span><span>event</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span>
  event</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">waitUntil</span></span><span><span style="color:#999999">(</span></span><span><span></span></span><span><span style="color:#999999">(</span></span><span><span style="color:#0077aa">async</span></span><span><span></span></span><span><span style="color:#0077aa">function</span></span><span><span></span></span><span><span style="color:#999999">(</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span></span></span><span><span style="color:#0077aa">await</span></span><span><span> caches
        </span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">open</span></span><span><span style="color:#999999">(</span></span><span><span>preCacheName</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">then</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#0077aa">function</span></span><span><span></span></span><span><span style="color:#999999">(</span></span><span><span>cache</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span></span></span><span><span style="color:#0077aa">return</span></span><span><span> cache</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">addAll</span></span><span><span style="color:#999999">(</span></span><span><span>filesToCache</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">then</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=&gt;</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span>
          self</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">skipWaiting</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#708090">// 激活 Service Worker</span></span><span><span>
self</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">addEventListener</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#669900">'activate'</span></span><span><span style="color:#999999">,</span></span><span><span></span></span><span><span style="color:#0077aa">function</span></span><span><span></span></span><span><span style="color:#999999">(</span></span><span><span>event</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span>
  event</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">waitUntil</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#0077aa">async</span></span><span><span></span></span><span><span style="color:#0077aa">function</span></span><span><span></span></span><span><span style="color:#999999">(</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span></span></span><span><span style="color:#0077aa">await</span></span><span><span></span></span><span><span style="color:#dd4a68">clearOutdateResources</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span>
    self</span></span><span><span style="color:#999999">.</span></span><span><span>clients</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">claim</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span></span></code></pre><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><span><span><span>现在，更新下</span></span></span><span><span><code><span>index.html</span></code></span></span><span><span><span>，然后将上述</span></span></span><span><span><code><span>sw.js</span></code></span></span><span><span><span>的更新保存，接着刷新两次页面 (不要着急，给注册和加载资源一些时间，可以在控制枱中观察下 Service Worker 的活跃状态以及缓存的变化)。</span></span></span></p><div><img alt="" src="https://s3.cn-north-1.jdcloud-oss.com/shendengbucket1/2023-12-02-17-060ft9bqjUqI5nj5X.png" referrerpolicy="no-referrer"></div><p><span style="color:transparent"><span><span><span>﻿</span></span></span></span><span><span><span>﻿</span></span></span></p><p><span><span><span>可以在某个时刻，发现同时存在两个 Service Worker，一个处于激活状态，是我们正在使用的，另一个处于待激活状态，因为正在进行</span></span></span><span><span><code><span>install</span></code></span></span><span><span><span>。此时缓存空间也会同时存在两个版本的缓存，等新的 Service Worker 激活后，就会删除旧缓存。然后就只存在一个最新的 Service Worker 了，同时缓存也只剩一个了。</span></span></span></p><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><span><span><span>现在每次用户打开新的页面，</span></span></span></p><ul><li><span><span><span><span>优先从缓存中获取资源</span></span></span></span></li><li><span><span><span><span>如果发现</span></span></span><span><span><code><span>sw</span></code></span></span><span><span><span>文件被更新，安装新的文件</span></span></span></span></li><li><span><span><span><span>文件内会下载新的资源，同时删除旧缓存，并且接管所有页面</span></span></span></span></li><li><span><span><span><span>用户下一次打开新页面或刷新当前页面，就会展示最新的内容</span></span></span></span></li></ul><span id="OSC_h1_7"></span><h1><span><span><span>能力扩展</span></span></span></h1><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><span><span><span>基础操作搞定了。但是上面我们还欠了点技术债，即如果不确定到底有哪些资源，怎么动态的做出缓存。不要着急，现在先进行下扩展阅读。</span></span></span></p><span id="OSC_h3_8"></span><h3><span><span><span>缓存的几种策略</span></span></span></h3><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><span><span><span>当谈到 Service Worker 缓存策略时，有以下几种常见的策略：</span></span></span></p><ul><li><span><span><span><span>Cache First（优先缓存）：首先尝试从缓存中获取响应，如果缓存中存在该资源，则直接返回；如果没有缓存或缓存过期，则向网络发送请求。</span></span></span></span></li><li><span><span><span><span>Network First（优先网络）：首先尝试从网络获取响应，如果网络请求成功，则返回网络响应；如果网络请求失败，则从缓存中获取响应，即使缓存过期也会返回缓存的响应。</span></span></span></span></li><li><span><span><span><span>Cache Only（仅缓存）：只从缓存中获取响应，不向网络发送请求。适用于完全离线可访问的资源。</span></span></span></span></li><li><span><span><span><span>Network Only（仅网络）：只从网络获取响应，不使用缓存。适用于需要实时数据的场景。</span></span></span></span></li><li><span><span><span><span>Stale-While-Revalidate（同时更新和使用缓存）：首先尝试从缓存中获取响应，如果缓存过期，则向网络发送请求获取最新响应，并更新缓存。同时返回缓存的响应，以便快速展示内容。</span></span></span></span></li></ul><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><span><span><span>上文中我们使用的，就是缓存优先模式。对于不怎么更新或者只有一个仓库的应用来说，使用</span></span></span><span><span><code><span>sw.js</span></code></span></span><span><span><span>文件的更新来说已经足够了。毕竟代码写的越多，bug 就越多。同比，更新的越频繁，系统就越不稳定。</span></span></span></p><span id="OSC_h3_9"></span><h3><span><span><span>Stale-While-Revalidate</span></span></span></h3><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><span><span><span>其他策略如果有兴趣，可以自行搜索，现在我们来讲下动态缓存是怎么实现的。毕竟对于微服务来说，不更新</span></span></span><span><span><code><span>sw</span></code></span></span><span><span><span>是最好的，如果能忘了它就更好了。</span></span></span></p><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><span><span><span>上文中我们介绍了</span></span></span><span><span><code><span>Cache First</span></code></span></span><span><span><span>，重新附下代码</span></span></span></p><pre><code><span><span><span style="color:#708090">// 拦截 fetch 事件并从缓存中返回响应</span></span><span><span>
self</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">addEventListener</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#669900">'fetch'</span></span><span><span style="color:#999999">,</span></span><span><span></span></span><span><span style="color:#0077aa">function</span></span><span><span></span></span><span><span style="color:#999999">(</span></span><span><span>event</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span>
  event</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">respondWith</span></span><span><span style="color:#999999">(</span></span><span><span>
    caches</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">match</span></span><span><span style="color:#999999">(</span></span><span><span>event</span></span><span><span style="color:#999999">.</span></span><span><span>request</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">then</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#0077aa">function</span></span><span><span></span></span><span><span style="color:#999999">(</span></span><span><span>response</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span></span></span><span><span style="color:#0077aa">return</span></span><span><span> response </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">||</span></span><span><span></span></span><span><span style="color:#dd4a68">fetch</span></span><span><span style="color:#999999">(</span></span><span><span>event</span></span><span><span style="color:#999999">.</span></span><span><span>request</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span></span></code></pre><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><span><span><span>新增一个</span></span></span><span><span><code><span>mock.js</span></code></span></span><span><span><span>，脚本会向 body 中新增一个字符串。将</span></span></span><span><span><code><span>js</span></code></span></span><span><span><span>文件使用</span></span></span><span><span><code><span>script</span></code></span></span><span><span><span>的方式加载。</span></span></span></p><pre><code><span><span><span style="color:#708090">// mock.js</span></span><span><span></span></span><span><span style="color:#0077aa">const</span></span><span><span> div </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=</span></span><span><span> document</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">createElement</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#669900">'div'</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span>
div</span></span><span><span style="color:#999999">.</span></span><span><span>innerText </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=</span></span><span><span></span></span><span><span style="color:#669900">'Hello World'</span></span><span><span style="color:#999999">;</span></span><span><span>
document</span></span><span><span style="color:#999999">.</span></span><span><span>body</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">appendChild</span></span><span><span style="color:#999999">(</span></span><span><span>div</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#708090">// index.html</span></span><span><span></span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">&lt;</span></span><span><span>script src</span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=</span></span><span><span style="color:#669900">"./mock.js"</span></span><span><span> type</span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=</span></span><span><span style="color:#669900">"text/javascript"</span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">&gt;</span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">&lt;</span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">/</span></span><span><span>script</span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">&gt;</span></span><span><span></span></span></span></code></pre><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><span><span><span>同时调整下</span></span></span><span><span><code><span>sw</span></code></span></span><span><span><span>的拦截逻辑。</span></span></span></p><pre><code><span><span><span style="color:#708090">// 新增 runtime 缓存</span></span><span><span></span></span><span><span style="color:#0077aa">const</span></span><span><span> runtimeCacheName </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=</span></span><span><span></span></span><span><span style="color:#669900">'runtime-cache-'</span></span><span><span></span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">+</span></span><span><span> version</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#708090">// 符合条件也是缓存优先，但是每次都重新发起网络请求更新缓存</span></span><span><span></span></span><span><span style="color:#0077aa">const</span></span><span><span></span></span><span><span>isStaleWhileRevalidate</span></span><span><span></span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=</span></span><span><span></span></span><span><span style="color:#999999">(</span></span><span><span>request</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=&gt;</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span></span></span><span><span style="color:#0077aa">const</span></span><span><span> url </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=</span></span><span><span> request</span></span><span><span style="color:#999999">.</span></span><span><span>url</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#0077aa">const</span></span><span><span> index </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=</span></span><span><span></span></span><span><span style="color:#999999">[</span></span><span><span style="color:#669900">'http://127.0.0.1:5500/mock.js'</span></span><span><span style="color:#999999">]</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">indexOf</span></span><span><span style="color:#999999">(</span></span><span><span>url</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#0077aa">return</span></span><span><span> index </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">!==</span></span><span><span></span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">-</span></span><span><span style="color:#990055">1</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span style="color:#999999">;</span></span><span><span>

self</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">addEventListener</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#669900">'fetch'</span></span><span><span style="color:#999999">,</span></span><span><span></span></span><span><span style="color:#0077aa">function</span></span><span><span></span></span><span><span style="color:#999999">(</span></span><span><span>event</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span>
  event</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">respondWith</span></span><span><span style="color:#999999">(</span></span><span><span></span></span><span><span style="color:#708090">// 尝试从缓存中获取响应</span></span><span><span>
    caches</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">match</span></span><span><span style="color:#999999">(</span></span><span><span>event</span></span><span><span style="color:#999999">.</span></span><span><span>request</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">then</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#0077aa">function</span></span><span><span></span></span><span><span style="color:#999999">(</span></span><span><span>response</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span></span></span><span><span style="color:#0077aa">var</span></span><span><span> fetchPromise </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=</span></span><span><span></span></span><span><span style="color:#dd4a68">fetch</span></span><span><span style="color:#999999">(</span></span><span><span>event</span></span><span><span style="color:#999999">.</span></span><span><span>request</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">then</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#0077aa">function</span></span><span><span></span></span><span><span style="color:#999999">(</span></span><span><span>networkResponse</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span></span></span><span><span style="color:#708090">// 符合匹配条件才克隆响应并将其添加到缓存中</span></span><span><span></span></span><span><span style="color:#0077aa">if</span></span><span><span></span></span><span><span style="color:#999999">(</span></span><span><span style="color:#dd4a68">isStaleWhileRevalidate</span></span><span><span style="color:#999999">(</span></span><span><span>event</span></span><span><span style="color:#999999">.</span></span><span><span>request</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span></span></span><span><span style="color:#0077aa">var</span></span><span><span> responseToCache </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=</span></span><span><span> networkResponse</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">clone</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span>
          caches</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">open</span></span><span><span style="color:#999999">(</span></span><span><span>runtimeCacheName</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">then</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#0077aa">function</span></span><span><span></span></span><span><span style="color:#999999">(</span></span><span><span>cache</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span>
            cache</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">put</span></span><span><span style="color:#999999">(</span></span><span><span>event</span></span><span><span style="color:#999999">.</span></span><span><span>request</span></span><span><span style="color:#999999">,</span></span><span><span> responseToCache</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">clone</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span></span></span><span><span style="color:#0077aa">return</span></span><span><span> networkResponse</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#708090">// 返回缓存的响应，然后更新缓存中的响应</span></span><span><span></span></span><span><span style="color:#0077aa">return</span></span><span><span> response </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">||</span></span><span><span> fetchPromise</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span></span></code></pre><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><span><span><span>现在每次用户打开新的页面，</span></span></span></p><ul><li><span><span><span><span>优先从缓存中获取资源，同时发起一个网络请求</span></span></span></span></li><li><span><span><span><span>有缓存则直接返回缓存，没有则返回一个</span></span></span><span><span><code><span>fetchPromise</span></code></span></span></span></li><li><span><span><span><code><span>fetchPromise</span></code></span></span><span><span><span>内部更新符合缓存条件的请求</span></span></span></span></li><li><span><span><span><span>用户下一次打开新页面或刷新当前页面，就会展示最新的内容</span></span></span></span></li></ul><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><span><span><span>通过修改</span></span></span><span><span><code><span>isStaleWhileRevalidate</span></code></span></span><span><span><span>中 url 的匹配条件，就能够控制是否更新缓存。在上面的示例中，我们可以将</span></span></span><span><span><code><span>index.html</span></code></span></span><span><span><span>从</span></span></span><span><span><code><span>precache</span></code></span></span><span><span><span>列表中移除，放入</span></span></span><span><span><code><span>runtime</span></code></span></span><span><span><span>中，或者专门处理下</span></span></span><span><span><code><span>index.html</span></code></span></span><span><span><span>的放置规则，去更新</span></span></span><span><span><code><span>precache</span></code></span></span><span><span><span>中的缓存。最好不要出现多个缓存桶中存在同一个</span></span></span><span><span><code><span>request</span></code></span></span><span><span><span>的缓存，那样就不知道走的到底是哪个缓存了。</span></span></span></p><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><span><span><span>一般来说，微前端的应用，资源文件都有个固定的存放位置，文件本身通过在文件名上增加</span></span></span><span><span><code><span>hash</span></code></span></span><span><span><span>或版本号来进行区分。我们在</span></span></span><span><span><code><span>isStaleWhileRevalidate</span></code></span></span><span><span><span>函数中匹配存放资源位置的路径，这样用户在第二次打开页面时，就可以直接使用缓存了。如果是内嵌页面，可以与平台沟通，是否可以在应用冷起的时候，偷偷访问一个资源页面，提前进行预加载，这样就能在首次打开的时候也享受本地缓存了。</span></span></span></p><span id="OSC_h3_10"></span><h3><span><span><span>缓存过期</span></span></span></h3><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><span><span><span>即使我们缓存了一些资源文件，例如 Iconfont、字体库等只会更新自身内容，但不会变化名称的文件。仅使用</span></span></span><span><span><code><span>Stale-While-Revalidate</span></code></span></span><span><span><span>其实也是可以的。用户会在第二次打开页面时看到最新的内容。</span></span></span></p><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><span><span><span>但为了提高一些体验，例如，用户半年没打开页面了，突然在今天打开了一下，展示历史的内容就不太合适了，这时候可以增加一个缓存过期的策略。</span></span></span></p><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><span><span><span>如果我们使用的是</span></span></span><span><span><code><span>Workbox</span></code></span></span><span><span><span>，通过使用</span></span></span><span><span><code><span>ExpirationPlugin</span></code></span></span><span><span><span>来实现的。</span></span></span><span><span><code><span>ExpirationPlugin</span></code></span></span><span><span><span>是</span></span></span><span><span><code><span>Workbox</span></code></span></span><span><span><span>中的一个缓存插件，它允许为缓存条目设置过期时间。示例如下所示</span></span></span></p><pre><code><span><span><span style="color:#0077aa">import</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span> registerRoute </span></span><span><span style="color:#999999">}</span></span><span><span></span></span><span><span style="color:#0077aa">from</span></span><span><span></span></span><span><span style="color:#669900">'workbox-routing'</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#0077aa">import</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span> CacheFirst</span></span><span><span style="color:#999999">,</span></span><span><span> StaleWhileRevalidate </span></span><span><span style="color:#999999">}</span></span><span><span></span></span><span><span style="color:#0077aa">from</span></span><span><span></span></span><span><span style="color:#669900">'workbox-strategies'</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#0077aa">import</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span> ExpirationPlugin </span></span><span><span style="color:#999999">}</span></span><span><span></span></span><span><span style="color:#0077aa">from</span></span><span><span></span></span><span><span style="color:#669900">'workbox-expiration'</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#708090">// 设置缓存的有效期为一小时</span></span><span><span></span></span><span><span style="color:#0077aa">const</span></span><span><span> cacheExpiration </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span>
  maxAgeSeconds</span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">:</span></span><span><span></span></span><span><span style="color:#990055">60</span></span><span><span></span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">*</span></span><span><span></span></span><span><span style="color:#990055">60</span></span><span><span style="color:#999999">,</span></span><span><span></span></span><span><span style="color:#708090">// 一小时</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#708090">// 使用 CacheFirst 策略，并应用 ExpirationPlugin</span></span><span><span></span></span><span><span style="color:#dd4a68">registerRoute</span></span><span><span style="color:#999999">(</span></span><span><span></span></span><span><span style="color:#999999">(</span></span><span><span>{ request }</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=&gt;</span></span><span><span> request</span></span><span><span style="color:#999999">.</span></span><span><span>destination </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">===</span></span><span><span></span></span><span><span style="color:#669900">'image'</span></span><span><span style="color:#999999">,</span></span><span><span></span></span><span><span style="color:#0077aa">new</span></span><span><span></span></span><span><span style="color:#dd4a68">CacheFirst</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#999999">{</span></span><span><span>
    cacheName</span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">:</span></span><span><span></span></span><span><span style="color:#669900">'image-cache'</span></span><span><span style="color:#999999">,</span></span><span><span>
    plugins</span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">:</span></span><span><span></span></span><span><span style="color:#999999">[</span></span><span><span></span></span><span><span style="color:#0077aa">new</span></span><span><span></span></span><span><span style="color:#dd4a68">ExpirationPlugin</span></span><span><span style="color:#999999">(</span></span><span><span>cacheExpiration</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">,</span></span><span><span></span></span><span><span style="color:#999999">]</span></span><span><span style="color:#999999">,</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#708090">// 使用 StaleWhileRevalidate 策略，并应用 ExpirationPlugin</span></span><span><span></span></span><span><span style="color:#dd4a68">registerRoute</span></span><span><span style="color:#999999">(</span></span><span><span></span></span><span><span style="color:#999999">(</span></span><span><span>{ request }</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=&gt;</span></span><span><span> request</span></span><span><span style="color:#999999">.</span></span><span><span>destination </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">===</span></span><span><span></span></span><span><span style="color:#669900">'script'</span></span><span><span style="color:#999999">,</span></span><span><span></span></span><span><span style="color:#0077aa">new</span></span><span><span></span></span><span><span style="color:#dd4a68">StaleWhileRevalidate</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#999999">{</span></span><span><span>
    cacheName</span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">:</span></span><span><span></span></span><span><span style="color:#669900">'script-cache'</span></span><span><span style="color:#999999">,</span></span><span><span>
    plugins</span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">:</span></span><span><span></span></span><span><span style="color:#999999">[</span></span><span><span></span></span><span><span style="color:#0077aa">new</span></span><span><span></span></span><span><span style="color:#dd4a68">ExpirationPlugin</span></span><span><span style="color:#999999">(</span></span><span><span>cacheExpiration</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">,</span></span><span><span></span></span><span><span style="color:#999999">]</span></span><span><span style="color:#999999">,</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span></span></code></pre><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><span><span><span>或者我们可以实现一下自己的缓存过期策略。首先是增加缓存过期时间。在原本的更新缓存的基础上，设置自己的</span></span></span><span><span><code><span>cache-control</span></code></span></span><span><span><span>，然后再放入缓存中。示例中直接删除了原本的</span></span></span><span><span><code><span>cache-control</span></code></span></span><span><span><span>，真正使用中，需要判断下，比如</span></span></span><span><span><code><span>no-cache</span></code></span></span><span><span><span>类型的资源，就不要使用缓存了。</span></span></span></p><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><span><span><span>每次命中缓存时，都会判断下是否过期，如果过期，则直接返回从网络中获取的最新的请求，并更新缓存。</span></span></span></p><pre><code><span><span><span>self</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">addEventListener</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#669900">'fetch'</span></span><span><span style="color:#999999">,</span></span><span><span></span></span><span><span style="color:#0077aa">function</span></span><span><span></span></span><span><span style="color:#999999">(</span></span><span><span>event</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span>
  event</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">respondWith</span></span><span><span style="color:#999999">(</span></span><span><span></span></span><span><span style="color:#708090">// 尝试从缓存中获取响应</span></span><span><span>
    caches</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">match</span></span><span><span style="color:#999999">(</span></span><span><span>event</span></span><span><span style="color:#999999">.</span></span><span><span>request</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">then</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#0077aa">function</span></span><span><span></span></span><span><span style="color:#999999">(</span></span><span><span>response</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span></span></span><span><span style="color:#0077aa">var</span></span><span><span> fetchPromise </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=</span></span><span><span></span></span><span><span style="color:#dd4a68">fetch</span></span><span><span style="color:#999999">(</span></span><span><span>event</span></span><span><span style="color:#999999">.</span></span><span><span>request</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">then</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#0077aa">function</span></span><span><span></span></span><span><span style="color:#999999">(</span></span><span><span>networkResponse</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span></span></span><span><span style="color:#0077aa">if</span></span><span><span></span></span><span><span style="color:#999999">(</span></span><span><span style="color:#dd4a68">isStaleWhileRevalidate</span></span><span><span style="color:#999999">(</span></span><span><span>event</span></span><span><span style="color:#999999">.</span></span><span><span>request</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span></span></span><span><span style="color:#708090">// 检查响应的状态码是否为成功</span></span><span><span></span></span><span><span style="color:#0077aa">if</span></span><span><span></span></span><span><span style="color:#999999">(</span></span><span><span>networkResponse</span></span><span><span style="color:#999999">.</span></span><span><span>status </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">===</span></span><span><span></span></span><span><span style="color:#990055">200</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span></span></span><span><span style="color:#708090">// 克隆响应并将其添加到缓存中</span></span><span><span></span></span><span><span style="color:#0077aa">var</span></span><span><span> clonedResponse </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=</span></span><span><span> networkResponse</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">clone</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#708090">// 在存储到缓存之前，设置正确的缓存头部</span></span><span><span></span></span><span><span style="color:#0077aa">var</span></span><span><span> headers </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=</span></span><span><span></span></span><span><span style="color:#0077aa">new</span></span><span><span></span></span><span><span style="color:#dd4a68">Headers</span></span><span><span style="color:#999999">(</span></span><span><span>networkResponse</span></span><span><span style="color:#999999">.</span></span><span><span>headers</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span>
            headers</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">delete</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#669900">'cache-control'</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span>
            headers</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">append</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#669900">'cache-control'</span></span><span><span style="color:#999999">,</span></span><span><span></span></span><span><span style="color:#669900">'public, max-age=3600'</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#708090">// 设置缓存有效期为 1 小时</span></span><span><span></span></span><span><span style="color:#708090">// 创建新的响应对象并存储到缓存中</span></span><span><span></span></span><span><span style="color:#0077aa">var</span></span><span><span> cachedResponse </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=</span></span><span><span></span></span><span><span style="color:#0077aa">new</span></span><span><span></span></span><span><span style="color:#dd4a68">Response</span></span><span><span style="color:#999999">(</span></span><span><span>clonedResponse</span></span><span><span style="color:#999999">.</span></span><span><span>body</span></span><span><span style="color:#999999">,</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span>
              status</span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">:</span></span><span><span> networkResponse</span></span><span><span style="color:#999999">.</span></span><span><span>status</span></span><span><span style="color:#999999">,</span></span><span><span>
              statusText</span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">:</span></span><span><span> networkResponse</span></span><span><span style="color:#999999">.</span></span><span><span>statusText</span></span><span><span style="color:#999999">,</span></span><span><span>
              headers</span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">:</span></span><span><span> headers</span></span><span><span style="color:#999999">,</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span>

            caches</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">open</span></span><span><span style="color:#999999">(</span></span><span><span>runtimeCacheName</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">then</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#999999">(</span></span><span><span>cache</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=&gt;</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span>
              cache</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">put</span></span><span><span style="color:#999999">(</span></span><span><span>event</span></span><span><span style="color:#999999">.</span></span><span><span>request</span></span><span><span style="color:#999999">,</span></span><span><span> cachedResponse</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span></span></span><span><span style="color:#0077aa">return</span></span><span><span> networkResponse</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#708090">// 检查缓存的响应是否存在且未过期</span></span><span><span></span></span><span><span style="color:#0077aa">if</span></span><span><span></span></span><span><span style="color:#999999">(</span></span><span><span>response </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">&amp;&amp;</span></span><span><span></span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">!</span></span><span><span style="color:#dd4a68">isExpired</span></span><span><span style="color:#999999">(</span></span><span><span>response</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span></span></span><span><span style="color:#0077aa">return</span></span><span><span> response</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#708090">// 返回缓存的响应</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span></span></span><span><span style="color:#0077aa">return</span></span><span><span> fetchPromise</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#0077aa">function</span></span><span><span></span></span><span><span style="color:#dd4a68">isExpired</span></span><span><span style="color:#999999">(</span></span><span><span>response</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span></span></span><span><span style="color:#708090">// 从响应的 headers 中获取缓存的有效期信息</span></span><span><span></span></span><span><span style="color:#0077aa">var</span></span><span><span> cacheControl </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=</span></span><span><span> response</span></span><span><span style="color:#999999">.</span></span><span><span>headers</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">get</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#669900">'cache-control'</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#0077aa">if</span></span><span><span></span></span><span><span style="color:#999999">(</span></span><span><span>cacheControl</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span></span></span><span><span style="color:#0077aa">var</span></span><span><span> maxAgeMatch </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=</span></span><span><span> cacheControl</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">match</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#ee9900">/max-age=(\d+)/</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#0077aa">if</span></span><span><span></span></span><span><span style="color:#999999">(</span></span><span><span>maxAgeMatch</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span></span></span><span><span style="color:#0077aa">var</span></span><span><span> maxAgeSeconds </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=</span></span><span><span></span></span><span><span style="color:#dd4a68">parseInt</span></span><span><span style="color:#999999">(</span></span><span><span>maxAgeMatch</span></span><span><span style="color:#999999">[</span></span><span><span style="color:#990055">1</span></span><span><span style="color:#999999">]</span></span><span><span style="color:#999999">,</span></span><span><span></span></span><span><span style="color:#990055">10</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#0077aa">var</span></span><span><span> requestTime </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=</span></span><span><span> Date</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">parse</span></span><span><span style="color:#999999">(</span></span><span><span>response</span></span><span><span style="color:#999999">.</span></span><span><span>headers</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">get</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#669900">'date'</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#0077aa">var</span></span><span><span> expirationTime </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=</span></span><span><span> requestTime </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">+</span></span><span><span> maxAgeSeconds </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">*</span></span><span><span></span></span><span><span style="color:#990055">1000</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#708090">// 检查当前时间是否超过了缓存的有效期</span></span><span><span></span></span><span><span style="color:#0077aa">if</span></span><span><span></span></span><span><span style="color:#999999">(</span></span><span><span>Date</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">now</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">&lt;</span></span><span><span> expirationTime</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span></span></span><span><span style="color:#0077aa">return</span></span><span><span></span></span><span><span style="color:#990055">false</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#708090">// 未过期</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span></span></span><span><span style="color:#0077aa">return</span></span><span><span></span></span><span><span style="color:#990055">true</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#708090">// 已过期</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span></span></span></span></code></pre><blockquote><span><span><span>从 Service Worker 发起的请求，可能会被浏览器自身的内存缓存或硬盘缓存捕获，然后直接返回。</span></span></span></blockquote><span id="OSC_h3_11"></span><h3><span><span><span>精确清理缓存</span></span></span></h3><blockquote><span><span><span>下面的内容，默认为微前端应用。</span></span></span></blockquote><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><span><span><span>随着微前端应用的更新，会逐渐出现失效的资源文件一直出现在缓存中，时间长了可能会导致缓存溢出。</span></span></span></p><span id="OSC_h4_12"></span><h4><span><span><span>定时更新</span></span></span></h4><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><span><span><span>例如以半年为期限，定期更新</span></span></span><span><span><code><span>sw</span></code></span></span><span><span><span>文件的版本号，每次更新都会一刀切的将上一个版本中的</span></span></span><span><span><strong><span>动态缓存</span></strong></span></span><span><span><span>干掉，此操作会导致下次加载变慢，因为会重新通过网络请求的方式加载来创建缓存。但如果更新频率控制得当，并且资源拆分合理，用户感知不会很大。</span></span></span></p><span id="OSC_h4_13"></span><h4><span><span><span>处理不常用缓存</span></span></span></h4><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><span><span><span>上文中的缓存过期策略，并不适用于此处。因为微服务中资源文件中，只要文件名不变，内容就应该不变。我们只是期望删除超过一定时间没有使用的条目，防止缓存溢出。这里也使用</span></span></span><span><span><code><span>Stale-While-Revalidate</span></code></span></span><span><span><span>的原因是为了帮助我们识别长期不使用的</span></span></span><span><span><code><span>js</span></code></span></span><span><span><span>文件，方便删除。</span></span></span></p><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><span><span><span>本来可以使用</span></span></span><span><span><code><span>self.registration.periodicSync.register</span></code></span></span><span><span><span>来创建一个周期性任务，但是由于兼容性问题，放弃了。需要的可自行研究，附上</span></span></span><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FAPI%2FPeriodicSyncManager" target="_blank" rel="nofollow"><span><span><span>网址</span></span></span></a><span><span><span>。</span></span></span></p><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><span><span><span>这里我们换一个条件。每当有网络请求被触发时，启动一个延迟 20s 的</span></span></span><span><span><code><span>debounce</span></code></span></span><span><span><span>函数，来处理缓存问题。先把之前的清除旧版本缓存的函数改名成</span></span></span><span><span><code><span>clearOldResources</span></code></span></span><span><span><span>。然后设定缓存过期时间为 10s，刷新两次页面来触发网路请求，20s 之后，</span></span></span><span><span><code><span>runtime</span></code></span></span><span><span><span>缓存中的</span></span></span><span><span><code><span>mock.js</span></code></span></span><span><span><span>就会被删除了。真实场景下，延迟函数和缓存过期都不会这么短，可以设置成 5min 和 3 个月。</span></span></span></p><pre><code><span><span><span style="color:#0077aa">function</span></span><span><span></span></span><span><span style="color:#dd4a68">debounce</span></span><span><span style="color:#999999">(</span></span><span><span>func, delay</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span></span></span><span><span style="color:#0077aa">let</span></span><span><span> timerId</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#0077aa">return</span></span><span><span></span></span><span><span style="color:#0077aa">function</span></span><span><span></span></span><span><span style="color:#999999">(</span></span><span><span>...args</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span></span></span><span><span style="color:#dd4a68">clearTimeout</span></span><span><span style="color:#999999">(</span></span><span><span>timerId</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span>

    timerId </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=</span></span><span><span></span></span><span><span style="color:#dd4a68">setTimeout</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=&gt;</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span></span></span><span><span style="color:#dd4a68">func</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">apply</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#0077aa">this</span></span><span><span style="color:#999999">,</span></span><span><span> args</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span style="color:#999999">,</span></span><span><span> delay</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span></span></span><span><span style="color:#0077aa">const</span></span><span><span> clearOutdateResources </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=</span></span><span><span></span></span><span><span style="color:#dd4a68">debounce</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#0077aa">function</span></span><span><span></span></span><span><span style="color:#999999">(</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span>
  cache
    </span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">open</span></span><span><span style="color:#999999">(</span></span><span><span>runtimeCacheName</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">keys</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">then</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#0077aa">function</span></span><span><span></span></span><span><span style="color:#999999">(</span></span><span><span>requests</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span>
      requests</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">forEach</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#0077aa">function</span></span><span><span></span></span><span><span style="color:#999999">(</span></span><span><span>request</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span>
        cache</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">match</span></span><span><span style="color:#999999">(</span></span><span><span>request</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">then</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#0077aa">function</span></span><span><span></span></span><span><span style="color:#999999">(</span></span><span><span>response</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span></span></span><span><span style="color:#708090">// response 为匹配到的 Response 对象</span></span><span><span></span></span><span><span style="color:#0077aa">if</span></span><span><span></span></span><span><span style="color:#999999">(</span></span><span><span style="color:#dd4a68">isExpiredWithTime</span></span><span><span style="color:#999999">(</span></span><span><span>response</span></span><span><span style="color:#999999">,</span></span><span><span></span></span><span><span style="color:#990055">10</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span>
            cache</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">delete</span></span><span><span style="color:#999999">(</span></span><span><span>request</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#0077aa">function</span></span><span><span></span></span><span><span style="color:#dd4a68">isExpiredWithTime</span></span><span><span style="color:#999999">(</span></span><span><span>response, time</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span></span></span><span><span style="color:#0077aa">var</span></span><span><span> requestTime </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=</span></span><span><span> Date</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">parse</span></span><span><span style="color:#999999">(</span></span><span><span>response</span></span><span><span style="color:#999999">.</span></span><span><span>headers</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">get</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#669900">'date'</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#0077aa">if</span></span><span><span></span></span><span><span style="color:#999999">(</span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">!</span></span><span><span>requestTime</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span></span></span><span><span style="color:#0077aa">return</span></span><span><span></span></span><span><span style="color:#990055">false</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span></span></span><span><span style="color:#0077aa">var</span></span><span><span> expirationTime </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=</span></span><span><span> requestTime </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">+</span></span><span><span> time </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">*</span></span><span><span></span></span><span><span style="color:#990055">1000</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#708090">// 检查当前时间是否超过了缓存的有效期</span></span><span><span></span></span><span><span style="color:#0077aa">if</span></span><span><span></span></span><span><span style="color:#999999">(</span></span><span><span>Date</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">now</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">&lt;</span></span><span><span> expirationTime</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span></span></span><span><span style="color:#0077aa">return</span></span><span><span></span></span><span><span style="color:#990055">false</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#708090">// 未过期</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span></span></span><span><span style="color:#0077aa">return</span></span><span><span></span></span><span><span style="color:#990055">true</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#708090">// 已过期</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span></span></span></span></code></pre><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><span><span><span>重新总结下微前端应用下的缓存配置：</span></span></span></p><div><span>1.</span><span><span><span><span>使用版本号，并初始化</span></span></span><span><span><code><span>preCache</span></code></span></span><span><span><span>和</span></span></span><span><span><code><span>runtimeCache</span></code></span></span></span></div><div><span style="color:var(--vscode-textPreformat-foreground)">2.</span><span><span><span><code><span>preCache</span></code></span></span><span><span><span>中预缓存基座数据，使用</span></span></span><span><span><code><span>Cache First</span></code></span></span><span><span><span>策略，</span></span></span><span><span><code><span>sw</span></code></span></span><span><span><span>不更新则基座数据不更新</span></span></span></span></div><div><span style="color:var(--vscode-textPreformat-foreground)">3.</span><span><span><span><code><span>runtimeCache</span></code></span></span><span><span><span>使用</span></span></span><span><span><code><span>Stale-While-Revalidate</span></code></span></span><span><span><span>策略负责动态缓存业务资源的数据，每次访问页面都动态更新一次</span></span></span></span></div><div><span>4.</span><span><span><span><span>使用</span></span></span><span><span><code><span>debounce</span></code></span></span><span><span><span>函数，每次访问页面都会延迟清除过期的缓存</span></span></span></span></div><div><span>5.</span><span><span><span><span>如果需要更新</span></span></span><span><span><code><span>preCache</span></code></span></span><span><span><span>中的基座数据，则需要升级版本号并重新安装</span></span></span><span><span><code><span>sw</span></code></span></span><span><span><span>文件。新服务激活后会删除上一个版本的数据</span></span></span></span></div><div><span style="color:var(--vscode-textPreformat-foreground)">6.</span><span><span><span><code><span>runtimeCache</span></code></span></span><span><span><span>和</span></span></span><span><span><code><span>preCache</span></code></span></span><span><span><span>不能同时存储一个资源，否则可能导致混乱。</span></span></span></span></div><span id="OSC_h1_14"></span><h1><span><span><span>最终示例</span></span></span></h1><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><span><span><span>下面是最终的</span></span></span><span><span><code><span>sw.js</span></code></span></span><span><span><span>，我删除掉了缓存过期的逻辑，如有需要请自行从上文代码中获取。顺便我增加了一点点丧心病狂的错误处理逻辑。</span></span></span></p><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><span><span><span>理论上，</span></span></span><span><span><code><span>index.html</span></code></span></span><span><span><span>应该放入预缓存的列表里，但我懒得写在</span></span></span><span><span><code><span>Stale-While-Revalidate</span></code></span></span><span><span><span>里分别更新</span></span></span><span><span><code><span>preCache</span></code></span></span><span><span><span>和</span></span></span><span><span><code><span>runtimeCache</span></code></span></span><span><span><span>了，相信看完上面内容的你，一定可以自己实现对应逻辑。</span></span></span></p><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><span><span><span>如果你用了下面的文件，每次刷新完页面的 20s 后，runtime 的缓存就会被清空，因为我们过期时间只设置了 10s。而每次发起请求后的 20s 后就会进行过期判断。</span></span></span></p><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><span><span><span>在真实的验证过程中，有部分</span></span></span></p><pre><code><span><span><span style="color:#0077aa">const</span></span><span><span> version </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=</span></span><span><span></span></span><span><span style="color:#669900">'v1'</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#0077aa">const</span></span><span><span> preCacheName </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=</span></span><span><span></span></span><span><span style="color:#669900">'pre-cache-'</span></span><span><span></span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">+</span></span><span><span> version</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#0077aa">const</span></span><span><span> runtimeCacheName </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=</span></span><span><span></span></span><span><span style="color:#669900">'runtime-cache'</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#708090">// runtime 不进行整体清除</span></span><span><span></span></span><span><span style="color:#0077aa">const</span></span><span><span> filesToCache </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=</span></span><span><span></span></span><span><span style="color:#999999">[</span></span><span><span style="color:#999999">]</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#708090">// 这里将 index.html 放到动态缓存里了，为了搭自动更新的便车。这个小项目也没别的需要预缓存的了</span></span><span><span></span></span><span><span style="color:#0077aa">const</span></span><span><span> maxAgeSeconds </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=</span></span><span><span></span></span><span><span style="color:#990055">10</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#708090">// 缓存过期时间，单位 s</span></span><span><span></span></span><span><span style="color:#0077aa">const</span></span><span><span> debounceClearTime </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=</span></span><span><span></span></span><span><span style="color:#990055">20</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#708090">// 延迟清理缓存时间，单位 s</span></span><span><span></span></span><span><span style="color:#708090">// 符合条件也是缓存优先，但是每次都重新发起网络请求更新缓存</span></span><span><span></span></span><span><span style="color:#0077aa">const</span></span><span><span></span></span><span><span>isStaleWhileRevalidate</span></span><span><span></span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=</span></span><span><span></span></span><span><span style="color:#999999">(</span></span><span><span>request</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=&gt;</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span></span></span><span><span style="color:#0077aa">const</span></span><span><span> url </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=</span></span><span><span> request</span></span><span><span style="color:#999999">.</span></span><span><span>url</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#0077aa">const</span></span><span><span> index </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=</span></span><span><span></span></span><span><span style="color:#999999">[</span></span><span><span>`${self.location.origin}/mock.js`</span></span><span><span style="color:#999999">,</span></span><span><span></span></span><span><span>`${self.location.origin}/index.html`</span></span><span><span style="color:#999999">]</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">indexOf</span></span><span><span style="color:#999999">(</span></span><span><span>url</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#0077aa">return</span></span><span><span> index </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">!==</span></span><span><span></span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">-</span></span><span><span style="color:#990055">1</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#708090">/*********************上面是配置代码***************************** */</span></span><span><span></span></span><span><span style="color:#0077aa">const</span></span><span><span></span></span><span><span>addResourcesToCache</span></span><span><span></span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=</span></span><span><span></span></span><span><span style="color:#0077aa">async</span></span><span><span></span></span><span><span style="color:#999999">(</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=&gt;</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span></span></span><span><span style="color:#0077aa">return</span></span><span><span> caches</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">open</span></span><span><span style="color:#999999">(</span></span><span><span>preCacheName</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">then</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#999999">(</span></span><span><span>cache</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=&gt;</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span></span></span><span><span style="color:#0077aa">return</span></span><span><span> cache</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">addAll</span></span><span><span style="color:#999999">(</span></span><span><span>filesToCache</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#708090">// 安装 Service Worker 时进行预缓存</span></span><span><span>
self</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">addEventListener</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#669900">'install'</span></span><span><span style="color:#999999">,</span></span><span><span></span></span><span><span style="color:#0077aa">function</span></span><span><span></span></span><span><span style="color:#999999">(</span></span><span><span>event</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span>
  event</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">waitUntil</span></span><span><span style="color:#999999">(</span></span><span><span></span></span><span><span style="color:#dd4a68">addResourcesToCache</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">then</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=&gt;</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span>
      self</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">skipWaiting</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#708090">// 删除上个版本的数据</span></span><span><span></span></span><span><span style="color:#0077aa">async</span></span><span><span></span></span><span><span style="color:#0077aa">function</span></span><span><span></span></span><span><span style="color:#dd4a68">clearOldResources</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span></span></span><span><span style="color:#0077aa">return</span></span><span><span> caches</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">keys</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">then</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#0077aa">function</span></span><span><span></span></span><span><span style="color:#999999">(</span></span><span><span>cacheNames</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span></span></span><span><span style="color:#0077aa">return</span></span><span><span> Promise</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">all</span></span><span><span style="color:#999999">(</span></span><span><span>
      cacheNames
        </span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">filter</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#0077aa">function</span></span><span><span></span></span><span><span style="color:#999999">(</span></span><span><span>cacheName</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span></span></span><span><span style="color:#0077aa">return</span></span><span><span></span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">!</span></span><span><span style="color:#999999">[</span></span><span><span>preCacheName</span></span><span><span style="color:#999999">,</span></span><span><span> runtimeCacheName</span></span><span><span style="color:#999999">]</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">includes</span></span><span><span style="color:#999999">(</span></span><span><span>cacheName</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">map</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#0077aa">function</span></span><span><span></span></span><span><span style="color:#999999">(</span></span><span><span>cacheName</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span></span></span><span><span style="color:#0077aa">return</span></span><span><span> caches</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">delete</span></span><span><span style="color:#999999">(</span></span><span><span>cacheName</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span></span></span><span><span style="color:#708090">// 激活 Service Worker</span></span><span><span>
self</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">addEventListener</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#669900">'activate'</span></span><span><span style="color:#999999">,</span></span><span><span></span></span><span><span style="color:#0077aa">function</span></span><span><span></span></span><span><span style="color:#999999">(</span></span><span><span>event</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span>
  event</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">waitUntil</span></span><span><span style="color:#999999">(</span></span><span><span></span></span><span><span style="color:#dd4a68">clearOldResources</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">finally</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=&gt;</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span>
      self</span></span><span><span style="color:#999999">.</span></span><span><span>clients</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">claim</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#dd4a68">clearOutdateResources</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#708090">// 缓存优先</span></span><span><span></span></span><span><span style="color:#0077aa">const</span></span><span><span></span></span><span><span>isCacheFirst</span></span><span><span></span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=</span></span><span><span></span></span><span><span style="color:#999999">(</span></span><span><span>request</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=&gt;</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span></span></span><span><span style="color:#0077aa">const</span></span><span><span> url </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=</span></span><span><span> request</span></span><span><span style="color:#999999">.</span></span><span><span>url</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#0077aa">const</span></span><span><span> index </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=</span></span><span><span> filesToCache</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">findIndex</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#999999">(</span></span><span><span>u</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=&gt;</span></span><span><span> url</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">includes</span></span><span><span style="color:#999999">(</span></span><span><span>u</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#0077aa">return</span></span><span><span> index </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">!==</span></span><span><span></span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">-</span></span><span><span style="color:#990055">1</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#0077aa">function</span></span><span><span></span></span><span><span style="color:#dd4a68">addToCache</span></span><span><span style="color:#999999">(</span></span><span><span>cacheName, request, response</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span></span></span><span><span style="color:#0077aa">try</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span>
    caches</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">open</span></span><span><span style="color:#999999">(</span></span><span><span>cacheName</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">then</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#999999">(</span></span><span><span>cache</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=&gt;</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span>
      cache</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">put</span></span><span><span style="color:#999999">(</span></span><span><span>request</span></span><span><span style="color:#999999">,</span></span><span><span> response</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span></span></span><span><span style="color:#0077aa">catch</span></span><span><span></span></span><span><span style="color:#999999">(</span></span><span><span>error</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span>
    console</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">error</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#669900">'add to cache error =&gt;'</span></span><span><span style="color:#999999">,</span></span><span><span> error</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span></span></span><span><span style="color:#0077aa">async</span></span><span><span></span></span><span><span style="color:#0077aa">function</span></span><span><span></span></span><span><span style="color:#dd4a68">cacheFirst</span></span><span><span style="color:#999999">(</span></span><span><span>request</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span></span></span><span><span style="color:#0077aa">try</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span></span></span><span><span style="color:#0077aa">return</span></span><span><span> caches
      </span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">match</span></span><span><span style="color:#999999">(</span></span><span><span>request</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">then</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#999999">(</span></span><span><span>response</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=&gt;</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span></span></span><span><span style="color:#0077aa">if</span></span><span><span></span></span><span><span style="color:#999999">(</span></span><span><span>response</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span></span></span><span><span style="color:#0077aa">return</span></span><span><span> response</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span></span></span><span><span style="color:#0077aa">return</span></span><span><span></span></span><span><span style="color:#dd4a68">fetch</span></span><span><span style="color:#999999">(</span></span><span><span>request</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">then</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#999999">(</span></span><span><span>response</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=&gt;</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span></span></span><span><span style="color:#708090">// 检查是否成功获取到响应</span></span><span><span></span></span><span><span style="color:#0077aa">if</span></span><span><span></span></span><span><span style="color:#999999">(</span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">!</span></span><span><span>response </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">||</span></span><span><span> response</span></span><span><span style="color:#999999">.</span></span><span><span>status </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">!==</span></span><span><span></span></span><span><span style="color:#990055">200</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span></span></span><span><span style="color:#0077aa">return</span></span><span><span> response</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#708090">// 返回原始响应</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span></span></span><span><span style="color:#0077aa">var</span></span><span><span> clonedResponse </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=</span></span><span><span> response</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">clone</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#dd4a68">addToCache</span></span><span><span style="color:#999999">(</span></span><span><span>runtimeCacheName</span></span><span><span style="color:#999999">,</span></span><span><span> request</span></span><span><span style="color:#999999">,</span></span><span><span> clonedResponse</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#0077aa">return</span></span><span><span> response</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">catch</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=&gt;</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span>
        console</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">error</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#669900">'match in cacheFirst error'</span></span><span><span style="color:#999999">,</span></span><span><span> error</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#0077aa">return</span></span><span><span></span></span><span><span style="color:#dd4a68">fetch</span></span><span><span style="color:#999999">(</span></span><span><span>request</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span></span></span><span><span style="color:#0077aa">catch</span></span><span><span></span></span><span><span style="color:#999999">(</span></span><span><span>error</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span>
    console</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">error</span></span><span><span style="color:#999999">(</span></span><span><span>error</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#0077aa">return</span></span><span><span></span></span><span><span style="color:#dd4a68">fetch</span></span><span><span style="color:#999999">(</span></span><span><span>request</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span></span></span><span><span style="color:#708090">// 缓存优先，同步更新</span></span><span><span></span></span><span><span style="color:#0077aa">async</span></span><span><span></span></span><span><span style="color:#0077aa">function</span></span><span><span></span></span><span><span style="color:#dd4a68">handleFetch</span></span><span><span style="color:#999999">(</span></span><span><span>request</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span></span></span><span><span style="color:#0077aa">try</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span></span></span><span><span style="color:#dd4a68">clearOutdateResources</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#708090">// 尝试从缓存中获取响应</span></span><span><span></span></span><span><span style="color:#0077aa">return</span></span><span><span> caches</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">match</span></span><span><span style="color:#999999">(</span></span><span><span>request</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">then</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#0077aa">function</span></span><span><span></span></span><span><span style="color:#999999">(</span></span><span><span>response</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span></span></span><span><span style="color:#0077aa">var</span></span><span><span> fetchPromise </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=</span></span><span><span></span></span><span><span style="color:#dd4a68">fetch</span></span><span><span style="color:#999999">(</span></span><span><span>request</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">then</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#0077aa">function</span></span><span><span></span></span><span><span style="color:#999999">(</span></span><span><span>networkResponse</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span></span></span><span><span style="color:#708090">// 检查响应的状态码是否为成功</span></span><span><span></span></span><span><span style="color:#0077aa">if</span></span><span><span></span></span><span><span style="color:#999999">(</span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">!</span></span><span><span>networkResponse </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">||</span></span><span><span> networkResponse</span></span><span><span style="color:#999999">.</span></span><span><span>status </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">!==</span></span><span><span></span></span><span><span style="color:#990055">200</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span></span></span><span><span style="color:#0077aa">return</span></span><span><span> networkResponse</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span></span></span><span><span style="color:#708090">// 克隆响应并将其添加到缓存中</span></span><span><span></span></span><span><span style="color:#0077aa">var</span></span><span><span> clonedResponse </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=</span></span><span><span> networkResponse</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">clone</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#dd4a68">addToCache</span></span><span><span style="color:#999999">(</span></span><span><span>runtimeCacheName</span></span><span><span style="color:#999999">,</span></span><span><span> request</span></span><span><span style="color:#999999">,</span></span><span><span> clonedResponse</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#0077aa">return</span></span><span><span> networkResponse</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#708090">// 返回缓存的响应，然后更新缓存中的响应</span></span><span><span></span></span><span><span style="color:#0077aa">return</span></span><span><span> response </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">||</span></span><span><span> fetchPromise</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span></span></span><span><span style="color:#0077aa">catch</span></span><span><span></span></span><span><span style="color:#999999">(</span></span><span><span>error</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span>
    console</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">error</span></span><span><span style="color:#999999">(</span></span><span><span>error</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#0077aa">return</span></span><span><span></span></span><span><span style="color:#dd4a68">fetch</span></span><span><span style="color:#999999">(</span></span><span><span>request</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span>

self</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">addEventListener</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#669900">'fetch'</span></span><span><span style="color:#999999">,</span></span><span><span></span></span><span><span style="color:#0077aa">function</span></span><span><span></span></span><span><span style="color:#999999">(</span></span><span><span>event</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span></span></span><span><span style="color:#0077aa">const</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span> request </span></span><span><span style="color:#999999">}</span></span><span><span></span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=</span></span><span><span> event</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#0077aa">if</span></span><span><span></span></span><span><span style="color:#999999">(</span></span><span><span style="color:#dd4a68">isCacheFirst</span></span><span><span style="color:#999999">(</span></span><span><span>request</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span>
    event</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">respondWith</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#dd4a68">cacheFirst</span></span><span><span style="color:#999999">(</span></span><span><span>request</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#0077aa">return</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span></span></span><span><span style="color:#0077aa">if</span></span><span><span></span></span><span><span style="color:#999999">(</span></span><span><span style="color:#dd4a68">isStaleWhileRevalidate</span></span><span><span style="color:#999999">(</span></span><span><span>request</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span>
    event</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">respondWith</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#dd4a68">handleFetch</span></span><span><span style="color:#999999">(</span></span><span><span>request</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#0077aa">return</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#0077aa">function</span></span><span><span></span></span><span><span style="color:#dd4a68">debounce</span></span><span><span style="color:#999999">(</span></span><span><span>func, delay</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span></span></span><span><span style="color:#0077aa">let</span></span><span><span> timerId</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#0077aa">return</span></span><span><span></span></span><span><span style="color:#0077aa">function</span></span><span><span></span></span><span><span style="color:#999999">(</span></span><span><span>...args</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span></span></span><span><span style="color:#dd4a68">clearTimeout</span></span><span><span style="color:#999999">(</span></span><span><span>timerId</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span>

    timerId </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=</span></span><span><span></span></span><span><span style="color:#dd4a68">setTimeout</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=&gt;</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span></span></span><span><span style="color:#dd4a68">func</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">apply</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#0077aa">this</span></span><span><span style="color:#999999">,</span></span><span><span> args</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span style="color:#999999">,</span></span><span><span> delay</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span></span></span><span><span style="color:#0077aa">const</span></span><span><span> clearOutdateResources </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=</span></span><span><span></span></span><span><span style="color:#dd4a68">debounce</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#0077aa">function</span></span><span><span></span></span><span><span style="color:#999999">(</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span></span></span><span><span style="color:#0077aa">try</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span>
    caches</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">open</span></span><span><span style="color:#999999">(</span></span><span><span>runtimeCacheName</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">then</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#999999">(</span></span><span><span>cache</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=&gt;</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span>
      cache</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">keys</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">then</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#0077aa">function</span></span><span><span></span></span><span><span style="color:#999999">(</span></span><span><span>requests</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span>
        requests</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">forEach</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#0077aa">function</span></span><span><span></span></span><span><span style="color:#999999">(</span></span><span><span>request</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span>
          cache</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">match</span></span><span><span style="color:#999999">(</span></span><span><span>request</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">then</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#0077aa">function</span></span><span><span></span></span><span><span style="color:#999999">(</span></span><span><span>response</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span></span></span><span><span style="color:#0077aa">const</span></span><span><span> isExpired </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=</span></span><span><span></span></span><span><span style="color:#dd4a68">isExpiredWithTime</span></span><span><span style="color:#999999">(</span></span><span><span>response</span></span><span><span style="color:#999999">,</span></span><span><span> maxAgeSeconds</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#0077aa">if</span></span><span><span></span></span><span><span style="color:#999999">(</span></span><span><span>isExpired</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span>
              cache</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">delete</span></span><span><span style="color:#999999">(</span></span><span><span>request</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span></span></span><span><span style="color:#0077aa">catch</span></span><span><span></span></span><span><span style="color:#999999">(</span></span><span><span>error</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span>
    console</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">error</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#669900">'clearOutdateResources error =&gt; '</span></span><span><span style="color:#999999">,</span></span><span><span> error</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span style="color:#999999">,</span></span><span><span> debounceClearTime </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">*</span></span><span><span></span></span><span><span style="color:#990055">1000</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#0077aa">function</span></span><span><span></span></span><span><span style="color:#dd4a68">isExpiredWithTime</span></span><span><span style="color:#999999">(</span></span><span><span>response, time</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span></span></span><span><span style="color:#0077aa">var</span></span><span><span> requestTime </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=</span></span><span><span> Date</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">parse</span></span><span><span style="color:#999999">(</span></span><span><span>response</span></span><span><span style="color:#999999">.</span></span><span><span>headers</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">get</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#669900">'date'</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#0077aa">if</span></span><span><span></span></span><span><span style="color:#999999">(</span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">!</span></span><span><span>requestTime</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span></span></span><span><span style="color:#0077aa">return</span></span><span><span></span></span><span><span style="color:#990055">false</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span></span></span><span><span style="color:#0077aa">var</span></span><span><span> expirationTime </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=</span></span><span><span> requestTime </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">+</span></span><span><span> time </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">*</span></span><span><span></span></span><span><span style="color:#990055">1000</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#708090">// 检查当前时间是否超过了缓存的有效期</span></span><span><span></span></span><span><span style="color:#0077aa">if</span></span><span><span></span></span><span><span style="color:#999999">(</span></span><span><span>Date</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">now</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">&lt;</span></span><span><span> expirationTime</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span></span></span><span><span style="color:#0077aa">return</span></span><span><span></span></span><span><span style="color:#990055">false</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#708090">// 未过期</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span></span></span><span><span style="color:#0077aa">return</span></span><span><span></span></span><span><span style="color:#990055">true</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#708090">// 已过期</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span></span></span></span></code></pre><span id="OSC_h3_15"></span><h3><span><span><strong><span>注意</span></strong></span></span></h3><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><span><span><span>在真实的验证过程中，有部分资源获取不到</span></span></span><span><span><code><span>date</span></code></span></span><span><span><span>这个数据，因此为了保险，我们还是在存入缓存时，自己补充一个存入时间</span></span></span></p><pre><code><span><span><span></span></span><span><span style="color:#708090">// 克隆响应并将其添加到缓存中</span></span><span><span></span></span><span><span style="color:#0077aa">var</span></span><span><span> clonedResponse </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=</span></span><span><span> networkResponse</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">clone</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#708090">// 在存储到缓存之前，设置正确的缓存头部</span></span><span><span></span></span><span><span style="color:#0077aa">var</span></span><span><span> headers </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=</span></span><span><span></span></span><span><span style="color:#0077aa">new</span></span><span><span></span></span><span><span style="color:#dd4a68">Headers</span></span><span><span style="color:#999999">(</span></span><span><span>networkResponse</span></span><span><span style="color:#999999">.</span></span><span><span>headers</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span>

headers</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">append</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#669900">'sw-save-date'</span></span><span><span style="color:#999999">,</span></span><span><span> Date</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">now</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#708090">// 创建新的响应对象并存储到缓存中</span></span><span><span></span></span><span><span style="color:#0077aa">var</span></span><span><span> cachedResponse </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=</span></span><span><span></span></span><span><span style="color:#0077aa">new</span></span><span><span></span></span><span><span style="color:#dd4a68">Response</span></span><span><span style="color:#999999">(</span></span><span><span>clonedResponse</span></span><span><span style="color:#999999">.</span></span><span><span>body</span></span><span><span style="color:#999999">,</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span>
  status</span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">:</span></span><span><span> networkResponse</span></span><span><span style="color:#999999">.</span></span><span><span>status</span></span><span><span style="color:#999999">,</span></span><span><span>
  statusText</span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">:</span></span><span><span> networkResponse</span></span><span><span style="color:#999999">.</span></span><span><span>statusText</span></span><span><span style="color:#999999">,</span></span><span><span>
  headers</span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">:</span></span><span><span> headers</span></span><span><span style="color:#999999">,</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span></span></code></pre><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><span><span><span>在判断过期时，取我们自己写入的</span></span></span><span><span><code><span>key</span></code></span></span><span><span><span>即可。</span></span></span></p><pre><code><span><span><span style="color:#0077aa">function</span></span><span><span></span></span><span><span style="color:#dd4a68">isExpiredWithTime</span></span><span><span style="color:#999999">(</span></span><span><span>response, time</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span></span></span><span><span style="color:#0077aa">var</span></span><span><span> requestTime </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=</span></span><span><span></span></span><span><span style="color:#dd4a68">Number</span></span><span><span style="color:#999999">(</span></span><span><span>response</span></span><span><span style="color:#999999">.</span></span><span><span>headers</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">get</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#669900">'sw-save-date'</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#0077aa">if</span></span><span><span></span></span><span><span style="color:#999999">(</span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">!</span></span><span><span>requestTime</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span></span></span><span><span style="color:#0077aa">return</span></span><span><span></span></span><span><span style="color:#990055">false</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span></span></span><span><span style="color:#0077aa">var</span></span><span><span> expirationTime </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=</span></span><span><span> requestTime </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">+</span></span><span><span> time </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">*</span></span><span><span></span></span><span><span style="color:#990055">1000</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#708090">// 检查当前时间是否超过了缓存的有效期</span></span><span><span></span></span><span><span style="color:#0077aa">if</span></span><span><span></span></span><span><span style="color:#999999">(</span></span><span><span>Date</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">now</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">&lt;</span></span><span><span> expirationTime</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span></span></span><span><span style="color:#0077aa">return</span></span><span><span></span></span><span><span style="color:#990055">false</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#708090">// 未过期</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span></span></span><span><span style="color:#0077aa">return</span></span><span><span></span></span><span><span style="color:#990055">true</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#708090">// 已过期</span></span><span><span></span></span><span><span style="color:#999999">}</span></span></span></code></pre><span id="OSC_h3_16"></span><h3><span><span><span>不可见响应</span></span></span></h3><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><span><span><span>还记得上面为了安全考虑，在存入缓存时，对响应的状态做了判断，非 200 的都不缓存。然后就又发现异常场景了。</span></span></span></p><pre><code><span><span><span></span></span><span><span style="color:#708090">// 检查是否成功获取到响应</span></span><span><span></span></span><span><span style="color:#0077aa">if</span></span><span><span></span></span><span><span style="color:#999999">(</span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">!</span></span><span><span>response </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">||</span></span><span><span> response</span></span><span><span style="color:#999999">.</span></span><span><span>status </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">!==</span></span><span><span></span></span><span><span style="color:#990055">200</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span></span></span><span><span style="color:#0077aa">return</span></span><span><span> response</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#708090">// 返回原始响应</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span></span></span></span></code></pre><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><span><span><code><span>opaque</span></code></span></span><span><span><span> 响应通常指的是跨源请求（CORS）中的一种情况，在该情况下，浏览器出于安全考虑，不允许访问服务端返回的响应内容。</span></span></span><span><span><code><span>opaque</span></code></span></span><span><span><span> 响应通常发生在服务工作者（Service Workers）进行的跨源请求中，且没有 CORS 头部的情况下。</span></span></span></p><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><span><span><code><span>opaque</span></code></span></span><span><span><span> 响应的特征是：</span></span></span></p><ul><li><span><span><span><span>响应的内容无法被 JavaScript 访问。</span></span></span></span></li><li><span><span><span><span>响应的大小无法确定，因此 Chrome 开发者工具中会显示为 (opaque)。</span></span></span></span></li><li><span><span><span><span>响应的状态码通常是 0，即使实际上服务器可能返回了不同的状态码。</span></span></span></span></li></ul><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><span><span><span>因此我们需要做一些补充动作。不单是补充</span></span></span><span><span><code><span>cors</span></code></span></span><span><span><span>模式，还得同步设置下</span></span></span><span><span><code><span>credentials</span></code></span></span><span><span><span>。</span></span></span></p><pre><code><span><span><span></span></span><span><span style="color:#0077aa">const</span></span><span><span> newRequest </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=</span></span><span><span>
  request</span></span><span><span style="color:#999999">.</span></span><span><span>url </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">===</span></span><span><span></span></span><span><span style="color:#669900">'index.html'</span></span><span><span></span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">?</span></span><span><span> request
    </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">:</span></span><span><span></span></span><span><span style="color:#0077aa">new</span></span><span><span></span></span><span><span style="color:#dd4a68">Request</span></span><span><span style="color:#999999">(</span></span><span><span>request</span></span><span><span style="color:#999999">,</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span> mode</span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">:</span></span><span><span></span></span><span><span style="color:#669900">'cors'</span></span><span><span style="color:#999999">,</span></span><span><span> credentials</span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">:</span></span><span><span></span></span><span><span style="color:#669900">'omit'</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span></span></code></pre><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><span><span><span>在 Service Workers 发起网络请求时，如果页面本身需要认证，那就像上面代码那样，对页面请求做个判断。</span></span></span><span><span><code><span>request.url === 'index.html'</span></code></span></span><span><span><span>是我写的示例，真实请求中，需要拼出完整的 url 路径。而对于资源文件，走非认证的</span></span></span><span><span><code><span>cors</span></code></span></span><span><span><span>请求即可。将请求的</span></span></span><span><span><code><span>request</span></code></span></span><span><span><span>改为我们变更后的</span></span></span><span><span><code><span>newRequest</span></code></span></span><span><span><span>，请求资源就可以正常的被缓存了。</span></span></span></p><pre><code><span><span><span style="color:#0077aa">var</span></span><span><span> fetchPromise </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=</span></span><span><span></span></span><span><span style="color:#dd4a68">fetch</span></span><span><span style="color:#999999">(</span></span><span><span>newRequest</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">then</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#0077aa">function</span></span><span><span></span></span><span><span style="color:#999999">(</span></span><span><span>networkResponse</span></span><span><span style="color:#999999">)</span></span></span></code></pre><span id="OSC_h1_17"></span><h1><span><span><span>销毁</span></span></span></h1><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><span><span><span>离线缓存用得好升职加薪，用不好就删库跑路。除了上面的一点点的防错逻辑，整体的降级方案一定要有。</span></span></span></p><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><span><span><span>看到这里，应该已经忘了 Service Worker 是如何被注册上的吧。没事，我们看个新的脚本。在原本的基础上，我们加了个变量</span></span></span><span><span><code><span>SW_FALLBACK</span></code></span></span><span><span><span>，如果离线缓存出问题了，赶紧到管理后台，把对应的值改成</span></span></span><span><span><code><span>true</span></code></span></span><span><span><span>。让用户多刷新两次就好了。只要不是彻底的崩溃导致</span></span></span><span><span><code><span>html</span></code></span></span><span><span><span>无法更新，这个方案就没问题。</span></span></span></p><pre><code><span><span><span style="color:#708090">// 如果有问题，将此值改成 true</span></span><span><span></span></span><span><span style="color:#990055">SW_FALLBACK</span></span><span><span></span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=</span></span><span><span></span></span><span><span style="color:#990055">false</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#0077aa">if</span></span><span><span></span></span><span><span style="color:#999999">(</span></span><span><span style="color:#669900">'serviceWorker'</span></span><span><span></span></span><span><span style="color:#0077aa">in</span></span><span><span> navigator</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span></span></span><span><span style="color:#0077aa">if</span></span><span><span></span></span><span><span style="color:#999999">(</span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">!</span></span><span><span style="color:#990055">SW_FALLBACK</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span>
    navigator</span></span><span><span style="color:#999999">.</span></span><span><span>serviceWorker
      </span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">register</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#669900">'/eemf-service-worker.js'</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">then</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#999999">(</span></span><span><span>registration</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=&gt;</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span>
        console</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">log</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#669900">'Service Worker 注册成功！'</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">catch</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#999999">(</span></span><span><span>error</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=&gt;</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span>
        console</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">log</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#669900">'Service Worker 注册失败：'</span></span><span><span style="color:#999999">,</span></span><span><span> error</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span></span></span><span><span style="color:#0077aa">else</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span>
    navigator</span></span><span><span style="color:#999999">.</span></span><span><span>serviceWorker</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">getRegistration</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#669900">'/'</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">then</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#999999">(</span></span><span><span>reg</span></span><span><span style="color:#999999">)</span></span><span><span></span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">=&gt;</span></span><span><span></span></span><span><span style="color:#999999">{</span></span><span><span>
      reg </span></span><span><span style="background-color:rgba(255, 255, 255, 0.5)">&amp;&amp;</span></span><span><span> reg</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">unregister</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#0077aa">if</span></span><span><span style="color:#999999">(</span></span><span><span>reg</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">{</span></span><span><span>
        window</span></span><span><span style="color:#999999">.</span></span><span><span>location</span></span><span><span style="color:#999999">.</span></span><span><span style="color:#dd4a68">reload</span></span><span><span style="color:#999999">(</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span style="color:#999999">)</span></span><span><span style="color:#999999">;</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span></span></span><span><span style="color:#999999">}</span></span><span><span></span></span></span></code></pre><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><span><span><span>对于没有管理后台配置</span></span></span><span><span><code><span>html</span></code></span></span><span><span><span>的项目，可以将上面的脚本移动到</span></span></span><span><span><code><span>sw-register.js</span></code></span></span><span><span><span>的脚本中，在</span></span></span><span><span><code><span>html</span></code></span></span><span><span><span>以</span></span></span><span><span><code><span>script</span></code></span></span><span><span><span>的形式加载该脚本，并将该文件缓存设置为</span></span></span><span><span><code><span>no-cache</span></code></span></span><span><span><span>，也不要在</span></span></span><span><span><code><span>sw</span></code></span></span><span><span><span>中缓存该文件。这样出问题后，覆写下该文件即可。</span></span></span></p><span id="OSC_h1_18"></span><h1><span><span><span>总结</span></span></span></h1><p style="color:#393c5a; margin-left:0; margin-right:0; text-align:start"><span><span><span>所有要说的，在上面都说完了。PWA 的离线方案，是一种很好的解决方案，但是也有其局限性。本项目所用的 demo 已经上传到了</span></span></span><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fgithub.com%2Fsuilang%2FPWA-demo" target="_blank" rel="nofollow"><span><span><span>github</span></span></span></a><span><span><span>，可自行查看。</span></span></span></p><span id="OSC_h1_19"></span><h1><span><span><span>参考文档</span></span></span></h1><ul><li><span><span><span><span>﻿</span></span></span><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FService_Worker_API" target="_blank" rel="nofollow"><span><span><span>Service Worker</span></span></span></a><span><span><span>﻿</span></span></span></span></li><li><span><span><span><span>﻿</span></span></span><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdeveloper.chrome.com%2Fdocs%2Fworkbox%2Fservice-worker-overview%2F" target="_blank" rel="nofollow"><span><span><span>Service worker overview</span></span></span></a><span><span><span>﻿</span></span></span></span></li><li><span><span><span><span>﻿</span></span></span><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdevelopers.google.com%2Fweb%2Ftools%2Fworkbox" target="_blank" rel="nofollow"><span><span><span>Workbox</span></span></span></a><span><span><span>﻿</span></span></span></span></li><li><span><span><span><span>GPT 问答</span></span></span></span></li></ul><blockquote><p>作者：CHO 张鹏程</p><p>来源：京东云开发者社区，转载请注明来源</p></blockquote></div>
                                    ]]>
            </description>
            <pubDate>Sat, 16 Dec 2023 03:02:00 GMT</pubDate>
            <guid isPermaLink="false">https://my.oschina.net/u/4090830/blog/10320663</guid>
            <link>https://my.oschina.net/u/4090830/blog/10320663</link>
            <author>
                <![CDATA[原创]]>
            </author>
        </item>
    </channel>
</rss>
