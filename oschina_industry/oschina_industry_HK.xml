<?xml version="1.0" encoding="UTF-8"?>
<rss
    xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"


>
    <channel>
        <title>
            <![CDATA[開源中國-綜合資訊]]>
        </title>
        <link>https://www.oschina.net/news/industry</link>
        <atom:link href="https://rsshub.app/oschina/news/industry" rel="self" type="application/rss+xml" />
        <description>
            <![CDATA[開源中國-綜合資訊 - Made with love by RSSHub(https://github.com/DIYgod/RSSHub)]]>
        </description>
        <generator>RSSHub</generator>
        <webMaster>i@diygod.me (DIYgod)</webMaster>
        <language>zh-cn</language>
        <lastBuildDate>Mon, 05 Feb 2024 02:41:08 GMT</lastBuildDate>
        <ttl>120</ttl>
        <item>
            <title>
                <![CDATA[pgx —— PostgreSQL 的純 Go 驅動程序和工具包]]>
            </title>
            <description>
                <![CDATA[<div class="content"><p>pgx 是用於 PostgreSQL 的純 Go 驅動程序和工具包。</p><p>pgx 驅動程序是一個低級、高性能的接口，它 expose 了 PostgreSQL 特有的功能，如 LISTEN / NOTIFY 和 COPY。它還包括一個標準<code>database/sql</code>接口適配器。</p><p>工具包組件是一組相關的軟件包，用於實現 PostgreSQL 的功能，如解析線協議和 PostgreSQL 與 Go 之間的類型映射。這些底層軟件包可用於實現替代驅動程序、代理、負載平衡器、邏輯複製客户端等。</p><p><strong>用法示例：</strong></p><pre style="text-align:start"><span style="color:var(--color-prettylights-syntax-keyword)">package</span> main

<span style="color:var(--color-prettylights-syntax-keyword)">import</span> (
<span style="color:var(--color-prettylights-syntax-string)">"context"</span><span style="color:var(--color-prettylights-syntax-string)">"fmt"</span><span style="color:var(--color-prettylights-syntax-string)">"os"</span><span style="color:var(--color-prettylights-syntax-string)">"github.com/jackc/pgx/v5"</span>
)

<span style="color:var(--color-prettylights-syntax-keyword)">func</span><span style="color:var(--color-prettylights-syntax-entity)">main</span>() {
<span style="color:var(--color-prettylights-syntax-comment)">// urlExample := "postgres://username:password@localhost:5432/database_name"</span><span>conn</span>, <span>err</span><span style="color:var(--color-prettylights-syntax-constant)">:=</span><span>pgx</span>.<span style="color:var(--color-prettylights-syntax-entity)">Connect</span>(<span>context</span>.<span style="color:var(--color-prettylights-syntax-entity)">Background</span>(), <span>os</span>.<span style="color:var(--color-prettylights-syntax-entity)">Getenv</span>(<span style="color:var(--color-prettylights-syntax-string)">"DATABASE_URL"</span>))
<span style="color:var(--color-prettylights-syntax-keyword)">if</span><span>err</span><span style="color:var(--color-prettylights-syntax-constant)">!=</span><span style="color:var(--color-prettylights-syntax-constant)">nil</span> {
<span>fmt</span>.<span style="color:var(--color-prettylights-syntax-entity)">Fprintf</span>(<span>os</span>.<span style="color:var(--color-prettylights-syntax-constant)">Stderr</span>, <span style="color:var(--color-prettylights-syntax-string)">"Unable to connect to database: %v<span>\n</span>"</span>, <span>err</span>)
<span>os</span>.<span style="color:var(--color-prettylights-syntax-entity)">Exit</span>(<span style="color:var(--color-prettylights-syntax-constant)">1</span>)
}
<span style="color:var(--color-prettylights-syntax-keyword)">defer</span><span>conn</span>.<span style="color:var(--color-prettylights-syntax-entity)">Close</span>(<span>context</span>.<span style="color:var(--color-prettylights-syntax-entity)">Background</span>())

<span style="color:var(--color-prettylights-syntax-keyword)">var</span><span>name</span><span style="color:var(--color-prettylights-syntax-storage-modifier-import)">string</span><span style="color:var(--color-prettylights-syntax-keyword)">var</span><span>weight</span><span style="color:var(--color-prettylights-syntax-storage-modifier-import)">int64</span><span>err</span><span style="color:var(--color-prettylights-syntax-constant)">=</span><span>conn</span>.<span style="color:var(--color-prettylights-syntax-entity)">QueryRow</span>(<span>context</span>.<span style="color:var(--color-prettylights-syntax-entity)">Background</span>(), <span style="color:var(--color-prettylights-syntax-string)">"select name, weight from widgets where id=$1"</span>, <span style="color:var(--color-prettylights-syntax-constant)">42</span>).<span style="color:var(--color-prettylights-syntax-entity)">Scan</span>(<span style="color:var(--color-prettylights-syntax-constant)">&amp;</span><span>name</span>, <span style="color:var(--color-prettylights-syntax-constant)">&amp;</span><span>weight</span>)
<span style="color:var(--color-prettylights-syntax-keyword)">if</span><span>err</span><span style="color:var(--color-prettylights-syntax-constant)">!=</span><span style="color:var(--color-prettylights-syntax-constant)">nil</span> {
<span>fmt</span>.<span style="color:var(--color-prettylights-syntax-entity)">Fprintf</span>(<span>os</span>.<span style="color:var(--color-prettylights-syntax-constant)">Stderr</span>, <span style="color:var(--color-prettylights-syntax-string)">"QueryRow failed: %v<span>\n</span>"</span>, <span>err</span>)
<span>os</span>.<span style="color:var(--color-prettylights-syntax-entity)">Exit</span>(<span style="color:var(--color-prettylights-syntax-constant)">1</span>)
}

<span>fmt</span>.<span style="color:var(--color-prettylights-syntax-entity)">Println</span>(<span>name</span>, <span>weight</span>)
}
</pre><p><strong>特性：</strong></p><ul><li>支持大約 70 種不同的 PostgreSQL 類型</li><li>自動語句準備和緩存</li><li>批量查詢</li><li>單次往返查詢方式</li><li>完整的 TLS 連接控制</li><li>對自定義類型的二進制格式支持（允許更快的編碼/解碼）</li><li><code>COPY</code>協議支持，實現更快的批量數據加載</li><li>Tracing 和 logging 支持</li><li>帶有 after-connect hook 的連接池，用於任意連接設置</li><li><code>LISTEN</code>/<code>NOTIFY</code></li><li>將 PostgreSQL 數組轉換為整數、浮點數和字符串的 Go 切片映射</li><li><code>hstore</code>支持</li><li><code>json</code>和<code>jsonb</code>支持</li><li>將<code>inet</code>和<code>cidr</code>PostgreSQL 類型映射為<code>netip.Addr</code>和<code>netip.Prefix</code></li><li>Large object&nbsp; 支持</li><li>NULL 映射為&nbsp;pointer to pointer</li><li>支持自定義類型的<code>database/sql.Scanner</code>和<code>database/sql/driver.Valuer</code>接口</li><li>通知響應處理</li><li>使用保存點模擬嵌套事務</li></ul></div>
                                                                ]]>
            </description>
            <pubDate>Mon, 05 Feb 2024 01:58:57 GMT</pubDate>
            <guid isPermaLink="false">https://www.oschina.net/p/pgx</guid>
            <link>https://www.oschina.net/p/pgx</link>
        </item>
        <item>
            <title>
                <![CDATA[Gitee 推薦 | 雲原生開發工具 KubeVPN]]>
            </title>
            <description>
                <![CDATA[<p><img src="https://raw.githubusercontent.com/wencaiwulue/kubevpn/master/samples/flat_log.png" alt="kubevpn" referrerpolicy="no-referrer"></p><p><a href="https://gitee.com/link?target=https%3A%2F%2Fgithub.com%2Fkubenetworks%2Fkubevpn%2Factions"><img src="https://img.shields.io/github/actions/workflow/status/kubenetworks/kubevpn/release.yml?logo=github" alt="GitHub Workflow" referrerpolicy="no-referrer"></a><a href="https://gitee.com/link?target=https%3A%2F%2Fgithub.com%2Fkubenetworks%2Fkubevpn%2Fblob%2Fmaster%2Fgo.mod"><img src="https://img.shields.io/github/go-mod/go-version/kubenetworks/kubevpn?logo=go" alt="Go Version" referrerpolicy="no-referrer"></a><a href="https://gitee.com/link?target=https%3A%2F%2Fgoreportcard.com%2Freport%2Fgithub.com%2Fwencaiwulue%2Fkubevpn"><img src="https://goreportcard.com/badge/github.com/wencaiwulue/kubevpn?style=flat" alt="Go Report" referrerpolicy="no-referrer"></a><a href="https://gitee.com/link?target=https%3A%2F%2Fcodeclimate.com%2Fgithub%2Fkubenetworks%2Fkubevpn%2Fmaintainability"><img src="https://api.codeclimate.com/v1/badges/b5b30239174fc6603aca/maintainability" alt="Maintainability" referrerpolicy="no-referrer"></a><a href="https://gitee.com/link?target=https%3A%2F%2Fgithub.com%2Fkubenetworks%2Fkubevpn%2Fblob%2Fmain%2FLICENSE"><img src="https://img.shields.io/github/license/kubenetworks/kubevpn" alt="GitHub License" referrerpolicy="no-referrer"></a><a href="https://gitee.com/link?target=https%3A%2F%2Fhub.docker.com%2Fr%2Fnaison%2Fkubevpn"><img src="https://img.shields.io/docker/pulls/naison/kubevpn?logo=docker" alt="Docker Pulls" referrerpolicy="no-referrer"></a><a href="https://gitee.com/link?target=https%3A%2F%2Fgithub.com%2Fkubenetworks%2Fkubevpn%2Freleases"><img src="https://img.shields.io/github/v/release/kubenetworks/kubevpn?logo=smartthings" alt="Releases" referrerpolicy="no-referrer"></a><a href="https://gitee.com/link?target=https%3A%2F%2Fgodoc.org%2Fgithub.com%2Fkubenetworks%2Fkubevpn"><img src="https://godoc.org/github.com/kubenetworks/kubevpn?status.png" alt="GoDoc" referrerpolicy="no-referrer"></a></p><h1><a id="kubevpn" class="anchor" href="https://gitee.com/kubevpn/kubevpn#kubevpn"></a>KubeVPN</h1><p><a href="https://gitee.com/kubevpn/kubevpn/blob/master/README.md">English</a> | <a href="https://gitee.com/kubevpn/kubevpn/blob/master/README_ZH.md">中文</a> | <a href="https://gitee.com/link?target=https%3A%2F%2Fgithub.com%2Fkubenetworks%2Fkubevpn%2Fwiki%2F%25E6%259E%25B6%25E6%259E%2584">維基</a></p><p>KubeVPN 是一個雲原生開發工具。通過連接雲端 kubernetes 網絡，可以在本地使用 k8s dns 或者 Pod IP / Service IP
直接訪問遠端集羣中的服務。攔截遠端集羣中的工作負載的入流量到本地電腦，配合服務網格便於調試及開發。同時還可以使用開發模式，直接在本地使用 Docker
模擬 k8s pod runtime 將容器運行在本地 (具有相同的環境變量，磁盤和網絡)。</p><h2><a id="快速開始" class="anchor" href="https://gitee.com/kubevpn/kubevpn#%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B"></a>快速開始</h2><h4><a id="從-github-release-下載編譯好的二進制文件" class="anchor" href="https://gitee.com/kubevpn/kubevpn#%E4%BB%8E-github-release-%E4%B8%8B%E8%BD%BD%E7%BC%96%E8%AF%91%E5%A5%BD%E7%9A%84%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%96%87%E4%BB%B6"></a>從 Github release 下載編譯好的二進制文件</h4><p><a href="https://gitee.com/link?target=https%3A%2F%2Fgithub.com%2Fkubenetworks%2Fkubevpn%2Freleases%2Flatest">鏈接</a></p><h4><a id="從-自定義-krew-倉庫安裝" class="anchor" href="https://gitee.com/kubevpn/kubevpn#%E4%BB%8E-%E8%87%AA%E5%AE%9A%E4%B9%89-krew-%E4%BB%93%E5%BA%93%E5%AE%89%E8%A3%85"></a>從，自定義 Krew 倉庫安裝</h4><div class="white"><div class="highlight markdown-code-block"><pre><span id="LC1" class="line"><span class="o">(</span></span><span id="LC2" class="line">  kubectl krew index add kubevpn https://github.com/kubenetworks/kubevpn.git <span class="o">&amp;&amp;</span><span class="se">\</span></span><span id="LC3" class="line">  kubectl krew <span class="nb">install </span>kubevpn/kubevpn <span class="o">&amp;&amp;</span> kubectl kubevpn </span><span id="LC4" class="line"><span class="o">)</span></span></pre><div class="markdown-code-block-copy-btn"></div></div></div><h4><a id="自己構建二進制文件" class="anchor" href="https://gitee.com/kubevpn/kubevpn#%E8%87%AA%E5%B7%B1%E6%9E%84%E5%BB%BA%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%96%87%E4%BB%B6"></a>自己構建二進制文件</h4><div class="white"><div class="highlight markdown-code-block"><pre><span id="LC1" class="line"><span class="o">(</span></span><span id="LC2" class="line">  git clone https://github.com/kubenetworks/kubevpn.git <span class="o">&amp;&amp;</span><span class="se">\</span></span><span id="LC3" class="line"><span class="nb">cd </span>kubevpn <span class="o">&amp;&amp;</span> make kubevpn <span class="o">&amp;&amp;</span> ./bin/kubevpn</span><span id="LC4" class="line"><span class="o">)</span></span><span id="LC5" class="line"></span></pre><div class="markdown-code-block-copy-btn"></div></div></div><h4><a id="安裝-bookinfo-作為-demo-應用" class="anchor" href="https://gitee.com/kubevpn/kubevpn#%E5%AE%89%E8%A3%85-bookinfo-%E4%BD%9C%E4%B8%BA-demo-%E5%BA%94%E7%94%A8"></a>安裝 bookinfo 作為 demo 應用</h4><div class="white"><div class="highlight markdown-code-block"><pre><span id="LC1" class="line">kubectl apply <span class="nt">-f</span> https://raw.githubusercontent.com/kubenetworks/kubevpn/master/samples/bookinfo.yaml</span></pre><div class="markdown-code-block-copy-btn"></div></div></div><h2><a id="功能" class="anchor" href="https://gitee.com/kubevpn/kubevpn#%E5%8A%9F%E8%83%BD"></a>功能</h2><h3><a id="鏈接到集羣網絡" class="anchor" href="https://gitee.com/kubevpn/kubevpn#%E9%93%BE%E6%8E%A5%E5%88%B0%E9%9B%86%E7%BE%A4%E7%BD%91%E7%BB%9C"></a>鏈接到集羣網絡</h3><div class="white"><div class="highlight markdown-code-block"><pre><span id="LC1" class="line">➜  ~ kubevpn connect</span><span id="LC2" class="line">Password:</span><span id="LC3" class="line">start to connect</span><span id="LC4" class="line">get cidr from cluster info...</span><span id="LC5" class="line">get cidr from cluster info ok</span><span id="LC6" class="line">get cidr from cni...</span><span id="LC7" class="line"><span class="nb">wait </span>pod cni-net-dir-kubevpn to be running <span class="nb">timeout</span>, reason , ignore</span><span id="LC8" class="line">get cidr from svc...</span><span id="LC9" class="line">get cidr from svc ok</span><span id="LC10" class="line">get cidr successfully</span><span id="LC11" class="line">traffic manager not exist, try to create it...</span><span id="LC12" class="line">label namespace default</span><span id="LC13" class="line">create serviceAccount kubevpn-traffic-manager</span><span id="LC14" class="line">create roles kubevpn-traffic-manager</span><span id="LC15" class="line">create roleBinding kubevpn-traffic-manager</span><span id="LC16" class="line">create service kubevpn-traffic-manager</span><span id="LC17" class="line">create deployment kubevpn-traffic-manager</span><span id="LC18" class="line">pod kubevpn-traffic-manager-66d969fd45-9zlbp is Pending</span><span id="LC19" class="line">Container     Reason            Message</span><span id="LC20" class="line">control-plane ContainerCreating</span><span id="LC21" class="line">vpn           ContainerCreating</span><span id="LC22" class="line">webhook       ContainerCreating</span><span id="LC23" class="line"></span><span id="LC24" class="line">pod kubevpn-traffic-manager-66d969fd45-9zlbp is Running</span><span id="LC25" class="line">Container     Reason           Message</span><span id="LC26" class="line">control-plane ContainerRunning</span><span id="LC27" class="line">vpn           ContainerRunning</span><span id="LC28" class="line">webhook       ContainerRunning</span><span id="LC29" class="line"></span><span id="LC30" class="line">Creating mutatingWebhook_configuration <span class="k">for </span>kubevpn-traffic-manager</span><span id="LC31" class="line">update ref count successfully</span><span id="LC32" class="line">port forward ready</span><span id="LC33" class="line">tunnel connected</span><span id="LC34" class="line">dns service ok</span><span id="LC35" class="line">+---------------------------------------------------------------------------+</span><span id="LC36" class="line">|    Now you can access resources <span class="k">in </span>the kubernetes cluster, enjoy it :<span class="o">)</span>    |</span><span id="LC37" class="line">+---------------------------------------------------------------------------+</span><span id="LC38" class="line">➜  ~</span></pre><div class="markdown-code-block-copy-btn"></div></div></div><div class="white"><div class="highlight markdown-code-block"><pre><span id="LC1" class="line">➜  ~ kubectl get pods <span class="nt">-o</span> wide</span><span id="LC2" class="line">NAME                                       READY   STATUS             RESTARTS   AGE     IP                NODE              NOMINATED NODE   READINESS GATES</span><span id="LC3" class="line">authors-dbb57d856-mbgqk                    3/3     Running            0          7d23h   172.29.2.132      192.168.0.5       &lt;none&gt;           &lt;none&gt;</span><span id="LC4" class="line">details-7d8b5f6bcf-hcl4t                   1/1     Running            0          61d     172.29.0.77       192.168.104.255   &lt;none&gt;           &lt;none&gt;</span><span id="LC5" class="line">kubevpn-traffic-manager-66d969fd45-9zlbp   3/3     Running            0          74s     172.29.2.136      192.168.0.5       &lt;none&gt;           &lt;none&gt;</span><span id="LC6" class="line">productpage-788df7ff7f-jpkcs               1/1     Running            0          61d     172.29.2.134      192.168.0.5       &lt;none&gt;           &lt;none&gt;</span><span id="LC7" class="line">ratings-77b6cd4499-zvl6c                   1/1     Running            0          61d     172.29.0.86       192.168.104.255   &lt;none&gt;           &lt;none&gt;</span><span id="LC8" class="line">reviews-85c88894d9-vgkxd                   1/1     Running            0          24d     172.29.2.249      192.168.0.5       &lt;none&gt;           &lt;none&gt;</span></pre><div class="markdown-code-block-copy-btn"></div></div></div><div class="white"><div class="highlight markdown-code-block"><pre><span id="LC1" class="line">➜  ~ ping 172.29.2.134</span><span id="LC2" class="line">PING 172.29.2.134 <span class="o">(</span>172.29.2.134<span class="o">)</span>: 56 data bytes</span><span id="LC3" class="line">64 bytes from 172.29.2.134: <span class="nv">icmp_seq</span><span class="o">=</span>0 <span class="nv">ttl</span><span class="o">=</span>63 <span class="nb">time</span><span class="o">=</span>55.727 ms</span><span id="LC4" class="line">64 bytes from 172.29.2.134: <span class="nv">icmp_seq</span><span class="o">=</span>1 <span class="nv">ttl</span><span class="o">=</span>63 <span class="nb">time</span><span class="o">=</span>56.270 ms</span><span id="LC5" class="line">64 bytes from 172.29.2.134: <span class="nv">icmp_seq</span><span class="o">=</span>2 <span class="nv">ttl</span><span class="o">=</span>63 <span class="nb">time</span><span class="o">=</span>55.228 ms</span><span id="LC6" class="line">64 bytes from 172.29.2.134: <span class="nv">icmp_seq</span><span class="o">=</span>3 <span class="nv">ttl</span><span class="o">=</span>63 <span class="nb">time</span><span class="o">=</span>54.293 ms</span><span id="LC7" class="line">^C</span><span id="LC8" class="line"><span class="nt">---</span> 172.29.2.134 ping statistics <span class="nt">---</span></span><span id="LC9" class="line">4 packets transmitted, 4 packets received, 0.0% packet loss</span><span id="LC10" class="line">round-trip min/avg/max/stddev <span class="o">=</span> 54.293/55.380/56.270/0.728 ms</span></pre><div class="markdown-code-block-copy-btn"></div></div></div><div class="white"><div class="highlight markdown-code-block"><pre><span id="LC1" class="line">➜  ~ kubectl get services <span class="nt">-o</span> wide</span><span id="LC2" class="line">NAME                      TYPE        CLUSTER-IP      EXTERNAL-IP   PORT<span class="o">(</span>S<span class="o">)</span>                              AGE     SELECTOR</span><span id="LC3" class="line">authors                   ClusterIP   172.21.5.160    &lt;none&gt;        9080/TCP                             114d    <span class="nv">app</span><span class="o">=</span>authors</span><span id="LC4" class="line">details                   ClusterIP   172.21.6.183    &lt;none&gt;        9080/TCP                             114d    <span class="nv">app</span><span class="o">=</span>details</span><span id="LC5" class="line">kubernetes                ClusterIP   172.21.0.1      &lt;none&gt;        443/TCP                              319d    &lt;none&gt;</span><span id="LC6" class="line">kubevpn-traffic-manager   ClusterIP   172.21.2.86     &lt;none&gt;        8422/UDP,10800/TCP,9002/TCP,80/TCP   2m28s   <span class="nv">app</span><span class="o">=</span>kubevpn-traffic-manager</span><span id="LC7" class="line">productpage               ClusterIP   172.21.10.49    &lt;none&gt;        9080/TCP                             114d    <span class="nv">app</span><span class="o">=</span>productpage</span><span id="LC8" class="line">ratings                   ClusterIP   172.21.3.247    &lt;none&gt;        9080/TCP                             114d    <span class="nv">app</span><span class="o">=</span>ratings</span><span id="LC9" class="line">reviews                   ClusterIP   172.21.8.24     &lt;none&gt;        9080/TCP                             114d    <span class="nv">app</span><span class="o">=</span>reviews</span></pre><div class="markdown-code-block-copy-btn"></div></div></div><div class="white"><div class="highlight markdown-code-block"><pre><span id="LC1" class="line">➜  ~ curl 172.21.10.49:9080</span><span id="LC2" class="line">&lt;<span class="o">!</span>DOCTYPE html&gt;</span><span id="LC3" class="line">&lt;html&gt;</span><span id="LC4" class="line">  &lt;<span class="nb">head</span><span class="o">&gt;</span></span><span id="LC5" class="line">    &lt;title&gt;Simple Bookstore App&lt;/title&gt;</span><span id="LC6" class="line">&lt;meta <span class="nv">charset</span><span class="o">=</span><span class="s2">"utf-8"</span><span class="o">&gt;</span></span><span id="LC7" class="line">&lt;meta http-equiv<span class="o">=</span><span class="s2">"X-UA-Compatible"</span><span class="nv">content</span><span class="o">=</span><span class="s2">"IE=edge"</span><span class="o">&gt;</span></span><span id="LC8" class="line">&lt;meta <span class="nv">name</span><span class="o">=</span><span class="s2">"viewport"</span><span class="nv">content</span><span class="o">=</span><span class="s2">"width=device-width, initial-scale=1"</span><span class="o">&gt;</span></span></pre><div class="markdown-code-block-copy-btn"></div></div></div><h3><a id="域名解析功能" class="anchor" href="https://gitee.com/kubevpn/kubevpn#%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90%E5%8A%9F%E8%83%BD"></a>域名解析功能</h3><div class="white"><div class="highlight markdown-code-block"><pre><span id="LC1" class="line">➜  ~ curl productpage.default.svc.cluster.local:9080</span><span id="LC2" class="line">&lt;<span class="o">!</span>DOCTYPE html&gt;</span><span id="LC3" class="line">&lt;html&gt;</span><span id="LC4" class="line">  &lt;<span class="nb">head</span><span class="o">&gt;</span></span><span id="LC5" class="line">    &lt;title&gt;Simple Bookstore App&lt;/title&gt;</span><span id="LC6" class="line">&lt;meta <span class="nv">charset</span><span class="o">=</span><span class="s2">"utf-8"</span><span class="o">&gt;</span></span><span id="LC7" class="line">&lt;meta http-equiv<span class="o">=</span><span class="s2">"X-UA-Compatible"</span><span class="nv">content</span><span class="o">=</span><span class="s2">"IE=edge"</span><span class="o">&gt;</span></span><span id="LC8" class="line">&lt;meta <span class="nv">name</span><span class="o">=</span><span class="s2">"viewport"</span><span class="nv">content</span><span class="o">=</span><span class="s2">"width=device-width, initial-scale=1"</span><span class="o">&gt;</span></span></pre><div class="markdown-code-block-copy-btn"></div></div></div><h3><a id="短域名解析功能" class="anchor" href="https://gitee.com/kubevpn/kubevpn#%E7%9F%AD%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90%E5%8A%9F%E8%83%BD"></a>短域名解析功能</h3><div class="white"><div class="highlight markdown-code-block"><pre><span id="LC1" class="line">➜  ~ curl productpage:9080</span><span id="LC2" class="line">&lt;<span class="o">!</span>DOCTYPE html&gt;</span><span id="LC3" class="line">&lt;html&gt;</span><span id="LC4" class="line">  &lt;<span class="nb">head</span><span class="o">&gt;</span></span><span id="LC5" class="line">    &lt;title&gt;Simple Bookstore App&lt;/title&gt;</span><span id="LC6" class="line">&lt;meta <span class="nv">charset</span><span class="o">=</span><span class="s2">"utf-8"</span><span class="o">&gt;</span></span><span id="LC7" class="line">&lt;meta http-equiv<span class="o">=</span><span class="s2">"X-UA-Compatible"</span><span class="nv">content</span><span class="o">=</span><span class="s2">"IE=edge"</span><span class="o">&gt;</span></span><span id="LC8" class="line">...</span></pre><div class="markdown-code-block-copy-btn"></div></div></div><h3><a id="鏈接到多集羣網絡" class="anchor" href="https://gitee.com/kubevpn/kubevpn#%E9%93%BE%E6%8E%A5%E5%88%B0%E5%A4%9A%E9%9B%86%E7%BE%A4%E7%BD%91%E7%BB%9C"></a>鏈接到多集羣網絡</h3><div class="white"><div class="highlight markdown-code-block"><pre><span id="LC1" class="line">➜  ~ kubevpn status</span><span id="LC2" class="line">ID Mode Cluster               Kubeconfig                 Namespace Status</span><span id="LC3" class="line">0  full ccijorbccotmqodvr189g /Users/naison/.kube/config default   Connected</span></pre><div class="markdown-code-block-copy-btn"></div></div></div><div class="white"><div class="highlight markdown-code-block"><pre><span id="LC1" class="line">➜  ~ kubevpn connect <span class="nt">-n</span> default <span class="nt">--kubeconfig</span> ~/.kube/dev_config <span class="nt">--lite</span></span><span id="LC2" class="line">start to connect</span><span id="LC3" class="line">got cidr from cache</span><span id="LC4" class="line">get cidr successfully</span><span id="LC5" class="line">update ref count successfully</span><span id="LC6" class="line">traffic manager already exist, reuse it</span><span id="LC7" class="line">port forward ready</span><span id="LC8" class="line">tunnel connected</span><span id="LC9" class="line">adding route...</span><span id="LC10" class="line">dns service ok</span><span id="LC11" class="line">+---------------------------------------------------------------------------+</span><span id="LC12" class="line">|    Now you can access resources <span class="k">in </span>the kubernetes cluster, enjoy it :<span class="o">)</span>    |</span><span id="LC13" class="line">+---------------------------------------------------------------------------+</span></pre><div class="markdown-code-block-copy-btn"></div></div></div><div class="white"><div class="highlight markdown-code-block"><pre><span id="LC1" class="line">➜  ~ kubevpn status</span><span id="LC2" class="line">ID Mode Cluster               Kubeconfig                     Namespace Status</span><span id="LC3" class="line">0  full ccijorbccotmqodvr189g /Users/naison/.kube/config     default   Connected</span><span id="LC4" class="line">1  lite ccidd77aam2dtnc3qnddg /Users/naison/.kube/dev_config default   Connected</span><span id="LC5" class="line">➜  ~</span></pre><div class="markdown-code-block-copy-btn"></div></div></div><h3><a id="反向代理" class="anchor" href="https://gitee.com/kubevpn/kubevpn#%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86"></a>反向代理</h3><div class="white"><div class="highlight markdown-code-block"><pre><span id="LC1" class="line">➜  ~ kubevpn proxy deployment/productpage</span><span id="LC2" class="line">already connect to cluster</span><span id="LC3" class="line">start to create remote inbound pod <span class="k">for </span>deployment/productpage</span><span id="LC4" class="line">workload default/deployment/productpage is controlled by a controller</span><span id="LC5" class="line">rollout status <span class="k">for </span>deployment/productpage</span><span id="LC6" class="line">Waiting <span class="k">for </span>deployment <span class="s2">"productpage"</span> rollout to finish: 1 old replicas are pending termination...</span><span id="LC7" class="line">Waiting <span class="k">for </span>deployment <span class="s2">"productpage"</span> rollout to finish: 1 old replicas are pending termination...</span><span id="LC8" class="line">deployment <span class="s2">"productpage"</span> successfully rolled out</span><span id="LC9" class="line">rollout status <span class="k">for </span>deployment/productpage successfully</span><span id="LC10" class="line">create remote inbound pod <span class="k">for </span>deployment/productpage successfully</span><span id="LC11" class="line">+---------------------------------------------------------------------------+</span><span id="LC12" class="line">|    Now you can access resources <span class="k">in </span>the kubernetes cluster, enjoy it :<span class="o">)</span>    |</span><span id="LC13" class="line">+---------------------------------------------------------------------------+</span><span id="LC14" class="line">➜  ~</span></pre><div class="markdown-code-block-copy-btn"></div></div></div><div class="white"><div class="highlight markdown-code-block"><pre><span id="LC1" class="line"><span class="k">package</span><span class="n">main</span></span><span id="LC2" class="line"></span><span id="LC3" class="line"><span class="k">import</span><span class="p">(</span></span><span id="LC4" class="line"><span class="s">"io"</span></span><span id="LC5" class="line"><span class="s">"net/http"</span></span><span id="LC6" class="line"><span class="p">)</span></span><span id="LC7" class="line"></span><span id="LC8" class="line"><span class="k">func</span><span class="n">main</span><span class="p">()</span><span class="p">{</span></span><span id="LC9" class="line"><span class="n">http</span><span class="o">.</span><span class="n">HandleFunc</span><span class="p">(</span><span class="s">"/"</span><span class="p">,</span><span class="k">func</span><span class="p">(</span><span class="n">writer</span><span class="n">http</span><span class="o">.</span><span class="n">ResponseWriter</span><span class="p">,</span><span class="n">request</span><span class="o">*</span><span class="n">http</span><span class="o">.</span><span class="n">Request</span><span class="p">)</span><span class="p">{</span></span><span id="LC10" class="line"><span class="n">_</span><span class="p">,</span><span class="n">_</span><span class="o">=</span><span class="n">io</span><span class="o">.</span><span class="n">WriteString</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span><span class="s">"Hello world!"</span><span class="p">)</span></span><span id="LC11" class="line"><span class="p">})</span></span><span id="LC12" class="line"><span class="n">_</span><span class="o">=</span><span class="n">http</span><span class="o">.</span><span class="n">ListenAndServe</span><span class="p">(</span><span class="s">":9080"</span><span class="p">,</span><span class="no">nil</span><span class="p">)</span></span><span id="LC13" class="line"><span class="p">}</span></span></pre><div class="markdown-code-block-copy-btn"></div></div></div><div class="white"><div class="highlight markdown-code-block"><pre><span id="LC1" class="line">➜  ~ curl productpage:9080</span><span id="LC2" class="line">Hello world!%</span><span id="LC3" class="line">➜  ~ curl productpage.default.svc.cluster.local:9080</span><span id="LC4" class="line">Hello world!%</span></pre><div class="markdown-code-block-copy-btn"></div></div></div><h3><a id="反向代理支持-service-mesh" class="anchor" href="https://gitee.com/kubevpn/kubevpn#%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E6%94%AF%E6%8C%81-service-mesh"></a>反向代理支持 service mesh</h3><p>支持 HTTP, GRPC 和 WebSocket 等, 攜帶了指定 header <code>"a: 1"</code> 的流量，將會路由到本地</p><div class="white"><div class="highlight markdown-code-block"><pre><span id="LC1" class="line">➜  ~ kubevpn proxy deployment/productpage <span class="nt">--headers</span><span class="nv">a</span><span class="o">=</span>1</span><span id="LC2" class="line">already connect to cluster</span><span id="LC3" class="line">start to create remote inbound pod <span class="k">for </span>deployment/productpage</span><span id="LC4" class="line">patch workload default/deployment/productpage with sidecar</span><span id="LC5" class="line">rollout status <span class="k">for </span>deployment/productpage</span><span id="LC6" class="line">Waiting <span class="k">for </span>deployment <span class="s2">"productpage"</span> rollout to finish: 1 old replicas are pending termination...</span><span id="LC7" class="line">Waiting <span class="k">for </span>deployment <span class="s2">"productpage"</span> rollout to finish: 1 old replicas are pending termination...</span><span id="LC8" class="line">deployment <span class="s2">"productpage"</span> successfully rolled out</span><span id="LC9" class="line">rollout status <span class="k">for </span>deployment/productpage successfully</span><span id="LC10" class="line">create remote inbound pod <span class="k">for </span>deployment/productpage successfully</span><span id="LC11" class="line">+---------------------------------------------------------------------------+</span><span id="LC12" class="line">|    Now you can access resources <span class="k">in </span>the kubernetes cluster, enjoy it :<span class="o">)</span>    |</span><span id="LC13" class="line">+---------------------------------------------------------------------------+</span><span id="LC14" class="line">➜  ~</span></pre><div class="markdown-code-block-copy-btn"></div></div></div><div class="white"><div class="highlight markdown-code-block"><pre><span id="LC1" class="line">➜  ~ curl productpage:9080</span><span id="LC2" class="line">&lt;<span class="o">!</span>DOCTYPE html&gt;</span><span id="LC3" class="line">&lt;html&gt;</span><span id="LC4" class="line">  &lt;<span class="nb">head</span><span class="o">&gt;</span></span><span id="LC5" class="line">    &lt;title&gt;Simple Bookstore App&lt;/title&gt;</span><span id="LC6" class="line">&lt;meta <span class="nv">charset</span><span class="o">=</span><span class="s2">"utf-8"</span><span class="o">&gt;</span></span><span id="LC7" class="line">&lt;meta http-equiv<span class="o">=</span><span class="s2">"X-UA-Compatible"</span><span class="nv">content</span><span class="o">=</span><span class="s2">"IE=edge"</span><span class="o">&gt;</span></span><span id="LC8" class="line">&lt;meta <span class="nv">name</span><span class="o">=</span><span class="s2">"viewport"</span><span class="nv">content</span><span class="o">=</span><span class="s2">"width=device-width, initial-scale=1"</span><span class="o">&gt;</span></span><span id="LC9" class="line">...</span></pre><div class="markdown-code-block-copy-btn"></div></div></div><div class="white"><div class="highlight markdown-code-block"><pre><span id="LC1" class="line">➜  ~ curl productpage:9080 <span class="nt">-H</span><span class="s2">"a: 1"</span></span><span id="LC2" class="line">Hello world!%</span></pre><div class="markdown-code-block-copy-btn"></div></div></div><p>如果你需要取消代理流量，可以執行如下命令：</p><div class="white"><div class="highlight markdown-code-block"><pre><span id="LC1" class="line">➜  ~ kubevpn leave deployments/productpage</span><span id="LC2" class="line">leave workload deployments/productpage</span><span id="LC3" class="line">workload default/deployments/productpage is controlled by a controller</span><span id="LC4" class="line">leave workload deployments/productpage successfully</span></pre><div class="markdown-code-block-copy-btn"></div></div></div><h3><a id="本地進入開發模式-" class="anchor" href="https://gitee.com/kubevpn/kubevpn#%E6%9C%AC%E5%9C%B0%E8%BF%9B%E5%85%A5%E5%BC%80%E5%8F%91%E6%A8%A1%E5%BC%8F-"></a>本地進入開發模式 🐳</h3><p>將 Kubernetes pod 運行在本地的 Docker 容器中，同時配合 service mesh, 攔截帶有指定 header 的流量到本地，或者所有的流量到本地。這個開發模式依賴於本地 Docker。</p><div class="white"><div class="highlight markdown-code-block"><pre><span id="LC1" class="line">➜  ~ kubevpn dev deployment/authors <span class="nt">--headers</span><span class="nv">a</span><span class="o">=</span>1 <span class="nt">-it</span><span class="nt">--rm</span><span class="nt">--entrypoint</span> sh</span><span id="LC2" class="line">connectting to cluster</span><span id="LC3" class="line">start to connect</span><span id="LC4" class="line">got cidr from cache</span><span id="LC5" class="line">get cidr successfully</span><span id="LC6" class="line">update ref count successfully</span><span id="LC7" class="line">traffic manager already exist, reuse it</span><span id="LC8" class="line">port forward ready</span><span id="LC9" class="line">tunnel connected</span><span id="LC10" class="line">dns service ok</span><span id="LC11" class="line">start to create remote inbound pod <span class="k">for </span>Deployment.apps/authors</span><span id="LC12" class="line">patch workload default/Deployment.apps/authors with sidecar</span><span id="LC13" class="line">rollout status <span class="k">for </span>Deployment.apps/authors</span><span id="LC14" class="line">Waiting <span class="k">for </span>deployment <span class="s2">"authors"</span> rollout to finish: 1 old replicas are pending termination...</span><span id="LC15" class="line">Waiting <span class="k">for </span>deployment <span class="s2">"authors"</span> rollout to finish: 1 old replicas are pending termination...</span><span id="LC16" class="line">deployment <span class="s2">"authors"</span> successfully rolled out</span><span id="LC17" class="line">rollout status <span class="k">for </span>Deployment.apps/authors successfully</span><span id="LC18" class="line">create remote inbound pod <span class="k">for </span>Deployment.apps/authors successfully</span><span id="LC19" class="line"><span class="nb">tar</span>: removing leading <span class="s1">'/'</span> from member names</span><span id="LC20" class="line">/var/folders/30/cmv9c_5j3mq_kthx63sb1t5c0000gn/T/4563987760170736212:/var/run/secrets/kubernetes.io/serviceaccount</span><span id="LC21" class="line"><span class="nb">tar</span>: Removing leading <span class="sb">`</span>/<span class="s1">' from member names</span></span><span id="LC22" class="line"><span class="s1">tar: Removing leading `/'</span> from hard <span class="nb">link </span>targets</span><span id="LC23" class="line">/var/folders/30/cmv9c_5j3mq_kthx63sb1t5c0000gn/T/4044542168121221027:/var/run/secrets/kubernetes.io/serviceaccount</span><span id="LC24" class="line">create docker network 56c25058d4b7498d02c2c2386ccd1b2b127cb02e8a1918d6d24bffd18570200e</span><span id="LC25" class="line">Created container: nginx_default_kubevpn_a9a22</span><span id="LC26" class="line">Wait container nginx_default_kubevpn_a9a22 to be running...</span><span id="LC27" class="line">Container nginx_default_kubevpn_a9a22 is running on port 80/tcp:80 8888/tcp:8888 9080/tcp:9080 now</span><span id="LC28" class="line">WARNING: The requested image<span class="s1">'s platform (linux/amd64) does not match the detected host platform (linux/arm64/v8) and no specific platform was requested</span></span><span id="LC29" class="line"><span class="s1">Created main container: authors_default_kubevpn_a9a22</span></span><span id="LC30" class="line"><span class="s1">/opt/microservices # ls</span></span><span id="LC31" class="line"><span class="s1">app</span></span><span id="LC32" class="line"><span class="s1">/opt/microservices # ps -ef</span></span><span id="LC33" class="line"><span class="s1">PID   USER     TIME  COMMAND</span></span><span id="LC34" class="line"><span class="s1">    1 root      0:00 nginx: master process nginx -g daemon off;</span></span><span id="LC35" class="line"><span class="s1">   29 101       0:00 nginx: worker process</span></span><span id="LC36" class="line"><span class="s1">   30 101       0:00 nginx: worker process</span></span><span id="LC37" class="line"><span class="s1">   31 101       0:00 nginx: worker process</span></span><span id="LC38" class="line"><span class="s1">   32 101       0:00 nginx: worker process</span></span><span id="LC39" class="line"><span class="s1">   33 101       0:00 nginx: worker process</span></span><span id="LC40" class="line"><span class="s1">   34 root      0:00 {sh} /usr/bin/qemu-x86_64 /bin/sh sh</span></span><span id="LC41" class="line"><span class="s1">   44 root      0:00 ps -ef</span></span><span id="LC42" class="line"><span class="s1">/opt/microservices # apk add curl</span></span><span id="LC43" class="line"><span class="s1">fetch https://dl-cdn.alpinelinux.org/alpine/v3.14/main/x86_64/APKINDEX.tar.gz</span></span><span id="LC44" class="line"><span class="s1">fetch https://dl-cdn.alpinelinux.org/alpine/v3.14/community/x86_64/APKINDEX.tar.gz</span></span><span id="LC45" class="line"><span class="s1">(1/4) Installing brotli-libs (1.0.9-r5)</span></span><span id="LC46" class="line"><span class="s1">(2/4) Installing nghttp2-libs (1.43.0-r0)</span></span><span id="LC47" class="line"><span class="s1">(3/4) Installing libcurl (8.0.1-r0)</span></span><span id="LC48" class="line"><span class="s1">(4/4) Installing curl (8.0.1-r0)</span></span><span id="LC49" class="line"><span class="s1">Executing busybox-1.33.1-r3.trigger</span></span><span id="LC50" class="line"><span class="s1">OK: 8 MiB in 19 packages</span></span><span id="LC51" class="line"><span class="s1">/opt/microservices # ./app &amp;</span></span><span id="LC52" class="line"><span class="s1">/opt/microservices # 2023/09/30 13:41:58 Start listening http port 9080 ...</span></span><span id="LC53" class="line"></span><span id="LC54" class="line"><span class="s1">/opt/microservices # curl localhost:9080/health</span></span><span id="LC55" class="line"><span class="s1">{"status":"Authors is healthy"}/opt/microservices # exit</span></span><span id="LC56" class="line"><span class="s1">prepare to exit, cleaning up</span></span><span id="LC57" class="line"><span class="s1">update ref count successfully</span></span><span id="LC58" class="line"><span class="s1">tun device closed</span></span><span id="LC59" class="line"><span class="s1">leave resource: deployments.apps/authors</span></span><span id="LC60" class="line"><span class="s1">workload default/deployments.apps/authors is controlled by a controller</span></span><span id="LC61" class="line"><span class="s1">leave resource: deployments.apps/authors successfully</span></span><span id="LC62" class="line"><span class="s1">clean up successfully</span></span><span id="LC63" class="line"><span class="s1">prepare to exit, cleaning up</span></span><span id="LC64" class="line"><span class="s1">update ref count successfully</span></span><span id="LC65" class="line"><span class="s1">clean up successfully</span></span><span id="LC66" class="line"><span class="s1">➜  ~</span></span></pre><div class="markdown-code-block-copy-btn"></div></div></div><p>此時本地會啓動兩個 container, 對應 pod 容器中的兩個 container, 並且共享端口, 可以直接使用 localhost:port 的形式直接訪問另一個 container,
並且, 所有的環境變量、掛載卷、網絡條件都和 pod 一樣, 真正做到與 kubernetes 運行環境一致。</p><div class="white"><div class="highlight markdown-code-block"><pre><span id="LC1" class="line">➜  ~ docker ps</span><span id="LC2" class="line">CONTAINER ID   IMAGE                           COMMAND                  CREATED          STATUS          PORTS                                                                NAMES</span><span id="LC3" class="line">afdecf41c08d   naison/authors:latest           <span class="s2">"sh"</span>                     37 seconds ago   Up 36 seconds                                                                        authors_default_kubevpn_a9a22</span><span id="LC4" class="line">fc04e42799a5   nginx:latest                    <span class="s2">"/docker-entrypoint.…"</span>   37 seconds ago   Up 37 seconds   0.0.0.0:80-&gt;80/tcp, 0.0.0.0:8888-&gt;8888/tcp, 0.0.0.0:9080-&gt;9080/tcp   nginx_default_kubevpn_a9a22</span><span id="LC5" class="line">➜  ~</span></pre><div class="markdown-code-block-copy-btn"></div></div></div><p>如果你只是想在本地啓動鏡像，可以用一種簡單的方式：</p><div class="white"><div class="highlight markdown-code-block"><pre><span id="LC1" class="line">kubevpn dev deployment/authors <span class="nt">--no-proxy</span><span class="nt">-it</span><span class="nt">--rm</span></span></pre><div class="markdown-code-block-copy-btn"></div></div></div><p>例如：</p><div class="white"><div class="highlight markdown-code-block"><pre><span id="LC1" class="line">➜  ~ kubevpn dev deployment/authors <span class="nt">--no-proxy</span><span class="nt">-it</span><span class="nt">--rm</span></span><span id="LC2" class="line">connectting to cluster</span><span id="LC3" class="line">start to connect</span><span id="LC4" class="line">got cidr from cache</span><span id="LC5" class="line">get cidr successfully</span><span id="LC6" class="line">update ref count successfully</span><span id="LC7" class="line">traffic manager already exist, reuse it</span><span id="LC8" class="line">port forward ready</span><span id="LC9" class="line">tunnel connected</span><span id="LC10" class="line">dns service ok</span><span id="LC11" class="line"><span class="nb">tar</span>: removing leading <span class="s1">'/'</span> from member names</span><span id="LC12" class="line">/var/folders/30/cmv9c_5j3mq_kthx63sb1t5c0000gn/T/5631078868924498209:/var/run/secrets/kubernetes.io/serviceaccount</span><span id="LC13" class="line"><span class="nb">tar</span>: Removing leading <span class="sb">`</span>/<span class="s1">' from member names</span></span><span id="LC14" class="line"><span class="s1">tar: Removing leading `/'</span> from hard <span class="nb">link </span>targets</span><span id="LC15" class="line">/var/folders/30/cmv9c_5j3mq_kthx63sb1t5c0000gn/T/1548572512863475037:/var/run/secrets/kubernetes.io/serviceaccount</span><span id="LC16" class="line">create docker network 56c25058d4b7498d02c2c2386ccd1b2b127cb02e8a1918d6d24bffd18570200e</span><span id="LC17" class="line">Created container: nginx_default_kubevpn_ff34b</span><span id="LC18" class="line">Wait container nginx_default_kubevpn_ff34b to be running...</span><span id="LC19" class="line">Container nginx_default_kubevpn_ff34b is running on port 80/tcp:80 8888/tcp:8888 9080/tcp:9080 now</span><span id="LC20" class="line">WARNING: The requested image<span class="s1">'s platform (linux/amd64) does not match the detected host platform (linux/arm64/v8) and no specific platform was requested</span></span><span id="LC21" class="line"><span class="s1">Created main container: authors_default_kubevpn_ff34b</span></span><span id="LC22" class="line"><span class="s1">2023/09/30 14:02:31 Start listening http port 9080 ...</span></span><span id="LC23" class="line"></span></pre><div class="markdown-code-block-copy-btn"></div></div></div><p>此時程序會掛起，默認為顯示日誌</p><p>如果你想指定在本地啓動容器的鏡像, 可以使用參數 <code>--docker-image</code>, 當本地不存在該鏡像時, 會從對應的鏡像倉庫拉取。如果你想指定啓動參數，可以使用 <code>--entrypoint</code>
參數，替換為你想要執行的命令，比如 <code>--entrypoint /bin/bash</code>, 更多使用參數，請參見 <code>kubevpn dev --help</code>.</p><h3><a id="dind--docker-in-docker--在-docker-中使用-kubevpn" class="anchor" href="https://gitee.com/kubevpn/kubevpn#dind--docker-in-docker--%E5%9C%A8-docker-%E4%B8%AD%E4%BD%BF%E7%94%A8-kubevpn"></a>DinD ( Docker in Docker ) 在 Docker 中使用 kubevpn</h3><p>如果你想在本地使用 Docker in Docker (DinD) 的方式啓動開發模式, 由於程序會讀寫 <code>/tmp</code> 目錄，您需要手動添加參數 <code>-v /tmp:/tmp</code>, 還有一點需要注意, 如果使用 DinD
模式，為了共享容器網絡和 pid, 還需要指定參數 <code>--network</code></p><p>例如:</p><div class="white"><div class="highlight markdown-code-block"><pre><span id="LC1" class="line">docker run <span class="nt">-it</span><span class="nt">--privileged</span><span class="nt">--sysctl</span> net.ipv6.conf.all.disable_ipv6<span class="o">=</span>0 <span class="nt">-v</span> /var/run/docker.sock:/var/run/docker.sock <span class="nt">-v</span> /tmp:/tmp <span class="nt">-v</span> ~/.kube/config:/root/.kube/config <span class="nt">--platform</span> linux/amd64 naison/kubevpn:v2.0.0</span></pre><div class="markdown-code-block-copy-btn"></div></div></div><div class="white"><div class="highlight markdown-code-block"><pre><span id="LC1" class="line">➜  ~ docker run <span class="nt">-it</span><span class="nt">--privileged</span><span class="nt">--sysctl</span> net.ipv6.conf.all.disable_ipv6<span class="o">=</span>0 <span class="nt">-v</span> /var/run/docker.sock:/var/run/docker.sock <span class="nt">-v</span> /tmp:/tmp <span class="nt">-v</span> ~/.kube/vke:/root/.kube/config <span class="nt">--platform</span> linux/amd64 naison/kubevpn:v2.0.0</span><span id="LC2" class="line">Unable to find image <span class="s1">'naison/kubevpn:v2.0.0'</span> locally</span><span id="LC3" class="line">v2.0.0: Pulling from naison/kubevpn</span><span id="LC4" class="line">445a6a12be2b: Already exists</span><span id="LC5" class="line">bd6c670dd834: Pull <span class="nb">complete</span></span><span id="LC6" class="line">64a7297475a2: Pull <span class="nb">complete</span></span><span id="LC7" class="line">33fa2e3224db: Pull <span class="nb">complete</span></span><span id="LC8" class="line">e008f553422a: Pull <span class="nb">complete</span></span><span id="LC9" class="line">5132e0110ddc: Pull <span class="nb">complete</span></span><span id="LC10" class="line">5b2243de1f1a: Pull <span class="nb">complete</span></span><span id="LC11" class="line">662a712db21d: Pull <span class="nb">complete</span></span><span id="LC12" class="line">4f4fb700ef54: Pull <span class="nb">complete</span></span><span id="LC13" class="line">33f0298d1d4f: Pull <span class="nb">complete</span></span><span id="LC14" class="line">Digest: sha256:115b975a97edd0b41ce7a0bc1d8428e6b8569c91a72fe31ea0bada63c685742e</span><span id="LC15" class="line">Status: Downloaded newer image <span class="k">for </span>naison/kubevpn:v2.0.0</span><span id="LC16" class="line">root@d0b3dab8912a:/app# kubevpn dev deployment/authors <span class="nt">--headers</span><span class="nv">user</span><span class="o">=</span>naison <span class="nt">-it</span><span class="nt">--entrypoint</span> sh</span><span id="LC17" class="line"></span><span id="LC18" class="line"><span class="nt">----------------------------------------------------------------------------------</span></span><span id="LC19" class="line">    Warn: Use <span class="nb">sudo </span>to execute <span class="nb">command </span>kubevpn can not use user <span class="nb">env </span>KUBECONFIG.</span><span id="LC20" class="line">    Because of <span class="nb">sudo </span>user <span class="nb">env </span>and user <span class="nb">env </span>are different.</span><span id="LC21" class="line">    Current <span class="nb">env </span>KUBECONFIG value:</span><span id="LC22" class="line"><span class="nt">----------------------------------------------------------------------------------</span></span><span id="LC23" class="line"></span><span id="LC24" class="line"><span class="nb">hostname </span>is d0b3dab8912a</span><span id="LC25" class="line">connectting to cluster</span><span id="LC26" class="line">start to connect</span><span id="LC27" class="line">got cidr from cache</span><span id="LC28" class="line">get cidr successfully</span><span id="LC29" class="line">update ref count successfully</span><span id="LC30" class="line">traffic manager already exist, reuse it</span><span id="LC31" class="line">port forward ready</span><span id="LC32" class="line">tunnel connected</span><span id="LC33" class="line">dns service ok</span><span id="LC34" class="line">start to create remote inbound pod <span class="k">for </span>Deployment.apps/authors</span><span id="LC35" class="line">patch workload default/Deployment.apps/authors with sidecar</span><span id="LC36" class="line">rollout status <span class="k">for </span>Deployment.apps/authors</span><span id="LC37" class="line">Waiting <span class="k">for </span>deployment <span class="s2">"authors"</span> rollout to finish: 1 old replicas are pending termination...</span><span id="LC38" class="line">Waiting <span class="k">for </span>deployment <span class="s2">"authors"</span> rollout to finish: 1 old replicas are pending termination...</span><span id="LC39" class="line">deployment <span class="s2">"authors"</span> successfully rolled out</span><span id="LC40" class="line">rollout status <span class="k">for </span>Deployment.apps/authors successfully</span><span id="LC41" class="line">create remote inbound pod <span class="k">for </span>Deployment.apps/authors successfully</span><span id="LC42" class="line"><span class="nb">tar</span>: removing leading <span class="s1">'/'</span> from member names</span><span id="LC43" class="line">/tmp/6460902982794789917:/var/run/secrets/kubernetes.io/serviceaccount</span><span id="LC44" class="line"><span class="nb">tar</span>: Removing leading <span class="sb">`</span>/<span class="s1">' from member names</span></span><span id="LC45" class="line"><span class="s1">tar: Removing leading `/'</span> from hard <span class="nb">link </span>targets</span><span id="LC46" class="line">/tmp/5028895788722532426:/var/run/secrets/kubernetes.io/serviceaccount</span><span id="LC47" class="line">network mode is container:d0b3dab8912a</span><span id="LC48" class="line">Created container: nginx_default_kubevpn_6df63</span><span id="LC49" class="line">Wait container nginx_default_kubevpn_6df63 to be running...</span><span id="LC50" class="line">Container nginx_default_kubevpn_6df63 is running now</span><span id="LC51" class="line">WARNING: The requested image<span class="s1">'s platform (linux/amd64) does not match the detected host platform (linux/arm64/v8) and no specific platform was requested</span></span><span id="LC52" class="line"><span class="s1">Created main container: authors_default_kubevpn_6df5f</span></span><span id="LC53" class="line"><span class="s1">/opt/microservices # ps -ef</span></span><span id="LC54" class="line"><span class="s1">PID   USER     TIME  COMMAND</span></span><span id="LC55" class="line"><span class="s1">    1 root      0:00 {bash} /usr/bin/qemu-x86_64 /bin/bash /bin/bash</span></span><span id="LC56" class="line"><span class="s1">   14 root      0:02 {kubevpn} /usr/bin/qemu-x86_64 /usr/local/bin/kubevpn kubevpn dev deployment/authors --headers</span></span><span id="LC57" class="line"><span class="s1">   25 root      0:01 {kubevpn} /usr/bin/qemu-x86_64 /usr/local/bin/kubevpn /usr/local/bin/kubevpn daemon</span></span><span id="LC58" class="line"><span class="s1">   37 root      0:04 {kubevpn} /usr/bin/qemu-x86_64 /usr/local/bin/kubevpn /usr/local/bin/kubevpn daemon --sudo</span></span><span id="LC59" class="line"><span class="s1">   53 root      0:00 nginx: master process nginx -g daemon off;</span></span><span id="LC60" class="line"><span class="s1">(4/4) Installing curl (8.0.1-r0)</span></span><span id="LC61" class="line"><span class="s1">Executing busybox-1.33.1-r3.trigger</span></span><span id="LC62" class="line"><span class="s1">OK: 8 MiB in 19 packagesnx: worker process</span></span><span id="LC63" class="line"><span class="s1">/opt/microservices #</span></span><span id="LC64" class="line"><span class="s1">/opt/microservices # apk add curl</span></span><span id="LC65" class="line"><span class="s1">OK: 8 MiB in 19 packages</span></span><span id="LC66" class="line"><span class="s1">/opt/microservices # curl localhost:80</span></span><span id="LC67" class="line"><span class="s1">&lt;!DOCTYPE html&gt;</span></span><span id="LC68" class="line"><span class="s1">&lt;html&gt;</span></span><span id="LC69" class="line"><span class="s1">&lt;head&gt;</span></span><span id="LC70" class="line"><span class="s1">&lt;title&gt;Welcome to nginx!&lt;/title&gt;</span></span><span id="LC71" class="line"><span class="s1">&lt;style&gt;</span></span><span id="LC72" class="line"><span class="s1">html { color-scheme: light dark; }</span></span><span id="LC73" class="line"><span class="s1">body { width: 35em; margin: 0 auto;</span></span><span id="LC74" class="line"><span class="s1">font-family: Tahoma, Verdana, Arial, sans-serif; }</span></span><span id="LC75" class="line"><span class="s1">&lt;/style&gt;</span></span><span id="LC76" class="line"><span class="s1">&lt;/head&gt;</span></span><span id="LC77" class="line"><span class="s1">&lt;body&gt;</span></span><span id="LC78" class="line"><span class="s1">&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;</span></span><span id="LC79" class="line"><span class="s1">&lt;p&gt;If you see this page, the nginx web server is successfully installed and</span></span><span id="LC80" class="line"><span class="s1">working. Further configuration is required.&lt;/p&gt;</span></span><span id="LC81" class="line"></span><span id="LC82" class="line"><span class="s1">&lt;p&gt;For online documentation and support please refer to</span></span><span id="LC83" class="line"><span class="s1">&lt;a href="http://nginx.org/"&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;</span></span><span id="LC84" class="line"><span class="s1">Commercial support is available at</span></span><span id="LC85" class="line"><span class="s1">&lt;a href="http://nginx.com/"&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;</span></span><span id="LC86" class="line"></span><span id="LC87" class="line"><span class="s1">&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;</span></span><span id="LC88" class="line"><span class="s1">&lt;/body&gt;</span></span><span id="LC89" class="line"><span class="s1">&lt;/html&gt;</span></span><span id="LC90" class="line"><span class="s1">/opt/microservices # ls</span></span><span id="LC91" class="line"><span class="s1">app</span></span><span id="LC92" class="line"><span class="s1">/opt/microservices # ls -alh</span></span><span id="LC93" class="line"><span class="s1">total 6M</span></span><span id="LC94" class="line"><span class="s1">drwxr-xr-x    2 root     root        4.0K Oct 18  2021 .</span></span><span id="LC95" class="line"><span class="s1">drwxr-xr-x    1 root     root        4.0K Oct 18  2021 ..</span></span><span id="LC96" class="line"><span class="s1">-rwxr-xr-x    1 root     root        6.3M Oct 18  2021 app</span></span><span id="LC97" class="line"><span class="s1">/opt/microservices # ./app &amp;</span></span><span id="LC98" class="line"><span class="s1">/opt/microservices # 2023/09/30 14:27:32 Start listening http port 9080 ...</span></span><span id="LC99" class="line"></span><span id="LC100" class="line"><span class="s1">/opt/microservices # curl authors:9080/health</span></span><span id="LC101" class="line"><span class="s1">/opt/microservices # curl authors:9080/health</span></span><span id="LC102" class="line"><span class="s1">{"status":"Authors is healthy"}/opt/microservices #</span></span><span id="LC103" class="line"><span class="s1">/opt/microservices # curl localhost:9080/health</span></span><span id="LC104" class="line"><span class="s1">{"status":"Authors is healthy"}/opt/microservices # exit</span></span><span id="LC105" class="line"><span class="s1">prepare to exit, cleaning up</span></span><span id="LC106" class="line"><span class="s1">update ref count successfully</span></span><span id="LC107" class="line"><span class="s1">tun device closed</span></span><span id="LC108" class="line"><span class="s1">leave resource: deployments.apps/authors</span></span><span id="LC109" class="line"><span class="s1">workload default/deployments.apps/authors is controlled by a controller</span></span><span id="LC110" class="line"><span class="s1">leave resource: deployments.apps/authors successfully</span></span><span id="LC111" class="line"><span class="s1">clean up successfully</span></span><span id="LC112" class="line"><span class="s1">prepare to exit, cleaning up</span></span><span id="LC113" class="line"><span class="s1">update ref count successfully</span></span><span id="LC114" class="line"><span class="s1">clean up successfully</span></span><span id="LC115" class="line"><span class="s1">root@d0b3dab8912a:/app# exit</span></span><span id="LC116" class="line"><span class="s1">exit</span></span><span id="LC117" class="line"><span class="s1">➜  ~</span></span></pre><div class="markdown-code-block-copy-btn"></div></div></div><div class="white"><div class="highlight markdown-code-block"><pre><span id="LC1" class="line">➜  ~ docker ps</span><span id="LC2" class="line">CONTAINER ID   IMAGE                           COMMAND                  CREATED         STATUS         PORTS     NAMES</span><span id="LC3" class="line">1cd576b51b66   naison/authors:latest           "sh"                     4 minutes ago   Up 4 minutes             authors_default_kubevpn_6df5f</span><span id="LC4" class="line">56a6793df82d   nginx:latest                    "/docker-entrypoint.…"   4 minutes ago   Up 4 minutes             nginx_default_kubevpn_6df63</span><span id="LC5" class="line">d0b3dab8912a   naison/kubevpn:v2.0.0     "/bin/bash"              5 minutes ago   Up 5 minutes             upbeat_noyce</span><span id="LC6" class="line">➜  ~</span></pre><div class="markdown-code-block-copy-btn"></div></div></div><h3><a id="支持多種協議" class="anchor" href="https://gitee.com/kubevpn/kubevpn#%E6%94%AF%E6%8C%81%E5%A4%9A%E7%A7%8D%E5%8D%8F%E8%AE%AE"></a>支持多種協議</h3><ul><li>TCP</li><li>UDP</li><li>ICMP</li><li>GRPC</li><li>WebSocket</li><li>HTTP</li><li>...</li></ul><h3><a id="支持三大平台" class="anchor" href="https://gitee.com/kubevpn/kubevpn#%E6%94%AF%E6%8C%81%E4%B8%89%E5%A4%A7%E5%B9%B3%E5%8F%B0"></a>支持三大平台</h3><ul><li>macOS</li><li>Linux</li><li>Windows</li></ul><p>Windows
下需要安裝 <a href="https://gitee.com/link?target=https%3A%2F%2Fdocs.microsoft.com%2Fzh-cn%2Fpowershell%2Fscripting%2Finstall%2Finstalling-powershell-on-windows%3Fview%3Dpowershell-7.2">PowerShell</a></p><h2><a id="問答" class="anchor" href="https://gitee.com/kubevpn/kubevpn#%E9%97%AE%E7%AD%94"></a>問答</h2><h3><a id="1 依賴的鏡像拉不下來或者內網環境無法訪問-dockerio-怎麼辦" class="anchor" href="https://gitee.com/kubevpn/kubevpn#1%E4%BE%9D%E8%B5%96%E7%9A%84%E9%95%9C%E5%83%8F%E6%8B%89%E4%B8%8D%E4%B8%8B%E6%9D%A5%E6%88%96%E8%80%85%E5%86%85%E7%BD%91%E7%8E%AF%E5%A2%83%E6%97%A0%E6%B3%95%E8%AE%BF%E9%97%AE-dockerio-%E6%80%8E%E4%B9%88%E5%8A%9E"></a>1，依賴的鏡像拉不下來，或者內網環境無法訪問 docker.io 怎麼辦？</h3><p>答：有兩種方法可以解決</p><ul><li>第一種，在可以訪問 docker.io 的網絡中，將命令 <code>kubevpn version</code> 中的 image 鏡像， 轉存到自己的私有鏡像倉庫，然後啓動命令的時候，加上 <code>--image 新鏡像</code> 即可。
例如:</li></ul><div class="white"><div class="highlight markdown-code-block"><pre><span id="LC1" class="line">➜  ~ kubevpn version</span><span id="LC2" class="line">KubeVPN: CLI</span><span id="LC3" class="line">    Version: v2.0.0</span><span id="LC4" class="line">    DaemonVersion: v2.0.0</span><span id="LC5" class="line">    Image: docker.io/naison/kubevpn:v2.0.0</span><span id="LC6" class="line">    Branch: feature/daemon</span><span id="LC7" class="line">    Git commit: 7c3a87e14e05c238d8fb23548f95fa1dd6e96936</span><span id="LC8" class="line">    Built <span class="nb">time</span>: 2023-09-30 22:01:51</span><span id="LC9" class="line">    Built OS/Arch: darwin/arm64</span><span id="LC10" class="line">    Built Go version: go1.20.5</span></pre><div class="markdown-code-block-copy-btn"></div></div></div><p>鏡像是 <code>docker.io/naison/kubevpn:v2.0.0</code>，將此鏡像轉存到自己的鏡像倉庫。</p><div class="white"><div class="highlight markdown-code-block"><pre><span id="LC1" class="line">docker pull docker.io/naison/kubevpn:v2.0.0</span><span id="LC2" class="line">docker tag docker.io/naison/kubevpn:v2.0.0 [鏡像倉庫地址]/[命名空間]/[鏡像倉庫]:[鏡像版本號]</span><span id="LC3" class="line">docker push [鏡像倉庫地址]/[命名空間]/[鏡像倉庫]:[鏡像版本號]</span></pre><div class="markdown-code-block-copy-btn"></div></div></div><p>然後就可以使用這個鏡像了，如下：</p><div class="white"><div class="highlight markdown-code-block"><pre><span id="LC1" class="line">➜  ~ kubevpn connect --image [docker registry]/[namespace]/[repo]:[tag]</span><span id="LC2" class="line">got cidr from cache</span><span id="LC3" class="line">traffic manager not exist, try to create it...</span><span id="LC4" class="line">pod [kubevpn-traffic-manager] status is Running</span><span id="LC5" class="line">...</span></pre><div class="markdown-code-block-copy-btn"></div></div></div><ul><li>第二種，使用選項 <code>--transfer-image</code>, 這個選項將會自動轉存鏡像到選項 <code>--image</code> 指定的地址。
例如：</li></ul><div class="white"><div class="highlight markdown-code-block"><pre><span id="LC1" class="line">➜  ~ kubevpn connect <span class="nt">--transfer-image</span><span class="nt">--image</span> nocalhost-team-docker.pkg.coding.net/nocalhost/public/kubevpn:v2.0.0</span><span id="LC2" class="line">v2.0.0: Pulling from naison/kubevpn</span><span id="LC3" class="line">Digest: sha256:450446850891eb71925c54a2fab5edb903d71103b485d6a4a16212d25091b5f4</span><span id="LC4" class="line">Status: Image is up to <span class="nb">date </span><span class="k">for </span>naison/kubevpn:v2.0.0</span><span id="LC5" class="line">The push refers to repository <span class="o">[</span>nocalhost-team-docker.pkg.coding.net/nocalhost/public/kubevpn]</span><span id="LC6" class="line">ecc065754c15: Preparing</span><span id="LC7" class="line">f2b6c07cb397: Pushed</span><span id="LC8" class="line">448eaa16d666: Pushed</span><span id="LC9" class="line">f5507edfc283: Pushed</span><span id="LC10" class="line">3b6ea9aa4889: Pushed</span><span id="LC11" class="line">ecc065754c15: Pushed</span><span id="LC12" class="line">feda785382bb: Pushed</span><span id="LC13" class="line">v2.0.0: digest: sha256:85d29ebb53af7d95b9137f8e743d49cbc16eff1cdb9983128ab6e46e0c25892c size: 2000</span><span id="LC14" class="line">start to connect</span><span id="LC15" class="line">got cidr from cache</span><span id="LC16" class="line">get cidr successfully</span><span id="LC17" class="line">update ref count successfully</span><span id="LC18" class="line">traffic manager already exist, reuse it</span><span id="LC19" class="line">port forward ready</span><span id="LC20" class="line">tunnel connected</span><span id="LC21" class="line">dns service ok</span><span id="LC22" class="line">+---------------------------------------------------------------------------+</span><span id="LC23" class="line">|    Now you can access resources <span class="k">in </span>the kubernetes cluster, enjoy it :<span class="o">)</span>    |</span><span id="LC24" class="line">+---------------------------------------------------------------------------+</span><span id="LC25" class="line">➜  ~</span></pre><div class="markdown-code-block-copy-btn"></div></div></div><h3><a id="2 在使用-kubevpn-dev-進入開發模式的時候有出現報錯-137-改怎麼解決-" class="anchor" href="https://gitee.com/kubevpn/kubevpn#2%E5%9C%A8%E4%BD%BF%E7%94%A8-kubevpn-dev-%E8%BF%9B%E5%85%A5%E5%BC%80%E5%8F%91%E6%A8%A1%E5%BC%8F%E7%9A%84%E6%97%B6%E5%80%99%E6%9C%89%E5%87%BA%E7%8E%B0%E6%8A%A5%E9%94%99-137-%E6%94%B9%E6%80%8E%E4%B9%88%E8%A7%A3%E5%86%B3-"></a>2，在使用 <code>kubevpn dev</code> 進入開發模式的時候,有出現報錯 137, 改怎麼解決 ?</h3><div class="white"><div class="highlight markdown-code-block"><pre><span id="LC1" class="line">dns service ok</span><span id="LC2" class="line">tar: Removing leading `/' from member names</span><span id="LC3" class="line">tar: Removing leading `/' from hard link targets</span><span id="LC4" class="line">/var/folders/30/cmv9c_5j3mq_kthx63sb1t5c0000gn/T/7375606548554947868:/var/run/secrets/kubernetes.io/serviceaccount</span><span id="LC5" class="line">Created container: server_vke-system_kubevpn_0db84</span><span id="LC6" class="line">Wait container server_vke-system_kubevpn_0db84 to be running...</span><span id="LC7" class="line">Container server_vke-system_kubevpn_0db84 is running on port 8888/tcp: 6789/tcp:6789 now</span><span id="LC8" class="line">$ Status: , Code: 137</span><span id="LC9" class="line">prepare to exit, cleaning up</span><span id="LC10" class="line">port-forward occurs error, err: lost connection to pod, retrying</span><span id="LC11" class="line">update ref count successfully</span><span id="LC12" class="line">ref-count is zero, prepare to clean up resource</span><span id="LC13" class="line">clean up successfully</span></pre><div class="markdown-code-block-copy-btn"></div></div></div><p>這是因為你的 <code>Docker-desktop</code> 聲明的資源, 小於 container 容器啓動時所需要的資源, 因此被 OOM 殺掉了, 你可以增加 <code>Docker-desktop</code> 對於 resources
的設置, 目錄是：<code>Preferences --&gt; Resources --&gt; Memory</code></p><h3><a id="3 使用-wsl-windows-sub-linux--docker-用命令-kubevpn-dev-進入開發模式的時候-在-terminal-中無法提示鏈接集羣網絡-這是為什麼-如何解決" class="anchor" href="https://gitee.com/kubevpn/kubevpn#3%E4%BD%BF%E7%94%A8-wsl-windows-sub-linux--docker-%E7%94%A8%E5%91%BD%E4%BB%A4-kubevpn-dev-%E8%BF%9B%E5%85%A5%E5%BC%80%E5%8F%91%E6%A8%A1%E5%BC%8F%E7%9A%84%E6%97%B6%E5%80%99-%E5%9C%A8-terminal-%E4%B8%AD%E6%97%A0%E6%B3%95%E6%8F%90%E7%A4%BA%E9%93%BE%E6%8E%A5%E9%9B%86%E7%BE%A4%E7%BD%91%E7%BB%9C-%E8%BF%99%E6%98%AF%E4%B8%BA%E4%BB%80%E4%B9%88-%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3"></a>3，使用 WSL( Windows Sub Linux ) Docker, 用命令 <code>kubevpn dev</code> 進入開發模式的時候, 在 terminal 中無法提示鏈接集羣網絡, 這是為什麼, 如何解決?</h3><p>答案: 這是因為 WSL 的 Docker 使用的是，主機 Windows 的網絡, 所以即便在 WSL 中啓動 container, 這個 container 不會使用 WSL 的網絡，而是使用 Windows 的網絡。
解決方案:</p><ul><li>1): 在 WSL 中安裝 Docker, 不要使用 Windows 版本的 Docker-desktop</li><li>2): 在主機 Windows 使用命令 <code>kubevpn connect</code>, 然後在 WSL 中使用 <code>kubevpn dev</code> 進入開發模式</li><li>3): 在主機 Windows 上啓動一個 container，在 container 中使用命令 <code>kubevpn connect</code>, 然後在 WSL
中使用 <code>kubevpn dev --network container:$CONTAINER_ID</code></li></ul><h3><a id="4 在使用-kubevpn-dev-進入開發模式後無法訪問容器網絡出現錯誤-1721701443-connect-refusued 該如何解決" class="anchor" href="https://gitee.com/kubevpn/kubevpn#4%E5%9C%A8%E4%BD%BF%E7%94%A8-kubevpn-dev-%E8%BF%9B%E5%85%A5%E5%BC%80%E5%8F%91%E6%A8%A1%E5%BC%8F%E5%90%8E%E6%97%A0%E6%B3%95%E8%AE%BF%E9%97%AE%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C%E5%87%BA%E7%8E%B0%E9%94%99%E8%AF%AF-1721701443-connect-refusued%E8%AF%A5%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3"></a>4，在使用 <code>kubevpn dev</code> 進入開發模式後，無法訪問容器網絡，出現錯誤 <code>172.17.0.1:443 connect refusued</code>，該如何解決？</h3><p>答案：大概率是因為 k8s 容器網絡和 docker 網絡網段衝突了。</p><p>解決方案：</p><ul><li>使用參數 <code>--connect-mode container</code> 在容器中鏈接，也可以解決此問題</li><li>可以修改文件 <code>~/.docker/daemon.json</code> 增加不衝突的網絡，例如 <code>"bip": "172.15.0.1/24"</code>.</li></ul><div class="white"><div class="highlight markdown-code-block"><pre><span id="LC1" class="line">➜  ~ <span class="nb">cat</span> ~/.docker/daemon.json</span><span id="LC2" class="line"><span class="o">{</span></span><span id="LC3" class="line"><span class="s2">"builder"</span>: <span class="o">{</span></span><span id="LC4" class="line"><span class="s2">"gc"</span>: <span class="o">{</span></span><span id="LC5" class="line"><span class="s2">"defaultKeepStorage"</span>: <span class="s2">"20GB"</span>,</span><span id="LC6" class="line"><span class="s2">"enabled"</span>: <span class="nb">true</span></span><span id="LC7" class="line"><span class="o">}</span></span><span id="LC8" class="line"><span class="o">}</span>,</span><span id="LC9" class="line"><span class="s2">"experimental"</span>: <span class="nb">false</span>,</span><span id="LC10" class="line"><span class="s2">"features"</span>: <span class="o">{</span></span><span id="LC11" class="line"><span class="s2">"buildkit"</span>: <span class="nb">true</span></span><span id="LC12" class="line"><span class="o">}</span>,</span><span id="LC13" class="line"><span class="s2">"insecure-registries"</span>: <span class="o">[</span></span><span id="LC14" class="line"><span class="o">]</span>,</span><span id="LC15" class="line"><span class="o">}</span></span></pre><div class="markdown-code-block-copy-btn"></div></div></div><p>增加不衝突的網段</p><div class="white"><div class="highlight markdown-code-block"><pre><span id="LC1" class="line">➜  ~ <span class="nb">cat</span> ~/.docker/daemon.json</span><span id="LC2" class="line"><span class="o">{</span></span><span id="LC3" class="line"><span class="s2">"builder"</span>: <span class="o">{</span></span><span id="LC4" class="line"><span class="s2">"gc"</span>: <span class="o">{</span></span><span id="LC5" class="line"><span class="s2">"defaultKeepStorage"</span>: <span class="s2">"20GB"</span>,</span><span id="LC6" class="line"><span class="s2">"enabled"</span>: <span class="nb">true</span></span><span id="LC7" class="line"><span class="o">}</span></span><span id="LC8" class="line"><span class="o">}</span>,</span><span id="LC9" class="line"><span class="s2">"experimental"</span>: <span class="nb">false</span>,</span><span id="LC10" class="line"><span class="s2">"features"</span>: <span class="o">{</span></span><span id="LC11" class="line"><span class="s2">"buildkit"</span>: <span class="nb">true</span></span><span id="LC12" class="line"><span class="o">}</span>,</span><span id="LC13" class="line"><span class="s2">"insecure-registries"</span>: <span class="o">[</span></span><span id="LC14" class="line"><span class="o">]</span>,</span><span id="LC15" class="line"><span class="s2">"bip"</span>: <span class="s2">"172.15.0.1/24"</span></span><span id="LC16" class="line"><span class="o">}</span></span></pre><div class="markdown-code-block-copy-btn"></div></div></div><p>重啓 docker，重新操作即可</p>]]>
            </description>
            <pubDate>Mon, 05 Feb 2024 01:51:57 GMT</pubDate>
            <guid isPermaLink="false">https://gitee.com/kubevpn/kubevpn</guid>
            <link>https://gitee.com/kubevpn/kubevpn</link>
        </item>
        <item>
            <title>
                <![CDATA[DBA 要被雲淘汰了？新人該咋辦？]]>
            </title>
            <description>
                <![CDATA[<div class="content"><p>DBA（Database Administrator），即數據庫管理員，專門負責管理和維護公司的數據庫。然而，隨着上雲的趨勢漸盛，許多企業都把數據庫遷到了雲平台上。雲服務提供商通常會提供自動化工具和標準化服務，這讓 DBA 的工作得到了解放，也產生了一絲危機——有人質疑：畢竟最重要的硬件管理和架構管理已經沒了需求，而日常的監控和優化工作藉助工具就能完成，是否也意味着，DBA 這一崗位要被雲淘汰了？</p><p>但也有人認為，現在談 DBA 被雲淘汰還為時過早，雲服務更多是輔助工具而非生產工具，它並沒有完全取代 DBA，只是改變了 DBA 的工作方式和職責，讓 DBA 更專注於高級的數據庫管理任務，在數據優化、安全管理、成本管理和合規性方面發揮更大的作用。</p><p>那麼，實際情況是怎樣的呢？企業對 DBA 這一崗位的需求減少了嗎？雲環境對 DBA 的工作產生了哪些新要求？作為個人的我們，又該補充哪些新知識，才能跟上雲時代的發展呢？</p><p>對此，開源中國邀請了磐吉雲數 CEO 馮若航、公眾號《瑞典馬工》主理人馬工、雲原生數據庫 clapdb 創始人李令輝、雲和恩墨的數據庫技術負責人李真旭、Oracle ACE-Pro 薛曉剛一起來討論，希望能給各位同行帶來啓發。</p><p>&nbsp;</p><span id="OSC_h1_1"></span><h1>01 DBA 對於組織的價值是什麼？</h1><p><strong>正方：馬工 speaking ——</strong></p><p>我沒有幹過 DBA ，但是跟很多 DBA 打過交道，在我看來，DBA 的工作主要是 3 點：</p><p>第一，安裝和部署 database，讓它跑起來；</p><p>第二，保證它不要掛掉，即保證它的可靠性；</p><p>第三，保證它的數據不要丟了，防止數據泄漏。</p><p>還有一些小事，比如説不要讓開發者搞砸數據庫以及性能調優。</p><p>不過，據我所見，每一個 DBA 的招聘啓示裏都會有「領導交辦的其他事項」，就是打雜嘛。如果在座有 DBA 的話，對打雜這個事應該感受很深。</p><p>以上這幾點，我看都被 RDS 做完了，如果是做不了的，剩下的工作也不足以支撐一個專職的崗位了。</p><p>&nbsp;</p><p><strong>正方：李令輝 speaking ——</strong></p><p>作為一個 DBA 團隊的直屬 leader，DBA 在我管理一箇中大型公司的 Infra 團隊的時候的確是非常重要的，因為專人專事。對於數據庫來説，我們最在乎的是它的可靠性，數據不丟、服務不斷，從這個角度來説，是需要一個專業團隊去維護的。</p><p>但是，如果這些事情，自動化就能做到，會怎麼樣？</p><p>如今，在雲上，這大部分已經成為現實了。<strong>首先，雲在 availability 和 durability 上做得比雲下系統好得多，</strong>雲上基本可以避免 SPOF（single point of failure），但是在雲下，這件事情成本非常高。在雲上，你可以按需購買，按量付費，<strong>這本身就讓小公司擁有了一些</strong><strong>高可用性</strong><strong>。</strong></p><p><strong>其次，雲刪減了一些原有的 </strong><strong>DBA</strong><strong> 工作。</strong>例如，原來買了一批新的服務器，或者上架了一個新業務的時候，都需要 DBA 把數據遷移過去測一下。但現在在雲上，硬件環境有限，這些事情已經不再需要我們作為甲方去處理了。</p><p>還有一件事是業務方面，過去阿里提出過一個詞，叫全鏈路壓測，這件事也是數據庫團隊做得最多的。可是在雲上最大的好處是，我很容易就可以用 IAC 的方式把我的服務複製一份。這些事情都可以自動化，都不再特別依賴人去做這件事情，而且 DBA 也不是靠手做這個事情，DBA 也是靠一些工具、腳本或者數據庫廠商提供的工具，那麼這些工具和硬件、業務之間的適配就需要人去完成。但如果這件事情，已經非常的自動化，那麼還需要一個人專職或者一個團隊專職去做嗎？我表示懷疑。</p><p>&nbsp;</p><p><strong>反方：李真旭 speaking ——</strong></p><p>我覺得第一，大家對 DBA 的工作認知有差異，好像 DBA 只做一些基本的安裝部署備份工作，雖然這些工作確實是 RDS 具備的功能，但是<strong>哪怕是 </strong><strong>AWS</strong><strong>，限制也是很多的，有很多功能都滿足不了。</strong></p><p>第二，很多人認為的刷個 MySQL、搭個主從複製、布個監控這些，都是比較初級的 DBA 乾的，<strong>真正的 DBA 已經不是一個單純的</strong><strong>數據庫管理員</strong><strong>了，</strong>硬件、網絡、存儲、主機、系統、數據庫他都懂一些，你可以把他理解為是一個小企業的 CIO 都可以。他的決策權還是比較大的，至少他對信息點的把控是比較好的，他能夠去決策要用什麼硬件、用什麼數據庫、什麼型號才能滿足業務的要求，而不是單純的做備份裝監控，這個太狹隘了。</p><p>第三，就算 RDS 能夠滿足用户的絕大部分需求了，大家也會發現一個問題：據統計，<strong>數據庫裏面，80% 的問題都不是因為你的硬件或者你的網絡，而是由於應用本身的代碼寫得不好導致的，</strong>比如説一下子上來就把 CPU 打滿了，這時候你覺得 RDS 還能幫你解決這個問題嗎？我認為是解決不了的，頂多就幫你評估一下，告訴你怎麼加索引，僅此而已。它還沒做到那麼智能。</p><p>除了保證數據庫的安全高效、穩定運行，DBA 還可以向外輸出，讓業務更有價值。比如説賦能研發，給他們培訓怎麼寫 sql，讓他們開發變得更高效。</p><p>&nbsp;</p><p><strong>反方：薛曉剛 speaking ——</strong></p><p>我認為 DBA 並不僅僅只是懂數據庫，還涉及到操作系統中間件，從哪來的到哪去，這些都是要知道的。就像李真旭老師説的，選型還是 DBA 更懂。</p><p>此外，DBA 負責的是設計、測試、部署、交付......全生命週期的數據庫管理。我現在所在的企業做數據治理、數據標準化，其中就提到了一個事情：<strong>建模。</strong>業務模型、邏輯模型、物理模型，這些東西都是要參與甚至主導的，而這些，雲都不能給你做，更不用説<strong>很多企業都用不了公有云了。</strong></p><p>我在甲方工作了將近 20 年，以我的工作經驗來説，很多東西是不能優化的，它在設計的時候就已經出問題了。像數據庫對象設計，有的數據類型都選錯了，視圖函數都建錯了，在這種情況下，優化要麼是沒有力度的，要麼是收效甚微的。我接觸的傳統行業就是這樣的，如果開發都不知道數據庫有什麼特性，不管你在雲上雲下，他都不會用啊。所以，我們帶着開發去做、去用這個數據庫，才能真的讓開發提升效率。</p><p>&nbsp;</p><span id="OSC_h1_2"></span><h1>02 <strong>DBA</strong><strong> 的可替代性有多強？</strong></h1><p><strong>反方：薛曉剛 speaking ——</strong></p><p>説到 DBA 的可替代性，我覺得在國內是很難被替代的，因為這個職位比較關鍵。像我在公司屬於重點對象，因為我掌握着所有數據庫的用户密碼。有一次我接觸支付行業，人行的老師來檢查我們牌照的時候説，有些開發你外包就外包了，甚至網絡外包就外包了，但你的數據庫不能外包，你必須放在自己手裏，這是人行的監管要求。</p><p>&nbsp;</p><p><strong>正方：李令輝 speaking ——</strong></p><p>我和各位背景不一樣，我來講一下從研發的角度看 DBA。</p><p>首先，我們在互聯網公司的時候不太可能會讓 DBA 去準備業務架構，因為業務是由產品經理根據業務需求定的，別説 DBA 了，研發都沒有資格去評價這個業務需求提得合不合理，沒有需求是不合理的。DBA 也沒這個權限。畢竟，技術是服務於業務的，而不是業務來適配技術。技術如果做不到，最簡單的辦法就是換一批人，讓能做到的人去做。</p><p>其次，薛老師剛才講的這一點，有點偷換概念，那不叫「DBA 不可替代」，那是您二位不可替代。您二位水平已經不能叫簡單的 DBA 了，在這種情況下去佐證 DBA 的不可替代性不合適。就好像説一個司機掌握了我們全公司所有門的鑰匙，所以這個司機不可替代。可是，所有的司機都能掌握您的鑰匙嗎？不能。任何行業都能出狀元，但你這個狀元的發展，和行業的平均水平並不是直接有關的。您不可替代，不等於 DBA 不可替代。這兩件事情，不要混淆。</p><p>第三，您剛才説您有所有的密碼，這在我看來恰恰很危險，誰能保證您的人身沒有風險？誰能保證您的可用性足夠？誰能保證您的記憶力沒有問題？如果一個技術團隊的領導容忍這樣的事情普遍發生，那麼是他的不稱職。如果密碼一定要交給一個人的話，我寧願交給一個可靠的服務。這個服務出問題的概率，至少比人低多了。</p><p>我們公司以前的運維就是這樣，地位確實有，但我們希望他們不要一起吃飯，不要一起出行。雖然我們降低了風險，但是把這件事情強加於紀律去控制人，確實不對。實際上也是，我們怎麼知道他們業餘生活在不在一起玩，坐不坐一架飛機？根本不知道。所以，既然我們是做技術行業的，我們就應該通過技術來解決這個問題。</p><p>&nbsp;</p><p><strong>正方：馬工 speaking ——</strong></p><p>剛才反方説 DBA 的配置很簡單，不是什麼問題，我不這麼認為，我認為目前搭建的數據庫都有嚴重的缺陷。剛剛薛老師説掌握了所有數據庫的密碼，這恰好説明，你們的訪問控制是沒有做的。對企業來説，安全等級非常低，完全依靠於內網、依靠網絡工程師做的網絡隔離。</p><p>如果我用 telephone 在雲上做一個數據庫，我可以做到任何一個數據庫只被它需要訪問的那個 application 去訪問。舉個例子，如果是分區的話，北京的應用只能訪問北京數據庫的某一行，或某一個 table。這都不需要 DBA 來配置。</p><p>在這個項目裏，密碼在任何時候都不會以名為形式向任何人公佈。比如説我們用 telephone 生成一個密碼，然後馬上把這個密碼直接傳到雲上的 secret manager，應用需要密碼的時候，再用它的 IAM 訪問 secret manager 把密碼拿過來。全程密碼不會在任何一個顯示器裏面出現，沒有人能偷到；它也不落盤，只在內存裏使用；最後我會定期去更新。所以在這一點上，我覺得 DBA 做的數據庫還沒我一個開發用 telephone 做的密碼安全。</p><p>另外，有了雲數據庫後，已經不需要 DBA 來恢復數據庫狀態了，因為所有的數據庫默認開啓了異地備份，出問題直接把備份拿過來就行了。在這個意義上，我看到的不僅是初級 DBA 被淘汰，高級 DBA 的市場也越來越小。</p><p>最後是曉剛説的建模和數據質疑，但是抱歉，那不叫 DBA，人家有專門的崗位，叫 data engineer，數據工程師，跟 DBA 完全不一樣，發展路徑不一樣，來源背景也不一樣，這是我的觀點。</p><p>&nbsp;</p><p><strong>反方：李真旭 speaking ——</strong></p><p>但這個異地備份它不是實時的。萬一用户對數據要求很高，怎麼辦？</p><p>&nbsp;</p><p><strong>正方：馬工 speaking ——</strong></p><p>這個場景只有萬分之一，萬分之一的話不需要一個專門的 DBA，全中國可能只需要你一個人就可以了。這個崗位不足以成為一個專職崗位，不需要每個公司都配備，也不需要年輕人去學習去複製去成為你。</p><p>&nbsp;</p><p><strong>反方：薛曉剛 speaking ——</strong></p><p>但是目前來説，人行監管就是要求數據庫要在自己手裏。還有很多不能上雲的企業，你們也沒有考慮到。掌握密碼這個事，很多公司都會有一定的機制保障，今天薛曉剛走了，明天會來一個李曉剛。這個崗位不是因我而設的，它就在那，誰來坐都一樣。</p><p>李令輝老師説，技術是服務業務的，這我不贊成。技術是要指導業務的。我經歷過很多這種事，學員給我的東西，我問起，他就説業務就這麼要求的，就像李老師説的「業務就是這樣的」，但業務真的是這樣嗎？開發説，我不知道，反正業務是這麼説的。當你把業務拉過來，再一起問一下，業務就説：我沒要求，是你理解錯了，或者我這個需求也提錯了。你們怎麼看？這種現象，在我們日常工作中是非常普遍的。</p><p>&nbsp;</p><span id="OSC_h1_3"></span><h1>03 <strong>雲數據庫</strong><strong>也不是萬能的</strong></h1><p><strong>反方：薛曉剛 speaking ——</strong></p><p>我處理過幾個朋友的問題，他們是創業公司，用的都是阿里雲，跑得比別人快，但是都出現過宕機問題，比方説一週宕機一次，嚴重影響業務開展。我去看了，基本上都是 SQL 問題，背後是數據庫和 SQL 的邏輯問題。阿里雲並不能幫他們解決什麼，我就告訴他們怎麼改，這兩家公司按照我的要求改了，業務再也沒宕機過。你看，雲並不能幫他們弄清楚業務的問題，改邏輯或者改 SQL ，甚至是改設計，這些都是做不了的。當然你可以説這屬於高級的 DBA，但是高級的 DBA 也是從初級走過來的。</p><p>&nbsp;</p><p><strong>反方：李真旭 speaking ——</strong></p><p>第一，我認同薛老師的觀點，如果沒有 DBA 這個崗位的話，可能會導致應用和運維脱節。因為開發人員可能並不能很好地使用數據庫，並不是説把數據庫換成 RDS 之後，開發就能夠把 RDS 用好，這個是不一定的。</p><p>第二是關於數據的隱私問題，特別是去年，很多大廠出了事故，鬧得很大，我就不展開了。</p><p>第三，這兩年經濟下行，我覺得大家可能會更關注成本。比如説，阿里雲，我發現它居然也支持 Oracle 在上面跑，RDS for Oracle，假設我要買一個企業級的數據庫，比如説 64 核，成本大概是一年 42000 多美金，其實並不便宜。國內的話，一年算下來，大概也要 70 多萬，夠我買高配的物理機了。</p><p>所以綜合下來看的話，RDS 優勢也並不大。</p><p>&nbsp;</p><p><strong>正方：馬工 speaking ——</strong></p><p>針對薛老師説的「阿里雲不幫用户解決性能問題」這一點，我認為可以用機器學習來解決。這裏有一個例子，Amazon for RDS，它把常見的一些數據庫問題給喂進去，雲上也會有 performance insights，大多數的常見問題都不難，你看了就能定位出問題在哪。如果你會用的話，你需要專家的概率其實是非常低的。當然，我不能保證説這兩個工具加起來之後，你就不需要薛老師這種專家了，但是需求量不大，可能全中國有三五個薛老師就夠了。所以還是那個問題，三五個薛老師不構成 DBA 這個崗位，不構成一個行業。</p><p>&nbsp;</p><p><strong>反方：薛曉剛 speaking ——</strong></p><p>馬老師説到的工具我們也有，大部分工具也是自動化的，但是單純指望工具太理想化了。很多人是「我知道有問題，但我不知道怎麼改，你得手把手教我」，我每次告訴他問題在哪給出建議還是不會改，我要寫個 demo 給他看，告訴他怎麼樣改，告訴他你要是實在不會寫，我用 java 給你寫一段，你照着抄......要這樣才行。在我國大部分情況下，你告訴他這個有問題，但不告訴解決方案，他根本不知道怎麼改。</p><p>&nbsp;</p><p><strong>正方：李令輝 speaking ——</strong></p><p>咱們從技術角度來看這個問題，你説 RDS 好不好？我覺得 RDS 確實不好。打一個現實中的比喻，就像現在大家都用電車了，RDS 它就強行在自己油車的油箱邊上加了個電機，所以 RDS 才會顯得這麼彆扭。</p><p>RDS，它是一個半成品，它是互聯網公司用單機時代的軟件去解決雲時代問題的一個嘗試。這個嘗試解決了互聯網公司當時的問題，你説這些互聯網公司自己有沒有 DBA？肯定有，我就在這個 DBA 團隊。每個互聯網公司包括 AWS、Google，他們都有 DBA。所以 DBA 他們是需要的，只不過沒有那麼多，可能幾十人就不錯了。</p><p>但是，這是未來嗎？我認為不是，純電車是未來。我小時候去我爸單位，他們有那個手動機牀，有些老工人非常的專業，能做出很漂亮的東西，但是現在你看，製造業都已經是數控機牀了。只要你把時間給夠，該發生的事情一定會發生。</p><p>在我看來，雲數據庫應該是和現在的 RDS 完全不同的，不應該利用 RDS 以前單機數據庫利用網絡來做網絡備份這種方式來做數據冗餘，來做高可用，來做什麼 IP 切換這種很 low 的辦法。雲數據庫現在的底座就是整個雲，在一個對象存儲上面有一些算力，這些算力使用臨時存儲，這就是為什麼在雲上自建數據庫並不好用的原因，因為 EBS 很貴，單機存儲它又不可靠，它天生不是為了 durability 設計的，也不是為了性能和 latency。</p><p>在雲時代，一個雲數據庫，可以在一個共享的對象存儲下。這個對象存儲和傳統的單機存儲最大的不同是它可以隨意擴展它的存儲量。也就是説，你在傳統的機器上一個進程高性能地訪問這個磁盤，別的進程就沒有 IO 能力了。可是在現代的雲上面，對象存儲不是這樣，它是可以動態擴容的。當我有十台虛擬機去訪問的時候，各自的帶寬是獨立的。雲可以在很短的時間內把流量擴過去，存儲量橫向擴展。這就帶來了在傳統的單機上絕不可能有的一種體驗。以前，我們要擔心的是螺絲殼裏做道場，怎麼有效地利用資源，有效地節省 IO，但現在都不存在這些問題。所以我們要做的是什麼？我們要在一個新的基礎建設上，做一個新的適配的軟件，軟件永遠是在硬件的基礎上服務業務。</p><p>&nbsp;</p><span id="OSC_h1_4"></span><h1>04 <strong>普通 </strong><strong>DBA</strong><strong> 該怎樣應對 </strong><strong>RDS</strong><strong> 的挑戰？</strong></h1><p><strong>反方：李真旭 speaking ——</strong></p><p>短期來看，從國內來講，機會還是很多的。現在大批的關係數據庫廠商，在未來三到五年會迎來一個考察的過程，這個時候我覺得對 DBA 來講，是個轉型升級的好機會。現在很多客户用的數據庫，還在做 Oracle 或 MySQL 兼容，如果你對這個比較瞭解，去做另外一款數據庫也是有優勢的。</p><p>至於説未來的職業發展，從長遠來看，DBA 的需求量是會越來越少的，但是不代表這個行業它會消失。初級的 DBA 可能會被軟件自動化取代，我們需要做的是更深入，對數據庫至少要比開發人員理解得更深入。</p><p>&nbsp;</p><p><strong>反方：薛曉剛 speaking ——</strong></p><p>那些非核心競爭力的基礎運作，由自動化工具代勞之後，我們這些從業者能從戰術層面走到戰略層面，我去管開發，我去管業務，就是技術指導業務嘛。只要有數據庫，都會有 DBA，如果哪天真的出現了，不要數據庫了，那我們可能去幹些別的。現在沒有云的，還是按沒有云的做法；如果有云，那就可以借雲數據庫從幕後走向台前。</p><p>&nbsp;</p><p><strong>正方：馬工 speaking ——</strong></p><p>如果你是個從業者，那你要好好考慮，作為一個職業生涯目標，你要想象它的長期可能性。長期來看，客户是不是會歸攏到某幾個大型的數據庫，會不會大量的使用？如果是這個趨勢的話，那 DBA 的崗位需求是會越來越少的。我的建議是，不要把自己固定為一個 DBA，你就是個工程師，只不過以前有點偏好於數據庫或者數據建模。你只要把自己當成工程師，所有的工具都只是你工程師工具箱裏面的一個，你今天選了個 Oracle DB，明天選個 type-script 都是 ok 的。雲也只是一個工具，不是你的敵人，可以拿過來用。最後，作為一個工程師，你一定要對團隊有價值。</p><hr><p>大家對此怎麼看呢？快留言説説你的經驗吧~</p><p>直播回放如下，錯過的趕緊掃碼看看回放↓↓↓</p><p style="text-align:center"><img height="259" src="https://oscimg.oschina.net/oscnet/up-66bae1f03def00f872b52f85338f621bf80.png" width="264" referrerpolicy="no-referrer"></p></div>
                                    ]]>
            </description>
            <pubDate>Mon, 05 Feb 2024 01:46:02 GMT</pubDate>
            <guid isPermaLink="false">https://my.oschina.net/u/6852546/blog/11029432</guid>
            <link>https://my.oschina.net/u/6852546/blog/11029432</link>
            <author>
                <![CDATA[原創]]>
            </author>
        </item>
        <item>
            <title>
                <![CDATA[聯想 2024 年將發佈全新 AI OS 操作系統]]>
            </title>
            <description>
                <![CDATA[<div class="content"><p>聯想集團宣佈將在 2024 年發佈全新的 AIOS 操作系統，該集團已經將 AI PC 以及個人 Agent 作為 2024 年業務推進重點。</p><p><img alt="" height="76" src="https://oscimg.oschina.net/oscnet/up-cd7a03471eb847bb2b1d418dd6f44e81d6c.png" width="380" referrerpolicy="no-referrer"></p><p>新的 AIOS 操作系統將內嵌個人 Agent、個人大模型、本地知識庫、應用接口，形成下一代 AI OS，個人 Agent 將穿梭於多種 AI 終端，使其融為一體，帶來更加智能、更加主動的 AI 服務。</p><p>在此戰略下，新的一年，聯想將發佈全新的 AI OS 操作系統，推出個人 Agent 以及更多集成個人大模型的 AI PC 產品，並持續推動 AI PC 生態建設助推 AI PC 進入新的發展階段。</p></div>
                                    ]]>
            </description>
            <pubDate>Sun, 04 Feb 2024 07:57:00 GMT</pubDate>
            <guid isPermaLink="false">https://www.oschina.net/news/277716</guid>
            <link>https://www.oschina.net/news/277716</link>
            <author>
                <![CDATA[來源: 投稿]]>
            </author>
        </item>
        <item>
            <title>
                <![CDATA[Redox OS 計劃移植更多 Linux 軟件]]>
            </title>
            <description>
                <![CDATA[<div class="content"><p><span style="color:#000000">基於 Rust 的 Redox OS 項目發佈了一篇最新的工作進展<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fwww.redox-os.org%2Fnews%2Fthis-month-240131%2F" target="_blank">博文</a>，概述了最近取得的一些成就以及對今年計劃的展望。</span></p><blockquote><p><span style="color:#000000">Redox 是一個用編程語言 Rust 編寫的類似 Unix 的微內核操作系統，它的重點是安全、穩定和性能。Redox 的靈感來自先前的內核和操作系統，如 SeL4、MINIX、Plan 9 和 BSD。它與 GNU 和 BSD 類似，但用一種內存安全的語言編寫，是在 MIT 許可下發布的開源軟件。</span></p></blockquote><p><span style="color:#000000">項目團隊對 logo 進行了改進，計劃在未來幾周內進行網站更新以使用新 logo。此外，Redox OS 傳統上依賴 URI/URL 格式來訪問資源，但為了方便將 Linux 軟件移植到 Redox 的工作，他們已經將資源路徑格式更改為與 Linux 兼容的 /scheme/scheme_name/path/to/resource。新的基於文件的路徑格式已開始用於內核和 relibc 實現，並能在不同格式之間進行透明轉換。</span></p><p><span style="color:#000000"><img alt="" height="302" src="https://oscimg.oschina.net/oscnet/up-637f014171fa77dbf69a32fe9982c100c43.png" width="500" referrerpolicy="no-referrer"></span></p><p><span style="color:#000000">針對 Linux 軟件的移植工作也越來越多，目前像 Nano 和 Helix 這樣的編輯器已經可以在 Redox OS 上運行。其他一些可在 Redox 上運行的一些程序包括：</span></p><ul><li><span style="color:#000000">極簡主義編輯器 kibi。</span></li><li><span style="color:#000000">TUI 幻燈片應用程序 Presenterm。</span></li><li><span style="color:#000000">國際象棋遊戲 chess-tui。</span></li><li><span style="color:#000000">十六進制文件查看器 hexyl，等等。</span></li></ul><p><span style="color:#000000">System76 的 COSMIC Desktop 也在向 Redox OS 移植。目前，其 Orbital Windowing System 上已經可以運行 cosmic-edit 和 cosmic-files。</span></p><p><span style="color:#000000"><img alt="" height="302" src="https://oscimg.oschina.net/oscnet/up-49bf18cec71ed5ef9cb09a88117a804c6ae.png" width="500" referrerpolicy="no-referrer"></span></p><p><img alt="" height="302" src="https://oscimg.oschina.net/oscnet/up-5900ff5266775f13644e78edb4ab7995826.png" width="500" referrerpolicy="no-referrer"></p><p><span style="color:#000000">其他的一些進展還包括：</span></p><ul><li><span style="color:#000000">Redox 現在可在 Raspberry Pi 3 Model B+ 上運行。構建系統也進行了改進，以便可以處理多個 RP 型號，每個型號都有自己的硬件配置。</span></li><li><span style="color:#000000">內核和驅動程序改進：主要包括 PCI 驅動程序的重新設計、內核中的一些修復和清理，以及構建系統的改進。</span></li><li><span style="color:#000000">Relibc：包括將 malloc 代碼升級為 dlmalloc-rs 移植版本；之前的 malloc 代碼是用 C 編寫的，現在已經完全刪除。還計劃努力實現 libm 和 libcrypt 的 Rust 實現，並實現了幾個新的 libc 函數，包括一些寬字符串函數和一些偽終端處理函數。</span></li><li><span style="color:#000000">等等......</span></li></ul><p><span style="color:#000000">展望未來，Redox 將致力於其 Web 服務器用例、支持 USB/HID、性能分析和改進、更多更好的自動測試、更多地移植 Linux 應用程序以及開發 relibc 和內核兼容功能。</span></p><p><span style="color:#000000">更多詳情可<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fwww.redox-os.org%2Fnews%2Fthis-month-240131%2F" target="_blank">查看官方博客</a>。</span></p></div>
                                    ]]>
            </description>
            <pubDate>Sun, 04 Feb 2024 06:46:00 GMT</pubDate>
            <guid isPermaLink="false">https://www.oschina.net/news/277701/redox-os-240131</guid>
            <link>https://www.oschina.net/news/277701/redox-os-240131</link>
            <author>
                <![CDATA[來源: OSCHINA]]>
            </author>
        </item>
        <item>
            <title>
                <![CDATA[完蛋！我把 AI 喂吐了！]]>
            </title>
            <description>
                <![CDATA[<div class="content"><p><strong>當我們用 RAG 構建一個知識庫問答應用的時候，總是希望知識庫裏面灌的數據越多，問答的效果越好，事實真是如此嗎？這篇文章給大家答案。</strong></p><p><img alt="" src="https://oscimg.oschina.net/oscnet/up-dfdd57c27b133d44a1db4b25502172f74c3.png" referrerpolicy="no-referrer"></p><p><strong>引言</strong><br> 在人工智能問答系統的發展中，RAG（Retrieval-Augmented Generation）技術以其獨特的檢索增強生成方式，為減少大模型幻覺開闢了新的天地。然而，在實際落地過程中有一個很大的疑問：RAG 系統，數據越多效果越好嗎？本文將深入分析數據量如何影響 RAG 系統的問答效果，並討論如何優化這一系統以適應不斷增長的海量數據。</p><p><strong>什麼是 RAG？</strong><br> 大型語言模型（LLMs）已經展現出了強大的能力，但在實際應用中仍面臨很多挑戰，如模型幻覺、知識更新緩慢以及答案缺乏可信度等。LLM 雖然是在非常龐大的數據集上訓練的，但並不是在您的數據上訓練的。檢索增強生成（RAG）通過將您的數據鏈接到 LLMs 來解決這個問題。</p><p>RAG 是一種將知識檢索與生成模型相結合的技術，可以提高問答系統的準確性和相關性。它通過從外部知識源中動態檢索信息，並將檢索到的數據作為參考來組織答案，從而能有效緩解 LLM 中存在的幻覺問題。</p><p><img alt="" src="https://oscimg.oschina.net/oscnet/up-21528f3b3673b9c485e34ff04483f4fa81d.png" referrerpolicy="no-referrer"></p><p style="text-align:center">RAG 系統</p><p>RAG 的工作流程主要包含三個模塊：</p><ul><li><strong>索引（indexing）</strong>：文本索引的構建包括以下步驟：文檔解析、文本分塊、Embedding 向量化和創建索引。先將不同格式的原始文件解析轉換為純文本，再把文本切分成較小的文本塊。通過 Embedding 為每一個文本塊生成一個向量表示，用於計算文本向量和問題向量之間的相似度。創建索引將原始文本塊和 Embedding 向量以鍵值對的形式存儲，以便將來進行快速和頻繁的搜索。</li><li><strong>檢索（Retrieval）</strong>：使用 Embedding 模型將用户輸入問題轉換為向量，計算問題的 Embedding 向量和語料庫中文本塊 Embedding 向量之間的相似度，選擇相似度最高的前 K 個文檔塊作為當前問題的增強上下文信息。</li><li><strong>生成（Generation）</strong>：將檢索得到的前 K 個文本塊和用户問題一起送進大模型，讓大模型基於給定的文本塊來回答用户的問題。</li></ul><p>有關 RAG 更全面的信息請參閲綜述論文：<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Farxiv.org%2Fpdf%2F2312.10997.pdf" target="_blank">Retrieval-Augmented Generation for Large Language Models: A Survey</a>，不想閲讀原始英文論文？<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fread.youdao.com%2F%23%2Fhome" target="_blank">使用「有道速讀」快速瞭解什麼是 RAG？</a></p><p><strong>RAG 系統：數據越多，效果越好嗎？</strong><br> 從宏觀層面來看，RAG 包含兩個核心的要素：數據和系統。RAG 的應用場景非常多，包括文檔助手，智能客服機器人，領域/行業知識庫問答等。不同的應用場景優化的側重點可能有所差異。</p><p>對於文檔助手這類應用來説，數據是已知的，我就上傳幾篇文檔，就針對這些文檔來問問題。我們幾乎不用關注數據側的事情，把精力放在優化系統就可以了。</p><p>而對於領域/行業知識庫問答來説，需要從數據側和系統側同時優化。因為如果用户問題回答不上來，有可能是沒相關數據，也有可能是有數據但 RAG 系統沒找到。</p><p>數據側的優化很「簡單」，就是儘可能多的收集領域內相關的數據，通通灌進知識庫裏面。但是， <strong>請先彆着急！</strong>在開始組織人力收集整理數據之前，我們首先得弄清楚一件事情：RAG 系統，數據越多，效果越好嗎？</p><p><strong>如果</strong>答案是肯定的，意味着：</p><ol><li><strong>海量數據放心灌，</strong>我可以一批一批地往知識庫中加數據，不用擔心數據量太大相互幹擾導致效果不佳。</li><li><strong>快速迭代快速優化，</strong>對於上線之後的 badcase，業務側可以直接通過加相應數據來快速迭代優化。</li><li><strong>降低數據成本</strong>，收集和整理的成本，不用費勁心思去做數據去重和髒數據的處理。</li><li><strong>增加系統的穩定性，</strong>如果我加的數據不相關，問答的效果不一定會變好，但是起碼能保證以前的效果不會變差。</li></ol><p>反之，那工作量可就大了😭</p><p><strong>實驗：數據量對於問答效果的影響</strong><br> 以教育領域的知識庫問答為例，我們基於 RAG 做了一個升學百科問答的應用，專門解答用户關於高考升學規劃和志願填報政策相關的問題。</p><p><img alt="" src="https://oscimg.oschina.net/oscnet/up-3443e76cdb8062538f4fb914470c9aa7298.png" referrerpolicy="no-referrer"></p><p style="text-align:center">升學百科問答</p><p>升學百科問答不是給定數據，給定問題，然後只需要去優化算法或者系統的 Benchmark 任務。它的問題是開放的，數據也是開放的（你可以收集到儘可能多的相關數據來提升問答的效果）。所以優化的變量就多了一個：系統是一部分，數據也是一部分。問答效果的好壞不光取決於好的 RAG 系統，還取決於你的數據量夠不夠，覆蓋的知識全不全？如何優化 RAG 能讓它完全發揮出海量數據的價值是我們研究的重點。</p><p>關於數據量對 RAG 問答質量的影響，我們在升學百科問答項目中做了比較詳細的研究。實驗設置如下：</p><ul><li><strong>用户問題</strong>：收集了 176 個升學百科相關的問題，包括升學路徑、志願填報、選科等相關政策諮詢問題。</li><li><strong>RAG 系統：</strong>一個經典的 RAG 系統，包括文本解析切片，embedding 向量化建庫，檢索相關片段，語言模型總結問答等模塊。</li><li><strong>領域數據：</strong>我們收集了海量升學規劃相關的資料來驗證數據的問題，包括教育領域的互聯網數據，書本資料，FAQ 問答對等。</li></ul><p><img alt="" src="https://oscimg.oschina.net/oscnet/up-519bd951fc8e8da2b60ca1c99438053376c.png" referrerpolicy="no-referrer"></p><p style="text-align:center">RAG 在升學百科問答中的實踐</p><p><strong>結果：檢索退化問題</strong><br> 我們分批往 RAG 知識庫中灌入數據，每加一批數據都做一次評測，觀察隨着數據量變大，問答效果的變化情況：</p><ul><li><strong>baseline：</strong>第一批數據加入後問答正確率有 42.6%，此時有一些問題沒回答上來是因為確實缺少相關資料。我們繼續加數據…</li><li><strong>迎來上漲：</strong>第二批加了更多數據，覆蓋知識範圍更廣。準確率提升到了 60.2%，提升非常明顯，看來加數據確實還是挺有用的。</li><li><strong>壞消息：</strong>當加入第三批數據的時候，我們最擔心的事情還是發生了。正確率急劇下降，跌了將近 8 個百分點。</li></ul><p><img alt="" src="https://oscimg.oschina.net/oscnet/up-9b4ab65b8b57cc9614dab72bf9b3b044189.png" referrerpolicy="no-referrer"></p><p>到這裏，我們的問題有了答案，<strong>不是所的 RAG 系統都能保證：數據越多，效果越好。</strong>海量數據有可能會把 AI 喂吐，隨着數據的增多，數據之間可能會有相互幹擾，導致檢索退化的問題，影響問答的質量。</p><p><strong>具體問題具體分析</strong><br> 先抓一個典型看看，<u>大連醫科大學怎麼樣？</u>這個問題在 v2 版本（加入第三批數據前）是能回答對的，v3 版本（加入第三批數據後）回答錯了。看了一下送到 LLM 的文本片段，居然全部都是<u>大連理工大學</u>相關的信息。</p><p><img alt="" src="https://oscimg.oschina.net/oscnet/up-ec645d0fe9a4be46b204e35260b319c96bc.png" referrerpolicy="no-referrer"></p><p style="text-align:center">問題分析：大連醫科大學的問答結果</p><p>主要原因是第三批加入的某些文檔中恰好有<u>大連理工大學 xxx 怎麼樣</u>？的句子，和 query<u>大連醫科大學怎麼樣？</u>表面上看起來確實非常像，Embedding 給它打了比較高的分。</p><p>而類似大連醫科大學師資介紹這樣的片段相關性就稍微低了些。而 LLM 輸入 token 有限制，前面兩個最相關但是實際並不能回答 query 問題的片段就已經佔滿了 token 的窗口，只能把他倆送進 LLM 裏。結果可想而知，啥都不知道。</p><p><img alt="" src="https://oscimg.oschina.net/oscnet/up-ba46a78fcfeaa165d79b3d32ebff25651fa.png" referrerpolicy="no-referrer"></p><p style="text-align:center">RAG 中的檢索退化問題</p><p><strong>語義檢索：相似≠相關</strong><br> 文本片段與 query 的相似性和文本片段是否包含 query 的答案（相關性）是兩回事。RAG 中一個非常重要的矛盾點在於檢索召回的片段比較多，但是 LLM 輸入 token 是有限制，所以必須把能回答 query 問題的片段（和問題最相關）給 LLM。</p><p><strong>Embedding（Bi-Encoder）</strong><br> Embedding 也可以給出一個得分，但是這個得分描述的更多的是相似性。Embedding 本質上是一個雙編碼器，兩個文本在模型內部沒有任何信息交互。只在最後計算兩個向量的餘弦相似度時才進行唯一一次交互。所以 Embedding 檢索只能把最相似的文本片段給你，沒有能力來判斷候選文本和 query 之間的相關性。但是相似又不等於相關。</p><p>如下圖所示，從某種程度上，Embedding 其實就是在算兩個文本塊中相似字符的個數佔比，它分不清 query 中的重點是大連醫科大學，在它看來每個字符的重要性都是一樣的。感興趣的話可以計算一下下圖中紅字部分的佔比，和最後餘弦相似度的得分基本是吻合的。</p><p><img alt="" src="https://oscimg.oschina.net/oscnet/up-e8edc0b11333a604827f66087e138276730.png" referrerpolicy="no-referrer"></p><p style="text-align:center">Embedding 原理</p><p><strong>Rerank（Cross-Encoder）</strong><br> Rerank 本質是一個 Cross-Encoder 的模型。Cross-Encoder 能讓兩個文本片段一開始就在 BERT 模型各層中通過 self-attention 進行交互。它能夠用 self-attention 判斷出來這個 query 中的重點在於<u>大連醫科大學</u>，而不是<u>怎麼樣？</u>。所以，如下圖所示，<u>大連醫科大學怎麼樣？</u>這個 query 和<u>大連醫科大學創建於 1947 年…</u>更相關。</p><p><img alt="" src="https://oscimg.oschina.net/oscnet/up-8d4d65f826a971d22b34c414fb70162d841.png" referrerpolicy="no-referrer"></p><p style="text-align:center">Rerank 原理</p><p><strong>Cross-Encoder 這麼好，為什麼不直接用？</strong><br> 因為速度慢。這裏説的速度慢不是 cross-encoder 的模型比 bi-encoder 的模型速度慢。關鍵在於 bi-encoder 可以離線計算海量文本塊的向量化表示，把他們暫存在向量數據庫中，在問答檢索的時候只需要計算一個 query 的向量化表示就可以了。拿着 query 的向量表示去庫裏找最相似的文本即可。</p><p>但是 cross-encoder 需要實時計算兩個文本塊的相關度，如果候選文本有幾萬條，每一條都需要和 query 一起送進 BERT 模型中算一遍，需要實時算幾萬次。這個成本是非常巨大的。</p><p>所以，我們可以把檢索過程分為兩個階段：召回（粗排）和重排。</p><ul><li>第一個階段的目標是儘可能多的召回相似的文本片段，這個階段的文本得分排序不是特別靠譜，所以候選的 topK 可以設置大一些，比如 topK=100；</li><li>第二個階段的目標是對 100 個粗排的候選文本片段進行重新排序，用 cross-encoder 計算 100 個候選文本和 query 的相關度得分；</li></ul><p>兩階段檢索結合可以兼顧效果和效率。</p><p><strong>兩階段檢索在 RAG 中的實驗</strong><br> 我們對上面升學百科中的文本片段用 Rerank 模型再做一次排序，重排序後的結果如下圖所示，左右可以對照着看，左邊是 Rerank 之前的文本片段，右邊是 Rerank 重排之後的文本片段。可以明顯看到右邊文本片段的得分和排序更加合理，和人的感受基本上是一致的。重排序之後送進 LLM 窗口內的文本和 query 是最相關的，語言模型也能輕鬆根據相關信息回答出問題，再也不會説不知道了。</p><p><img alt="" src="https://oscimg.oschina.net/oscnet/up-4797d54a8067ea396396171be813ce22a06.png" referrerpolicy="no-referrer"></p><p style="text-align:center">兩階段檢索在 RAG 中的實驗</p><p><strong>QAnything：兩階段檢索問答框架</strong><br><strong>QAnything</strong> (<strong>Q</strong>uestion and <strong>A</strong>nswer based on <strong>Anything</strong>) 是致力於支持任意格式文件或數據庫的本地知識庫問答系統。基於有道自研兩階段檢索框架，能夠做到數據越多，問答效果越好！</p><p>QAnything 具有以下特點：</p><ul><li><strong>數據安全放心用，</strong>完全離線使用；</li><li><strong>跨語種知識隨意問</strong>，中英文問答隨意切換，無所謂文件是什麼語種；</li><li><strong>海量數據放心灌，</strong>兩階段向量排序，解決了大規模數據檢索退化的問題，數據越多，效果越好；</li><li><strong>生產級系統直接裝，</strong>可直接部署企業級應用；</li><li><strong>一鍵安裝輕鬆用</strong>，無需繁瑣的配置，一鍵安裝部署，拿來就用；</li><li><strong>多知識庫隨時切，</strong>支持多個知識庫聯合問答。</li><li><strong>完全開源，完全免費！</strong></li></ul><p><img alt="" src="https://oscimg.oschina.net/oscnet/up-d7ab5597d8e97eed09547979ca0d93b826b.png" referrerpolicy="no-referrer"></p><p style="text-align:center">QAnything 系統架構</p><p>QAnything 使用的有道自研檢索組件<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fgithub.com%2Fnetease-youdao%2FBCEmbedding" target="_blank">BCEmbedding</a>有非常強悍的雙語和跨語種能力，能消除語義檢索裏面的中英語言之間的差異。其中包含的 embedding 和 rerank 模型均達到業界 SOTA，詳細評測指標請參考：<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fgithub.com%2Fnetease-youdao%2FBCEmbedding%2Fblob%2Fmaster%2FDocs%2FEvaluationSummary%2Fembedding_eval_summary.md" target="_blank">有道 BECEmbedding 模型和 Rerank 模型指標彙總</a>，如果需要單獨使用 embedding 和 rerank 組件，點擊下面的鏈接進行下載：</p><p><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fgithub.com%2Fnetease-youdao%2FBCEmbedding" target="_blank">https://github.com/netease-youdao/BCEmbedding</a></p><p><strong>最終結果</strong><br> 至此，我們可以在以上兩階段檢索的 QAnything 系統上重新跑前三批數據的實驗了。結果如下：</p><p><img alt="" src="https://oscimg.oschina.net/oscnet/up-1bb7b39cb3f131a6c5068dc62e72bdcbda2.png" referrerpolicy="no-referrer"></p><p>在數據不變的情況，兩階段檢索問答準確率從 52.8% 提升到 65.9%，這個結果再次證明瞭一階段檢索中存在數據互相干擾的情況。兩階段檢索可以最大化的挖掘出數據的潛力，我們繼續加數據，效果能夠穩定提升。</p><p><img alt="" src="https://oscimg.oschina.net/oscnet/up-d8915eb8807fbceefc14299a7b320e15ae8.png" referrerpolicy="no-referrer"></p><p style="text-align:center">QAnything 實現數據越多效果越好</p><p>QAnything 兩階段檢索最大的意義不是在某一個實驗上面提升了 10 個點。它最大的意義在於讓「數據越多，效果越好」變成了現實。這是在準備開始優化一個 RAG 系統之前要確保的第一件事情。</p><p><strong>QAnything 應用</strong><br> QAnything 和有道領世聯合推出<em><strong>「AI 升學規劃師」</strong></em>。基於 QAnything 強勁的檢索增強生成能力和有道領世多年深耕的海量升學數據資料，可以為每個學生和家長配備一名私人 AI 升學規劃師，提供更加全面、專業、及時的升學規劃服務。</p><p>基於<strong><em>「QAnything」</em></strong>，有道 AI 升學規劃師在升學百科問答中準確率達到 95%，可以解答用户關於高考政策、升學路徑、學習生活以及職業規劃等各種問題。並且隨着不斷地數據補充和更新，這個準確率會一直上漲。</p><div class="ckeditor-html5-video" style="text-align:center"><video autoplay="autoplay" controls="controls" poster="https://oscimg.oschina.net/oscnet/up-072ac9e407286e5b380d0c13eaa3c9454aa.png" src="https://www.bilibili.com/video/BV1MH4y1v7MQ/?vd_source=5b7cd5db06252fb1e0b555e9b076ec34">
   &nbsp; 
 </video></div><p style="text-align:center">有道領世 AI 規劃師（Powered by QAnything）</p><p style="text-align:center">如果視頻無法播放可點擊視頻原始鏈接播放：B 站播放鏈接，可<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV1MH4y1v7MQ%2F%3Fvd_source%3D5b7cd5db06252fb1e0b555e9b076ec34" target="_blank">點擊此處播放</a>。</p><p><strong>展望</strong><br> 兩階段檢索是一個大的框架，給 RAG 提供了一個好的基礎。未來可以在兩階段的基礎上做更多細緻的優化。這裏有一些想法，貼出來和大家一起探討：</p><ul><li><strong>切片策略：</strong>切片策略對檢索召回的影響非常大，目前主流的切片策略還比較機械，經常造成一些信息的損失，未來可能會出現更加智能的切片方式。</li><li><strong>多路召回：</strong>可以在 embedding 檢索的基礎上增加 BM25 檢索，或者通過 LLM 改寫 query 的方式生成多個檢索 query 增加召回率。</li><li><strong>意圖分類：</strong>不同的問題走不同的知識庫，或者用不同的處理邏輯。</li><li><strong>Agent：</strong>基於文檔的問答能做的事情非常有限，Agent 和 RAG 結合起來可以做更多事情。</li></ul><p><strong>開源</strong><br> 自從_<strong>「QAnything」</strong>_項目開放源代碼以來，受到了開發社區的熱烈歡迎和廣泛認可。截至 2024 年 2 月 1 日，項目在 GitHub 上已經積累了 3600 多個星標，這反映出了其流行度和用户對其價值的高度評價。</p><p><img alt="" src="https://oscimg.oschina.net/oscnet/up-cf43409261471c344f4df393c2de66133fe.png" referrerpolicy="no-referrer"></p><p>歡迎點擊下面的鏈接下載試用：</p><p>QAnything github: <a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fgithub.com%2Fnetease-youdao%2FQAnything" target="_blank">https://github.com/netease-youdao/QAnything</a></p><p>QAnything gitee: <a href="https://gitee.com/netease-youdao/QAnything">https://gitee.com/netease-youdao/QAnything</a></p><p>歡迎大家在 GitHub 上為<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fgithub.com%2Fnetease-youdao%2FQAnything" target="_blank">「QAnything」</a>加星助力，方便收到新版本更新的通知！</p><p><img alt="" src="https://oscimg.oschina.net/oscnet/up-bd913c4ea881c00bf7ac16c9184ac1c5d65.gif" referrerpolicy="no-referrer"></p><p><strong>參考信息</strong><br> QAnything: <a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fgithub.com%2Fnetease-youdao%2FQAnything" target="_blank">https://github.com/netease-youdao/QAnything</a></p><p>BCEmbedding: <a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fgithub.com%2Fnetease-youdao%2FBCEmbedding" target="_blank">https://github.com/netease-youdao/BCEmbedding</a></p><p>RAG Survery: <a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Farxiv.org%2Fpdf%2F2312.10997.pdf" target="_blank">Retrieval-Augmented Generation for Large Language Models: A Survey</a></p><p>LlamaIndex RAG: <a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdocs.llamaindex.ai%2Fen%2Fstable%2Fgetting_started%2Fconcepts.html%23retrieval-augmented-generation-rag" target="_blank">https://docs.llamaindex.ai/en/stable/getting_started/concepts.html#retrieval-augmented-generation-rag</a></p><p>Cross-encoder: <a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fwww.sbert.net%2Fexamples%2Fapplications%2Fcross-encoder%2FREADME.html" target="_blank">https://www.sbert.net/examples/applications/cross-encoder/README.html</a></p><p>Sentence-BERT: <a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Farxiv.org%2Fpdf%2F1908.10084.pdf" target="_blank">https://arxiv.org/pdf/1908.10084.pdf</a></p></div>
                                    ]]>
            </description>
            <pubDate>Sun, 04 Feb 2024 03:20:00 GMT</pubDate>
            <guid isPermaLink="false">https://my.oschina.net/youdaotech/blog/11015018</guid>
            <link>https://my.oschina.net/youdaotech/blog/11015018</link>
            <author>
                <![CDATA[原創]]>
            </author>
        </item>
        <item>
            <title>
                <![CDATA[Mixtral-8x7B Pytorch 實現]]>
            </title>
            <description>
                <![CDATA[<div class="content"><div class="rich_media_content js_underline_content
                       autoTypeSetting24psection
            " id="js_content"><span id="OSC_h1_1"></span><h1 data-tool="mdnice 編輯器" style="margin-top: 30px;margin-bottom: 15px;outline: 0px;font-weight: bold;font-size: 24px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;visibility: visible;" data-mpa-powered-by="yiban.io">0.前言</h1><section data-tool="mdnice 編輯器" data-website="https://www.mdnice.com" style="margin-bottom: 0px;padding-right: 10px;padding-left: 10px;outline: 0px;letter-spacing: 0px;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;line-height: 1.6;word-break: break-word;visibility: visible;"><p data-tool="mdnice 編輯器" style="padding-top: 8px;padding-bottom: 8px;outline: 0px;line-height: 26px;visibility: visible;">本文從代碼角度來談下&nbsp;<code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;visibility: visible;">Mixtral 8x7B</code>&nbsp;混合專家<code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;visibility: visible;">Pytorch</code>的實現</p></section><span id="OSC_h1_2"></span><h1 data-tool="mdnice 編輯器" style="margin-top: 30px;margin-bottom: 15px;outline: 0px;font-weight: bold;font-size: 24px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;visibility: visible;">1.論文概述</h1><figure data-tool="mdnice 編輯器" style="margin-top: 10px;margin-bottom: 10px;outline: 0px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;display: flex;flex-direction: column;justify-content: center;align-items: center;visibility: visible;"><img class="rich_pages wxw-img" data-imgfileid="100006729" data-ratio="0.47229551451187335" src="https://oscimg.oschina.net/oscnet/08de9207-ec2d-4fd6-8d38-f450e6e0396e.png" data-type="png" data-w="758" style="margin-right: auto;margin-left: auto;outline: 0px;display: block;visibility: visible !important;width: 656.979px !important;" referrerpolicy="no-referrer"></figure><p data-tool="mdnice 編輯器" style="margin-bottom: 0px;padding-top: 8px;padding-bottom: 8px;outline: 0px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;line-height: 26px;visibility: visible;"><code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;visibility: visible;">Mixtral-8x7B&nbsp;</code>引爆了<code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;visibility: visible;">MoE</code>的技術方向，更多針對<code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;visibility: visible;">MoE</code>優化的<code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;visibility: visible;">Trick</code>出現，迴歸模型本身來解析：</p><ol data-tool="mdnice 編輯器" class="list-paddingleft-1" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;outline: 0px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;visibility: visible;"><li style="outline: 0px;visibility: visible;"><section style="margin-top: 5px;margin-bottom: 5px;outline: 0px;line-height: 26px;color: rgb(1, 1, 1);visibility: visible;"><code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;visibility: visible;">Mixtral 8x7B</code>&nbsp;採用了 
    <code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;visibility: visible;">sMoE</code>模型結構，模型的細節如何？路由負載均衡如何計算？代碼如何實現？ 
   </section></li><li style="outline: 0px;visibility: visible;"><section style="margin-top: 5px;margin-bottom: 5px;outline: 0px;line-height: 26px;color: rgb(1, 1, 1);visibility: visible;"><code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;visibility: visible;">Mixtral 8x7B</code>&nbsp;的訓練流程和推理流程是怎麼樣的，如何提高訓練和推理效率？ 
   </section></li><li style="outline: 0px;visibility: visible;"><section style="margin-top: 5px;margin-bottom: 5px;outline: 0px;line-height: 26px;color: rgb(1, 1, 1);visibility: visible;"><code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;visibility: visible;">Mixtral 8x7B</code>&nbsp;的模型參數是如何計算的？ 
   </section></li><li style="outline: 0px;visibility: visible;"><section style="margin-top: 5px;margin-bottom: 5px;outline: 0px;line-height: 26px;color: rgb(1, 1, 1);visibility: visible;"><code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;visibility: visible;">Mixtral 8x7B</code>&nbsp;性能硬剛 
    <code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;visibility: visible;">LLaMA2-70B</code>和 
    <code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;visibility: visible;">GPT-3.5</code>， 性能一線水準，在 
    <code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;visibility: visible;">MBPP</code>代碼能力超越 
    <code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;visibility: visible;">3.5</code></section></li></ol><figure data-tool="mdnice 編輯器" style="margin-top: 10px;margin-bottom: 10px;outline: 0px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;display: flex;flex-direction: column;justify-content: center;align-items: center;visibility: visible;"><img class="rich_pages wxw-img" data-imgfileid="100006735" data-ratio="0.31203703703703706" src="https://oscimg.oschina.net/oscnet/570ae0a1-9cf9-4aec-abc1-eccfee1f7667.png" data-type="png" data-w="1080" style="margin-right: auto;margin-left: auto;outline: 0px;display: block;visibility: visible !important;width: 656.969px !important;" referrerpolicy="no-referrer"></figure><span id="OSC_h2_3"></span><h2 data-tool="mdnice 編輯器" style="margin-top: 30px;margin-bottom: 15px;outline: 0px;font-weight: bold;font-size: 22px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;">2. Mixtral 8x7B 模型架構和計算流程</h2><blockquote data-tool="mdnice 編輯器" style="margin-top: 20px;margin-bottom: 20px;padding: 10px 10px 10px 20px;outline: 0px;border-left-color: rgba(0, 0, 0, 0.4);color: rgb(106, 115, 125);font-size: 0.9em;letter-spacing: normal;text-align: left;text-wrap: wrap;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;border-top: none;border-right: none;border-bottom: none;overflow: auto;background: rgba(0, 0, 0, 0.05);"><p style="padding-top: 8px;padding-bottom: 8px;outline: 0px;font-size: 16px;color: black;line-height: 26px;">Mixtral is based on a&nbsp;<strong style="outline: 0px;">transformer architecture [31]</strong>&nbsp;and uses the same&nbsp;<strong style="outline: 0px;">modifications</strong>&nbsp;<strong style="outline: 0px;">as described in [18]</strong>, with the notable exceptions that Mixtral supports a fully dense context length of 32k tokens, and the&nbsp;<strong style="outline: 0px;">feed forward</strong>&nbsp;<strong style="outline: 0px;">blocks are replaced by Mixture-of-Expert layers</strong>&nbsp;(Section 2.1). The model architecture parameters are summarized in Table 1.</p></blockquote><ul data-tool="mdnice 編輯器" class="list-paddingleft-1" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;outline: 0px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;"><li style="outline: 0px;"><section style="margin-top: 5px;margin-bottom: 5px;outline: 0px;line-height: 26px;color: rgb(1, 1, 1);"><code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">base</code>的模型結構為 
    <code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">Transformers</code>的改版 
    <code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">Mistral-7B</code></section></li><li style="outline: 0px;"><section style="margin-top: 5px;margin-bottom: 5px;outline: 0px;line-height: 26px;color: rgb(1, 1, 1);"><code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">MoE</code>&nbsp;作用在 
    <code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">Feed Forward Blocks</code>上 
   </section></li></ul><figure data-tool="mdnice 編輯器" style="margin-top: 10px;margin-bottom: 10px;outline: 0px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img class="rich_pages wxw-img" data-imgfileid="100006730" data-ratio="0.46574074074074073" src="https://oscimg.oschina.net/oscnet/a4575f91-4dfa-4468-95a2-254e1ed3eadd.png" data-type="png" data-w="1080" style="margin-right: auto;margin-left: auto;outline: 0px;display: block;visibility: visible !important;width: 656.99px !important;" referrerpolicy="no-referrer"></figure><span id="OSC_h2_4"></span><h2 data-tool="mdnice 編輯器" style="margin-top: 30px;margin-bottom: 15px;outline: 0px;font-weight: bold;font-size: 22px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;">2.1 Mixtral 模型架構</h2><blockquote data-tool="mdnice 編輯器" style="margin-top: 20px;margin-bottom: 20px;padding: 10px 10px 10px 20px;outline: 0px;border-left-color: rgba(0, 0, 0, 0.4);color: rgb(106, 115, 125);font-size: 0.9em;letter-spacing: normal;text-align: left;text-wrap: wrap;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;border-top: none;border-right: none;border-bottom: none;overflow: auto;background: rgba(0, 0, 0, 0.05);"><p style="padding-top: 8px;padding-bottom: 8px;outline: 0px;font-size: 16px;color: black;line-height: 26px;">In a Transformer model, the MoE layer is applied independently per token and replaces the feed-forward (FFN) sub-block of the transformer block. For Mixtral we use the same SwiGLU architecture as the expert function Ei(x) and set K = 2. This means each token is routed to two SwiGLU sub-blocks with different sets of weights. Taking this all together, the output y for an input token x is computed as:</p></blockquote><section role="presentation" data-formula="y=\sum^{n-1}_{i=0}\text{Softmax}(\text{Top2}(x \cdot W_g))_i \cdot \text{SwiGLU}_i(x) 
" data-formula-type="block-equation" data-tool="mdnice 編輯器" style="margin-bottom: 0px;outline: 0px;letter-spacing: normal;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;text-align: center;overflow: auto;"><embed style="vertical-align: -2.819ex;width: 44.983ex;height: auto;max-width: 300% !important;" src="https://oscimg.oschina.net/oscnet/ce68f4d9-a02c-41e1-a90d-9789dedfa8e7.svg" data-type="svg+xml" data-imgfileid="100006734"></section><ul data-tool="mdnice 編輯器" class="list-paddingleft-1" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;outline: 0px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;"><li style="outline: 0px;"><section style="margin-top: 5px;margin-bottom: 5px;outline: 0px;line-height: 26px;color: rgb(1, 1, 1);">
     以 
    <code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">LLaMA2</code>或 
    <code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">Mistral-7B</code>來説其 
    <code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">MLP</code>都是 
    <code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">SwiGLU</code>形式 
   </section></li><li style="outline: 0px;"><section style="margin-top: 5px;margin-bottom: 5px;outline: 0px;line-height: 26px;color: rgb(1, 1, 1);">
     在 
    <code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">Mixtral-8x7B</code>中 
    <em style="outline: 0px;color: black;">每層</em>的 
    <code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">Decoder</code>層的 
    <code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">MLP</code>都以 
    <code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">sMoE</code>來替換掉 
   </section></li></ul><figure data-tool="mdnice 編輯器" style="margin-top: 10px;margin-bottom: 10px;outline: 0px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img class="rich_pages wxw-img" data-imgfileid="100006731" data-ratio="0.5712962962962963" src="https://oscimg.oschina.net/oscnet/81836df0-5cfd-463c-94c9-b71cbdff3faa.png" data-type="png" data-w="1080" style="margin-right: auto;margin-left: auto;outline: 0px;display: block;visibility: visible !important;width: 656.979px !important;" referrerpolicy="no-referrer"></figure><p data-tool="mdnice 編輯器" style="margin-bottom: 0px;padding-top: 8px;padding-bottom: 8px;outline: 0px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;line-height: 26px;">Transformers Mixtral-of-Expert</p><p data-tool="mdnice 編輯器" style="margin-bottom: 0px;padding-top: 8px;padding-bottom: 8px;outline: 0px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;line-height: 26px;">代碼實現:</p><p data-tool="mdnice 編輯器" style="margin-bottom: 0px;padding-top: 8px;padding-bottom: 8px;outline: 0px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;line-height: 26px;">在<code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">Huggingface</code>的<code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">Transformers</code>框架中,&nbsp;<code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">Mixtral</code>主要有兩部分組成</p><ul data-tool="mdnice 編輯器" class="list-paddingleft-1" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;outline: 0px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;"><li style="outline: 0px;"><section style="margin-top: 5px;margin-bottom: 5px;outline: 0px;line-height: 26px;color: rgb(1, 1, 1);"><code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">MixtralDecoderLayer</code></section></li><li style="outline: 0px;"><section style="margin-top: 5px;margin-bottom: 5px;outline: 0px;line-height: 26px;color: rgb(1, 1, 1);"><code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">MixtralSparseMoeBlock</code>：替換掉原有的 MLP 層 
   </section></li></ul><pre data-tool="mdnice 編輯器" style="margin-top: 10px;margin-bottom: 10px;outline: 0px;letter-spacing: normal;text-align: left;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="margin-bottom: -7px;outline: 0px;display: block;background: url(&quot;https://oscimg.oschina.net/oscnet/97137f2e-9f16-422b-aac0-3a34b7643e27.svg&quot;) 10px 10px / 40px no-repeat rgb(40, 44, 52);height: 30px;width: 657px;border-radius: 5px;"></span><code style="padding: 15px 16px 16px;outline: 0px;overflow-x: auto;color: rgb(171, 178, 191);display: -webkit-box;font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;font-size: 12px;background: rgb(40, 44, 52);border-radius: 5px;">MixtralForCausalLM(<br style="outline: 0px;">  (model): MixtralModel(<br style="outline: 0px;">    (embed_tokens): Embedding(<span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">32000</span>, <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">128</span>)<br style="outline: 0px;">    (layers): ModuleList(<br style="outline: 0px;">      (<span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">1</span>): MixtralDecoderLayer(<br style="outline: 0px;">        (self_attn): MixtralAttention(<br style="outline: 0px;">          (q_proj): Linear(in_features=<span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">128</span>, out_features=<span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">128</span>, bias=<span style="outline: 0px;color: rgb(86, 182, 194);line-height: 26px;">False</span>)<br style="outline: 0px;">          (k_proj): Linear(in_features=<span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">128</span>, out_features=<span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">128</span>, bias=<span style="outline: 0px;color: rgb(86, 182, 194);line-height: 26px;">False</span>)<br style="outline: 0px;">          (v_proj): Linear(in_features=<span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">128</span>, out_features=<span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">128</span>, bias=<span style="outline: 0px;color: rgb(86, 182, 194);line-height: 26px;">False</span>)<br style="outline: 0px;">          (o_proj): Linear(in_features=<span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">128</span>, out_features=<span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">128</span>, bias=<span style="outline: 0px;color: rgb(86, 182, 194);line-height: 26px;">False</span>)<br style="outline: 0px;">          (rotary_emb): MixtralRotaryEmbedding()<br style="outline: 0px;">        )<br style="outline: 0px;">        (block_sparse_moe): MixtralSparseMoeBlock(<br style="outline: 0px;">          (gate): Linear(in_features=<span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">128</span>, out_features=<span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">8</span>, bias=<span style="outline: 0px;color: rgb(86, 182, 194);line-height: 26px;">False</span>)<br style="outline: 0px;">          (experts): ModuleList(<br style="outline: 0px;">            (<span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">0</span><span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">-7</span>): <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">8</span> x MixtralBLockSparseTop2MLP(<br style="outline: 0px;">              (w1): Linear(in_features=<span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">128</span>, out_features=<span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">256</span>, bias=<span style="outline: 0px;color: rgb(86, 182, 194);line-height: 26px;">False</span>)<br style="outline: 0px;">              (w2): Linear(in_features=<span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">256</span>, out_features=<span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">128</span>, bias=<span style="outline: 0px;color: rgb(86, 182, 194);line-height: 26px;">False</span>)<br style="outline: 0px;">              (w3): Linear(in_features=<span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">128</span>, out_features=<span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">256</span>, bias=<span style="outline: 0px;color: rgb(86, 182, 194);line-height: 26px;">False</span>)<br style="outline: 0px;">              (act_fn): SiLU()<br style="outline: 0px;">            )<br style="outline: 0px;">          )<br style="outline: 0px;">        )<br style="outline: 0px;">        (input_layernorm): MixtralRMSNorm()<br style="outline: 0px;">        (post_attention_layernorm): MixtralRMSNorm()<br style="outline: 0px;">      )<br style="outline: 0px;">    )<br style="outline: 0px;">    (norm): MixtralRMSNorm()<br style="outline: 0px;">  )<br style="outline: 0px;"></code></pre><span id="OSC_h2_5"></span><h2 data-tool="mdnice 編輯器" style="margin-top: 30px;margin-bottom: 15px;outline: 0px;font-weight: bold;font-size: 22px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;">2.2 SMoE 層實現</h2><span id="OSC_h3_6"></span><h3 data-tool="mdnice 編輯器" style="margin-top: 30px;margin-bottom: 15px;outline: 0px;font-weight: bold;font-size: 20px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;">2.2.1 單個 Expert 實現</h3><section data-tool="mdnice 編輯器" data-website="https://www.mdnice.com" style="margin-bottom: 0px;padding-right: 10px;padding-left: 10px;outline: 0px;letter-spacing: 0px;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;line-height: 1.6;word-break: break-word;"><pre data-tool="mdnice 編輯器" style="margin-top: 10px;margin-bottom: 10px;outline: 0px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="margin-bottom: -7px;outline: 0px;display: block;background: url(&quot;https://oscimg.oschina.net/oscnet/97137f2e-9f16-422b-aac0-3a34b7643e27.svg&quot;) 10px 10px / 40px no-repeat rgb(40, 44, 52);height: 30px;width: 637px;border-radius: 5px;"></span><code style="padding: 15px 16px 16px;outline: 0px;overflow-x: auto;color: rgb(171, 178, 191);display: -webkit-box;font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;font-size: 12px;background: rgb(40, 44, 52);border-radius: 5px;"><span style="outline: 0px;color: rgb(198, 120, 221);line-height: 26px;">import</span> torch<br style="outline: 0px;"><span style="outline: 0px;color: rgb(198, 120, 221);line-height: 26px;">from</span> torch <span style="outline: 0px;color: rgb(198, 120, 221);line-height: 26px;">import</span> nn<br style="outline: 0px;"><span style="outline: 0px;color: rgb(198, 120, 221);line-height: 26px;">from</span> transformers <span style="outline: 0px;color: rgb(198, 120, 221);line-height: 26px;">import</span> MixtralConfig<br style="outline: 0px;"><br style="outline: 0px;"><span style="outline: 0px;line-height: 26px;"><span style="outline: 0px;color: rgb(198, 120, 221);line-height: 26px;">class</span><span style="outline: 0px;color: rgb(230, 192, 123);line-height: 26px;">MixtralBLockSparseTop2MLP</span><span style="outline: 0px;line-height: 26px;">(nn.Module)</span>:</span><br style="outline: 0px;"><span style="outline: 0px;line-height: 26px;"><span style="outline: 0px;color: rgb(198, 120, 221);line-height: 26px;">def</span><span style="outline: 0px;color: rgb(97, 174, 238);line-height: 26px;">__init__</span><span style="outline: 0px;line-height: 26px;">(self, config: MixtralConfig)</span>:</span><br style="outline: 0px;">        super().__init__()<br style="outline: 0px;">        self.ffn_dim = config.intermediate_size<br style="outline: 0px;">        self.hidden_dim = config.hidden_size<br style="outline: 0px;"><br style="outline: 0px;">        self.w1 = nn.Linear(self.hidden_dim, self.ffn_dim, bias=<span style="outline: 0px;color: rgb(86, 182, 194);line-height: 26px;">False</span>)<br style="outline: 0px;">        self.w2 = nn.Linear(self.ffn_dim, self.hidden_dim, bias=<span style="outline: 0px;color: rgb(86, 182, 194);line-height: 26px;">False</span>)<br style="outline: 0px;">        self.w3 = nn.Linear(self.hidden_dim, self.ffn_dim, bias=<span style="outline: 0px;color: rgb(86, 182, 194);line-height: 26px;">False</span>)<br style="outline: 0px;"><br style="outline: 0px;">        self.act_fn = nn.SiLU()<br style="outline: 0px;"><br style="outline: 0px;"><span style="outline: 0px;color: rgb(92, 99, 112);font-style: italic;line-height: 26px;"># Forward 是 SwiGLU</span><br style="outline: 0px;"><span style="outline: 0px;line-height: 26px;"><span style="outline: 0px;color: rgb(198, 120, 221);line-height: 26px;">def</span><span style="outline: 0px;color: rgb(97, 174, 238);line-height: 26px;">forward</span><span style="outline: 0px;line-height: 26px;">(self, hidden_states)</span>:</span><br style="outline: 0px;">        y = self.act_fn(self.w1(hidden_states)) * self.w3(hidden_states)<br style="outline: 0px;">        y = self.w2(y)<br style="outline: 0px;"><span style="outline: 0px;color: rgb(198, 120, 221);line-height: 26px;">return</span> y<br style="outline: 0px;"><br style="outline: 0px;">x = torch.randn(<span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">1</span>, <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">64</span>, <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">128</span>)<br style="outline: 0px;">expert = MixtralBLockSparseTop2MLP(config)<br style="outline: 0px;">print(<span style="outline: 0px;color: rgb(152, 195, 121);line-height: 26px;">'單個專家為原 LLaMA 的 MLP 層'</span>)<br style="outline: 0px;">print(expert)<br style="outline: 0px;">g = expert(x)<br style="outline: 0px;">print(<span style="outline: 0px;color: rgb(152, 195, 121);line-height: 26px;">'單個專家輸入:'</span>, x.shape)<br style="outline: 0px;">print(<span style="outline: 0px;color: rgb(152, 195, 121);line-height: 26px;">'單個專家輸出結果：'</span>, g.shape)</code></pre></section><p data-tool="mdnice 編輯器" style="margin-bottom: 0px;padding-top: 8px;padding-bottom: 8px;outline: 0px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;line-height: 26px;">結果</p><pre data-tool="mdnice 編輯器" style="margin-top: 10px;margin-bottom: 10px;outline: 0px;letter-spacing: normal;text-align: left;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="margin-bottom: -7px;outline: 0px;display: block;background: url(&quot;https://oscimg.oschina.net/oscnet/97137f2e-9f16-422b-aac0-3a34b7643e27.svg&quot;) 10px 10px / 40px no-repeat rgb(40, 44, 52);height: 30px;width: 657px;border-radius: 5px;"></span><code style="padding: 15px 16px 16px;outline: 0px;overflow-x: auto;color: rgb(171, 178, 191);display: -webkit-box;font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;font-size: 12px;background: rgb(40, 44, 52);border-radius: 5px;">單個專家為原 LLaMA 的 MLP 層<br style="outline: 0px;">MixtralBLockSparseTop2MLP(<br style="outline: 0px;">  (w1): Linear(in_features=128, out_features=256, bias=False)<br style="outline: 0px;">  (w2): Linear(in_features=256, out_features=128, bias=False)<br style="outline: 0px;">  (w3): Linear(in_features=128, out_features=256, bias=False)<br style="outline: 0px;">  (act_fn): SiLU()<br style="outline: 0px;">)<br style="outline: 0px;">單個專家輸入:<br style="outline: 0px;">torch.Size([1, 64, 128])<br style="outline: 0px;">單個專家輸出結果：<br style="outline: 0px;">torch.Size([1, 64, 128])<br style="outline: 0px;"></code></pre><span id="OSC_h3_7"></span><h3 data-tool="mdnice 編輯器" style="margin-top: 30px;margin-bottom: 15px;outline: 0px;font-weight: bold;font-size: 20px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;">2.2.2&nbsp;混合 Expert 實現</h3><pre data-tool="mdnice 編輯器" style="margin-top: 10px;margin-bottom: 10px;outline: 0px;letter-spacing: normal;text-align: left;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="margin-bottom: -7px;outline: 0px;display: block;background: url(&quot;https://oscimg.oschina.net/oscnet/97137f2e-9f16-422b-aac0-3a34b7643e27.svg&quot;) 10px 10px / 40px no-repeat rgb(40, 44, 52);height: 30px;width: 657px;border-radius: 5px;"></span><code style="padding: 15px 16px 16px;outline: 0px;overflow-x: auto;color: rgb(171, 178, 191);display: -webkit-box;font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;font-size: 12px;background: rgb(40, 44, 52);border-radius: 5px;"><span style="outline: 0px;line-height: 26px;"><span style="outline: 0px;color: rgb(198, 120, 221);line-height: 26px;">class</span><span style="outline: 0px;color: rgb(230, 192, 123);line-height: 26px;">MixtralSparseMoeBlock</span><span style="outline: 0px;line-height: 26px;">(nn.Module)</span>:</span><br style="outline: 0px;"><span style="outline: 0px;line-height: 26px;"><span style="outline: 0px;color: rgb(198, 120, 221);line-height: 26px;">def</span><span style="outline: 0px;color: rgb(97, 174, 238);line-height: 26px;">__init__</span><span style="outline: 0px;line-height: 26px;">(self, config)</span>:</span><br style="outline: 0px;">        super().__init__()<br style="outline: 0px;">        self.hidden_dim = config.hidden_size<br style="outline: 0px;">        self.ffn_dim = config.intermediate_size<br style="outline: 0px;">        self.num_experts = config.num_local_experts<br style="outline: 0px;">        self.top_k = config.num_experts_per_tok<br style="outline: 0px;"><br style="outline: 0px;"><span style="outline: 0px;color: rgb(92, 99, 112);font-style: italic;line-height: 26px;"># gating</span><br style="outline: 0px;">        self.gate = nn.Linear(self.hidden_dim, self.num_experts, bias=<span style="outline: 0px;color: rgb(86, 182, 194);line-height: 26px;">False</span>)<br style="outline: 0px;"><br style="outline: 0px;"><span style="outline: 0px;color: rgb(92, 99, 112);font-style: italic;line-height: 26px;"># 多個 SwiGLU MLP 層組成混合專家</span><br style="outline: 0px;">        self.experts = nn.ModuleList([MixtralBLockSparseTop2MLP(config) \<br style="outline: 0px;"><span style="outline: 0px;color: rgb(198, 120, 221);line-height: 26px;">for</span> _ <span style="outline: 0px;color: rgb(198, 120, 221);line-height: 26px;">in</span> range(self.num_experts)])<br style="outline: 0px;"><br style="outline: 0px;">x = torch.randn(<span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">1</span>, <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">64</span>, <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">128</span>)<br style="outline: 0px;">experts = MixtralSparseMoeBlock(config)<br style="outline: 0px;">print(<span style="outline: 0px;color: rgb(152, 195, 121);line-height: 26px;">'多個專家混合專家'</span>)<br style="outline: 0px;">print(experts)<br style="outline: 0px;"></code></pre><p data-tool="mdnice 編輯器" style="margin-bottom: 0px;padding-top: 8px;padding-bottom: 8px;outline: 0px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;line-height: 26px;">在以上我們實現了模型的關鍵結構， 但是這裏的<code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">sMoE</code>的<code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">Forward</code>並沒有實現</p><span id="OSC_h2_8"></span><h2 data-tool="mdnice 編輯器" style="margin-top: 30px;margin-bottom: 15px;outline: 0px;font-weight: bold;font-size: 22px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;">2.3 SMoE 計算流程</h2><figure data-tool="mdnice 編輯器" style="margin-top: 10px;margin-bottom: 10px;outline: 0px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img class="rich_pages wxw-img" data-imgfileid="100006740" data-ratio="0.8083333333333333" src="https://oscimg.oschina.net/oscnet/c0a489e5-d07a-48a6-86d2-943afad9c5df.png" data-type="png" data-w="1080" style="margin-right: auto;margin-left: auto;outline: 0px;display: block;visibility: visible !important;width: 656.99px !important;" referrerpolicy="no-referrer"></figure><span id="OSC_h3_9"></span><h3 data-tool="mdnice 編輯器" style="margin-top: 30px;margin-bottom: 15px;outline: 0px;font-weight: bold;font-size: 20px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;">2.3.1 Gating 流程</h3><p data-tool="mdnice 編輯器" style="margin-bottom: 0px;padding-top: 8px;padding-bottom: 8px;outline: 0px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;line-height: 26px;">以下表示為多個<code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">token</code>的<code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">gating</code>計算流程</p><pre data-tool="mdnice 編輯器" style="margin-top: 10px;margin-bottom: 10px;outline: 0px;letter-spacing: normal;text-align: left;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="margin-bottom: -7px;outline: 0px;display: block;background: url(&quot;https://oscimg.oschina.net/oscnet/97137f2e-9f16-422b-aac0-3a34b7643e27.svg&quot;) 10px 10px / 40px no-repeat rgb(40, 44, 52);height: 30px;width: 657px;border-radius: 5px;"></span><code style="padding: 15px 16px 16px;outline: 0px;overflow-x: auto;color: rgb(171, 178, 191);display: -webkit-box;font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;font-size: 12px;background: rgb(40, 44, 52);border-radius: 5px;"><span style="outline: 0px;color: rgb(92, 99, 112);font-style: italic;line-height: 26px;"># 階段一</span><br style="outline: 0px;"><span style="outline: 0px;color: rgb(92, 99, 112);font-style: italic;line-height: 26px;"># 計算稀疏 gating 值</span><br style="outline: 0px;">tokens = <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">6</span><br style="outline: 0px;">x = torch.randn(<span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">1</span>, tokens, <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">128</span>) <span style="outline: 0px;color: rgb(92, 99, 112);font-style: italic;line-height: 26px;"># 6 個 token</span><br style="outline: 0px;">hidden_states = x<br style="outline: 0px;">batch_size, sequence_length, hidden_dim = hidden_states.shape<br style="outline: 0px;">hidden_states = hidden_states.view(<span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">-1</span>, hidden_dim)<br style="outline: 0px;"><br style="outline: 0px;"><span style="outline: 0px;color: rgb(92, 99, 112);font-style: italic;line-height: 26px;"># 每層都會產生 router_logits, 將用於最後作 load balance loss</span><br style="outline: 0px;">router_logits = experts.gate(hidden_states)<br style="outline: 0px;">print(<span style="outline: 0px;color: rgb(152, 195, 121);line-height: 26px;">f'experts.gate output router logits : \n <span style="outline: 0px;color: rgb(224, 108, 117);line-height: 26px;">{router_logits}</span>'</span>)<br style="outline: 0px;"><br style="outline: 0px;"><span style="outline: 0px;color: rgb(92, 99, 112);font-style: italic;line-height: 26px;"># 計算 TopK 的，專家 logits 和 Top2 專家的位置</span><br style="outline: 0px;">routing_weights = F.softmax(router_logits, dim=<span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">1</span>, dtype=torch.float)<br style="outline: 0px;">print(<span style="outline: 0px;color: rgb(152, 195, 121);line-height: 26px;">f'softmax weight  : \n <span style="outline: 0px;color: rgb(224, 108, 117);line-height: 26px;">{routing_weights}</span>'</span>)<br style="outline: 0px;"><br style="outline: 0px;">routing_weights, selected_experts = torch.topk(routing_weights, \<br style="outline: 0px;">                                               experts.top_k, dim=<span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">-1</span>)<br style="outline: 0px;">print(<span style="outline: 0px;color: rgb(152, 195, 121);line-height: 26px;">f'expert select : \n <span style="outline: 0px;color: rgb(224, 108, 117);line-height: 26px;">{selected_experts}</span>'</span>)<br style="outline: 0px;">print(<span style="outline: 0px;color: rgb(152, 195, 121);line-height: 26px;">f'topk : \n <span style="outline: 0px;color: rgb(224, 108, 117);line-height: 26px;">{routing_weights}</span>'</span>)<br style="outline: 0px;"><br style="outline: 0px;">routing_weights /= routing_weights.sum(dim=<span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">-1</span>, keepdim=<span style="outline: 0px;color: rgb(86, 182, 194);line-height: 26px;">True</span>)<br style="outline: 0px;">print(<span style="outline: 0px;color: rgb(152, 195, 121);line-height: 26px;">f'topk 歸一化 : \n <span style="outline: 0px;color: rgb(224, 108, 117);line-height: 26px;">{routing_weights}</span>'</span>)<br style="outline: 0px;"><br style="outline: 0px;">routing_weights = routing_weights.to(hidden_states.dtype)<br style="outline: 0px;"><br style="outline: 0px;"><span style="outline: 0px;color: rgb(92, 99, 112);font-style: italic;line-height: 26px;">## One Hot 編碼</span><br style="outline: 0px;">expert_mask = torch.nn.functional.one_hot(selected_experts, \<br style="outline: 0px;">                                          num_classes=experts.num_experts).permute(<span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">2</span>, <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">1</span>, <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">0</span>)<br style="outline: 0px;"><span style="outline: 0px;color: rgb(198, 120, 221);line-height: 26px;">for</span> i <span style="outline: 0px;color: rgb(198, 120, 221);line-height: 26px;">in</span> range(tokens):<br style="outline: 0px;">    print(<span style="outline: 0px;color: rgb(152, 195, 121);line-height: 26px;">f'【token_<span style="outline: 0px;color: rgb(224, 108, 117);line-height: 26px;">{i}</span>】\n'</span>, expert_mask[:,:,i])<br style="outline: 0px;"></code></pre><figure data-tool="mdnice 編輯器" style="margin-top: 10px;margin-bottom: 10px;outline: 0px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img class="rich_pages wxw-img" data-imgfileid="100006744" data-ratio="0.8296296296296296" src="https://oscimg.oschina.net/oscnet/1c6f9548-60de-41a6-891f-8cc9b3014138.png" data-type="png" data-w="1080" style="margin-right: auto;margin-left: auto;outline: 0px;display: block;visibility: visible !important;width: 656.99px !important;" referrerpolicy="no-referrer"></figure><p data-tool="mdnice 編輯器" style="margin-bottom: 0px;padding-top: 8px;padding-bottom: 8px;outline: 0px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;line-height: 26px;">追蹤<code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">x3</code>的結果</p><figure data-tool="mdnice 編輯器" style="margin-top: 10px;margin-bottom: 10px;outline: 0px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img class="rich_pages wxw-img" data-imgfileid="100006742" data-ratio="0.2518518518518518" data-type="png" data-w="1080" src="https://oscimg.oschina.net/oscnet/1b246c20-c0e4-464e-a0cb-5b43546dc042.png" style="margin-right: auto;margin-left: auto;outline: 0px;display: block;visibility: visible !important;width: 656.958px !important;" referrerpolicy="no-referrer"></figure><span id="OSC_h2_10"></span><h2 data-tool="mdnice 編輯器" style="margin-top: 30px;margin-bottom: 15px;outline: 0px;font-weight: bold;font-size: 22px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;">2.3.2 Expert 流程</h2><section role="presentation" data-formula="y = \sum ^{n-1}_{i=0}\text{Softmax}(\text{Top2}(x\cdot W_g))_i \cdot \text{SwiGLU}_i(x)
" data-formula-type="block-equation" data-tool="mdnice 編輯器" style="margin-bottom: 0px;outline: 0px;letter-spacing: normal;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;text-align: center;overflow: auto;"><embed style="vertical-align: -2.819ex;width: 44.983ex;height: auto;max-width: 300% !important;" src="https://oscimg.oschina.net/oscnet/ce68f4d9-a02c-41e1-a90d-9789dedfa8e7.svg" data-type="svg+xml" data-imgfileid="100006732"></section><ul data-tool="mdnice 編輯器" class="list-paddingleft-1" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;outline: 0px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;"><li style="outline: 0px;"><section style="margin-top: 5px;margin-bottom: 5px;outline: 0px;line-height: 26px;color: rgb(1, 1, 1);"><code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">sMoE</code>中是基於專家來選擇 
    <code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">token</code>來計算的 
   </section></li><li style="outline: 0px;"><section style="margin-top: 5px;margin-bottom: 5px;outline: 0px;line-height: 26px;color: rgb(1, 1, 1);"><code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">token</code>先序：左圖為 
    <code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">token3</code>選擇 
    <code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">expert 2</code>,&nbsp; 
    <code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">expert 3</code>號來計算 
    <code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">sMoE</code>結果 
   </section></li><li style="outline: 0px;"><section style="margin-top: 5px;margin-bottom: 5px;outline: 0px;line-height: 26px;color: rgb(1, 1, 1);"><code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">expert</code>先序：右圖為依次計算 
    <code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">expert2</code>和 
    <code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">expert3</code>才得出 
    <code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">token3</code>&nbsp;的 
    <code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">sMoE</code>結果 
   </section></li></ul><figure data-tool="mdnice 編輯器" style="margin-top: 10px;margin-bottom: 10px;outline: 0px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img class="rich_pages wxw-img" data-imgfileid="100006743" data-ratio="0.6342592592592593" src="https://oscimg.oschina.net/oscnet/fca3697d-85f8-4851-8bde-773a42c43cca.png" data-type="png" data-w="1080" style="margin-right: auto;margin-left: auto;outline: 0px;display: block;visibility: visible !important;width: 657px !important;" referrerpolicy="no-referrer"></figure><p data-tool="mdnice 編輯器" style="margin-bottom: 0px;padding-top: 8px;padding-bottom: 8px;outline: 0px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;line-height: 26px;">代碼實現結果為：</p><pre data-tool="mdnice 編輯器" style="margin-top: 10px;margin-bottom: 10px;outline: 0px;letter-spacing: normal;text-align: left;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="margin-bottom: -7px;outline: 0px;display: block;background: url(&quot;https://oscimg.oschina.net/oscnet/97137f2e-9f16-422b-aac0-3a34b7643e27.svg&quot;) 10px 10px / 40px no-repeat rgb(40, 44, 52);height: 30px;width: 657px;border-radius: 5px;"></span><code style="padding: 15px 16px 16px;outline: 0px;overflow-x: auto;color: rgb(171, 178, 191);display: -webkit-box;font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;font-size: 12px;background: rgb(40, 44, 52);border-radius: 5px;"><span style="outline: 0px;color: rgb(92, 99, 112);font-style: italic;line-height: 26px;">## 最終結果</span><br style="outline: 0px;">final_hidden_states = torch.zeros(<br style="outline: 0px;">    (batch_size * sequence_length, hidden_dim), \<br style="outline: 0px;">        dtype=hidden_states.dtype, device=hidden_states.device<br style="outline: 0px;">)<br style="outline: 0px;">print(<span style="outline: 0px;color: rgb(152, 195, 121);line-height: 26px;">f'final moe result shape for each token: <span style="outline: 0px;color: rgb(224, 108, 117);line-height: 26px;">{final_hidden_states.shape}</span>'</span>)<br style="outline: 0px;"><br style="outline: 0px;"><span style="outline: 0px;color: rgb(92, 99, 112);font-style: italic;line-height: 26px;"># 每個專家收集需要計算 token</span><br style="outline: 0px;"><span style="outline: 0px;color: rgb(198, 120, 221);line-height: 26px;">for</span> expert_idx <span style="outline: 0px;color: rgb(198, 120, 221);line-height: 26px;">in</span> range(experts.num_experts):<br style="outline: 0px;"><br style="outline: 0px;">    print(<span style="outline: 0px;color: rgb(152, 195, 121);line-height: 26px;">f'--------expert <span style="outline: 0px;color: rgb(224, 108, 117);line-height: 26px;">{expert_idx}</span> ---------'</span>)<br style="outline: 0px;"><br style="outline: 0px;">    expert_layer = experts.experts[expert_idx]<br style="outline: 0px;">    print(expert_mask[expert_idx])<br style="outline: 0px;">    idx, top_x = torch.where(expert_mask[expert_idx])<br style="outline: 0px;">    print(<span style="outline: 0px;color: rgb(152, 195, 121);line-height: 26px;">f'專家 <span style="outline: 0px;color: rgb(224, 108, 117);line-height: 26px;">{expert_idx}</span> 計算的樣本編號:'</span>,top_x.tolist()) <span style="outline: 0px;color: rgb(92, 99, 112);font-style: italic;line-height: 26px;"># select x_idx for expert top1</span><br style="outline: 0px;">    print(<span style="outline: 0px;color: rgb(152, 195, 121);line-height: 26px;">f'專家 <span style="outline: 0px;color: rgb(224, 108, 117);line-height: 26px;">{expert_idx}</span> top1:0, top2:1 '</span>,idx.tolist()) <span style="outline: 0px;color: rgb(92, 99, 112);font-style: italic;line-height: 26px;"># 0 is top1 ,1 is top2</span><br style="outline: 0px;">    print(<span style="outline: 0px;color: rgb(152, 195, 121);line-height: 26px;">f'有 <span style="outline: 0px;color: rgb(224, 108, 117);line-height: 26px;">{len(top_x)}</span> / <span style="outline: 0px;color: rgb(224, 108, 117);line-height: 26px;">{x.shape[<span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">1</span>]}</span> token 選到專家 <span style="outline: 0px;color: rgb(224, 108, 117);line-height: 26px;">{expert_idx}</span>'</span>)<br style="outline: 0px;"><br style="outline: 0px;">    top_x_list = top_x.tolist()<br style="outline: 0px;">    idx_list = idx.tolist()<br style="outline: 0px;"><br style="outline: 0px;">    current_state = hidden_states[<span style="outline: 0px;color: rgb(86, 182, 194);line-height: 26px;">None</span>, top_x_list].reshape(<span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">-1</span>, hidden_dim)<br style="outline: 0px;"><br style="outline: 0px;"><span style="outline: 0px;color: rgb(92, 99, 112);font-style: italic;line-height: 26px;"># expert_0(x) * routing_weights</span><br style="outline: 0px;">    current_hidden_states = expert_layer(current_state)  \<br style="outline: 0px;">                            * routing_weights[top_x_list, idx_list, <span style="outline: 0px;color: rgb(86, 182, 194);line-height: 26px;">None</span>]<br style="outline: 0px;"><br style="outline: 0px;"><span style="outline: 0px;color: rgb(92, 99, 112);font-style: italic;line-height: 26px;"># 將計算的單個專家結果填入到結果表裏</span><br style="outline: 0px;">    final_hidden_states.index_add_(<span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">0</span>, top_x, current_hidden_states.to(hidden_states.dtype))<br style="outline: 0px;"><br style="outline: 0px;">    print(current_state.shape) <br style="outline: 0px;">    print(routing_weights[top_x_list, idx_list, <span style="outline: 0px;color: rgb(86, 182, 194);line-height: 26px;">None</span>].shape)<br style="outline: 0px;">    print(current_hidden_states.shape)<br style="outline: 0px;">    print(final_hidden_states.shape)<br style="outline: 0px;"></code></pre><p data-tool="mdnice 編輯器" style="margin-bottom: 0px;padding-top: 8px;padding-bottom: 8px;outline: 0px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;line-height: 26px;">輸出結果為:</p><figure data-tool="mdnice 編輯器" style="margin-top: 10px;margin-bottom: 10px;outline: 0px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img class="rich_pages wxw-img" data-imgfileid="100006745" data-ratio="0.8870370370370371" src="https://oscimg.oschina.net/oscnet/4dbff434-6e52-42ad-9e57-99a809a779e2.png" data-type="png" data-w="1080" style="margin-right: auto;margin-left: auto;outline: 0px;display: block;visibility: visible !important;width: 656.99px !important;" referrerpolicy="no-referrer"></figure><span id="OSC_h2_11"></span><h2 data-tool="mdnice 編輯器" style="margin-top: 30px;margin-bottom: 15px;outline: 0px;font-weight: bold;font-size: 22px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;">2.4 Router Load Balence 計算</h2><p data-tool="mdnice 編輯器" style="margin-bottom: 0px;padding-top: 8px;padding-bottom: 8px;outline: 0px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;line-height: 26px;">路由負載均衡的實現來自<code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">Switch Transformers</code></p><blockquote data-tool="mdnice 編輯器" style="margin-top: 20px;margin-bottom: 20px;padding: 10px 10px 10px 20px;outline: 0px;border-left-color: rgba(0, 0, 0, 0.4);color: rgb(106, 115, 125);font-size: 0.9em;letter-spacing: normal;text-align: left;text-wrap: wrap;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;border-top: none;border-right: none;border-bottom: none;overflow: auto;background: rgba(0, 0, 0, 0.05);"><p style="padding-top: 8px;padding-bottom: 8px;outline: 0px;font-size: 16px;color: black;line-height: 26px;">Computes auxiliary load balancing loss as in Switch Transformer - implemented in Pytorch. See Switch Transformer for more details. This function implements the loss function presented in equations (4) - (6) of the paper. It aims at penalizing cases where the routing between experts is too unbalanced.</p></blockquote><span id="OSC_h3_12"></span><h3 data-tool="mdnice 編輯器" style="margin-top: 30px;margin-bottom: 15px;outline: 0px;font-weight: bold;font-size: 20px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;">2.4.1 Switch Transformers Load Balance Loss</h3><p data-tool="mdnice 編輯器" style="margin-bottom: 0px;padding-top: 8px;padding-bottom: 8px;outline: 0px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;line-height: 26px;">該算法為<code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">sMoE</code>簡化版<code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">load balance&nbsp;</code>, 去除了原版&nbsp;balance loss&nbsp;<span style="outline: 0px;">估計</span></p><section data-tool="mdnice 編輯器" data-website="https://www.mdnice.com" style="margin-bottom: 0px;padding-right: 10px;padding-left: 10px;outline: 0px;letter-spacing: 0px;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;line-height: 1.6;word-break: break-word;"><section role="presentation" data-formula="loss = \alpha\cdot N\cdot \sum ^N_{i=1}f_i\cdot P_i
" data-formula-type="block-equation" data-tool="mdnice 編輯器" style="outline: 0px;text-align: center;overflow: auto;"><svg
                xmlns="http://www.w3.org/2000/svg" role="img" focusable="false" viewBox="0 -1733 10080.5 2978.9" aria-hidden="true" style="-webkit-overflow-scrolling: touch;vertical-align: -2.819ex;width: 22.806ex;height: 6.74ex;max-width: 300% !important;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="mi" transform="translate(298, 0)"><path data-c="6F" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(783, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mi" transform="translate(1252, 0)"><path data-c="73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mo" transform="translate(1998.8, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mi" transform="translate(3054.6, 0)"><path data-c="3B1" d="M34 156Q34 270 120 356T309 442Q379 442 421 402T478 304Q484 275 485 237V208Q534 282 560 374Q564 388 566 390T582 393Q603 393 603 385Q603 376 594 346T558 261T497 161L486 147L487 123Q489 67 495 47T514 26Q528 28 540 37T557 60Q559 67 562 68T577 70Q597 70 597 62Q597 56 591 43Q579 19 556 5T512 -10H505Q438 -10 414 62L411 69L400 61Q390 53 370 41T325 18T267 -2T203 -11Q124 -11 79 39T34 156ZM208 26Q257 26 306 47T379 90L403 112Q401 255 396 290Q382 405 304 405Q235 405 183 332Q156 292 139 224T121 120Q121 71 146 49T208 26Z"></path></g><g data-mml-node="mo" transform="translate(3916.8, 0)"><path data-c="22C5" d="M78 250Q78 274 95 292T138 310Q162 310 180 294T199 251Q199 226 182 208T139 190T96 207T78 250Z"></path></g><g data-mml-node="mi" transform="translate(4417, 0)"><path data-c="4E" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"></path></g><g data-mml-node="mo" transform="translate(5527.2, 0)"><path data-c="22C5" d="M78 250Q78 274 95 292T138 310Q162 310 180 294T199 251Q199 226 182 208T139 190T96 207T78 250Z"></path></g><g data-mml-node="munderover" transform="translate(6027.4, 0)"><g data-mml-node="mo"><path data-c="2211" d="M60 948Q63 950 665 950H1267L1325 815Q1384 677 1388 669H1348L1341 683Q1320 724 1285 761Q1235 809 1174 838T1033 881T882 898T699 902H574H543H251L259 891Q722 258 724 252Q725 250 724 246Q721 243 460 -56L196 -356Q196 -357 407 -357Q459 -357 548 -357T676 -358Q812 -358 896 -353T1063 -332T1204 -283T1307 -196Q1328 -170 1348 -124H1388Q1388 -125 1381 -145T1356 -210T1325 -294L1267 -449L666 -450Q64 -450 61 -448Q55 -446 55 -439Q55 -437 57 -433L590 177Q590 178 557 222T452 366T322 544L56 909L55 924Q55 945 60 948Z"></path></g><g data-mml-node="TeXAtom" transform="translate(148.2, -1087.9) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="69" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mo" transform="translate(345, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(1123, 0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g><g data-mml-node="mi" transform="translate(408, 1150) scale(0.707)"><path data-c="4E" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"></path></g></g><g data-mml-node="msub" transform="translate(7638.1, 0)"><g data-mml-node="mi"><path data-c="66" d="M118 -162Q120 -162 124 -164T135 -167T147 -168Q160 -168 171 -155T187 -126Q197 -99 221 27T267 267T289 382V385H242Q195 385 192 387Q188 390 188 397L195 425Q197 430 203 430T250 431Q298 431 298 432Q298 434 307 482T319 540Q356 705 465 705Q502 703 526 683T550 630Q550 594 529 578T487 561Q443 561 443 603Q443 622 454 636T478 657L487 662Q471 668 457 668Q445 668 434 658T419 630Q412 601 403 552T387 469T380 433Q380 431 435 431Q480 431 487 430T498 424Q499 420 496 407T491 391Q489 386 482 386T428 385H372L349 263Q301 15 282 -47Q255 -132 212 -173Q175 -205 139 -205Q107 -205 81 -186T55 -132Q55 -95 76 -78T118 -61Q162 -61 162 -103Q162 -122 151 -136T127 -157L118 -162Z"></path></g><g data-mml-node="mi" transform="translate(490, -150) scale(0.707)"><path data-c="69" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g></g><g data-mml-node="mo" transform="translate(8644.3, 0)"><path data-c="22C5" d="M78 250Q78 274 95 292T138 310Q162 310 180 294T199 251Q199 226 182 208T139 190T96 207T78 250Z"></path></g><g data-mml-node="msub" transform="translate(9144.5, 0)"><g data-mml-node="mi"><path data-c="50" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g><g data-mml-node="mi" transform="translate(642, -150) scale(0.707)"><path data-c="69" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g></g></g></g></svg></section><section role="presentation" data-formula="f_i = \frac{1}{T}\sum_{x\in\mathcal{B}}\mathbb{1}\{\text{argmax }p(x)=i\}
" data-formula-type="block-equation" data-tool="mdnice 編輯器" style="outline: 0px;text-align: center;overflow: auto;"><embed style="vertical-align: -2.814ex;width: 30.879ex;height: auto;max-width: 300% !important;" src="https://oscimg.oschina.net/oscnet/a44025fc-3ccf-4c1b-9d1d-5b6c059ec916.svg" data-type="svg+xml" data-imgfileid="100006733"></section><p data-tool="mdnice 編輯器" style="padding-top: 8px;padding-bottom: 8px;outline: 0px;line-height: 26px;"><code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">fi</code>:在一個<code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">batch</code>中第<code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">i</code>專家分配到<code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">token</code>的數量概率</p><section role="presentation" data-formula="P_i=\frac{1}{T}\sum_{x\in \mathcal{B}}p_i(x)
" data-formula-type="block-equation" data-tool="mdnice 編輯器" style="outline: 0px;text-align: center;overflow: auto;"><svg
                xmlns="http://www.w3.org/2000/svg" role="img" focusable="false" viewBox="0 -1342 7337.8 2585.8" aria-hidden="true" style="-webkit-overflow-scrolling: touch;vertical-align: -2.814ex;width: 16.601ex;height: 5.85ex;max-width: 300% !important;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="50" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g><g data-mml-node="mi" transform="translate(642, -150) scale(0.707)"><path data-c="69" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g></g><g data-mml-node="mo" transform="translate(1213.7, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mfrac" transform="translate(2269.5, 0)"><g data-mml-node="mn" transform="translate(322, 676)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mi" transform="translate(220, -686)"><path data-c="54" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path></g><rect width="904" height="60" x="120" y="220"></rect></g><g data-mml-node="munder" transform="translate(3580.2, 0)"><g data-mml-node="mo"><path data-c="2211" d="M60 948Q63 950 665 950H1267L1325 815Q1384 677 1388 669H1348L1341 683Q1320 724 1285 761Q1235 809 1174 838T1033 881T882 898T699 902H574H543H251L259 891Q722 258 724 252Q725 250 724 246Q721 243 460 -56L196 -356Q196 -357 407 -357Q459 -357 548 -357T676 -358Q812 -358 896 -353T1063 -332T1204 -283T1307 -196Q1328 -170 1348 -124H1388Q1388 -125 1381 -145T1356 -210T1325 -294L1267 -449L666 -450Q64 -450 61 -448Q55 -446 55 -439Q55 -437 57 -433L590 177Q590 178 557 222T452 366T322 544L56 909L55 924Q55 945 60 948Z"></path></g><g data-mml-node="TeXAtom" transform="translate(51.7, -1115.5) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="78" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g><g data-mml-node="mo" transform="translate(572, 0)"><path data-c="2208" d="M84 250Q84 372 166 450T360 539Q361 539 377 539T419 540T469 540H568Q583 532 583 520Q583 511 570 501L466 500Q355 499 329 494Q280 482 242 458T183 409T147 354T129 306T124 272V270H568Q583 262 583 250T568 230H124V228Q124 207 134 177T167 112T231 48T328 7Q355 1 466 0H570Q583 -10 583 -20Q583 -32 568 -40H471Q464 -40 446 -40T417 -41Q262 -41 172 45Q84 127 84 250Z"></path></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(1239, 0)"><g data-mml-node="mi"><path data-c="42" d="M304 342Q292 342 292 353Q292 372 323 391Q331 396 417 428T533 487Q563 512 563 555V562Q563 575 557 589T530 618T475 636Q429 636 396 613T330 539Q263 446 210 238Q196 183 173 120Q135 31 121 16Q108 1 85 -10T47 -22T32 -10Q32 -5 44 18T77 93T112 206Q135 296 154 395T182 550T191 615Q191 616 190 616Q188 616 179 611T157 601T131 594Q113 594 113 605Q113 623 144 644Q154 650 205 676T267 703Q277 705 279 705Q295 705 295 693Q295 686 288 635T278 575Q278 572 287 582Q336 635 402 669T540 704Q603 704 633 673T664 599Q664 559 638 523T580 462Q553 440 504 413L491 407L504 402Q566 381 596 338T627 244Q627 172 575 110T444 13T284 -22Q208 -22 158 28Q144 42 146 50Q150 67 178 85T230 103Q236 103 246 95T267 75T302 56T357 47Q436 47 486 93Q526 136 526 198V210Q526 228 518 249T491 292T436 330T350 345Q335 345 321 344T304 342Z"></path></g></g></g></g><g data-mml-node="msub" transform="translate(5190.8, 0)"><g data-mml-node="mi"><path data-c="70" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></g><g data-mml-node="mi" transform="translate(503, -150) scale(0.707)"><path data-c="69" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g></g><g data-mml-node="mo" transform="translate(5987.8, 0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(6376.8, 0)"><path data-c="78" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g><g data-mml-node="mo" transform="translate(6948.8, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g></g></svg></section><p data-tool="mdnice 編輯器" style="padding-top: 8px;padding-bottom: 8px;outline: 0px;line-height: 26px;"><code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">Pi</code>:在一個<code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">batch</code>中<code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">T</code>個<code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">tokens</code>，各個專家選到<code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">tokens</code>的概率和</p></section><p data-tool="mdnice 編輯器" style="margin-bottom: 0px;padding-top: 8px;padding-bottom: 8px;outline: 0px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;line-height: 26px;"><img class="rich_pages wxw-img" data-imgfileid="100006748" data-ratio="0.8111111111111111" src="https://oscimg.oschina.net/oscnet/cb976fdf-8c5e-4d05-bc80-1dbabb5f288c.png" data-type="png" data-w="1080" style="margin-right: auto;margin-left: auto;outline: 0px;display: block;visibility: visible !important;width: 657px !important;" referrerpolicy="no-referrer"><span style="outline: 0px;font-size: 20px;font-weight: bold;">2.4.2&nbsp;手撕 Mixtral Load Balance Loss 計算流程</span></p><p data-tool="mdnice 編輯器" style="margin-bottom: 0px;padding-top: 8px;padding-bottom: 8px;outline: 0px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;line-height: 26px;">可以想象下<code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">layer norm</code>只是在<strong style="outline: 0px;">當前層</strong>裏對所有<code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">tokens</code>&nbsp;做，而負載均衡處理範圍更廣，對<strong style="outline: 0px;">所有層</strong>的<code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">tokens</code>&nbsp;，在每個<code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">expert</code>的縱向計算出單專家負載值，求和便得到整個網絡的負載均衡 loss</p><figure data-tool="mdnice 編輯器" style="margin-top: 10px;margin-bottom: 10px;outline: 0px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img class="rich_pages wxw-img" data-imgfileid="100006749" data-ratio="1.038888888888889" src="https://oscimg.oschina.net/oscnet/50a571f0-7da0-4439-8d14-de0abd1849fc.png" data-type="png" data-w="1080" style="margin-right: auto;margin-left: auto;outline: 0px;display: block;visibility: visible !important;width: 656.99px !important;" referrerpolicy="no-referrer"></figure><span id="OSC_h3_13"></span><h3 data-tool="mdnice 編輯器" style="margin-top: 30px;margin-bottom: 15px;outline: 0px;font-weight: bold;font-size: 20px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;">2.4.3 手撕 Mixtral Load Balance</h3><pre data-tool="mdnice 編輯器" style="margin-top: 10px;margin-bottom: 10px;outline: 0px;letter-spacing: normal;text-align: left;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><code style="padding: 15px 16px 16px;outline: 0px;overflow-x: auto;color: rgb(171, 178, 191);display: -webkit-box;font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;font-size: 12px;background: rgb(40, 44, 52);border-radius: 5px;"><span style="outline: 0px;color: rgb(198, 120, 221);line-height: 26px;">import</span> torch<br style="outline: 0px;"><br style="outline: 0px;">num_experts = <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">8</span><br style="outline: 0px;">batch = <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">10</span><br style="outline: 0px;">seq_length = <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">6</span><br style="outline: 0px;">top_k = <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">2</span><br style="outline: 0px;"><br style="outline: 0px;">print(<span style="outline: 0px;color: rgb(152, 195, 121);line-height: 26px;">f'sMoE num_experts:<span style="outline: 0px;color: rgb(224, 108, 117);line-height: 26px;">{num_experts}</span> top_k:<span style="outline: 0px;color: rgb(224, 108, 117);line-height: 26px;">{top_k}</span> batch:<span style="outline: 0px;color: rgb(224, 108, 117);line-height: 26px;">{batch}</span> seq_length:<span style="outline: 0px;color: rgb(224, 108, 117);line-height: 26px;">{seq_length}</span>'</span>)<br style="outline: 0px;"><br style="outline: 0px;">router_logits_1 = torch.randn(batch, seq_length, num_experts).view(<span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">-1</span>,num_experts) <span style="outline: 0px;color: rgb(92, 99, 112);font-style: italic;line-height: 26px;"># layer 1</span><br style="outline: 0px;">router_logits_2 = torch.randn(batch, seq_length, num_experts).view(<span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">-1</span>,num_experts) <span style="outline: 0px;color: rgb(92, 99, 112);font-style: italic;line-height: 26px;"># layer 2</span><br style="outline: 0px;">router_logits = [router_logits_1, router_logits_2] <br style="outline: 0px;"><br style="outline: 0px;">concatenated_gate_logits = torch.cat(router_logits, dim = <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">0</span>)<br style="outline: 0px;">print(<span style="outline: 0px;color: rgb(152, 195, 121);line-height: 26px;">'單層 gating 的路由 logits:'</span>, router_logits_1.shape) <br style="outline: 0px;">print(<span style="outline: 0px;color: rgb(152, 195, 121);line-height: 26px;">'兩層 gating 的路由 logits:'</span>, concatenated_gate_logits.shape)<br style="outline: 0px;"><br style="outline: 0px;">print(<span style="outline: 0px;color: rgb(152, 195, 121);line-height: 26px;">'根據 logits top-k 計算熱獨編碼'</span>)<br style="outline: 0px;">routing_weights = torch.nn.functional.softmax(concatenated_gate_logits, dim=<span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">-1</span>)<br style="outline: 0px;">_, selected_experts = torch.topk(routing_weights, top_k, dim=<span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">-1</span>)<br style="outline: 0px;">expert_mask = torch.nn.functional.one_hot(selected_experts, num_experts)<br style="outline: 0px;">print(expert_mask.shape)<br style="outline: 0px;"><br style="outline: 0px;">tokens_sum_expert = torch.sum(expert_mask.float(), dim=<span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">0</span>)<br style="outline: 0px;">tokens_per_expert = torch.mean(expert_mask.float(), dim=<span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">0</span>)<br style="outline: 0px;">print(<span style="outline: 0px;color: rgb(152, 195, 121);line-height: 26px;">f'top1 每個專家平均處理的 token   :'</span>, tokens_sum_expert[<span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">0</span>])<br style="outline: 0px;">print(<span style="outline: 0px;color: rgb(152, 195, 121);line-height: 26px;">f'top2 每個專家平均處理的 token fi:'</span>, tokens_per_expert[<span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">1</span>])<br style="outline: 0px;">print(<span style="outline: 0px;color: rgb(152, 195, 121);line-height: 26px;">f'top1 與 top2 水平合計'</span>, tokens_per_expert.sum(dim=<span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">1</span>))<br style="outline: 0px;"><br style="outline: 0px;"><span style="outline: 0px;color: rgb(92, 99, 112);font-style: italic;line-height: 26px;"># Compute the average probability of routing to these experts</span><br style="outline: 0px;">router_prob_per_expert = torch.mean(routing_weights, dim=<span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">0</span>)<br style="outline: 0px;">print(<span style="outline: 0px;color: rgb(152, 195, 121);line-height: 26px;">'router_prob_per_expert Pi: '</span> , router_prob_per_expert)<br style="outline: 0px;"><br style="outline: 0px;">print( <span style="outline: 0px;color: rgb(152, 195, 121);line-height: 26px;">'每個專家的負載：'</span>,  tokens_per_expert * router_prob_per_expert.unsqueeze(<span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">0</span>))<br style="outline: 0px;">overall_loss = torch.sum(tokens_per_expert * router_prob_per_expert.unsqueeze(<span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">0</span>))<br style="outline: 0px;">print(<span style="outline: 0px;color: rgb(152, 195, 121);line-height: 26px;">'final loss:'</span>, overall_loss)<br style="outline: 0px;"><br style="outline: 0px;"></code></pre><p data-tool="mdnice 編輯器" style="margin-bottom: 0px;padding-top: 8px;padding-bottom: 8px;outline: 0px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;line-height: 26px;">計算結果</p><pre data-tool="mdnice 編輯器" style="margin-top: 10px;margin-bottom: 10px;outline: 0px;letter-spacing: normal;text-align: left;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="margin-bottom: -7px;outline: 0px;display: block;background: url(&quot;https://oscimg.oschina.net/oscnet/97137f2e-9f16-422b-aac0-3a34b7643e27.svg&quot;) 10px 10px / 40px no-repeat rgb(40, 44, 52);height: 30px;width: 657px;border-radius: 5px;"></span><code style="padding: 15px 16px 16px;outline: 0px;overflow-x: auto;color: rgb(171, 178, 191);display: -webkit-box;font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;font-size: 12px;background: rgb(40, 44, 52);border-radius: 5px;">sMoE num_experts:<span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">8</span> top_k:<span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">2</span> batch:<span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">10</span> seq_length:<span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">6</span><br style="outline: 0px;">單層 gating 的路由 logits:<br style="outline: 0px;">torch.Size([<span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">60</span>, <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">8</span>])<br style="outline: 0px;">兩層 gating 的路由 logits:<br style="outline: 0px;">torch.Size([<span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">120</span>, <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">8</span>])<br style="outline: 0px;">根據 logits top-k 計算熱獨編碼<br style="outline: 0px;">torch.Size([<span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">120</span>, <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">2</span>, <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">8</span>])<br style="outline: 0px;">top1 每個專家平均處理的 token   : tensor([<span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">10.</span>, <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">14.</span>, <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">19.</span>, <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">17.</span>, <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">14.</span>,  <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">9.</span>, <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">17.</span>, <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">20.</span>])<br style="outline: 0px;">top2 每個專家平均處理的 token fi: tensor([<span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">0.1667</span>, <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">0.1333</span>, <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">0.1833</span>, <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">0.0833</span>, <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">0.1167</span>, <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">0.1500</span>, <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">0.0667</span>, <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">0.1000</span>])<br style="outline: 0px;">top1 與 top2 水平合計 tensor([<span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">1.</span>, <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">1.</span>])<br style="outline: 0px;">router_prob_per_expert Pi:  tensor([<span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">0.1236</span>, <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">0.1184</span>, <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">0.1351</span>, <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">0.1168</span>, <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">0.1311</span>, <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">0.1147</span>, <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">0.1156</span>, <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">0.1447</span>])<br style="outline: 0px;">每個專家的負載：tensor([[<span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">0.0103</span>, <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">0.0138</span>, <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">0.0214</span>, <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">0.0165</span>, <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">0.0153</span>, <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">0.0086</span>, <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">0.0164</span>, <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">0.0241</span>],<br style="outline: 0px;">        [<span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">0.0206</span>, <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">0.0158</span>, <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">0.0248</span>, <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">0.0097</span>, <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">0.0153</span>, <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">0.0172</span>, <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">0.0077</span>, <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">0.0145</span>]])<br style="outline: 0px;">final loss: tensor(<span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">0.2520</span>)<br style="outline: 0px;"></code></pre><p data-tool="mdnice 編輯器" style="margin-bottom: 0px;padding-top: 8px;padding-bottom: 8px;outline: 0px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;line-height: 26px;">這裏的<code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">gating logits</code>&nbsp;是跨<code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">batch</code>跨層的，作用在每個<code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">token</code>上</p><span id="OSC_h1_14"></span><h1 data-tool="mdnice 編輯器" style="margin-top: 30px;margin-bottom: 15px;outline: 0px;font-weight: bold;font-size: 24px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;">3. Mixtral 8x7B 參數量計算</h1><span id="OSC_h2_15"></span><h2 data-tool="mdnice 編輯器" style="margin-top: 30px;margin-bottom: 15px;outline: 0px;font-weight: bold;font-size: 22px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;">3.1 原論文描述</h2><p data-tool="mdnice 編輯器" style="margin-bottom: 0px;padding-top: 8px;padding-bottom: 8px;outline: 0px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;line-height: 26px;">這裏的<code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">13B</code>&nbsp;是指單個<code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">&nbsp;token</code>涉及的模型參數量，實際推理時每個<code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">token</code>都有不同的<code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">expert</code>&nbsp;，那麼實際運行還是跑<code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">47B&nbsp;</code>參數的, 使用了 sMoE 並不會減少顯存佔用。</p><figure data-tool="mdnice 編輯器" style="margin-top: 10px;margin-bottom: 10px;outline: 0px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img class="rich_pages wxw-img" data-imgfileid="100006750" data-ratio="0.362962962962963" src="https://oscimg.oschina.net/oscnet/9dedd8c0-fbbd-4ab8-ab42-dd864369be7d.png" data-type="png" data-w="1080" style="margin-right: auto;margin-left: auto;outline: 0px;display: block;visibility: visible !important;width: 656.969px !important;" referrerpolicy="no-referrer"></figure><span id="OSC_h2_16"></span><h2 data-tool="mdnice 編輯器" style="margin-top: 30px;margin-bottom: 15px;outline: 0px;font-weight: bold;font-size: 22px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;">3.2 模型參數量計算</h2><p data-tool="mdnice 編輯器" style="margin-bottom: 0px;padding-top: 8px;padding-bottom: 8px;outline: 0px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;line-height: 26px;">忽略<code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">GQA</code>計算</p><pre data-tool="mdnice 編輯器" style="margin-top: 10px;margin-bottom: 10px;outline: 0px;letter-spacing: normal;text-align: left;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="margin-bottom: -7px;outline: 0px;display: block;background: url(&quot;https://oscimg.oschina.net/oscnet/97137f2e-9f16-422b-aac0-3a34b7643e27.svg&quot;) 10px 10px / 40px no-repeat rgb(40, 44, 52);height: 30px;width: 657px;border-radius: 5px;"></span><code style="padding: 15px 16px 16px;outline: 0px;overflow-x: auto;color: rgb(171, 178, 191);display: -webkit-box;font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;font-size: 12px;background: rgb(40, 44, 52);border-radius: 5px;">dim = <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">4096</span><br style="outline: 0px;">n_layers = <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">32</span><br style="outline: 0px;">head_dim = <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">128</span><br style="outline: 0px;">hidden_dim = <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">14336</span><br style="outline: 0px;">n_heads = <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">32</span><br style="outline: 0px;">n_kv_heads = <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">8</span><span style="outline: 0px;color: rgb(92, 99, 112);font-style: italic;line-height: 26px;"># ignore GQA</span><br style="outline: 0px;">vocab_size = <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">32000</span><br style="outline: 0px;">num_experts = <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">8</span><br style="outline: 0px;">top_k_experts = <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">2</span><br style="outline: 0px;"><br style="outline: 0px;"><span style="outline: 0px;color: rgb(92, 99, 112);font-style: italic;line-height: 26px;"># attention mlp layernorm</span><br style="outline: 0px;">llama_num = n_layers * (dim * dim * <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">4</span> + hidden_dim * dim * <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">3</span> + <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">2</span> * dim ) \<br style="outline: 0px;">        + <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">2</span> * vocab_size * dim <br style="outline: 0px;">print(<span style="outline: 0px;color: rgb(152, 195, 121);line-height: 26px;">'llama:'</span>, llama_num)<br style="outline: 0px;"><br style="outline: 0px;"><span style="outline: 0px;color: rgb(92, 99, 112);font-style: italic;line-height: 26px;"># attention 【mlp*8】 layernorm</span><br style="outline: 0px;">moe_num = n_layers * (dim * dim * <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">4</span> + hidden_dim * dim * <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">3</span> * <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">8</span> + <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">2</span> * dim ) \<br style="outline: 0px;">        + <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">2</span> * vocab_size * dim <br style="outline: 0px;">print(<span style="outline: 0px;color: rgb(152, 195, 121);line-height: 26px;">'moe:'</span>, moe_num)<br style="outline: 0px;"><br style="outline: 0px;"><span style="outline: 0px;color: rgb(92, 99, 112);font-style: italic;line-height: 26px;"># attention 【mlp*2】 layernorm</span><br style="outline: 0px;"><span style="outline: 0px;color: rgb(92, 99, 112);font-style: italic;line-height: 26px;"># ToP2-inference</span><br style="outline: 0px;">moe_num = n_layers * (dim * dim * <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">4</span> + hidden_dim * dim * <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">3</span> * <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">2</span> + <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">2</span> * dim ) \<br style="outline: 0px;">        + <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">2</span> * vocab_size * dim <br style="outline: 0px;">print(<span style="outline: 0px;color: rgb(152, 195, 121);line-height: 26px;">'moe top-2:'</span>, moe_num)<br style="outline: 0px;"></code></pre><p data-tool="mdnice 編輯器" style="margin-bottom: 0px;padding-top: 8px;padding-bottom: 8px;outline: 0px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;line-height: 26px;">結果</p><pre data-tool="mdnice 編輯器" style="margin-top: 10px;margin-bottom: 10px;outline: 0px;letter-spacing: normal;text-align: left;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="margin-bottom: -7px;outline: 0px;display: block;background: url(&quot;https://oscimg.oschina.net/oscnet/97137f2e-9f16-422b-aac0-3a34b7643e27.svg&quot;) 10px 10px / 40px no-repeat rgb(40, 44, 52);height: 30px;width: 657px;border-radius: 5px;"></span><code style="padding: 15px 16px 16px;outline: 0px;overflow-x: auto;color: rgb(171, 178, 191);display: -webkit-box;font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;font-size: 12px;background: rgb(40, 44, 52);border-radius: 5px;">llama: 8047034368<br style="outline: 0px;">moe: 47507046400<br style="outline: 0px;">moe top-2: 13684178944<br style="outline: 0px;"></code></pre><span id="OSC_h1_17"></span><h1 data-tool="mdnice 編輯器" style="margin-top: 30px;margin-bottom: 15px;outline: 0px;font-weight: bold;font-size: 24px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;">4. MoE 擴展</h1><span id="OSC_h2_18"></span><h2 data-tool="mdnice 編輯器" style="margin-top: 30px;margin-bottom: 15px;outline: 0px;font-weight: bold;font-size: 22px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;">4.1 MegaBlocks</h2><blockquote data-tool="mdnice 編輯器" style="margin-top: 20px;margin-bottom: 20px;padding: 10px 10px 10px 20px;outline: 0px;border-left-color: rgba(0, 0, 0, 0.4);color: rgb(106, 115, 125);font-size: 0.9em;letter-spacing: normal;text-align: left;text-wrap: wrap;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;border-top: none;border-right: none;border-bottom: none;overflow: auto;background: rgba(0, 0, 0, 0.05);"><p style="padding-top: 8px;padding-bottom: 8px;outline: 0px;font-size: 16px;color: black;line-height: 26px;">MoE layers can be run efficiently on single GPUs with high performance specialized kernels. For example,&nbsp;<strong style="outline: 0px;">Megablocks</strong></p></blockquote><p data-tool="mdnice 編輯器" style="margin-bottom: 0px;padding-top: 8px;padding-bottom: 8px;outline: 0px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;line-height: 26px;"><code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">MegaBlocks</code>實現稀疏的<code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">MoE</code>計算</p><figure data-tool="mdnice 編輯器" style="margin-top: 10px;margin-bottom: 10px;outline: 0px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img class="rich_pages wxw-img" data-imgfileid="100006753" data-ratio="0.26481481481481484" src="https://oscimg.oschina.net/oscnet/e1bfdd99-c538-4ff0-abdc-f9abb0d217f0.png" data-type="png" data-w="1080" style="margin-right: auto;margin-left: auto;outline: 0px;display: block;visibility: visible !important;width: 656.979px !important;" referrerpolicy="no-referrer"></figure><section data-tool="mdnice 編輯器" data-website="https://www.mdnice.com" style="margin-bottom: 0px;padding-right: 10px;padding-left: 10px;outline: 0px;letter-spacing: 0px;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);font-size: 16px;color: black;line-height: 1.6;word-break: break-word;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;"><p data-tool="mdnice 編輯器" style="padding-top: 8px;padding-bottom: 8px;outline: 0px;line-height: 26px;">題外話：<code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">XFormers</code>也實現了類似思想的算子，<code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">batch</code>裏的<code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">attention</code>通過<code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">Mask</code>實現多序列稀疏計算。</p></section><figure data-tool="mdnice 編輯器" style="margin-top: 10px;margin-bottom: 10px;outline: 0px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img class="rich_pages wxw-img" data-imgfileid="100006755" data-ratio="0.2351851851851852" data-type="png" data-w="1080" src="https://oscimg.oschina.net/oscnet/78f9ff04-18ec-4713-8eab-f99b63be1268.png" style="margin-right: auto;margin-left: auto;outline: 0px;display: block;visibility: visible !important;width: 656.969px !important;" referrerpolicy="no-referrer"></figure><span id="OSC_h2_19"></span><h2 data-tool="mdnice 編輯器" style="margin-top: 30px;margin-bottom: 15px;outline: 0px;font-weight: bold;font-size: 22px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;">4.2 GShard</h2><p data-tool="mdnice 編輯器" style="margin-bottom: 0px;padding-top: 8px;padding-bottom: 8px;outline: 0px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;line-height: 26px;"><code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">Mixtral</code>論文裏在<code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">load balance</code>裏提了一下<code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">GShard</code>, 是首篇將<code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">MoE</code>引入到<code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">Transformers</code>的工作</p><blockquote data-tool="mdnice 編輯器" style="margin-top: 20px;margin-bottom: 20px;padding: 10px 10px 10px 20px;outline: 0px;border-left-color: rgba(0, 0, 0, 0.4);color: rgb(106, 115, 125);font-size: 0.9em;letter-spacing: normal;text-align: left;text-wrap: wrap;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;border-top: none;border-right: none;border-bottom: none;overflow: auto;background: rgba(0, 0, 0, 0.05);"><p style="padding-top: 8px;padding-bottom: 8px;outline: 0px;font-size: 16px;color: black;line-height: 26px;">This formulation is similar to the GShard architecture [21], with the exceptions that we replace all FFN sub-blocks by MoE layers while GShard replaces every other block, and that GShard uses a more elaborate gating strategy for the second expert assigned to each token.</p></blockquote><p data-tool="mdnice 編輯器" style="margin-bottom: 0px;padding-top: 8px;padding-bottom: 8px;outline: 0px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;line-height: 26px;"><code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">GShard</code>在不同<code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">GPU</code>上分配不同的專家，其他參數都共享，數據派發到專家，專家結果彙總都由<code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">All-to-All</code>算子實現</p><figure data-tool="mdnice 編輯器" style="margin-top: 10px;margin-bottom: 10px;outline: 0px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img class="rich_pages wxw-img" data-imgfileid="100006754" data-ratio="0.6712962962962963" src="https://oscimg.oschina.net/oscnet/d8a02488-b56d-432d-859d-96169d2a7fa3.png" data-type="png" data-w="1080" style="margin-right: auto;margin-left: auto;outline: 0px;display: block;visibility: visible !important;width: 657px !important;" referrerpolicy="no-referrer"></figure><p data-tool="mdnice 編輯器" style="margin-bottom: 0px;padding-top: 8px;padding-bottom: 8px;outline: 0px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;line-height: 26px;">DeepSpeed-MoE 源碼對<code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">All-to-All</code>的實現如下</p><pre data-tool="mdnice 編輯器" style="margin-top: 10px;margin-bottom: 10px;outline: 0px;letter-spacing: normal;text-align: left;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="margin-bottom: -7px;outline: 0px;display: block;background: url(&quot;https://oscimg.oschina.net/oscnet/97137f2e-9f16-422b-aac0-3a34b7643e27.svg&quot;) 10px 10px / 40px no-repeat rgb(40, 44, 52);height: 30px;width: 657px;border-radius: 5px;"></span><code style="padding: 15px 16px 16px;outline: 0px;overflow-x: auto;color: rgb(171, 178, 191);display: -webkit-box;font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;font-size: 12px;background: rgb(40, 44, 52);border-radius: 5px;"><span style="outline: 0px;line-height: 26px;"><span style="outline: 0px;color: rgb(198, 120, 221);line-height: 26px;">class</span><span style="outline: 0px;color: rgb(230, 192, 123);line-height: 26px;">_AllToAll</span><span style="outline: 0px;line-height: 26px;">(torch.autograd.Function)</span>:</span><br style="outline: 0px;"><br style="outline: 0px;"><span style="outline: 0px;color: rgb(97, 174, 238);line-height: 26px;">    @staticmethod</span><br style="outline: 0px;"><span style="outline: 0px;line-height: 26px;"><span style="outline: 0px;color: rgb(198, 120, 221);line-height: 26px;">def</span><span style="outline: 0px;color: rgb(97, 174, 238);line-height: 26px;">forward</span><span style="outline: 0px;line-height: 26px;">(<br style="outline: 0px;">            ctx: Any,<br style="outline: 0px;"><span style="outline: 0px;color: rgb(92, 99, 112);font-style: italic;line-height: 26px;"># <span style="outline: 0px;color: rgb(198, 120, 221);line-height: 26px;">TODO:</span> replace with DS process group</span><br style="outline: 0px;">            group: torch.distributed.ProcessGroup,<br style="outline: 0px;">            input: Tensor)</span> -&gt; Tensor:</span><span style="outline: 0px;color: rgb(92, 99, 112);font-style: italic;line-height: 26px;"># type: ignore</span><br style="outline: 0px;">        ctx.group = group<br style="outline: 0px;">        input = input.contiguous()<br style="outline: 0px;">        output = torch.empty_like(input)<br style="outline: 0px;">        dist.all_to_all_single(output, input, group=group)<br style="outline: 0px;"><span style="outline: 0px;color: rgb(198, 120, 221);line-height: 26px;">return</span> output<br style="outline: 0px;"><br style="outline: 0px;"><span style="outline: 0px;color: rgb(97, 174, 238);line-height: 26px;">    @staticmethod</span><br style="outline: 0px;"><span style="outline: 0px;line-height: 26px;"><span style="outline: 0px;color: rgb(198, 120, 221);line-height: 26px;">def</span><span style="outline: 0px;color: rgb(97, 174, 238);line-height: 26px;">backward</span><span style="outline: 0px;line-height: 26px;">(ctx: Any, *grad_output: Tensor)</span> -&gt; Tuple[<span style="outline: 0px;color: rgb(198, 120, 221);line-height: 26px;">None</span>, Tensor]:</span><br style="outline: 0px;"><span style="outline: 0px;color: rgb(198, 120, 221);line-height: 26px;">return</span> (<span style="outline: 0px;color: rgb(86, 182, 194);line-height: 26px;">None</span>, _AllToAll.apply(ctx.group, *grad_output))<br style="outline: 0px;"><br style="outline: 0px;"><span style="outline: 0px;line-height: 26px;"><span style="outline: 0px;color: rgb(198, 120, 221);line-height: 26px;">class</span><span style="outline: 0px;color: rgb(230, 192, 123);line-height: 26px;">MOELayer</span><span style="outline: 0px;line-height: 26px;">(Base)</span>:</span><br style="outline: 0px;"><span style="outline: 0px;color: rgb(92, 99, 112);font-style: italic;line-height: 26px;"># ...</span><br style="outline: 0px;"><span style="outline: 0px;line-height: 26px;"><span style="outline: 0px;color: rgb(198, 120, 221);line-height: 26px;">def</span><span style="outline: 0px;color: rgb(97, 174, 238);line-height: 26px;">forward</span><span style="outline: 0px;line-height: 26px;">(self, *input: Tensor, **kwargs: Any)</span> -&gt; Tensor:</span><br style="outline: 0px;"><span style="outline: 0px;color: rgb(92, 99, 112);font-style: italic;line-height: 26px;"># ...</span><br style="outline: 0px;">        dispatched_input = _AllToAll.apply(self.ep_group, dispatched_input)<br style="outline: 0px;"><br style="outline: 0px;"><span style="outline: 0px;color: rgb(92, 99, 112);font-style: italic;line-height: 26px;"># Re-shape after all-to-all: ecm -&gt; gecm</span><br style="outline: 0px;">        dispatched_input = dispatched_input.reshape(self.ep_size, self.num_local_experts, <span style="outline: 0px;color: rgb(209, 154, 102);line-height: 26px;">-1</span>, d_model)<br style="outline: 0px;"><br style="outline: 0px;">        expert_output = self.experts(dispatched_input)<br style="outline: 0px;"><br style="outline: 0px;"><br style="outline: 0px;">        expert_output = _AllToAll.apply(self.ep_group, expert_output)<br style="outline: 0px;"><br style="outline: 0px;"><span style="outline: 0px;color: rgb(92, 99, 112);font-style: italic;line-height: 26px;">#...</span><br style="outline: 0px;"></code></pre><span id="OSC_h2_20"></span><h2 data-tool="mdnice 編輯器" style="margin-top: 30px;margin-bottom: 15px;outline: 0px;font-weight: bold;font-size: 22px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;">4.3 DeepSpeed-MoE</h2><ul data-tool="mdnice 編輯器" class="list-paddingleft-1" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;outline: 0px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;"><li style="outline: 0px;"><section style="margin-top: 5px;margin-bottom: 5px;outline: 0px;line-height: 26px;color: rgb(1, 1, 1);">
     更加工程化的實現可以看 
    <code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">DeepSpeed-MoE</code>的開源方案 
   </section></li><li style="outline: 0px;"><section style="margin-top: 5px;margin-bottom: 5px;outline: 0px;line-height: 26px;color: rgb(1, 1, 1);"><code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">MoE</code>層使用 
    <code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">Expert-Paralallelism</code>做並行&nbsp; 
    <code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">AlltoAll</code>實現如上 
   </section></li><li style="outline: 0px;"><section style="margin-top: 5px;margin-bottom: 5px;outline: 0px;line-height: 26px;color: rgb(1, 1, 1);">
     非 
    <code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">MoE</code>層使用 
    <code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">TP+DP</code></section></li></ul><figure data-tool="mdnice 編輯器" style="margin-top: 10px;margin-bottom: 10px;outline: 0px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img class="rich_pages wxw-img" data-imgfileid="100006758" data-ratio="0.5425925925925926" src="https://oscimg.oschina.net/oscnet/fbcafecf-4739-44ac-94c8-e4c601d87f5f.png" data-type="png" data-w="1080" style="margin-right: auto;margin-left: auto;outline: 0px;display: block;visibility: visible !important;width: 656.99px !important;" referrerpolicy="no-referrer"></figure><span id="OSC_h2_21"></span><h2 data-tool="mdnice 編輯器" style="margin-top: 30px;margin-bottom: 15px;outline: 0px;font-weight: bold;font-size: 22px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;">4.4 LLaMA-MoE</h2><p data-tool="mdnice 編輯器" style="margin-bottom: 0px;padding-top: 8px;padding-bottom: 8px;outline: 0px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;line-height: 26px;"><code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">Mixtral 8x7B</code>訓不動？試試將<code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">LLaMA</code>原<code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">MLP</code>改造成<code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">LLaMA-MoE</code></p><figure data-tool="mdnice 編輯器" style="margin-top: 10px;margin-bottom: 10px;outline: 0px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img class="rich_pages wxw-img" data-imgfileid="100006757" data-ratio="0.5592592592592592" src="https://oscimg.oschina.net/oscnet/39e6e216-e428-4182-b4aa-20a0b6bb3650.png" data-type="png" data-w="1080" style="margin-right: auto;margin-left: auto;outline: 0px;display: block;visibility: visible !important;width: 656.979px !important;" referrerpolicy="no-referrer"></figure><p data-tool="mdnice 編輯器" style="margin-bottom: 0px;padding-top: 8px;padding-bottom: 8px;outline: 0px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;line-height: 26px;">LLaMA-MoE 上關鍵代碼是用<code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">LinearGLUExperts</code>代替原本<code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">LLaMA</code>裏的<code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">SwiGLU</code>層</p><pre data-tool="mdnice 編輯器" style="margin-top: 10px;margin-bottom: 10px;outline: 0px;letter-spacing: normal;text-align: left;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="margin-bottom: -7px;outline: 0px;display: block;background: url(&quot;https://oscimg.oschina.net/oscnet/97137f2e-9f16-422b-aac0-3a34b7643e27.svg&quot;) 10px 10px / 40px no-repeat rgb(40, 44, 52);height: 30px;width: 657px;border-radius: 5px;"></span><code style="padding: 15px 16px 16px;outline: 0px;overflow-x: auto;color: rgb(171, 178, 191);display: -webkit-box;font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;font-size: 12px;background: rgb(40, 44, 52);border-radius: 5px;"> class LinearGLUExperts(nn.Module):<br style="outline: 0px;">    # ...<br style="outline: 0px;">    def __init__(...):<br style="outline: 0px;">        # ... <br style="outline: 0px;">        # 每個專家都創建 SwiGLU MLP 層<br style="outline: 0px;">        for i in range(num_experts):<br style="outline: 0px;">            # this matrix will be transposed when performing linear forwarding<br style="outline: 0px;">            this_expert_weight_gate = nn.Parameter(<br style="outline: 0px;">                torch.empty((size_experts[i], in_features), **factory_kwargs)<br style="outline: 0px;">            )<br style="outline: 0px;">            # this matrix will be transposed when performing linear forwarding<br style="outline: 0px;">            this_expert_weight_up = nn.Parameter(<br style="outline: 0px;">                torch.empty((size_experts[i], in_features), **factory_kwargs)<br style="outline: 0px;">            )<br style="outline: 0px;">            # this matrix will be transposed when performing linear forwarding<br style="outline: 0px;">            this_expert_weight_down = nn.Parameter(<br style="outline: 0px;">                torch.empty((out_features, size_experts[i]), **factory_kwargs)<br style="outline: 0px;">            )<br style="outline: 0px;">            self.weight_gate.append(this_expert_weight_gate)<br style="outline: 0px;">            self.weight_up.append(this_expert_weight_up)<br style="outline: 0px;">            self.weight_down.append(this_expert_weight_down)<br style="outline: 0px;">        # ...<br style="outline: 0px;"></code></pre><h1 data-tool="mdnice 編輯器" style="margin-top: 30px;margin-bottom: 15px;outline: 0px;font-weight: bold;font-size: 24px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;"></h1><span id="OSC_h1_22"></span><h1 data-tool="mdnice 編輯器" style="margin-top: 30px;margin-bottom: 15px;outline: 0px;font-weight: bold;font-size: 24px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;">5. Mixtral 8x7B 總結 &amp; 進一步閲讀</h1><ul data-tool="mdnice 編輯器" class="list-paddingleft-1" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);"><li style="outline: 0px;color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;"><section style="margin-top: 5px;margin-bottom: 5px;outline: 0px;line-height: 26px;color: rgb(1, 1, 1);"><code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">Mixtral 8x7B</code>實現並不複雜，其中 
    <code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">load-balance loss</code>是 
    <code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">expert-wise</code>維度計算的 
   </section></li><li style="outline: 0px;color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;"><section style="margin-top: 5px;margin-bottom: 5px;outline: 0px;line-height: 26px;color: rgb(1, 1, 1);">
     當前發佈的模型還是圍繞模型結構展開的， 期待 
    <code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">mistral.AI</code>上線創新的對齊方案 
   </section></li><li style="outline: 0px;color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;"><section style="margin-top: 5px;margin-bottom: 5px;outline: 0px;line-height: 26px;color: rgb(1, 1, 1);">
     涉及到多機多卡的 
    <code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">sMoE</code>分佈式訓練非常需要工程技巧, 不同的模型架構和集羣可以有多種 
    <code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;outline: 0px;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">DP\TP\EP..</code>組合方案， 
   </section></li><li style="outline: 0px;"><section style="margin-top: 5px;margin-bottom: 5px;outline: 0px;line-height: 26px;"><span style="outline: 0px;color: rgb(1, 1, 1);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;">在·Mixtral·中對於實驗反直覺論點，專家的知識是作用在&nbsp;</span><span style="outline: 0px;color: rgb(30, 107, 184);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;"><span style="outline: 0px;font-size: 14px;background-color: rgba(27, 31, 35, 0.05);">token&nbsp;</span></span><span style="outline: 0px;color: rgb(1, 1, 1);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;"><span style="outline: 0px;font-size: 16px;">級別，而不是<span style="outline: 0px;color: rgb(30, 107, 184);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;font-size: 14px;background-color: rgba(27, 31, 35, 0.05);">domain</span>級別，對&nbsp;<span style="outline: 0px;color: rgb(30, 107, 184);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;font-size: 14px;background-color: rgba(27, 31, 35, 0.05);">MoE&nbsp;</span>感興趣的話可以進一步開盒分析</span></span></section></li></ul><span id="OSC_h2_23"></span><h2 data-tool="mdnice 編輯器" style="margin-top: 30px;margin-bottom: 15px;outline: 0px;font-weight: bold;font-size: 22px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;">Reference</h2><ol data-tool="mdnice 編輯器" class="list-paddingleft-1" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;outline: 0px;letter-spacing: normal;text-align: left;text-wrap: wrap;background-color: rgb(255, 255, 255);color: black;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;"><li style="outline: 0px;"><section style="margin-top: 5px;margin-bottom: 5px;outline: 0px;line-height: 26px;color: rgb(1, 1, 1);">
     Mixture of Experts Explained 
   </section></li><li style="outline: 0px;"><section style="margin-top: 5px;margin-bottom: 5px;outline: 0px;line-height: 26px;color: rgb(1, 1, 1);">
     方佳瑞：MoE 訓練論文解讀之 Megablocks：打破動態路由限制 
   </section></li><li style="outline: 0px;"><section style="margin-top: 5px;margin-bottom: 5px;outline: 0px;line-height: 26px;color: rgb(1, 1, 1);">
     方佳瑞：MoE 訓練系統之 JANUS：參數服務器助力 MoE 訓練 
   </section></li><li style="outline: 0px;"><section style="margin-top: 5px;margin-bottom: 5px;outline: 0px;line-height: 26px;color: rgb(1, 1, 1);">
     方佳瑞：MoE 訓練論文解讀之 Tutel: 動態切換並行策略實現動態路由 
   </section></li><li style="outline: 0px;"><section style="margin-top: 5px;margin-bottom: 5px;outline: 0px;line-height: 26px;color: rgb(1, 1, 1);">
     西門宇少：對 MoE 大模型的訓練和推理做分佈式加速——DeepSpeed-MoE 論文速讀 
   </section></li><li style="outline: 0px;"><section style="margin-top: 5px;margin-bottom: 5px;outline: 0px;line-height: 26px;color: rgb(1, 1, 1);">
     吃果凍不吐果凍皮：大模型分佈式訓練並行技術（八）-MOE 並行 
   </section></li><li style="outline: 0px;"><section style="margin-top: 5px;margin-bottom: 5px;outline: 0px;line-height: 26px;color: rgb(1, 1, 1);">
     孟繁續：Mixtral-8x7B 模型挖坑 
   </section></li><li style="outline: 0px;"><section style="margin-top: 5px;margin-bottom: 5px;outline: 0px;line-height: 26px;color: rgb(1, 1, 1);">
     Mixtral-of-experts 
   </section></li><li style="outline: 0px;"><section style="margin-top: 5px;margin-bottom: 5px;outline: 0px;line-height: 26px;color: rgb(1, 1, 1);">
     Mistral-7B 
   </section></li><li style="outline: 0px;"><section style="margin-top: 5px;margin-bottom: 5px;outline: 0px;line-height: 26px;color: rgb(1, 1, 1);">
     Gshard 
   </section></li><li style="outline: 0px;"><section style="margin-top: 5px;margin-bottom: 5px;outline: 0px;line-height: 26px;color: rgb(1, 1, 1);">
     Switch Transformers 
   </section></li><li style="outline: 0px;"><section style="margin-top: 5px;margin-bottom: 5px;outline: 0px;line-height: 26px;color: rgb(1, 1, 1);">
     sMoE 
   </section></li><li style="outline: 0px;"><section style="margin-top: 5px;margin-bottom: 5px;outline: 0px;line-height: 26px;color: rgb(1, 1, 1);">
     Transformers-Mixtral-of-Experts 
   </section></li><li style="outline: 0px;"><section style="margin-top: 5px;margin-bottom: 5px;outline: 0px;line-height: 26px;color: rgb(1, 1, 1);">
     DeepSpeed-MoE 
   </section></li><li style="outline: 0px;"><section style="margin-top: 5px;margin-bottom: 5px;outline: 0px;line-height: 26px;color: rgb(1, 1, 1);">
     Megablocks 
   </section></li><li style="outline: 0px;"><section style="margin-top: 5px;margin-bottom: 5px;outline: 0px;line-height: 26px;color: rgb(1, 1, 1);">
     LLaMA-MoE 
   </section></li></ol><hr style="border-style: solid;border-width: 1px 0 0;border-color: rgba(0,0,0,0.1);-webkit-transform-origin: 0 0;-webkit-transform: scale(1, 0.5);transform-origin: 0 0;transform: scale(1, 0.5);"><p><span style="outline: 0px;color: rgb(62, 62, 62);font-family: system-ui, -apple-system, &quot;system-ui&quot;, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 14px;letter-spacing: 1px;"><br>本文由 H</span><span style="outline: 0px;color: rgb(62, 62, 62);font-family: system-ui, -apple-system, &quot;system-ui&quot;, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 14px;letter-spacing: 1px;">ugging Face 中文社區內容共建項目提供，稿件由社區成員投稿，經授權發佈於 Hugging Face 公眾號。文章內容不代表官方立場，文中介紹的產品和服務等均不構成投資建議。瞭解更多請關注公眾號:</span><br></p><section class="mp_profile_iframe_wrp"><mp-common-profile class="js_uneditable custom_select_card mp_profile_iframe" data-pluginname="mpprofile" data-id="MzkzNzU4MTU5Nw==" data-headimg="http://mmbiz.qpic.cn/sz_mmbiz_png/kF2wpSFV2cicD6iaT6OicQEZPOnbLvlg4888uRNd3XqaPacRjELDf5EonkxM1eLaautlN2jDcUaClUI0siaH2QlaZA/0?wx_fmt=png" data-nickname="手撕 LLM" data-alias="xiaodonggua_AIGC" data-signature="原創課程 【手撕 LLM+RLHF】" data-from="0" data-is_biz_ban="0"></mp-common-profile></section><p style="outline: 0px;font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);"><span style="outline: 0px;color: rgb(62, 62, 62);font-family: system-ui, -apple-system, &quot;system-ui&quot;, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 14px;letter-spacing: 1px;">如果你有與開源 AI、</span><span style="outline: 0px;color: rgb(62, 62, 62);font-family: system-ui, -apple-system, &quot;system-ui&quot;, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 14px;letter-spacing: 1px;">Hugging Face 相關的技術和實踐分享內容，以及最新的開源 AI 項目發佈，希望通過我們分享給更多 AI 從業者和開發者們，請通過下面的鏈接投稿與我們取得聯繫:</span></p><section style="margin: 8px;outline: 0px;text-wrap: wrap;background-color: rgb(255, 255, 255);letter-spacing: 0.578px;line-height: 1.75em;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, Arial, sans-serif;"><span style="outline: 0px;color: rgb(136, 136, 136);font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 14px;letter-spacing: 1px;">https://hf.link/tougao</span></section><p><br></p><p style="display: none;"><mp-style-type data-value="3"></mp-style-type></p></div><p style="color: #858585; font-size: 13px;">本文分享自微信公眾號 - Hugging Face（gh_504339124f0f）。<br>如有侵權，請聯繫 support@oschina.cn 刪除。<br>本文參與「<a href="https://www.oschina.net/sharing-plan" target="_blank">OSC 源創計劃</a>」，歡迎正在閲讀的你也加入，一起分享。</p></div>
                                    ]]>
            </description>
            <pubDate>Sun, 04 Feb 2024 03:01:22 GMT</pubDate>
            <guid isPermaLink="false">https://my.oschina.net/HuggingFace/blog/11020073</guid>
            <link>https://my.oschina.net/HuggingFace/blog/11020073</link>
            <author>
                <![CDATA[HuggingFace]]>
            </author>
        </item>
        <item>
            <title>
                <![CDATA[歐盟 AI 法案已獲得成員國的一致批准]]>
            </title>
            <description>
                <![CDATA[<div class="content"><p>歐盟《人工智能法案 ( AI Act)》是一項基於風險的監管人工智能應用的計劃。目前，歐盟成員國已經投票就該法律草案的最終文本達成<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fsiliconangle.com%2F2024%2F02%2F02%2Feu-member-states-approve-landmark-ai-regulation%2F" target="_blank">一致</a>，後續將提交歐洲議會表決，這也是新法律正式頒佈的最後一個步驟。</p><p><img height="449" src="https://oscimg.oschina.net/oscnet/up-6bf9f5a6ac55a4844b0cf834eef6c8cbfba.png" width="300" referrerpolicy="no-referrer"></p><p>歐盟行政部門歐盟委員會於 2021 年首次提出該立法。2023 年 12 月，立法者就法律應包括的內容達成了臨時協議。12 月獲得臨時批准的版本要求禁止有害的 AI 能用例，例如工作場所和教育機構中的情緒識別。此外，該草案還包含旨在規範高風險神經網絡（例如保險和銀行部門使用的神經網絡）使用的規則。</p><p>12 月版本的立法將對所謂的 high-impact GPAI（或通用人工智能）模型應用第二套規則。這些附加要求指定開發人員必須檢查其模型是否存在「系統性風險」並緩解他們發現的任何問題。開發人員還必須執行某些其他任務，例如報告神經網絡的能效。</p><p>該法案在 12 月獲得臨時批准後，啓動了長達數週、涉及多個歐盟成員國的談判進程。據 Politico 報道，德國和法國曾暗示，由於擔心該法案對 AI 創新的影響，他們可能會反對該法案。奧地利據説也表達了類似的立場，因為官員們對該法的隱私條款有疑慮。</p><p>為瞭解決這些問題，歐盟委員會針對 AI 領域推出了"一攬子支持創新措施"。還成立了一個名為"Artificial Intelligence Office "的新監管機構，負責實施《人工智能法案》。</p><p>一個由歐盟成員國官員組成的專家組將就實施過程向歐盟委員會提供建議。專家組的工作重點之一將是確保《人工智能法案》與其他法規之間沒有重疊。預計這項工作將特別強調歐盟現有的一些與醫療設備和機械有關的法規。</p><p>該法案將於本月晚些時候在歐洲議會的委員會投票之前進行。如果獲得批准，該法案將進入全體會議投票。大多數參與《人工智能法案》制定的歐洲議會官員預計，該法將在不對當前版本做任何修改的情況下通過。</p><p>一旦獲得通過，該法案將在歐盟官方公報上發佈 20 天后生效。在新規則適用於範圍內的應用程序和人工智能模型之前，將有一個分級實施期——在法規中規定的人工智能禁止使用清單開始適用之前有六個月的寬限期（可能在秋季左右）。</p><p>分階段生效還允許在基礎模型（又稱通用人工智能）適用規則前留出一年時間--因此要等到 2025 年。其餘大部分規則要到法律發佈兩年後才適用。</p></div>
                                    ]]>
            </description>
            <pubDate>Sun, 04 Feb 2024 02:55:22 GMT</pubDate>
            <guid isPermaLink="false">https://www.oschina.net/news/277667/eu-member-states-approve-ai-act</guid>
            <link>https://www.oschina.net/news/277667/eu-member-states-approve-ai-act</link>
            <author>
                <![CDATA[來源: 投稿]]>
            </author>
        </item>
        <item>
            <title>
                <![CDATA[谷歌已從搜索結果頁面刪除「緩存鏈接」]]>
            </title>
            <description>
                <![CDATA[<div class="content"><p>谷歌確認已從搜索結果頁面刪除「緩存鏈接」，並表示將在不久的將來<strong>徹底移除緩存功能</strong>。</p><blockquote><p><img src="https://oscimg.oschina.net/oscnet/up-1db958065a51564516fd6ec5c09f9897ce5.png" referrerpolicy="no-referrer"></p><p><em><u><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Ftwitter.com%2Fsearchliaison%2Fstatus%2F1753156161509916873" target="_blank">https://twitter.com/searchliaison/status/1753156161509916873</a></u></em></p></blockquote><p>目前谷歌搜索結果頁面不會再出現任何緩存鏈接，不過仍可通過在搜索框中輸入搜索運算符<code>cache:</code>來訪問谷歌緩存的快照—— 會自動跳轉到 "https://webcache.googleusercontent.com/search?q=cache:"，如下：</p><blockquote><p><img height="686" src="https://oscimg.oschina.net/oscnet/up-b852cd9166f6ee8b84f49fc8400ce2c03ea.png" width="1244" referrerpolicy="no-referrer"></p><p><img src="https://oscimg.oschina.net/oscnet/up-452fdcf89c884ae3bf8622fa0dc0b9ac519.png" referrerpolicy="no-referrer"></p><p><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fwebcache.googleusercontent.com%2Fsearch%3Fq%3Dcache%3Aoschina.net" target="_blank">https://webcache.googleusercontent.com/search?q=cache:oschina.net</a></p></blockquote><p>谷歌表示，緩存是為了幫助用户訪問頁面加載太慢的網頁，現在這種情況有了很大改善，因此他們決定退役該功能。</p><p>早在 2022 年，百度搜索就下線了同樣的「快照功能」，當時官方的迴應是「由於網頁技術的發展及代際變遷所致」。</p><blockquote><p><img src="https://oscimg.oschina.net/oscnet/up-80d269bfd3fd8c8e81068b9fa3405297dd0.png" referrerpolicy="no-referrer"><em><u><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Ffinance.sina.com.cn%2Ftech%2Finternet%2F2022-08-01%2Fdoc-imizmscv4375142.shtml" target="_blank">https://finance.sina.com.cn/tech/internet/2022-08-01/doc-imizmscv4375142.shtml</a></u></em></p></blockquote></div>
                                    ]]>
            </description>
            <pubDate>Sun, 04 Feb 2024 02:51:00 GMT</pubDate>
            <guid isPermaLink="false">https://www.oschina.net/news/277666</guid>
            <link>https://www.oschina.net/news/277666</link>
            <author>
                <![CDATA[來源: OSCHINA]]>
            </author>
        </item>
        <item>
            <title>
                <![CDATA[飛致雲開源社區月度動態報告（2024 年 1 月）]]>
            </title>
            <description>
                <![CDATA[<div class="content"><div><div><span><span>自 2023 年 6 月起，中國領先的開源軟件公司 FIT2CLOUD 飛致雲以月度為單位發佈《飛致雲開源社區月度動態報告》，旨在向廣大社區用户同步飛致雲旗下系列開源軟件的發展情況，以及當月主要的產品新版本發佈、社區運營成果等相關信息。</span></span></div></div><div><div><strong><span>飛致雲開源大屏（2024 年 1 月）</span></strong></div><div><img alt="" height="734" src="https://oscimg.oschina.net/oscnet/up-28bfa544042627ebd282c6fc43e3d636c52.png" width="1324" referrerpolicy="no-referrer"></div><div>
   ▲圖 1 飛致雲開源大屏（2024.1.31 12:00） 
 </div></div><div><div><span><span>2024 年 1 月飛致雲開源軟件運營數據概覽（統計時間為 2024.1.1～2024.1.31）</span></span></div><div><img alt="" height="602" src="https://oscimg.oschina.net/oscnet/up-d8824acee812525358db28877275c9cf6af.png" width="1400" referrerpolicy="no-referrer"></div></div><div><div><strong><span>2024 年 1 月產品發佈事件</span></strong></div></div><div><div><strong><span>■</span></strong><span><span><span>&nbsp;</span></span></span><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzkyNTI0OTYwOQ%3D%3D%26mid%3D2247485932%26idx%3D1%26sn%3Da31d07d9ded696e6ffdc86e2bb2a8930%26scene%3D21%23wechat_redirect" target="_blank" rel="nofollow"><strong><span>DataEase 開源數據可視化分析工具</span></strong></a></div></div><div><div><span><span>2024 年 1 月 8 日，DataEase 開源數據可視化分析平台正式發佈 v2.2.0 版本。</span></span></div></div><div><div><span><span>這一版本的功能升級包括：在「模板管理」頁面中，用户可以通過模板管理的批量操作功能，對已有模板進行快速重新分類、刪除等維護操作；數據大屏中，支持多個組件構成的分組中某一組件的快速重新定位；儀錶板中的查詢組件支持了設置查詢條件為必填項。此外，DataEase 開源項目組還對其他一些常用的功能進行了功能優化和問題修復。</span></span></div></div><div><div><strong><span>■</span></strong><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzIxOTU1ODQ4NQ%3D%3D%26mid%3D2247484330%26idx%3D1%26sn%3Dada95d0a0893b6400946c3ad6915df96%26scene%3D21%23wechat_redirect" target="_blank" rel="nofollow"><strong><span>1Panel 開源面板</span></strong></a></div></div><div><div><span><span>2024 年 1 月 15 日，現代化、開源的 Linux 服務器運維管理面板 1Panel 正式發佈 v1.9.3 版本。</span></span></div></div><div><div><span><span>在這一版本中，1Panel 新增了 PostgreSQL 數據庫管理功能，並且支持設置 PHP 運行環境擴展模版。此外，1Panel 開源項目組還進行了 30 多項功能更新和問題修復。1Panel 應用商店新增了 3 款應用，並且更新了 22 款應用。</span></span></div></div><div><div><strong><span>■<span>&nbsp;</span></span></strong><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzg4MzkwMjM5MQ%3D%3D%26mid%3D2247485612%26idx%3D1%26sn%3Dc4f3669a65417a419a80ec9e05656efc%26scene%3D21%23wechat_redirect" target="_blank" rel="nofollow"><strong><span>JumpServer 開源堡壘機</span></strong></a></div></div><div><div><span><span>2024 年 1 月 22 日，JumpServer 開源堡壘機正式發佈 v3.10.2 LTS 版本。JumpServer 開源項目組將對 v3.10 LTS 版本提供長期的支持和維護，並定期迭代發佈小版本。歡迎廣大社區用户升級至 v3.10 LTS 版本，以獲得更佳的使用體驗。</span></span></div></div><div><div><span><span>在 v3.10.2 LTS 版本中，JumpServer 的郵件服務功能新增支持 Exchange 協議。目前 JumpServer 所支持的郵件協議包括 SMTP 協議（即簡單郵件傳輸協議）和 Exchange 協議，為用户提供了更多的選擇。同時，LDAP（即輕量目錄訪問協議）定時同步用户功能支持設置消息收件人，定時同步用户任務完成後，系統會自動發送消息通知給收件人。另外，資產歷史賬號也支持設置保留數量，以滿足用户的更多安全需求</span></span></div></div><div><div><span><span>X-Pack 增強包方面，JumpServer 的 SQL Server 數據庫連接支持命令審計，用户通過 Magnus 代理連接 SQL Server 數據庫時，進行 CURD 操作會進行命令審計記錄。</span></span></div></div><div><div><strong><span>■ MeterSphere 開源持續測試平台</span></strong></div></div><div><div><span><span>2024 年 1 月 25 日，MeterSphere 開源持續測試平台發佈 v2.10.11 LTS 版本。</span></span></div></div><div><div><span><span>在這一版本中，性能測試方面，性能測試的高級配置增加選項，報告採樣支持顯示接口返回數據類型為圖片，下載 zip 文件時支持使用流下載；測試跟蹤方面，修改場景測試轉性能測試時部分 CSV 文件無法解析的問題，採用批量處理的方式自動清理報告數據，增加服務啓動項，對刪除失敗的資源報告進行刪除。此外，MeterSphere 項目組還進行了 14 項漏洞修復工作。</span></span></div></div><div><div><strong><span>其他重要事件</span></strong></div></div><div><div><strong><span>■</span></strong><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzI4OTA1NzQ1OQ%3D%3D%26mid%3D2649624563%26idx%3D1%26sn%3D1d2576847bce8dccb2a3ffa5123fd231%26scene%3D21%23wechat_redirect" target="_blank" rel="nofollow"><strong><span><span>&nbsp;</span>飛致雲旗下開源項目 GitHub Star 數量突破 100,000 個！</span></strong></a></div></div><div><div><span><span>2024 年 1 月 19 日，中國領先的開源軟件提供商 FIT2CLOUD 飛致雲宣佈，其旗下開源項目在代碼託管平台 GitHub 上所獲得的 Star 數量已經超過 100,000 個。與此同時，飛致雲旗下開源項目的月度新增軟件下載次數也超過 100,000 次。</span></span></div><div><img alt="" height="720" src="https://oscimg.oschina.net/oscnet/up-813fe7e32e429dcf3dd7fbec5c220afa93d.jpg" width="1280" referrerpolicy="no-referrer"></div><div>
   ▲圖 2 飛致雲旗下開源項目 GitHub Star 數量突破 100,000 個 
 </div></div><div><div><span><span>在創新與併購的雙輪驅動下，飛致雲以「為數字經濟時代創造好軟件」為使命的開源生態體系不斷髮展壯大。目前，飛致雲旗下開源項目的貢獻者超過 1,700 位，有超過 7,000 位社區用户提交 Issue，Fork 總數量超過 24,000 次，PR（(Pull Request）數量超過 43,000 次。另據不完全統計，飛致雲開源社區交流總人數已經超過 30,000 人。</span></span></div></div><div><div><strong><span>■</span></strong><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzg5Mjg3NTQ1Ng%3D%3D%26mid%3D2247485254%26idx%3D1%26sn%3Dfe5bba30cc4d9ca1d7009b51e3da70f3%26scene%3D21%23wechat_redirect" target="_blank" rel="nofollow"><strong><span><span>&nbsp;</span>Halo Maintainer 2023 年度榜單發佈</span></strong></a></div></div><div><div><span><span>2024 年 1 月 24 日，Halo 開源項目組為了感謝 245 位開發者的慷慨付出，特別發佈「Halo Maintainer 2023 年度榜單」，以表彰為 Halo 項目做出突出貢獻的開發者們</span></span></div></div><div><div><strong><span>■<span>&nbsp;</span></span></strong><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzIxOTU1ODQ4NQ%3D%3D%26mid%3D2247484339%26idx%3D1%26sn%3D92241cdb3029010995e575b4bcb94a98%26scene%3D21%23wechat_redirect" target="_blank" rel="nofollow"><strong><span>1Panel 開源面板項目 GitHub Star 數量突破 15,000！</span></strong></a></div></div><div><div><span><span>截至 2024 年 1 月 24 日 14:00，1Panel 開源 Linux 服務器運維管理面板項目 GitHub Star 數超過 15,000 個。</span></span></div></div><div><div><strong><span>■</span></strong><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzIxOTU1ODQ4NQ%3D%3D%26mid%3D2247484345%26idx%3D1%26sn%3Dc9cbfd07aaca2d077d184b688d53bbcf%26scene%3D21%23wechat_redirect" target="_blank" rel="nofollow"><strong><span><span>&nbsp;</span>1Panel 開源面板項目致敬社區開發者</span></strong></a></div></div><div><div><span><span>2024 年 1 月 26 日，1Panel 開源項目組發佈 61 位社區開發者名單，感謝他們在過去的 10 個月為 1Panel 開源項目所做出的傑出貢獻。</span></span></div></div><div><div><strong><span>關於飛致雲開源大屏</span></strong></div></div><div><div><span><span>飛致雲開源大屏（</span></span><em><span>https://bi.fit2cloud.com/link/6CgpMHrT</span></em><span><span>）是 FIT2CLOUD 飛致雲為展示其旗下開源軟件的社區運營情況製作的數據儀錶板。該大屏使用 DataEase 開源數據可視化分析平台製作，實時呈現飛致雲開源社區近 30 日內的動態信息。<span>&nbsp;</span></span></span></div></div><div><div><span><span>廣大社區用户可以通過該大屏瞭解飛致雲旗下開源項目的 GitHub Star、Fork、Issue、貢獻者等指標的數量信息，以及近 30 日內新增的 Star、Fork、下載、Issue、PR 數量等，同時該大屏還展示了飛致雲旗下開源項目的 Issue 趨勢、Commit 趨勢、PR 趨勢、Issue 生命週期等。</span></span></div></div><div><div><span><span>除了展示所有項目的彙總信息外，該大屏還支持用户分類別查看 JumpServer、DataEase、MeterSphere、Halo、1Panel、CloudExplorer Lite 六個開源項目的獨立運營數據。</span></span></div></div><div>
  &nbsp; 
</div><p>&nbsp;</p></div>
                                    ]]>
            </description>
            <pubDate>Sun, 04 Feb 2024 01:55:00 GMT</pubDate>
            <guid isPermaLink="false">https://my.oschina.net/u/4736111/blog/10997723</guid>
            <link>https://my.oschina.net/u/4736111/blog/10997723</link>
            <author>
                <![CDATA[原創]]>
            </author>
        </item>
        <item>
            <title>
                <![CDATA[OpenAI 推出 Vision Pro 版 ChatGPT]]>
            </title>
            <description>
                <![CDATA[<div class="content"><p>OpenAI <u><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Ftwitter.com%2FChatGPTapp%2Fstatus%2F1753480988569866332" target="_blank">宣佈</a></u>推出可在 Vision Pro 上運行的 ChatGPT，現已在&nbsp;<span>visionOS App Store 上架。</span></p><p><img src="https://oscimg.oschina.net/oscnet/up-8a4aed40a73de4363dfa0fca1453aba4efa.png" referrerpolicy="no-referrer"></p><p><u><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fventurebeat.com%2Fai%2Fopenai-launches-chatgpt-app-for-apple-vision-pro%2F" target="_blank">據 VentureBeat 報道</a></u>，蘋果 Vision Pro 上的 ChatGPT 由 OpenAI 最新的大型語言模型（LLM）GPT 4 Turbo 支持。</p><p>2 月 2 日，蘋果 Vision Pro 頭顯今日正式在美國開售，該產品有 256GB、512GB、1TB 三種存儲容量供選擇。蘋果公司稱，Vision Pro 發佈時將提供 600 個新應用和遊戲，ChatGPT 就是其中之一。這款混合現實頭顯還支持 iPad 上的 100 多萬個應用程序。</p><p><img alt="" src="https://oscimg.oschina.net/oscnet/up-1fffde79e15f258deab1180745435097ce9.png" referrerpolicy="no-referrer"></p><p><img alt="" src="https://oscimg.oschina.net/oscnet/up-d001be7f7613037ebb5b017f03c1317af73.png" referrerpolicy="no-referrer"></p><p><img alt="" src="https://oscimg.oschina.net/oscnet/up-bf210a7f1224575a21c9188df7ae0b97e72.png" referrerpolicy="no-referrer"></p></div>
                                    ]]>
            </description>
            <pubDate>Sun, 04 Feb 2024 01:48:00 GMT</pubDate>
            <guid isPermaLink="false">https://www.oschina.net/news/277654/chatgpt-app-for-apple-vision-pro</guid>
            <link>https://www.oschina.net/news/277654/chatgpt-app-for-apple-vision-pro</link>
            <author>
                <![CDATA[來源: 投稿]]>
            </author>
        </item>
        <item>
            <title>
                <![CDATA[Zig 編程語言 2024 年全新路線圖發佈]]>
            </title>
            <description>
                <![CDATA[<div class="content"><p>在最新的一次專訪中，Zig 編程語言的創始人 Andrew Kelley 詳細介紹了 Zig 即將發佈的版本和未來規劃的精彩亮點。這次更新着眼於解決關鍵的第三方項目問題、修復 bug、提升編譯器性能以及實施增量編譯的戰略。同時，Andrew 還分享了關於為 Zig 軟件基金會（ZSF）籌集資金和實現 1.0 版本目標的寶貴信息。</p><p><strong>即將到來的版本：專注於質量而非時間</strong></p><p>Zig 團隊採取了一種獨特的方法來推進即將發佈的版本，即專注於完成具體任務而不是遵循嚴格的時間表。這一策略允許開發人員專注於交付核心特性，而不是急於發佈。通過 Zig 的 GitHub 頁面上的「Milestones」標籤，社區成員可以跟蹤進展，並將他們的項目添加到重要的第三方項目列表中，確保了廣泛的兼容性和支持。</p><p><strong>提升性能與用户體驗</strong></p><p>隨着發佈後的焦點轉向解決 bug 和提高編譯器性能，Zig 面臨着解決超過 1,200 個已報告 bug 的挑戰。減少編譯時間成為提高效率的關鍵，旨在使開發者能夠更快地測試和編輯代碼。此外，Andrew 強調了增量編譯在 Zig 未來發展中的核心作用，這一特性儘管目前還未實施，但預計將為遊戲開發、終端應用、JavaScript 引擎和數據庫等資源密集型應用帶來顯著的生產力提升。</p><p><strong>解決異步編程與工具支持挑戰</strong></p><p>在討論到 Zig 的異步功能和工具支持時，Andrew 坦承雖然異步編程具有巨大吸引力，但將其融入 Zig 需要克服多項技術障礙，如自定義代碼生成後端和調試工具的開發。他也提到，儘管 Zig 的部分工具，如語言服務器和文檔生成器，已經相當健壯，但仍有其他領域需要進一步發展。團隊對持續改進持開放態度，並鼓勵社區貢獻。</p><p><strong>資助 Zig 軟件基金會（ZSF）</strong></p><p>為了加速 Zig 的發展並實現 1.0 版本目標，Andrew 討論了 ZSF 面臨的資金挑戰，指出個人捐贈目前僅佔總收入的三分之一。增加來自個人和組織的資金支持將極大助力 ZSF 僱傭更多承包商，從而加快開發進程。</p><p><strong>朝向 1.0 版本邁進</strong></p><p>Zig 正致力於幾個關鍵目標以實現 1.0 版本，包括提升編譯器性能、調整語言以適應編譯器優化，以及增強標準庫。Andrew 強調，即使在達到 1.0 版本之前，使用 Zig 也能幫助早期識別和解決問題，他建議在源代碼中引入版本聲明以支持不同版本的平滑過渡。</p><p>通過這一系列措施和計劃，Zig 展現了其對開發者社區的承諾和對編程語言未來的雄心壯志。隨着 Zig 不斷髮展和改進，它有望為編程社區帶來更多的創新和便利。</p></div>
                                    ]]>
            </description>
            <pubDate>Sun, 04 Feb 2024 01:18:00 GMT</pubDate>
            <guid isPermaLink="false">https://www.oschina.net/news/277651/zig-roadmap-2024</guid>
            <link>https://www.oschina.net/news/277651/zig-roadmap-2024</link>
            <author>
                <![CDATA[來源: 投稿]]>
            </author>
        </item>
        <item>
            <title>
                <![CDATA[10 年前的今天 —— Vue.js 正式問世]]>
            </title>
            <description>
                <![CDATA[<div class="content"><p>Vue 官方推特賬號的最新動態<u><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Ftwitter.com%2Fvuejs%2Fstatus%2F1753678155444101385" target="_blank">寫道</a></u>：</p><blockquote><p>10 年前的今天（2014 年 2 月 3 日），Vue 在 Hacker News 上首次對外亮相：<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fnews.ycombinator.com%2Fitem%3Fid%3D7169288" target="_blank">news.ycombinator.com/item?id=7169288</a></p><p>10 年後，Vue 已成為使用最廣泛的前端項目之一，在世界各地擁有多元化的社區。</p><p><img src="https://oscimg.oschina.net/oscnet/up-75ad5ac6e8149ffa4d18fee49546a79cd6a.png" referrerpolicy="no-referrer"></p></blockquote><p>Vue.js 是由尤雨溪獨立開發的開源前端框架，目前由他和其他活躍的核心團隊成員維護。</p><p>在谷歌的 Creative Lab 就職期間，尤雨溪接觸到 Google 團隊開發的 Web 前端框架「Angular」，他對 Angular 可通過數據綁定來處理網頁 DOM 的運作方式很感興趣，並想以此為基礎開發出一個功能相似，但更輕量的框架。</p><p>後來，尤雨溪將所開發出的框架命名為「Vue.js」，並在 2014 年 2 月正式對外公佈，宣稱讓「<strong>Java MVVM 變得更簡單</strong>」。</p><p><img src="https://oscimg.oschina.net/oscnet/up-581bff0bf554afab956437fa62cb1777d18.png" referrerpolicy="no-referrer"><em><u><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fnews.ycombinator.com%2Fitem%3Fid%3D7169288" target="_blank">https://news.ycombinator.com/item?id=7169288</a></u></em></p><p>在與開發者的互動交流中，尤雨溪認真解答了 Vue.js 和 Angular 在技術架構設計方面的不同之處。為了保證框架儘可能輕量，Vue.js 捨棄了依賴注入、預編譯 JSX 等特性。</p><p><img src="https://oscimg.oschina.net/oscnet/up-fafe1a062037bfc8b7e2738cefe3da01c61.png" referrerpolicy="no-referrer"></p><p>根據尤雨溪在 Vue.js 正式對外發布一週後的<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fblog.evanyou.me%2F2014%2F02%2F11%2Ffirst-week-of-launching-an-oss-project%2F" target="_blank">覆盤數據</a>，他最開始在 Hacke rNews、EchoJS 和 Reddit 子版塊<span>/r/javascript 這三個網站宣佈了 Vue.js。</span>一天之內，Vue.js 火速佔據它們榜首。</p></div>
                                    ]]>
            </description>
            <pubDate>Sat, 03 Feb 2024 08:53:49 GMT</pubDate>
            <guid isPermaLink="false">https://www.oschina.net/news/277597/vuejs-10yr</guid>
            <link>https://www.oschina.net/news/277597/vuejs-10yr</link>
            <author>
                <![CDATA[來源: OSCHINA]]>
            </author>
        </item>
        <item>
            <title>
                <![CDATA[開源日報：中國首個腦機接口開源軟件平台；謹慎升級 VS Code]]>
            </title>
            <description>
                <![CDATA[<div class="content"><p>歡迎閲讀 OSCHINA 編輯部出品的開源日報，每天更新一期。</p><p><strong># 2024.2.2</strong></p><h2><span><span><span style="color:#000000"><span><span><span style="color:#00b050">今日要點</span></span></span></span></span></span></h2><p style="text-align:justify"><strong>OpenSource Daily</strong></p><h3><u><a href="https://www.oschina.net/news/277399" target="_blank">天津大學發佈中國首個腦機接口開源軟件平台 MetaBCI 研究成果</a></u></h3><p style="color:#333333; margin-left:0; margin-right:0; text-align:left">近日，天津大學神經工程團隊在數學與計算生物學領域 SCI 一區 TOP 期刊《Computers in Biology and Medicine》上發表論文，介紹了中國首個腦機接口開源軟件平台 MetaBCI 的技術架構與實現方法。</p><p style="color:#333333; margin-left:0; margin-right:0; text-align:left">MetaBCI 由離線分析模塊 Brainda、刺激呈現模塊 Brainstim 和在線數據流模塊 Brainflow 三大部分構成，提供了面向 BCI 軟件層面全鏈條開發的解決方案。</p><ul style="list-style-type:disc; margin-left:0; margin-right:0"><li>面向離線分析需求，Brainda 統一了現有公開數據集接口，優化了腦電數據讀取、處理流程，復現多種主要 BCI 數據分析及解碼算法，以此提高研究者的算法開發效率；</li><li>面向刺激呈現需求，Brainstim 提供了簡潔高效的範式設計模塊，可快速創建腦機接口範式刺激界面；</li><li>面向在線開發需求，Brainflow 利用雙線程、雙進程編程方法實現了實時高速的數據讀取、數據處理、結果反饋等功能，幫助開發者輕鬆搭建腦機接口在線實驗系統。</li></ul><p style="color:#333333; margin-left:0; margin-right:0; text-align:left"><img src="https://oscimg.oschina.net/oscnet/up-8f4d4e3e7fbcc8a74be3635f43436fba05b.png" referrerpolicy="no-referrer"></p><h3><u><a href="https://www.oschina.net/news/277439/vscode-1-86-drops-ubuntu-18-04" target="_blank">VS Code 1.86 會導致遠程開發功能無法使用</a></u></h3><p style="color:#333333; margin-left:0; margin-right:0; text-align:left">Visual Studio Code 今日發佈的最新版<span>&nbsp;</span><u><a href="https://www.oschina.net/news/277414/vs-code-1-86-released">1.86</a></u><span>&nbsp;引入一項嚴重的破壞性變化，其</span>遠程開發服務器工具鏈<span>最低環境要求的&nbsp;</span>glibc 版本提升為 2.28。</p><p style="color:#333333; margin-left:0; margin-right:0; text-align:left">由於&nbsp;Ubuntu 18.04 LTS 使用 glibc 2.27，因此有開發者發現自己升級到 VS Code 新版本後，使用 Remote SSH 無法連接到遠程機器。</p><blockquote><p style="margin-left:0; margin-right:0"><img src="https://oscimg.oschina.net/oscnet/up-7159057b7f201b731192ad420804af1891b.png" referrerpolicy="no-referrer"></p><p style="margin-left:0; margin-right:0"><u><em><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fv2ex.com%2Ft%2F1013590" target="_blank">https://v2ex.com/t/1013590</a></em></u></p></blockquote><p style="color:#333333; margin-left:0; margin-right:0; text-align:left">對於該問題，目前的解決方案有兩種：</p><ul style="list-style-type:disc; margin-left:0; margin-right:0"><li><strong>根據對應的發行版，升級至 Ubuntu 20.04 LTS、Debian 10 或 RHEL 8</strong></li><li><strong>降級到 VS Code 1.85</strong></li></ul><h3><u><a href="https://www.oschina.net/news/277402/allenai-olmo-truly-open-llm" target="_blank">AI2 開源新 LLM，重新定義 open AI</a></u></h3><p style="color:#333333; margin-left:0; margin-right:0; text-align:left"><span style="color:#000000">艾倫人工智能研究所（Allen Institute for AI，簡稱 AI2）<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fblog.allenai.org%2Fhello-olmo-a-truly-open-llm-43f7e7359222" target="_blank">宣佈</a>推出一個名為 OLMo 7B 的新大語言模型，並開源發佈了預訓練數據和訓練代碼。OLMo 7B 被描述為 「一個真正開放的、最先進的大型語言模型」。</span></p><p style="color:#333333; margin-left:0; margin-right:0; text-align:left"><span style="color:#000000">AI2 是由已故的微軟公司聯合創始人保羅 - 艾倫（Paul Allen）於 2014 年在西雅圖創辦的一家非營利組織。該組織表示，他們開源 OLMo 模型旨在讓 AI 研究社區充分了解最先進的大語言模型（LLM），從而推動自然語言處理的發展，並以科學的方式正視現有 LLM 存在的問題。</span></p><p><img src="https://oscimg.oschina.net/oscnet/up-5f4ac19f48b404e2adf9eed484a4a22035d.png" referrerpolicy="no-referrer"></p><hr><h2><strong><span><span><span style="color:#000000"><span><span><span style="color:#00b050">今日推薦</span></span></span></span></span></span></strong></h2><p><img src="https://oscimg.oschina.net/oscnet/up-4caec6d25c5413f5ea4275653e65a5444dd.png" referrerpolicy="no-referrer"></p><hr><h2><strong><span><span><span style="color:#000000"><span><span><span style="color:#00b050">媒體觀點</span></span></span></span></span></span></strong></h2><p><img src="https://oscimg.oschina.net/oscnet/up-90cadeca4d271edb7a2ad700c6263fdc51d.png" referrerpolicy="no-referrer"></p><hr><h2><strong><span><span><span style="color:#000000"><span><span><span style="color:#00b050">每日項目榜</span></span></span></span></span></span></strong></h2><p>GitHub 榜單：</p><p><img alt="" src="https://oscimg.oschina.net/oscnet/up-b98d9200d2d848543db7dae28c134e95c33.png" referrerpolicy="no-referrer"><img alt="" src="https://oscimg.oschina.net/oscnet/up-5292ae0f6e0cd094f67afe814ba672e45a7.png" referrerpolicy="no-referrer"></p><blockquote><h4><span style="background-color:#e67e22">在線閲讀完整日報內容，訪問：</span><u><a href="https://oscimg.oschina.net/public_shard/%E5%BC%80%E6%BA%90%E6%97%A5%E6%8A%A5%E7%AC%AC008%E6%9C%9F%EF%BC%9A%E6%8E%A8%E5%8A%A8%E4%B8%AD%E5%9B%BD%E5%BC%80%E6%BA%90%E8%BD%AF%E7%A1%AC%E4%BB%B6%E5%8F%91%E5%B1%95%E7%9A%84%E7%BB%8F%E9%AA%8C%E4%B8%8E%E5%BB%BA%E8%AE%AE.pdf" target="_blank"><span style="background-color:#e67e22">開源日報第 008 期：推動中國開源軟硬件發展的經驗與建議</span></a></u></h4></blockquote><hr><p><strong>往期回顧</strong></p><ul><li><u><a href="https://oscimg.oschina.net/public_shard/%E5%BC%80%E6%BA%90%E6%97%A5%E6%8A%A5%E7%AC%AC007%E6%9C%9F.pdf">開源日報第 007 期：「Linux 中國」 開源社區宣佈停止運營</a></u></li><li><u><a href="https://oscimg.oschina.net/public_shard/%E5%BC%80%E6%BA%90%E6%97%A5%E6%8A%A5%E7%AC%AC006%E6%9C%9F%EF%BC%9A%E9%80%89%E6%8B%A9%E6%8A%80%E6%9C%AF%E6%A0%88%E4%B8%80%E5%AE%9A%E8%A6%81%E9%80%89%E6%8B%A9%E5%BC%80%E6%BA%90%E7%9A%84.pdf" target="_blank">開源日報第 006 期：選擇技術棧一定要選擇開源的</a></u></li><li><a href="http://www.oschina.net/news/277040"><u>開源日報第 005 期：RISC-V 萬兆開源交換機發售；npm 存在大量武林外傳視頻</u></a></li><li><u><a href="https://www.oschina.net/news/276864" target="news">開源日報第 004 期：百度輸入法在候選詞區域植入廣告；大神用 Excel 構建 CPU</a></u></li></ul></div>
                                    ]]>
            </description>
            <pubDate>Sat, 03 Feb 2024 06:36:00 GMT</pubDate>
            <guid isPermaLink="false">https://www.oschina.net/news/277585</guid>
            <link>https://www.oschina.net/news/277585</link>
            <author>
                <![CDATA[來源: OSCHINA]]>
            </author>
        </item>
        <item>
            <title>
                <![CDATA[FastGateway：一個可以用於代替 Nginx 的網關]]>
            </title>
            <description>
                <![CDATA[<div class="content"><p>在我本人研究 Yarp 的時候經常用於公司項目的業務網關代理，這時候就個大佬問我是否可以實現動態加載 HTTPS 證書？那時候我説不太可能實現，然而在某一天我看到</p><p>微軟使用 Yarp 代替了 Nginx 吞吐量提升了百分之八十！</p><p><img height="2340" src="https://oscimg.oschina.net/oscnet/up-9b031c83a55889ff53d2b4981411def100f.png" width="1080" referrerpolicy="no-referrer"></p><p>這個時候我就萌生了自己使用 yarp 造一個 Gateway 的項目，應為我本身也經常使用 nginx 作為網關，但是 nginx 的使用總得寫 conf，然後重啓我的 nginx，並且還需要配置證書重啓，我就在想是否可以實現界面管理，並且完全動態管理？</p><p>然後我們的 FastGateway 項目就誕生了，下面我們介紹一下我們的 FastGateway 的項目簡單案例</p><p>## FastGateway</p><p>我們的 FastGateway 提供了倆個容器，一個是代理服務，一個是前端服務</p><p>一般簡單使用就可以直接使用我們的 docker-compose 構建，非常簡單</p><p>FastGateway 支持哪些功能？</p><ul><li><span>&nbsp;</span>登錄授權&nbsp; 
  <ul><li>通過環境變量簡單設置賬號密碼</li></ul></li><li><span>&nbsp;</span>動態路由管理 
  <ul><li>完全界面操作並且實時更新</li></ul></li><li><span>&nbsp;</span>動態配置證書管理 
  <ul><li>完全界面操作並且實時更新</li></ul></li><li><span>&nbsp;</span>dashboard 監控 
  <ul><li>提供了簡單數據監控，後續還會提供更完善的功能</li></ul></li><li><span>&nbsp;</span>靜態文件服務代理 
  <ul><li>使用中間件簡單實現了靜態文件代理（Yarp 默認是不支持靜態文件代理）</li></ul></li><li><span>&nbsp;</span>穿透隧道功能 
  <ul><li>只需要提供一個公網的 Gateway 服務端，然後下載我們的 Gateway 的客户端就可以將客户端的局域網的服務映射到外網（只支持 http 協議的服務）</li></ul></li><li><span>&nbsp;</span>出入口流量監控 
  <ul><li>基於 Kestrel 實現出入口流量監控，還提供當前服務器的所有網卡的出入流量實時監控</li></ul></li></ul><h2>技術棧</h2><h3>後端技術棧</h3><ul><li>Asp.Net 8.0 用於提供基礎服務</li><li>Yarp 用於提供反向代理服務</li><li>FreeSql 用於提供數據庫服務</li><li>JWT 用於提供登錄授權服務</li><li>MiniApis 提供 WebApi 服務</li></ul><h3>前端技術棧</h3><ul><li>reset-css 用於重置瀏覽器默認樣式</li><li>axios 用於發送 http 請求</li><li>semi 用於提供基礎組件</li><li>react-router-dom 用於路由管理</li></ul><h2>鏡像執行指令</h2><div><div><pre><span><span style="color:#0086b3">mkdir </span>data</span><span>docker run <span style="color:#ffcc55">-d</span><span style="color:#ffcc55">--restart</span> always <span style="color:#ffcc55">--name</span> gateway-api <span style="color:#ffcc55">-p</span> 8000:8000 <span style="color:#ffcc55">-p</span> 8200:8080 <span style="color:#ffcc55">-p</span> 8300:8081 <span style="color:#ffcc55">-v</span><span style="color:orange">$(</span><span style="color:#0086b3">pwd</span><span style="color:orange">)</span>/data:/data/ registry.cn-shenzhen.aliyuncs.com/tokengo/gateway-api</span><span>docker run <span style="color:#ffcc55">-d</span><span style="color:#ffcc55">--restart</span> always <span style="color:#ffcc55">--privileged</span><span style="color:#ffcc55">--name</span> gateway-web <span style="color:#ffcc55">-p</span> 10800:80 <span style="color:#ffcc55">-e</span><span style="color:#ffaa44">api_url</span><span>=</span>http://localhost:8000 registry.cn-shenzhen.aliyuncs.com/tokengo/gateway-web</span></pre><div>
   &nbsp;
  </div></div></div><h2>Docker-Compose 文件</h2><div><div><pre><span><span style="color:#008080">services</span><span>:</span></span><span><span style="color:#008080">gateway-api</span><span>:</span></span><span><span style="color:#008080">image</span><span>:</span><span style="background-color:transparent; color:#00aadd">registry.cn-shenzhen.aliyuncs.com/tokengo/gateway-api</span></span><span><span style="color:#008080">restart</span><span>:</span><span style="background-color:transparent; color:#00aadd">always</span></span><span><span style="color:#008080">container_name</span><span>:</span><span style="background-color:transparent; color:#00aadd">gateway-api</span></span><span><span style="color:#008080">environment</span><span>:</span></span><span><span style="color:#008080">USER</span><span>:</span><span style="background-color:transparent; color:#00aadd">root</span></span><span><span style="color:#008080">PASS</span><span>:</span><span style="background-color:transparent; color:#00aadd">Aa010426.</span></span><span><span style="color:#008080">ports</span><span>:</span></span><span><span>-</span><span style="background-color:transparent; color:#00aadd">8000:8000</span><span style="color:#888888"># 提供給 web 端調用的管理接口</span></span><span><span>-</span><span style="background-color:transparent; color:#00aadd">8200:8080</span><span style="color:#888888"># Http 代理端口</span></span><span><span>-</span><span style="background-color:transparent; color:#00aadd">8300:8081</span><span style="color:#888888"># Https 代理端口</span></span><span><span style="color:#008080">volumes</span><span>:</span></span><span><span>-</span><span style="background-color:transparent; color:#00aadd">./data:/data/</span><span style="color:#888888"># 請注意手動創建 data 目錄，負責在 Linux 下可能出現權限問題導致無法寫入</span></span><span><span style="color:#008080">gateway-web</span><span>:</span></span><span><span style="color:#008080">image</span><span>:</span><span style="background-color:transparent; color:#00aadd">registry.cn-shenzhen.aliyuncs.com/tokengo/gateway-web</span></span><span><span style="color:#008080">restart</span><span>:</span><span style="background-color:transparent; color:#00aadd">always</span></span><span><span style="color:#008080">build</span><span>:</span></span><span><span style="color:#008080">context</span><span>:</span><span style="background-color:transparent; color:#00aadd">../web</span></span><span><span style="color:#008080">dockerfile</span><span>:</span><span style="background-color:transparent; color:#00aadd">Dockerfile</span></span><span><span style="color:#008080">privileged</span><span>:</span><span style="color:turquoise">true</span></span><span><span style="color:#008080">environment</span><span>:</span></span><span><span style="color:#008080">api_url</span><span>:</span><span style="background-color:transparent; color:#00aadd">http://localhost:8000</span></span><span><span style="color:#008080">ports</span><span>:</span></span><span><span>-</span><span style="background-color:transparent; color:#00aadd">10800:80</span></span></pre><div>
   &nbsp;
  </div></div></div><p style="color:#40485b; margin-left:0; margin-right:0; text-align:left">如果並沒有提供賬號密碼則默認</p><p style="color:#40485b; margin-left:0; margin-right:0; text-align:left">賬號：root</p><p style="color:#40485b; margin-left:0; margin-right:0; text-align:left">密碼：Aa010426.</p><h2>替換默認的 https 證書</h2><p style="color:#40485b; margin-left:0; margin-right:0; text-align:left">由於需要使用 https，為了方便系統默認提供了一個 pfx 證書，如果你需要提供的話可以按照以下操作進行，如果是 Docker 執行的話證書的目錄則是<span>&nbsp;</span><code>/app/certificates/gateway.pfx</code></p><div><div><pre><span><span style="color:#008080">services</span><span>:</span></span><span><span style="color:#008080">gateway-api</span><span>:</span></span><span><span style="color:#008080">image</span><span>:</span><span style="background-color:transparent; color:#00aadd">registry.cn-shenzhen.aliyuncs.com/tokengo/gateway-api</span></span><span><span style="color:#008080">restart</span><span>:</span><span style="background-color:transparent; color:#00aadd">always</span></span><span><span style="color:#008080">container_name</span><span>:</span><span style="background-color:transparent; color:#00aadd">gateway-api</span></span><span><span style="color:#008080">ports</span><span>:</span></span><span><span>-</span><span style="background-color:transparent; color:#00aadd">8000:8000</span><span style="color:#888888"># 提供給 web 端調用的管理接口</span></span><span><span>-</span><span style="background-color:transparent; color:#00aadd">8200:8080</span><span style="color:#888888"># Http 代理端口</span></span><span><span>-</span><span style="background-color:transparent; color:#00aadd">8300:8081</span><span style="color:#888888"># Https 代理端口</span></span><span><span style="color:#008080">environment</span><span>:</span></span><span><span style="color:#008080">USER</span><span>:</span><span style="background-color:transparent; color:#00aadd">root</span></span><span><span style="color:#008080">PASS</span><span>:</span><span style="background-color:transparent; color:#00aadd">Aa010426.</span></span><span><span style="color:#008080">HTTPS_PASSWORD</span><span>:</span><span style="background-color:transparent; color:#00aadd">dd666666</span></span><span><span style="color:#008080">HTTPS_FILE</span><span>:</span><span style="background-color:transparent; color:#00aadd">gateway.pfx</span></span><span><span style="color:#008080">ports</span><span>:</span></span><span><span>-</span><span style="background-color:transparent; color:#00aadd">8200:8080</span></span><span><span style="color:#008080">volumes</span><span>:</span></span><span><span>-</span><span style="background-color:transparent; color:#00aadd">./data:/data/</span></span><span><span>-</span><span style="background-color:transparent; color:#00aadd">./app/certificates:/app/certificates</span></span><span><span style="color:#008080">gateway-web</span><span>:</span></span><span><span style="color:#008080">image</span><span>:</span><span style="background-color:transparent; color:#00aadd">registry.cn-shenzhen.aliyuncs.com/tokengo/gateway-web</span></span><span><span style="color:#008080">restart</span><span>:</span><span style="background-color:transparent; color:#00aadd">always</span></span><span><span style="color:#008080">container_name</span><span>:</span><span style="background-color:transparent; color:#00aadd">gateway-web</span></span><span><span style="color:#008080">privileged</span><span>:</span><span style="color:turquoise">true</span></span><span><span style="color:#008080">environment</span><span>:</span></span><span><span style="color:#008080">api_url</span><span>:</span><span style="background-color:transparent; color:#00aadd">http://localhost:8000</span></span><span><span style="color:#008080">ports</span><span>:</span></span><span><span>-</span><span style="background-color:transparent; color:#00aadd">10800:80</span></span></pre><div>
   &nbsp;
  </div></div></div><p style="color:#40485b; margin-left:0; margin-right:0; text-align:left">參考上面的 docker-compose 文件，我們提供了倆個環境變量<code>HTTPS_PASSWORD</code>，<code>HTTPS_FILE</code>，</p><p style="color:#40485b; margin-left:0; margin-right:0; text-align:left"><code>HTTPS_FILE</code>：</p><ul><li>在系統中已經指定了容器的<code>/app/certificates</code>目錄，你只想要掛在目錄中的文件名即可</li></ul><p style="color:#40485b; margin-left:0; margin-right:0; text-align:left"><code>HTTPS_PASSWORD</code>：</p><ul><li>Pfx 證書的密碼，如果修改了證書請填寫證書的密碼。</li></ul><p style="color:#40485b; margin-left:0; margin-right:0; text-align:left"><code>/app/certificates</code>：</p><ul><li>這個是系統證書默認存放目錄，如果映射了目錄則需要提供自己的證書。</li></ul><h2>使用隧道</h2><div><div><pre><span><span style="color:#008080">services</span><span>:</span></span><span><span style="color:#008080">gateway-api</span><span>:</span></span><span><span style="color:#008080">image</span><span>:</span><span style="background-color:transparent; color:#00aadd">registry.cn-shenzhen.aliyuncs.com/tokengo/gateway-api</span></span><span><span style="color:#008080">restart</span><span>:</span><span style="background-color:transparent; color:#00aadd">always</span></span><span><span style="color:#008080">container_name</span><span>:</span><span style="background-color:transparent; color:#00aadd">gateway-api</span></span><span><span style="color:#008080">environment</span><span>:</span></span><span><span style="color:#008080">USER</span><span>:</span><span style="background-color:transparent; color:#00aadd">root</span></span><span><span style="color:#008080">PASS</span><span>:</span><span style="background-color:transparent; color:#00aadd">Aa010426.</span></span><span><span style="color:#008080">HTTPS_PASSWORD</span><span>:</span><span style="background-color:transparent; color:#00aadd">dd666666</span></span><span><span style="color:#008080">TUNNEL_PASSWORD</span><span>:</span><span style="background-color:transparent; color:#00aadd">dd666666</span></span><span><span style="color:#008080">HTTPS_FILE</span><span>:</span><span style="background-color:transparent; color:#00aadd">gateway.pfx</span></span><span><span style="color:#008080">ports</span><span>:</span></span><span><span>-</span><span style="background-color:transparent; color:#00aadd">8000:8000</span><span style="color:#888888"># 提供給 web 端調用的管理接口</span></span><span><span>-</span><span style="background-color:transparent; color:#00aadd">8200:8080</span><span style="color:#888888"># Http 代理端口</span></span><span><span>-</span><span style="background-color:transparent; color:#00aadd">8300:8081</span><span style="color:#888888"># Https 代理端口</span></span><span><span style="color:#008080">volumes</span><span>:</span></span><span><span>-</span><span style="background-color:transparent; color:#00aadd">./data:/data/</span></span><span><span>-</span><span style="background-color:transparent; color:#00aadd">./app/certificates:/app/certificates</span></span><span><span style="color:#008080">gateway-web</span><span>:</span></span><span><span style="color:#008080">image</span><span>:</span><span style="background-color:transparent; color:#00aadd">registry.cn-shenzhen.aliyuncs.com/tokengo/gateway-web</span></span><span><span style="color:#008080">restart</span><span>:</span><span style="background-color:transparent; color:#00aadd">always</span></span><span><span style="color:#008080">container_name</span><span>:</span><span style="background-color:transparent; color:#00aadd">gateway-web</span></span><span><span style="color:#008080">privileged</span><span>:</span><span style="color:turquoise">true</span></span><span><span style="color:#008080">environment</span><span>:</span></span><span><span style="color:#008080">api_url</span><span>:</span><span style="background-color:transparent; color:#00aadd">http://localhost:8000</span></span><span><span style="color:#008080">ports</span><span>:</span></span><span><span>-</span><span style="background-color:transparent; color:#00aadd">10800:80</span></span></pre><div>
   &nbsp;
  </div></div></div><p style="color:#40485b; margin-left:0; margin-right:0; text-align:left">增加<code>TUNNEL_PASSWORD</code>環境變量，默認為空不設置密碼</p><p style="color:#40485b; margin-left:0; margin-right:0; text-align:left">下載隧道客户端<span>&nbsp;</span><a href="https://gitee.com/hejiale010426/Gateway/releases">https://gitee.com/hejiale010426/Gateway/releases</a><span>&nbsp;</span>然後解壓壓縮包，打開 appsettings.json 文件修改 Tunnel 節點的 Url，如果 Gateway 使用了 TUNNEL_PASSWORD，那麼你的 URL 應該是<code>https://localhost:8081/api/gateway/connect-h2?host=backend1.app&amp;password=dd666666</code>，<span>&nbsp;</span><code>host</code>是在集羣中的集羣端點的域名，這個域名就是定義到我們的隧道客户端的<code>host</code>的這個參數，請保證值的唯一性，當綁定集羣的路由匹配成功以後則會訪問圖片定義的端點，如果並沒有存在節點那麼他會直接代理。</p><p style="color:#40485b; margin-left:0; margin-right:0; text-align:left"><img alt="輸入圖片説明" src="https://gitee.com/hejiale010426/FastGateway/raw/master/img/%E9%9B%86%E7%BE%A4-01.png.png" referrerpolicy="no-referrer"></p><h2>出入流量監控</h2><p style="color:#40485b; margin-left:0; margin-right:0; text-align:left">使用環境變量控制是否啓用流量監控，使用環境變量<code>ENABLE_FLOW_MONITORING</code>設置我們是否啓用流量監控，如果為空則默認啓動流量監控，然後可以打開我們的控制面板查看流量監控的數據。</p><div><div><pre><span><span style="color:#008080">services</span><span>:</span></span><span><span style="color:#008080">gateway-api</span><span>:</span></span><span><span style="color:#008080">image</span><span>:</span><span style="background-color:transparent; color:#00aadd">registry.cn-shenzhen.aliyuncs.com/tokengo/gateway-api</span></span><span><span style="color:#008080">restart</span><span>:</span><span style="background-color:transparent; color:#00aadd">always</span></span><span><span style="color:#008080">container_name</span><span>:</span><span style="background-color:transparent; color:#00aadd">gateway-api</span></span><span><span style="color:#008080">environment</span><span>:</span></span><span><span style="color:#008080">USER</span><span>:</span><span style="background-color:transparent; color:#00aadd">root</span></span><span><span style="color:#008080">PASS</span><span>:</span><span style="background-color:transparent; color:#00aadd">Aa010426.</span></span><span><span style="color:#008080">HTTPS_PASSWORD</span><span>:</span><span style="background-color:transparent; color:#00aadd">dd666666</span></span><span><span style="color:#008080">HTTPS_FILE</span><span>:</span><span style="background-color:transparent; color:#00aadd">gateway.pfx</span></span><span><span style="color:#008080">ENABLE_FLOW_MONITORING</span><span>:</span><span style="color:turquoise">true</span></span><span><span style="color:#008080">ports</span><span>:</span></span><span><span>-</span><span style="background-color:transparent; color:#00aadd">8000:8000</span><span style="color:#888888"># 提供給 web 端調用的管理接口</span></span><span><span>-</span><span style="background-color:transparent; color:#00aadd">8200:8080</span><span style="color:#888888"># Http 代理端口</span></span><span><span>-</span><span style="background-color:transparent; color:#00aadd">8300:8081</span><span style="color:#888888"># Https 代理端口</span></span><span><span style="color:#008080">volumes</span><span>:</span></span><span><span>-</span><span style="background-color:transparent; color:#00aadd">./data:/data/</span></span><span><span>-</span><span style="background-color:transparent; color:#00aadd">./app/certificates:/app/certificates</span></span><span><span style="color:#008080">gateway-web</span><span>:</span></span><span><span style="color:#008080">image</span><span>:</span><span style="background-color:transparent; color:#00aadd">registry.cn-shenzhen.aliyuncs.com/tokengo/gateway-web</span></span><span><span style="color:#008080">restart</span><span>:</span><span style="background-color:transparent; color:#00aadd">always</span></span><span><span style="color:#008080">container_name</span><span>:</span><span style="background-color:transparent; color:#00aadd">gateway-web</span></span><span><span style="color:#008080">privileged</span><span>:</span><span style="color:turquoise">true</span></span><span><span style="color:#008080">environment</span><span>:</span></span><span><span style="color:#008080">api_url</span><span>:</span><span style="background-color:transparent; color:#00aadd">http://localhost:8000</span></span><span><span style="color:#008080">ports</span><span>:</span></span><span><span>-</span><span style="background-color:transparent; color:#00aadd">10800:80</span></span></pre></div></div><p>&nbsp;</p><p>開源地址：<a href="https://gitee.com/hejiale010426/FastGateway">FastGateway: FastGateway 一個超級簡單方便的網關，基於 Kestrel+Yarp 實現的網關。 支持動態配置路由，支持動態配置集羣，支持動態配置 HTTPS 證書，無需重啓即可使用。 (gitee.com)</a></p><p>&nbsp;</p><p><strong>效果圖</strong></p><p><img height="974" src="https://oscimg.oschina.net/oscnet/up-213cad83fbc8f296333c9970b2dee268483.png" width="1480" referrerpolicy="no-referrer"></p><p>&nbsp;</p><p><img height="979" src="https://oscimg.oschina.net/oscnet/up-64949f2af7f4f1cd4a212c94f185ba0df7d.png" width="1485" referrerpolicy="no-referrer"></p><p><img height="986" src="https://oscimg.oschina.net/oscnet/up-57d5ac2dcda53c11dc8019ca721f9835f84.png" width="1489" referrerpolicy="no-referrer"></p></div>
                                    ]]>
            </description>
            <pubDate>Sat, 03 Feb 2024 03:57:00 GMT</pubDate>
            <guid isPermaLink="false">https://www.oschina.net/news/277575</guid>
            <link>https://www.oschina.net/news/277575</link>
            <author>
                <![CDATA[來源: 投稿]]>
            </author>
        </item>
        <item>
            <title>
                <![CDATA[扎克伯格解釋 Meta 為什麼要開源其 AI 技術]]>
            </title>
            <description>
                <![CDATA[<div class="content"><p>在今天的 2023 年第四季度財報電話會議中，馬克 - 扎克伯格解釋 Meta 為什麼要開源其 AI 技術。</p><p>Meta 開源其 AI 技術是出於推動技術創新、提升模型質量、建立行業標準、吸引人才、增加透明度和支持其長期戰略的考慮。這不僅有助於 Meta 在競爭激烈的 AI 領域保持領先地位，也有助於推動整個行業的前進。</p><p>1. <strong>促進行業創新</strong>: 通過開源 AI 模型，Meta 可以鼓勵全球的開發者、研究人員和公司利用這些技術進行創新。這種共享精神有助於加速 AI 技術的進步，並推動新應用和服務的開發。</p><p>2. <strong>提高模型質量</strong>: 開源允許更廣泛的社區參與到模型的測試和改進中來。來自全球的貢獻可以幫助發現並修復錯誤，提出改進意見，從而提高模型的性能和可靠性。</p><p>3. <strong>建立行業標準</strong>: 通過將自己的技術開源，Meta 有機會塑造行業標準和最佳實踐。這種影響力可以確保 Meta 在 AI 領域的技術和方法得到廣泛接受和使用，從而加強其市場地位。</p><p>4. <strong>吸引和保留人才</strong>: 開源項目通常對研究人員和開發者具有吸引力。通過貢獻於開放且受尊重的項目，Meta 可以吸引頂尖人才加入，這對於維持其在 AI 領域的競爭優勢至關重要。</p><p>5. <strong>提升安全性和透明度</strong>: 開源 AI 模型可以提高透明度，讓外部研究人員和公眾能夠更好地理解模型的工作原理和潛在影響。這有助於識別和緩解與 AI 應用相關的風險和倫理問題，從而增強公眾對 AI 技術的信任。</p><p>6. <strong>支持長期戰略</strong>: Meta 開源 AI 技術也是其長期戰略的一部分，旨在確保公司在 AI 和機器學習領域的長期領導地位。通過開源，Meta 可以推動整個生態系統的發展，為自己的產品和服務創造更多的創新機會。</p><blockquote><p>本文已獲授權。</p><p>完整內容參考：<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fs21.q4cdn.com%2F399680738%2Ffiles%2Fdoc_financials%2F2023%2Fq4%2FMETA-Q4-2023-Earnings-Call-Transcript.pdf" target="_blank">https://s21.q4cdn.com/399680738/files/doc_financials/2023/q4/META-Q4-2023-Earnings-Call-Transcript.pdf</a><br> 譯文：<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fbaoyu.io%2Ftranslations%2Fmeta%2Fmark-zuckerberg-explains-why-meta-open-sources-its-ai" target="_blank">https://baoyu.io/translations/meta/mark-zuckerberg-explains-why-meta-open-sources-its-ai</a></p></blockquote></div>
                                    ]]>
            </description>
            <pubDate>Sat, 03 Feb 2024 03:01:36 GMT</pubDate>
            <guid isPermaLink="false">https://www.oschina.net/news/277568</guid>
            <link>https://www.oschina.net/news/277568</link>
            <author>
                <![CDATA[來源: OSCHINA]]>
            </author>
        </item>
        <item>
            <title>
                <![CDATA[谷歌 Bard 支持文本生成圖像功能]]>
            </title>
            <description>
                <![CDATA[<div class="content"><p>谷歌對話式 AI 工具&nbsp;<span style="font-family:-apple-system,BlinkMacSystemFont,&quot;Apple Color Emoji&quot;,&quot;Segoe UI Emoji&quot;,&quot;Segoe UI Symbol&quot;,&quot;Segoe UI&quot;,&quot;PingFang SC&quot;,&quot;Hiragino Sans GB&quot;,&quot;Microsoft YaHei&quot;,&quot;Helvetica Neue&quot;,Helvetica,Arial,sans-serif">Bard 近日發佈了更新，此次更新後將支持文生圖和擴展雙重檢查功能。</span></p><blockquote><p><img src="https://oscimg.oschina.net/oscnet/up-1a225c71ee0e459f8cfa6a7ac710106c3f6.png" referrerpolicy="no-referrer"><em><u><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fbard.google.com%2Fupdates" target="_blank">https://bard.google.com/updates</a></u></em></p></blockquote><p><strong>Bard 此次新增的圖像生成功能將在全球受支持的地區免費提供，由谷歌 Imagen 2 模型提供支持，但需要英語指令</strong>。用户現在可以根據向 Bard 提供的描述生成自定義圖像。谷歌承諾，Bard 可提供「高質量、逼真的圖像輸出」。</p><p><img src="https://oscimg.oschina.net/oscnet/up-4b6453ff6415cb9ad30a9eab1cd5a61b3cb.png" referrerpolicy="no-referrer"></p><p>谷歌表示，Imagen 2 不會生成暴力、攻擊性或包含色情內容的圖片。此外，Imagen 2 還接受了一些「培訓」，可以幫助它避免創建特定人羣的圖像。為將 Bard 生成的 AI 圖片與人類作品區分開來，谷歌將嵌入「像素級別」的數字可識別水印。</p><p>Bard 在此次更新之後，谷歌 Gemini Pro 模型新增了 40 多種語言、230 多個國家和地區的支持。</p><p>谷歌表示，Gemini Pro 增強了 Bard 的理解、總結、推理、創意、協作和規劃方面的能力。谷歌還將 Bard 的「雙重檢查」功能擴展到 40 多種語言，用户可以通過檢查整個互聯網的內容來驗證 AI 所作回答的準確性。在此之前，「雙重檢查」功能僅限於英語。</p><p>詳情查看&nbsp;<u><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fblog.google%2Ftechnology%2Fai%2Fgoogle-imagen-2%2F" target="_blank">https://blog.google/technology/ai/google-imagen-2/</a></u></p></div>
                                    ]]>
            </description>
            <pubDate>Sat, 03 Feb 2024 02:54:00 GMT</pubDate>
            <guid isPermaLink="false">https://www.oschina.net/news/277567/bard-ai-image-generation</guid>
            <link>https://www.oschina.net/news/277567/bard-ai-image-generation</link>
            <author>
                <![CDATA[來源: 投稿]]>
            </author>
        </item>
        <item>
            <title>
                <![CDATA[OurBMC 社區入駐開源中國！]]>
            </title>
            <description>
                <![CDATA[<div class="content"><p><strong><span style="background-color:#ffffff; color:#343434">近日，OurBMC 社區完成</span>開源中國<span style="background-color:#ffffff; color:#343434">（OSCHINA）企業號註冊，正式入駐開源中國技術社區。OurBMC 將攜手開源中國優秀開發者們，共同推進 BMC 技術快速發展，共建 BMC 繁榮生態。</span></strong></p><p style="text-align:center"><img height="400" src="https://oscimg.oschina.net/oscnet/up-f144f219c0a9452e188438fb29d3ff0243e.jpg" width="940" referrerpolicy="no-referrer"></p><p><span style="color:#343434"><span>作為國內知名的開源技術社區，OSCHINA 聚集了超過 1500 萬開發者，不僅推廣了</span>開源軟件<span>的使用，還在提升本土開源技術能力和優化開源生態環境方面發揮了重要作用。自創建至今，經過十五年深耕與發展，結合對中國本土開源環境的深刻理解，OSCHINA 已成為推動國內開源技術進步的重要力量。</span></span></p><p><span style="color:#343434">OurBMC 社區是飛騰公司攜手崑崙太科、百敖軟件聯合籌建的國內首個 BMC 開源根社區。在多方共同努力下，OurBMC 社區官網已於 2023 年 9 月 21 日正式上線。社區在廣大成員單位齊心協力建設 OurBMC 技術生態的努力之下，已經獲得了不錯的成效，不僅擁有來自芯片、固件、整機、操作系統等多方向的 47 家成員單位，還建立了 4 個 SIG 併發布了 11 個代碼倉。經過社區開發者的共同努力，2023 年 12 月 29 日，OurBMC 首個版本 1.0.0 正式發佈。</span></p><p><span style="color:#343434">OurBMC 入駐開源中國技術社區，將攜手開源中國優秀的 BMC 技術愛好者一起為社區和 BMC 生態貢獻力量，共同取得更加卓越的成就。大家可通過下面兩種方式訪問 OurBMC 相關信息：</span></p><h3><strong>一鍵搜索，技術乾貨貼展現眼前</strong></h3><p><span style="background-color:#ffffff; color:#343434">進入<span>&nbsp;</span></span><strong>開源中國官網首頁</strong><strong>-&gt;</strong><strong>右上角輸入 「OurBMC」 關鍵詞</strong><strong>-&gt;</strong><strong>點擊搜索</strong><span style="background-color:#ffffff; color:#343434">，查看 OurBMC 發佈的技術博客、BMC 技術資訊及 OurBMC 產品資訊等乾貨信息。</span></p><p style="text-align:center"><img height="388" src="https://oscimg.oschina.net/oscnet/up-339ec0f66bbf91e77e8c90d91ec02b5ebaa.png" width="1473" referrerpolicy="no-referrer"></p><h3><strong><span>複製鏈接，更快、更全面地瞭解 OurBMC</span></strong></h3><p><span style="background-color:#ffffff; color:#343434">直接訪問&nbsp;<strong>開源中國 OurBMC 個人中心</strong>（</span><a href="https://my.oschina.net/ourbmc">https://my.oschina.net/ourbmc</a><span style="background-color:#ffffff; color:#343434">），查看 OurBMC 發佈的相關博文、資訊，以及 OurBMC 參與的技術問答情況等。</span></p><p style="text-align:center"><img height="790" src="https://oscimg.oschina.net/oscnet/up-fd758ff0673e642d72a0410f995dac05431.png" width="1441" referrerpolicy="no-referrer"></p><p><span style="color:#343434">未來，OurBMC 將在開源中國技術社區積極回答 BMC 技術問題，同時攜手廣大優秀開發者共同探索 BMC 全棧技術，厚培開源土壤，持續推動 BMC 生態成熟發展。OurBMC 社區誠邀業界廣大同仁積極參與社區建設和交流！</span></p><p style="color:rgba(0, 0, 0, 0.9); margin-left:8px; margin-right:8px; text-align:center"><strong><span style="color:#343434">歡迎廣大開發者加入 OurBMC 社區</span></strong></p><p style="text-align:center"><strong><span style="color:#343434">開源中國 OurBMC 個人空間更多信息請訪問：</span></strong></p><p style="color:rgba(0, 0, 0, 0.9); margin-left:8px; margin-right:8px; text-align:center"><a href="https://my.oschina.net/ourbmc">https://my.oschina.net/ourbmc</a></p><p style="color:rgba(0, 0, 0, 0.9); margin-left:8px; margin-right:8px; text-align:center"><strong><span style="color:#343434">OurBMC 社區官網更多功能請訪問：</span></strong></p><p style="text-align:center"><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fwww.ourbmc.cn%2F" target="_blank">https://www.ourbmc.cn/</a></p><p style="text-align:center"><img alt="動態底部圖片.jpeg" src="https://oss-nc-beijing-2.cecloudcs.com/ourbmc/c257f53322344116b7eea72013ffcbd5/%E5%8A%A8%E6%80%81%E5%BA%95%E9%83%A8%E5%9B%BE%E7%89%87.jpeg" referrerpolicy="no-referrer"></p></div>
                                    ]]>
            </description>
            <pubDate>Sat, 03 Feb 2024 02:26:00 GMT</pubDate>
            <guid isPermaLink="false">https://www.oschina.net/news/277662</guid>
            <link>https://www.oschina.net/news/277662</link>
            <author>
                <![CDATA[來源: 投稿]]>
            </author>
        </item>
        <item>
            <title>
                <![CDATA[deepin V23 最後一個測試版本 —— Beta3 來了！]]>
            </title>
            <description>
                <![CDATA[<div class="content"><p style="color:rgba(0, 0, 0, 0.9); margin-left:0; margin-right:0; text-align:justify"><span>deepin V23 最後一個測試版本——Beta3&nbsp;來了！</span></p><p style="color:#020000; margin-left:0; margin-right:0"><span>deepin V23 Beta3 版本對鏡像預裝包中 1400+ 包進行升級，新增了 250+ 軟件包系統更新，並進一步優化功能體驗，包括：</span></p><ul><li><p style="color:#020000; margin-left:0; margin-right:0"><span>安裝器支持 768P、1080P、2K、4K 屏幕界面自適應；</span></p></li><li><p style="color:#020000; margin-left:0; margin-right:0"><span>支持 Steam 原生應用正常安裝和遊戲運行；</span></p></li><li><p style="color:#020000; margin-left:0; margin-right:0"><span>系統底層依賴的更新升級：GCC、Qt、glibc 等等；</span></p></li><li><p style="color:#020000; margin-left:0; margin-right:0"><span>對啓動器進行了代碼層面重構提升了運行速度；</span></p></li><li><p style="color:#020000; margin-left:0; margin-right:0"><span>控制中心-時間日期-區域-國家地區支持根據用户所在的區域語言，設置本土化時間、日期格式；</span></p><p style="color:#020000; margin-left:0; margin-right:0"><span>......</span></p></li></ul><p style="color:#020000; margin-left:0; margin-right:0"><span>感謝每一位 deepiner 提供想法與建議，讓我們一起為打造美觀易用、安全可靠的開源操作系統而努力！</span></p><p style="margin-left:0px; margin-right:0px; text-align:center"><u><span><strong>&nbsp;</strong></span><span><strong>功能新增</strong></span><span><strong>&nbsp;</strong></span></u></p><p><strong><span style="color:#01a0e7">【系統/安裝】</span></strong></p><ul><li><p><span style="background-color:#ffffff; color:#020000">鏡像安裝時 Grub 頁面 safe 模式後增加了説明提示性文字</span><span style="background-color:#ffffff; color:#020000">，避免用户因不理解而錯誤使用 safe 模式安裝問題；</span></p></li><li><p><span>安裝器支持 768P、1080P、2K、4K 屏幕界面自適應；</span></p></li><li><p><span>對部分 i386 設備驅動進行了支持；</span></p></li><li><p><span>支持了 Steam 原生應用正常安裝和遊戲運行。</span></p></li></ul><p><strong><span style="color:#01a0e7">【系統倉庫】</span></strong></p><ul><li><p><span>大量系統底層庫得到更新，系統倉庫整體約 4000+ 軟件包更新 (包括新增軟件包)&nbsp;添加了 i386、RISC-V64、LoongArch64 架構支持；</span></p></li><li><p><span>GCC 更新到 13.2 版本；</span></p></li><li><p><span>glibc 更新到 2.37；</span></p></li><li><p><span>ICU 更新到 73.2；</span></p></li><li><p><span>Qt6 更新到 6.6.1；</span></p></li><li><p><span>FFmpeg 更新到 6.0；</span></p></li><li><p><span>Mesa 更新到 23.3.3；</span></p></li><li><p><span>Python 默認版本更新到 3.11；</span></p></li><li><p><span>Perl 更新到 5.36；</span></p></li><li><p><span>LLVM 默認版本更新到 16。</span></p></li></ul><p><strong><span style="color:#01a0e7">【桌面環境】</span></strong></p><ul><li><p><span>對啓動器進行了代碼層面重構提升了運行速度；</span></p></li><li><p><span>優化了功能佈局與界面 UI 設計細節，提升了整體視覺效果；</span></p></li><li><p><span>對鍵盤選中狀態與鼠標 hover 狀態進行狀態區分；</span></p></li><li><p><span>新增增加字母表功能，可通過字母表進行應用快速檢索；</span></p></li><li><p><span>對通知圖標和時間日期點擊換出內容進行優化；</span></p></li><li><p><span>通知中心中增加了日曆組件；</span></p></li><li><p><span>優化了通知中心清除通知消息圖標，解決了錯誤圖標給用户帶來的誤導；</span></p></li><li><p><span>優化了控制中心-網絡-VPN-導入操作按鈕圖標樣式；</span></p></li><li><p><span>控制中心-賬户頭像中新增創意插圖分類；</span></p></li><li><p><span>控制中心-賬户頭像-人物頭像中增加了立體風格素材圖片；</span></p></li><li><p><span>控制中心-通用新增啓動動畫設置項；</span></p></li><li><p><span>控制中心-藍牙支持藍牙設備剩餘電量顯示；</span></p></li><li><p><span>控制中心-賬户密碼登錄、鎖屏管理功能進行了統一管理；</span></p></li><li><p><span>控制中心-聲音-音頻增加外設插拔管理中插拔音頻設備是否暫停播放進行管理；</span></p></li><li><p><span>控制中心-聲音-多媒體音頻框架高級設置，可切換音頻框架；</span></p></li><li><p><span>控制中心-時間日期-區域-國家地區支持根據用户所在的區域語言，設置本土化時間、日期格式；</span></p></li><li><p><span>控制中心-網絡設置中 IPV4\IPV6 方法設置項中增加了禁用選項；</span></p></li><li><p><span>控制中心-電源-通用，性能模式功能中增加了説明文字；</span></p></li><li><p><span>控制中心-電源-通用，對 Intel、AMD 內存增加了電源性能管理選項。</span></p></li></ul><p><strong><span style="color:#01a0e7">【UOS AI】</span></strong></p><ul><li><p><span>系統預裝了 UOS AI 插件，用户可使用 UOS AI；</span></p></li><li><p><span>提供了免費的 AI 試用帳號，可在系統中使用 UOS AI 功能；</span></p></li><li><p><span>對了接了主流的 AI 模型接口，用户可使用自有的 AI 帳號進行綁定使用。</span></p></li></ul><p><strong><span style="color:#01a0e7">【日曆】</span></strong></p><ul><li><p><span>日曆應用更新了 2024 年法定休假安排。</span></p></li></ul><p><strong><span style="color:#01a0e7">【應用商店】</span></strong></p><ul><li><p><span>新增 deepin ID 同步應用下載記錄功能；</span></p></li><li><p><span>新增用户提交心願單，反饋所需應用功能；</span></p></li><li><p><span>應用更新頁面，忽略應用更新功能；</span></p></li><li><p><span>應用更新/應用管理頁面支持搜索已安裝應用；</span></p></li><li><p><span>針對應用商店內付費應用添加提示。</span></p></li></ul><p><strong><span style="color:#01a0e7">【文件管理器】</span></strong></p><ul><li><p><span>新增右鍵菜單增加反選選項；</span></p></li><li><p><span>新增右鍵菜單顯示快捷鍵功能；</span></p></li><li><p><span>新增右鍵文件屬性複製信息；</span></p></li><li><p><span>新增窗口主視圖篩選搜索功能；</span></p></li><li><p><span>新增遠程環境是否展示縮略圖預覽設置項；</span></p></li><li><p><span>設置中增加複選項「列表視圖以樹形結構展示」功能設置項；</span></p></li><li><p><span>對文管圖標視圖佈局進行優化，提升空間利用率；</span></p></li><li><p style="color:#020000; margin-left:0; margin-right:0"><span>對側邊欄目錄顯示規則進行優化。</span></p></li></ul><p style="margin-left:0px; margin-right:0px; text-align:center"><u><span><strong>&nbsp;</strong></span><span><strong>用户反饋修復</strong></span><span><strong>&nbsp;</strong></span></u></p><p><strong><span style="color:#01a0e7">【DDE】</span></strong></p><ul><li><p><span>修復在商店中卸載應用後，桌面圖標消失了，但是啓動器中的圖標沒有消失問題；</span></p></li><li><p><span>修復啓動器應用分類中的應用展示順序及位置不正確；</span></p></li><li><p><span>修復打開應用如音樂，將音樂託盤圖片拖動至任務欄，重新打開應用，託盤區域出現兩個音樂圖標問題；</span></p></li><li><p><span>修復開啓託盤駐留應用後，任務欄重複拖動託盤圖標導致託盤區域圖標消失問題；</span></p></li><li><p><span>修復外接顯示器後斷開顯示器連接，快捷面板中亮度調節插件無法恢復問題；</span></p></li><li><p><span>修復了在調整屏幕縮放比例後等待時間過長問題；</span></p></li><li><p><span>修復控制中心-網絡無法連接或斷開時，deepin ID 賬户頭像無法正常顯示異常問題；</span></p></li><li><p><span>修復控制中心-更新設置項玲瓏軟件更新按鈕關閉後,系統重啓後變為開啓狀態,未記住用户設置；</span></p></li><li><p><span>修復切換主題時，主題切換成功但壁紙為上一主題的壁紙問題；</span></p></li><li><p><span>修復任務欄插件面板中屏幕鍵盤圖標展示為白色圖標，導致無法看清圖標問題；</span></p></li><li><p><span>修復在終端安裝 Libreswan 後，控制中心網絡模塊圖標消失問題；</span></p></li><li><p><span>修復鼠標移動至任務欄快捷面板面板邊緣錯誤顯示可調整大小問題；</span></p></li><li><p><span>修復在任務欄快捷面板中，使用鼠標滾輪調整顯示亮度時，亮度值在 28 和 56 時就無法繼續滾動設置問題；</span></p></li><li><p><span>修復設置系統窗口圓角為直角，添加或修改系統時區時世界地圖二級窗口圓角未跟隨系統設置變化問題；</span></p></li><li><p><span>修復部分機型進入桌面後，關閉飛行模式後，無線網絡搜索不到網絡問題；</span></p></li><li><p><span>修復控制中心工作區相關的快捷鍵修改後，快捷鍵沒有響應問題；</span></p></li><li><p><span>修復控制中心聲音模塊中的設備管理-輸入設備和輸出設備開關無實際作用問題。</span></p></li></ul><p><strong><span style="color:#01a0e7">【文件管理器】</span></strong></p><ul><li><p><span>修復深色模式下，重命名文件名稱時右鍵菜單命令前的圖標展示為黑色無法看清問題；</span></p></li><li><p><span>修復在 NTFS 格式磁盤中新建文件夾包含有空格字符結尾的文件夾無法創建成功，提示設備或資源繁忙問題；</span></p></li><li><p><span>修復從回收站複製文件夾到任意位置進行粘貼操作時會提示該文件夾已存在的錯誤提示；</span></p></li><li><p><span>修復在 SMB 上刪除 .gif 格式圖片無法刪除成功，提示刪除失敗文件繁忙問題；</span></p></li><li><p><span>修復從 Ext4 格式分區複製或剪切文件夾名稱中空格結尾的文件夾至 NTFS 格式分區時，無法複製或剪切成功問題；</span></p></li><li><p><span>修復從本機硬盤往 U 盤或移動硬盤複製或剪貼文件時進度和文件夾窗口消失，文件複製中斷問題；</span></p></li><li><p><span>修復文件進行替換操作時，提示信息中展示的文件大小信息與實際文件大小信息不一致問題；</span></p></li><li><p><span>修復 Chrome 谷歌瀏覽器創建桌面應用快捷方式，生成網站 icon 失敗問題。</span></p></li></ul><p><strong><span style="color:#01a0e7">【終端】</span></strong></p><ul><li><p><span>修復在任意目錄右鍵點擊，選擇「在終端中打開」，都會被定位到家目錄的問題；</span></p></li><li><p><span>修復終端分屏分辨率不一致時，雷神窗口寬度可能過小的問題；</span></p></li><li><p><span>修復新建用户登錄系統，打開終端後未展示當前用户名、機器名稱、當前路徑等信息問題；</span></p></li><li><p><span>修復連接 4K 屏幕擴展模式下，在 4K 屏幕按 Alt F2 打開雷神終端，將鼠標移動到另一屏幕按 Alt F2 時，雷神終端顯示異常問題；</span></p></li><li><p><span>雙屏擴展模式下，在主屏 Alt F2 打開雷神終端,點擊屏幕空白處，再將鼠標移動到另一屏幕按 Alt F2 時，出現兩個雷神終端問題；</span></p></li><li><p><span>將主題設置為跟隨系統後，再將鼠標移動到深色時，預覽圖的標題欄沒有同步展示為深色問題；</span></p></li><li><p><span>調換切換前後標籤頁快捷鍵為正確順序；</span></p></li><li><p><span>修復雷神窗口無法設置模糊的問題；</span></p></li><li><p><span>Dirty Fix 改為部分刷新光標後的顯示問題；</span></p></li><li><p><span>修復無法打開未以&nbsp;「 / 」&nbsp;結尾帶端口號鏈接的問題；</span></p></li><li><p><span>修復調整窗口大小時刷新大量 debug 日誌的問題；</span></p></li><li><p><span>修改右鍵菜單打開文件/文件夾時的調用方式。</span></p></li></ul><p><strong><span style="color:#01a0e7">【深度之家】</span></strong></p><ul><li><p><span>修復提交反饋中郵箱文本框中，輸入的文本中&nbsp;@&nbsp;字符不允許以首字符或中間字符輸入問題；</span></p></li><li><p style="margin-left:0; margin-right:0"><span>修復點擊主菜單圖標，無法收起已經展開菜單。</span></p></li></ul><p><strong><span style="color:#01a0e7">【玲瓏】</span></strong></p><ul><li><p><span>修復右鍵 Markdown 文件，以玲瓏 MarkText 軟件打開時可打開軟件未顯示文檔內容問</span><span>題；</span></p></li><li><p><span>修復在啓動器中設置玲瓏為開機自啓動後，玲瓏應用啓動過程中自動閃退問題；</span></p></li><li><p><span>修復了玲瓏環境變量丟失問題；</span></p></li><li><p style="margin-left:0; margin-right:0"><span>修復瀏覽器更新版本後，無法播放網頁視頻問題。</span></p></li></ul><p><strong><span style="color:#01a0e7">【已知待修復問題】</span></strong></p><ul><li><p><span>更新了系統時區庫，可能導致安裝完成後區錯誤需進入控制中心中重新設置；</span></p></li><li><p><span>部分華為終端聲音設備輸出異常，需要刷新 BIOS 或更新內核至 6.6 後才可解決；</span></p></li><li><p><span>部分機型雙屏擴展模式下，啓動器全屏模式時，啓動器會顯示在另一個屏幕上；</span></p></li><li><p><span>雙屏擴展模式下，啓動器偶現在兩個屏幕中間顯示；</span></p></li><li><p><span>啓動器全屏時，點擊任務欄中應用圖標打開應用，啓動器未自動退出；</span></p></li><li><p><span>啓動器全屏模式下未鋪滿整個屏幕；</span></p></li><li><p><span>啓動器開啓按下截圖快捷鍵啓動器被隱藏；</span></p></li><li><p><span>啓動器全屏時按下右鍵菜單並滾動屏幕菜單不會被隱藏。</span></p></li></ul><p><span><span style="background-color:#ffffff; color:#020000">以上就是 deepin V23 Beta3 版本更新的主要內容，歡迎下載體驗，並將所遇到的問題反饋給我們。</span></span></p><p><strong><span style="background-color:#ffffff; color:#020000">鏡像下載地址：</span></strong><span style="background-color:#ffffff; color:#020000">www.deepin.org/download/</span></p><p style="color:#020000; margin-left:0; margin-right:0; text-align:justify"><strong>注意事項：</strong></p><ul><li><p style="color:#020000; margin-left:0; margin-right:0"><span>升級過程中不要鎖屏、待機、關機、重啓等；</span></p></li><li><p style="color:#020000; margin-left:0; margin-right:0"><span>升級前請保證系統根分區擁有足夠的備份空間和更新空間；</span></p></li><li><p style="color:#020000; margin-left:0; margin-right:0"><span>保留用户數據重裝系統，可能會導致安裝完成後無法啓動。</span></p></li></ul></div>
                                    ]]>
            </description>
            <pubDate>Fri, 02 Feb 2024 10:26:00 GMT</pubDate>
            <guid isPermaLink="false">https://my.oschina.net/u/5046223/blog/11023703</guid>
            <link>https://my.oschina.net/u/5046223/blog/11023703</link>
            <author>
                <![CDATA[原創]]>
            </author>
        </item>
        <item>
            <title>
                <![CDATA[每日一博 | 初探分佈式鏈路追蹤]]>
            </title>
            <description>
                <![CDATA[<div class="content"><div class="rich_media_content js_underline_content
                       autoTypeSetting24psection
            " id="js_content"><section style="margin-bottom: 8px;outline: 0px;font-family: system-ui, -apple-system, &quot;system-ui&quot;, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;color: rgb(34, 34, 34);background-color: rgb(255, 255, 255);text-align: center;visibility: visible;" data-mpa-powered-by="yiban.io"><img class="rich_pages wxw-img __bg_gif" data-backh="96" data-backw="578" data-cropselx1="0" data-cropselx2="578" data-cropsely1="0" data-cropsely2="96" data-imgfileid="503043772" data-ratio="0.16666666666666666" data-type="gif" data-w="636" src="https://oscimg.oschina.net/oscnet/71323de7-edc6-4b55-b3be-08214ac4934e.gif" style="outline: 0px;letter-spacing: 0.544px;font-size: var(--articleFontsize);border-radius: 8px;text-align: justify;width: 100%;visibility: visible !important;background-size: 16px !important;height: auto;" referrerpolicy="no-referrer"><br style="outline: 0px;visibility: visible;"></section><section data-mpa-template="t" data-mpa-template-id="502" data-mpa-category="模板" style="outline: 0px;font-family: system-ui, -apple-system, &quot;system-ui&quot;, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;color: rgb(34, 34, 34);background-color: rgb(255, 255, 255);visibility: visible;"><section data-mpa-category="模板" data-mid="" style="padding-right: 1px;padding-left: 1px;outline: 0px;width: 677px;display: flex;justify-content: flex-start;align-items: center;flex-direction: column;visibility: visible;"><section data-mid="" style="outline: 0px;letter-spacing: 0.544px;width: 675px;display: grid;grid-template-columns: 26px auto;visibility: visible;"><section data-mid="" style="outline: 0px;width: 26px;height: 14px;display: flex;justify-content: center;align-items: center;align-self: center;visibility: visible;"><br style="outline: 0px;visibility: visible;"></section><section data-mid="" style="padding-left: 7px;outline: 0px;display: flex;justify-content: flex-start;align-items: center;visibility: visible;"><section data-mid="" style="margin-right: 7px;outline: 0px;text-align: left;visibility: visible;"><p data-mid="" style="outline: 0px;width: 0px;font-size: 14px;font-family: PingFangSC-Semibold, &quot;PingFang SC&quot;;font-weight: bold;color: rgb(58, 92, 244);line-height: 20px;visibility: visible;"><br style="outline: 0px;visibility: visible;"></p></section><section data-mid="" style="margin-bottom: 4px;outline: 0px;width: 635px;height: 1px;border-top: 1px solid rgb(58, 92, 244);align-self: flex-end;visibility: visible;"><br style="outline: 0px;visibility: visible;"></section></section></section><section data-mid="" style="padding: 7px 14px 9px 19px;outline: 0px;width: 675px;text-align: left;border-bottom: 1px solid rgb(58, 92, 244);visibility: visible;"><p style="margin-top: 8px;margin-bottom: 8px;outline: 0px;min-height: 24px;letter-spacing: 0.578px;text-align: justify;visibility: visible;line-height: 1.75em;"><span style="outline: 0px;color: rgb(0, 0, 0);text-align: left;text-indent: 2em;font-size: 15px;letter-spacing: 1px;visibility: visible;">本篇文章，主要介紹應用如何正確使用日誌系統，幫助用户從依賴、輸出、清理、問題排查、報警等各方面全面掌握。</span></p></section></section></section><section style="margin-top: 8px;margin-bottom: 8px;outline: 0px;font-family: system-ui, -apple-system, &quot;system-ui&quot;, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);line-height: 1.75em;visibility: visible;"><br style="outline: 0px;visibility: visible;"></section><section style="margin-bottom: 0px;outline: 0px;box-sizing: inherit;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);color: rgba(25, 26, 31, 0.9);font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 16px;text-align: center;visibility: visible;line-height: 1.75em;"><span style="outline: 0px;visibility: visible;font-size: 15px;letter-spacing: 1px;"><img class="rich_pages wxw-img" data-imgfileid="503043770" data-ratio="0.3161764705882353" data-s="300,640" data-type="png" data-w="408" src="https://oscimg.oschina.net/oscnet/83abeb6c-dd57-43c7-ab42-53b4b2eb5c03.png" style="outline: 0px;color: rgb(34, 34, 34);font-family: system-ui, -apple-system, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;visibility: visible !important;width: 113px !important;" referrerpolicy="no-referrer"></span></section><section style="margin-bottom: 0px;outline: 0px;font-family: system-ui, -apple-system, &quot;system-ui&quot;, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);color: rgb(34, 34, 34);text-align: center;visibility: visible;line-height: normal;"><span style="outline: 0px;color: rgb(3, 69, 255);font-family: -apple-system, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 18px;letter-spacing: 1px;visibility: visible;">可觀測性</span></section><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><br></p><section style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;">可觀察性不單是一套理論框架，而且並不強制具體的技術規格。其核心在於鼓勵團隊內化可觀察性的理念，並確保由研發人員構建的應用程序具備可觀察性。在學術領域中，儘管「可觀測性」這一術語是近年來從控制理論中引進的新詞，但實際上，它在計算機科學領域已有深厚的實踐基礎。學者們通常會把可觀測性細化為三個更具體的研究方向：事件日誌、鏈路追蹤和聚合度量。這三個領域雖然各有側重點，但並非完全孤立，它們之間存在着天然的交集與互補性。</span></section><section style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;"><br></span></section><section style="margin-top: 8px;line-height: 1.75em;text-align: center;margin-bottom: 8px;"><span style="color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;"><img class="rich_pages wxw-img" data-imgfileid="503043773" data-ratio="0.5888888888888889" src="https://oscimg.oschina.net/oscnet/69822782-4580-4b1d-b1c2-5ee89714d645.png" data-type="png" data-w="1080" referrerpolicy="no-referrer"></span></section><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><br></p><ol class="list-paddingleft-1" style="list-style-type: decimal;"><li><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;">日誌 (Logging），展現的是應用運行而產生的事件或者程序在執行的過程中間產生的一些日誌，可以詳細解釋系統的運行狀態，但是存儲和查詢需要消耗大量的資源。所以往往使用過濾器減少數據量。</span></p></li><li><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;">度量 (Metrics)，是一種聚合數值，存儲空間很小，可以觀察系統的狀態和趨勢，但對於問題定位缺乏細節展示。這個時候使用等高線指標等多維數據結構來增強對於細節的表現力。例如統計一個服務的 TBS 的正確率、成功率、流量等，這是常見的針對單個指標或者某一個數據庫的。</span></p></li><li><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;">追蹤 (Tracing)，面向的是請求，可以輕鬆分析出請求中異常點，但與日誌有相同的問題就是資源消耗較大。通常也需要通過採樣的方式減少數據量。比如一次請求的範圍，也就是從瀏覽器或者手機端發起的任何一次調用，一個流程化的東西，需要軌跡去追蹤。</span></p></li></ol><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><br></p><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;">在工業界，歷經長期的競爭，日誌和度量領域的主導技術已逐漸明朗。日誌收集與分析方面，Elastic Stack（亦稱為 ELK Stack）已成為廣泛採納的技術選擇。然而，追蹤技術的發展路徑與日誌和度量領域顯然不同。追蹤技術高度依賴於特定的網絡協議和編程語言。服務間是通過 HTTP 還是 gRPC 通信，會直接決定追蹤實施的具體方法。同樣，服務是否採用 Java、Golang、還是 Node.js 編寫，也會影響到如何追蹤進程內調用堆棧。這種依賴性使得追蹤工具通常需要以插件或探針的形式進行深度集成，因而具有一定的侵入性。此外，由於追蹤技術需要適應不同的語言和網絡環境，追蹤領域很難形成單一的主導者。相反，市場上存在多樣化的產品，旨在滿足各種不同技術棧的追蹤需求。</span></p><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;"><br></span></p><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;">本文主要探討其中的追蹤下日誌內容。</span></p><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;"><br></span></p><section style="margin-bottom: 0px;outline: 0px;box-sizing: inherit;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);color: rgba(25, 26, 31, 0.9);font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 16px;text-align: center;visibility: visible;line-height: normal;"><span style="outline: 0px;font-size: 15px;letter-spacing: 1px;visibility: visible;"><img class="rich_pages wxw-img" data-imgfileid="503043771" data-ratio="0.3056872037914692" data-s="300,640" data-type="png" data-w="422" src="https://oscimg.oschina.net/oscnet/a8e72552-35db-4b13-b67f-29ad569034ae.png" style="outline: 0px;color: rgb(34, 34, 34);font-family: system-ui, -apple-system, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;visibility: visible !important;width: 117px !important;" referrerpolicy="no-referrer"></span></section><section style="margin-bottom: 0px;outline: 0px;font-family: system-ui, -apple-system, &quot;system-ui&quot;, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);color: rgb(34, 34, 34);text-align: center;visibility: visible;line-height: normal;"><span style="outline: 0px;font-family: -apple-system, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 18px;letter-spacing: 1px;visibility: visible;color: rgb(0, 17, 255);">鏈路追蹤</span></section><section style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><br></section><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;">分佈式鏈路追蹤公認的起源是 Google 在 2010 年發表的論文《Dapper : a Large-Scale Distributed Systems Tracing Infrastructure》，這篇論文介紹了 Google 從 2004 年開始使用的分佈式追蹤系統 Dapper 的實現原理。</span></p><section style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><br></section><section style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;text-align: left;"><span style="white-space: break-spaces;color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;"><span style="color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);">論文</span>《</span><span style="color: rgb(0, 0, 0);">Dapper : a Large-Scale Distributed Systems Tracing Infrastructure</span><span style="white-space: break-spaces;color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;">》地址：https://static.googleusercontent.com/media/research.google.com/zh-CN//archive/papers/dapper-2010-1.pdf</span></section><section style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;text-align: left;"><span style="white-space: break-spaces;color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;"><br></span></section><span id="OSC_h4_1"></span><h4 data-lake-id="ca6fa186228ff7efaa653334195896c8" data-wording="true" style="margin-top: 0.5em;margin-bottom: 8px;outline: 0px;letter-spacing: 0.544px;text-wrap: wrap;color: rgb(34, 34, 34);background-color: rgb(255, 255, 255);font-family: -apple-system-font, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;visibility: visible;line-height: 1.75em;"><span style="outline: 0px;visibility: visible;letter-spacing: 1px;color: rgb(0, 17, 255);"><strong style="outline: 0px;visibility: visible;"><span style="outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">▐</span></strong><strong style="outline: 0px;visibility: visible;"><span style="outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">&nbsp;&nbsp;</span></strong><strong style="outline: 0px;visibility: visible;"><span style="color: rgb(0, 17, 255);outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">基本原理</span></strong></span></h4><section style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;text-align: left;"><br></section><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><br></p><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;">分佈式鏈路追蹤的基本原理就是在分佈式應用的接口方法上設置一些觀察點，然後在入口節點給每個請求分配一個全局唯一的標識 TraceId。當請求流經這些觀察點時就會記錄一行對應的鏈路日誌（包含鏈路唯一標識，接口名稱，時間戳，主機信息等）。最後通過 TraceId 將一次請求的所有鏈路日誌進行組裝，就可以還原出該次請求的鏈路軌跡。</span></p><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;"><br></span></p><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;">分佈式鏈路追蹤實現請求回溯的關鍵點有兩個：一是低成本、高質量的觀察點設置，也就是鏈路插樁，確保追蹤的信息足夠豐富，能夠快速定位異常根因；二是保證鏈路上下文在不同環境下都能夠完整透傳，避免出現上下文丟失導致的斷鏈現象。</span></p><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;"><br></span></p><span id="OSC_h4_2"></span><h4 data-lake-id="ca6fa186228ff7efaa653334195896c8" data-wording="true" style="margin-top: 0.5em;margin-bottom: 8px;text-wrap: wrap;outline: 0px;letter-spacing: 0.544px;color: rgb(34, 34, 34);background-color: rgb(255, 255, 255);font-family: -apple-system-font, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;visibility: visible;line-height: 1.75em;"><span style="outline: 0px;visibility: visible;letter-spacing: 1px;color: rgb(0, 17, 255);"><strong style="outline: 0px;visibility: visible;"><span style="outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">▐</span></strong><strong style="outline: 0px;visibility: visible;"><span style="outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">&nbsp;&nbsp;</span></strong><strong style="outline: 0px;visibility: visible;"><span style="color: rgb(0, 17, 255);outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">基礎術語</span></strong></span></h4><section style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><br></section><section style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;">雖然分佈式鏈路追蹤的實現方式多種多樣，但是仍然有一些基礎術語在業界具備廣泛的共識。</span></section><section style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><br></section><ul class="list-paddingleft-1" style="list-style-type: disc;"><li style="color: rgb(0, 17, 255);"><span id="OSC_h4_3"></span><h4 data-cangjie-key="57" data-cangjie-leaf-block="true" data-type="heading-4" style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;color: rgb(0, 17, 255);">Trace</span></h4></li></ul><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><br></p><section style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;">一條 Trace 代表一次入口請求在 IT 系統內的完整調用軌跡及其關聯數據集合。其中，全局唯一的鏈路標識 TraceId，是最具代表的一個屬性。通過 TraceId 才能將同一個請求分散在不同節點的鏈路數據準確的關聯起來，實現請求粒度的「確定性關聯」價值。</span></section><section style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;"><br></span></section><section style="margin-top: 8px;line-height: 1.75em;text-align: center;margin-bottom: 8px;"><span style="color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;"><img class="rich_pages wxw-img" data-backh="176" data-backw="578" data-imgfileid="503043775" data-ratio="0.30462962962962964" src="https://oscimg.oschina.net/oscnet/5f12720d-9501-485d-8784-95fb2eb5de4d.png" data-type="png" data-w="1080" style="width: 100%;height: auto;" referrerpolicy="no-referrer"></span></section><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><br></p><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;">以集團的 Eagleeye 設計的 traceId 設計為例，根據這個 id，可以知道這個請求在 2022-10-18 10:10:40 發出，被 11.15.148.83 機器上進程號為 14031 的 Nginx（對應標識位 e）接收到。其中的四位原子遞增數從 0-9999，目的是為了防止單機併發造成 traceId 碰撞。</span></p><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><br></p><ul class="list-paddingleft-1" style="list-style-type: disc;"><li style="color: rgb(0, 17, 255);"><span id="OSC_h4_4"></span><h4 data-cangjie-key="70" data-cangjie-leaf-block="true" data-type="heading-4" style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;color: rgb(0, 17, 255);">Span</span></h4></li></ul><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><br></p><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;">Span 是一個操作，它代表系統中一個邏輯運行單元。Span 之間通過嵌套或者順序排列建立因果關係。Span 包含以下對象</span></p><ol class="list-paddingleft-1" style="list-style-type: decimal;"><li><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="background-color: rgb(255, 255, 255);color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;font-size: 15px;letter-spacing: 1px;text-align: left;white-space-collapse: break-spaces;">Operation Name：描述了當前接口的行為語義，比如 /api/createOrder 代表執行了一次創建訂單的動作。</span></p></li><li><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="background-color: rgb(255, 255, 255);color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;font-size: 15px;letter-spacing: 1px;text-align: left;white-space-collapse: break-spaces;">SpanId/ParentSpanId：接口調用的層級標識，用於還原 Trace 內部的層次調用關係。</span></p></li><li><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="background-color: rgb(255, 255, 255);color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;font-size: 15px;letter-spacing: 1px;text-align: left;white-space-collapse: break-spaces;">Start/FinishTime：接口調用的開始和結束時間，二者相減就是該次調用的耗時。</span></p></li><li><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="background-color: rgb(255, 255, 255);color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;font-size: 15px;letter-spacing: 1px;text-align: left;white-space-collapse: break-spaces;">StatusCode：響應狀態，標識當次調用是成功或失敗。</span></p></li><li><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="background-color: rgb(255, 255, 255);color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;font-size: 15px;letter-spacing: 1px;text-align: left;white-space-collapse: break-spaces;">Tags &amp; Events：調用附加信息，詳見下面的描述。</span></p></li></ol><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><br></p><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;text-align: center;"><span style="color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;"><img class="rich_pages wxw-img" data-backh="453" data-backw="578" data-imgfileid="503043778" data-ratio="0.7842592592592592" src="https://oscimg.oschina.net/oscnet/cc981138-638b-46de-9e82-6d487c0af89a.png" data-type="png" data-w="1080" style="width: 100%;height: auto;" referrerpolicy="no-referrer"></span></p><section style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><br></section><section style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;">其中最重要的是 SpanId 的設計。同樣以阿里的 Eagleeye 的 spanId（rpcId）設計為例，Eagleeye 設計了 RpcId 來區別同一個調用鏈下多個網絡調用的順序和嵌套層次，用 0.X1.X2.X3.....Xi 來表示，根節點的 RpcId 固定從 0 開始，id 的位數（"."的數量）表示了 Span 在這棵樹中的層級，Id 最後一位表示了 Span 在這一層級中的順序。那麼給定同一個 Trace 中的所有 RpcId，便可以很容易還原出一個完成的調用鏈：</span></section><section class="code-snippet__fix code-snippet__js"><pre class="code-snippet__js" data-lang="css"><code><span class="code-snippet_outer">- 0</span></code><code><span class="code-snippet_outer">  - 0.1</span></code><code><span class="code-snippet_outer">    - 0.1.1</span></code><code><span class="code-snippet_outer">    - 0.1.2</span></code><code><span class="code-snippet_outer">      - 0.1.2.1</span></code><code><span class="code-snippet_outer">  - 0.2</span></code><code><span class="code-snippet_outer">    - 0.2.1</span></code><code><span class="code-snippet_outer">  - 0.3</span></code><code><span class="code-snippet_outer">    - 0.3.1</span></code><code><span class="code-snippet_outer">      - 0.3.1.1</span></code><code><span class="code-snippet_outer">    - 0.3.2</span></code></pre></section><section style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><br></section><ul class="list-paddingleft-1" style="list-style-type: disc;"><li style="color: rgb(0, 17, 255);"><span id="OSC_h4_5"></span><h4 data-cangjie-key="104" data-cangjie-leaf-block="true" data-type="heading-4" style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;color: rgb(0, 17, 255);">Tags</span></h4></li></ul><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;"><br></span></p><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;">如果需要進一步記錄請求的行為特徵，可以使用 Tags 來擴展語義。Tags 是一組由 {Key:Value} 組成的鍵值對集合，描述這一次接口調用的具體屬性。比如 Eagleeye 裏就有「Tags」的實現（UserData），阿里的全鏈路壓測標識就是通過 UserData 裏傳遞實現的。</span></p><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;"><br></span></p><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;">在分佈式追蹤的上下文中，一個 Trace 可被視為一個有向無環圖，其中每個 Span 代表圖中的一個節點，而節點之間的連接則表示為鏈接。觀察這樣的圖表，我們可以看到一個單獨的 Span 節點可能擁有多條鏈接，這表明它具有多個子 Span。這種結構揭示了各個操作間的父子或者因果關係，從而使得追蹤整個請求的流程成為可能。</span></p><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;"><br></span></p><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;">Trace 定義了 Span 間兩種基本關係：</span></p><ol class="list-paddingleft-1" style="list-style-type: decimal;"><li><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="background-color: rgb(255, 255, 255);color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;font-size: 15px;letter-spacing: 1px;text-align: left;white-space-collapse: break-spaces;">ChildOf：表示父 Span 在一定程度上依賴子 Span。</span></p></li><li><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="background-color: rgb(255, 255, 255);color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;font-size: 15px;letter-spacing: 1px;text-align: left;white-space-collapse: break-spaces;">FollowsFrom：表示父 Span 完全不依賴其子 Span 的結果。</span></p></li></ol><section style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><br></section><span id="OSC_h4_6"></span><h4 data-lake-id="ca6fa186228ff7efaa653334195896c8" data-wording="true" style="margin-top: 0.5em;margin-bottom: 8px;outline: 0px;letter-spacing: 0.544px;text-wrap: wrap;color: rgb(34, 34, 34);background-color: rgb(255, 255, 255);font-family: -apple-system-font, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;visibility: visible;line-height: 1.75em;"><span style="outline: 0px;visibility: visible;letter-spacing: 1px;color: rgb(0, 17, 255);"><strong style="outline: 0px;visibility: visible;"><span style="outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">▐</span></strong><strong style="outline: 0px;visibility: visible;"><span style="outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">&nbsp;&nbsp;</span></strong><strong style="outline: 0px;visibility: visible;"><span style="color: rgb(0, 17, 255);outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">鏈路追蹤的挑戰</span></strong></span></h4><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><br></p><ul class="list-paddingleft-1" style="list-style-type: disc;"><li style="color: rgb(0, 17, 255);"><span id="OSC_h4_7"></span><h4 data-cangjie-key="125" data-cangjie-leaf-block="true" data-type="heading-4" style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;color: rgb(0, 17, 255);">日誌存儲</span></h4></li></ul><section style="margin-bottom: 8px;"><br></section><section style="margin-bottom: 8px;"><span style="color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;">本地存儲埋點數據涉及磁盤操作，而磁盤 I/O 速度通常較慢。在高併發的環境中，如果採用同步刷新磁盤的方式，可能會對原有業務的性能造成顯著影響。因此，在鏈路追蹤系統中進行數據埋點時，應當儘量減少對系統的性能損耗，確保對原業務的邏輯和性能具有無侵入性。這意味着追蹤系統的設計需要儘量輕量化，並採取策略如異步處理、緩存等方法來降低對業務性能的影響。</span></section><p style="margin-bottom: 8px;"><br></p><span id="OSC_h5_8"></span><h5 data-cangjie-key="131" data-cangjie-leaf-block="true" data-type="heading-5" style="margin-bottom: 8px;"><span style="font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;color: rgb(0, 17, 255);">併發環形隊列</span></h5><p style="margin-bottom: 8px;"><br></p><p style="margin-bottom: 8px;"><span style="color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;">集團的 Eagleeye 採用併發環形隊列存儲 Trace 數據，如下圖所示：</span></p><p style="margin-bottom: 8px;text-align: center;"><span style="color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;"><img class="rich_pages wxw-img" data-backh="413" data-backw="578" data-imgfileid="503043774" data-ratio="0.7138888888888889" src="https://oscimg.oschina.net/oscnet/f3ce3db2-6786-4434-9a5c-ee90beacf3a2.png" data-type="png" data-w="1080" style="width: 100%;height: auto;" referrerpolicy="no-referrer"></span></p><p style="margin-bottom: 8px;"><br></p><p style="margin-bottom: 8px;"><span style="color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;">環形隊列確實是日誌框架中實現異步日誌寫入的一種常用技術。在這種隊列中，存在兩個關鍵的指針，即讀指針（take）和寫指針（put）。</span></p><ol class="list-paddingleft-1" style="list-style-type: decimal;"><li><p style="margin-bottom: 8px;"><span style="background-color: rgb(255, 255, 255);color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;font-size: 15px;letter-spacing: 1px;text-align: left;white-space-collapse: break-spaces;">讀指針（take）: 它指向隊列中的最舊數據，即下一條待消費的數據。</span></p></li><li><p style="margin-bottom: 8px;"><span style="background-color: rgb(255, 255, 255);color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;font-size: 15px;letter-spacing: 1px;text-align: left;white-space-collapse: break-spaces;">寫指針（put）: 它指向隊列中下一個將要存放新數據的位置。</span></p></li></ol><p style="margin-bottom: 8px;"><br></p><p style="margin-bottom: 8px;"><span style="color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;">這個隊列被設計為支持原子性的讀寫操作，以保證在多線程環境中數據的一致性。這意味着，當一個線程在執行讀或寫操作時，其他線程不能同時修改被操作的數據項。</span></p><p style="margin-bottom: 8px;"><span style="color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;"><br></span></p><p style="margin-bottom: 8px;"><span style="color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;">讀指針和寫指針按同一方向（如時鐘方向）移動，隨着數據的不斷生產和消費，這兩個指針在隊列中循環前進。然而，如果生產數據的速度持續超過消費速度，寫指針最終會「追上」讀指針，這種情況被稱為「套圈」。</span></p><p style="margin-bottom: 8px;"><span style="color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;"><br></span></p><p style="margin-bottom: 8px;"><span style="color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;">當出現套圈現象時，隊列將根據預設的策略來處理新產生的數據。常見的處理策略包括：</span></p><ol class="list-paddingleft-1" style="list-style-type: decimal;"><li><p style="margin-bottom: 8px;"><span style="background-color: rgb(255, 255, 255);color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;font-size: 15px;letter-spacing: 1px;text-align: left;white-space-collapse: break-spaces;">丟棄即將寫入的新數據，以保護隊列中已存在的數據不被覆蓋。</span></p></li><li><p style="margin-bottom: 8px;"><span style="background-color: rgb(255, 255, 255);color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;font-size: 15px;letter-spacing: 1px;text-align: left;white-space-collapse: break-spaces;">覆蓋隊列中最舊的數據，這意味着最先入隊的數據將被新數據取代，這種策略適用於對最新數據保持最高優先級的場景。</span></p></li></ol><p style="margin-bottom: 8px;"><span style="color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;"><br></span></p><p style="margin-bottom: 8px;"><span style="color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;">選擇哪種策略取決於具體應用場景的需求和對數據丟失的容忍度。環形隊列的這種設計使得它在處理高併發日誌數據時非常高效，能夠在保證性能的同時減少資源佔用。</span></p><p style="margin-bottom: 8px;"><span style="color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;"><br></span></p><p style="margin-bottom: 8px;"><span style="color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;">Skywalking 在實現上有所區別，採用分區的 QueueBuffer 存儲 Trace 數據，多個消費線程通過 Driver 平均分配到各個 QueueBuffer 上進行數據消費：</span></p><p style="margin-bottom: 8px;text-align: center;"><span style="color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;"><img class="rich_pages wxw-img" data-backh="385" data-backw="578" data-imgfileid="503043777" data-ratio="0.6657407407407407" src="https://oscimg.oschina.net/oscnet/7b68e2bc-5c2f-4ebb-972d-f9143207d775.png" data-type="png" data-w="1080" style="width: 100%;height: auto;" referrerpolicy="no-referrer"></span></p><p style="margin-bottom: 8px;"><br></p><p style="margin-bottom: 8px;"><span style="color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;">在高性能的應用場景中，隊列的實現方式對於整體性能有顯著的影響。QueueBuffer 通常有兩種不同的實現方式：</span></p><ol class="list-paddingleft-1" style="list-style-type: decimal;"><li><p style="margin-bottom: 8px;"><span style="background-color: rgb(255, 255, 255);color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;font-size: 15px;letter-spacing: 1px;text-align: left;white-space-collapse: break-spaces;">基於 JDK 的阻塞隊列：這種實現方式利用了 Java 標準庫中的 java.util.concurrent 包下的阻塞隊列，例如 ArrayBlockingQueue 或 LinkedBlockingQueue。這些隊列內部處理了線程同步的邏輯，使得在多線程環境下生產者和消費者可以安全地進行併發操作。基於 JDK 的阻塞隊列通常用於服務端，因為服務端可以承受相對較重的負載，並且更注重於穩定性和線程安全。</span></p></li><li><p style="margin-bottom: 8px;"><span style="background-color: rgb(255, 255, 255);color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;font-size: 15px;letter-spacing: 1px;text-align: left;white-space-collapse: break-spaces;">普通數組 + 原子下標：這種實現方式使用了一個普通的數組，並結合了原子操作的下標（如 AtomicInteger）用於記錄讀寫的位置。這種隊列不是阻塞的，因此，當隊列滿時，它需要顯式地處理生產者的等待邏輯，當隊列空時，需要處理消費者的等待邏輯。SkyWalking 的 Agent 端採用這種方式，因為它相對更輕量級，且在高吞吐量場景下提供了更高的性能。Agent 端的性能尤其重要，因為它直接運行在應用程序內部，性能的任何抖動都可能影響到應用程序本身的性能。</span></p></li></ol><p style="margin-bottom: 8px;"><span style="color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;"><br></span></p><p style="margin-bottom: 8px;"><span style="color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;">在普通數組 + 原子下標的實現中，有一些值得關注的點：</span></p><ol class="list-paddingleft-1" style="list-style-type: decimal;"><li><p style="margin-bottom: 8px;"><span style="background-color: rgb(255, 255, 255);color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;font-size: 15px;letter-spacing: 1px;text-align: left;white-space-collapse: break-spaces;">原子性操作：通過使用原子類（如 AtomicInteger），可以確保在併發場景下修改下標時的線程安全性，避免了鎖的開銷。</span></p></li><li><p style="margin-bottom: 8px;"><span style="background-color: rgb(255, 255, 255);color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;font-size: 15px;letter-spacing: 1px;text-align: left;white-space-collapse: break-spaces;">非阻塞算法：由於不使用阻塞隊列，這種實現可以採用非阻塞算法來優化性能，尤其是在高併發的生產者-消費者模型中。</span></p></li><li><p style="margin-bottom: 8px;"><span style="background-color: rgb(255, 255, 255);color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;font-size: 15px;letter-spacing: 1px;text-align: left;white-space-collapse: break-spaces;">迴繞邏輯：當數組達到其末端時，讀寫下標需要回繞到數組的開始，形成一個環狀結構，這就是所謂的環形緩衝區。</span></p></li><li><p style="margin-bottom: 8px;"><span style="background-color: rgb(255, 255, 255);color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;font-size: 15px;letter-spacing: 1px;text-align: left;white-space-collapse: break-spaces;">飽和策略：需要定義當隊列滿時的行為，是等待、丟棄數據還是覆蓋舊數據。</span></p></li><li><p style="margin-bottom: 8px;"><span style="color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;">總的來説，不同的 QueueBuffer 實現方式適用於不同的使用場景</span></p></li></ol><p style="margin-bottom: 8px;"><br></p><ul class="list-paddingleft-1" style="list-style-type: disc;"><li style="color: rgb(0, 17, 255);"><span id="OSC_h4_9"></span><h4 data-cangjie-key="208" data-cangjie-leaf-block="true" data-type="heading-4" style="margin-bottom: 8px;"><span style="font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;color: rgb(0, 17, 255);">日誌傳輸</span></h4></li></ul><p style="margin-bottom: 8px;"><br></p><p style="margin-bottom: 8px;"><img class="rich_pages wxw-img" data-backh="210" data-backw="578" data-imgfileid="503043776" data-ratio="0.362962962962963" src="https://oscimg.oschina.net/oscnet/f5fd8941-d2db-4445-8e7d-ff95fae1ddf5.png" data-type="png" data-w="1080" style="width: 100%;height: auto;" referrerpolicy="no-referrer"></p><p style="margin-bottom: 8px;"><br></p><p style="margin-bottom: 8px;"><span style="color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;">鷹眼（EagleEye）和 SkyWalking 採用了不同的數據採集及傳輸策略，每種方法都有其適用場景和相應的權衡。</span></p><p style="margin-bottom: 8px;"><span style="color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;"><br></span></p><p style="margin-bottom: 8px;"><span style="color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;">鷹眼系統首先將數據存儲到本地日誌文件中，然後利用一個代理（agent）來收集這些日誌並將其傳輸到服務端。這種基於日誌加邊車代理的方法使得數據採集可以在不直接幹擾主應用邏輯的情況下進行，但這也意味着需要處理日誌文件的管理和代理的維護。</span></p><p style="margin-bottom: 8px;"><span style="color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;"><br></span></p><p style="margin-bottom: 8px;"><span style="color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;">相比之下，SkyWalking 提供了 gRPC 和 Kafka 兩種基於服務的數據傳輸方式，這使得數據可以更實時地傳輸到處理後端。gRPC 是一種高性能的遠程過程調用（RPC）框架，Kafka 是一個分佈式流處理平台，兩者都能有效地處理大量的數據流。</span></p><p style="margin-bottom: 8px;"><span style="color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;"><br></span></p><p style="margin-bottom: 8px;"><span style="color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;">從架構上看，SkyWalking 採取了分離應用層埋點和中間件代碼的策略，這在某種程度上實現了應用級別的透明性。用户不需要在應用代碼中直接管理追蹤邏輯，而是依賴中間件層的插件來自動完成數據的採集。然而，這種方式意味着當中間件需要升級時，相關的插件也可能需要更新，這可能在維護方面引入一些挑戰。</span></p><p style="margin-bottom: 8px;"><span style="color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;"><br></span></p><p style="margin-bottom: 8px;"><span style="color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;">鷹眼的埋點方法由專門的中間件團隊來維護，對於上層應用來説同樣是透明的，這意味着應用開發者不需要關心數據採集的具體實現細節。這種方法非常適合阿里巴巴集團內部的環境，因為它能夠提供統一的標準和容易控制的集成點。</span></p><p style="margin-bottom: 8px;"><span style="color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;"><br></span></p><p style="margin-bottom: 8px;"><span style="color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;">總的來説，這兩種系統提供了不同的解決方案，各自的優點和挑戰都值得在選擇和實施追蹤系統時予以考慮。</span></p><p style="margin-bottom: 8px;"><br></p><ul class="list-paddingleft-1" style="list-style-type: disc;"><li style="color: rgb(0, 17, 255);"><span id="OSC_h4_10"></span><h4 data-cangjie-key="233" data-cangjie-leaf-block="true" data-type="heading-4" style="margin-bottom: 8px;"><span style="font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;color: rgb(0, 17, 255);">數據埋點</span></h4></li></ul><p style="margin-bottom: 8px;"><br></p><p style="margin-bottom: 8px;"><span style="color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;">在分佈式鏈路追蹤系統中，方法增強（通常稱為「埋點」）指的是在代碼中插入額外的邏輯來捕獲和記錄執行信息，這是實現追蹤的核心技術。Dapper，谷歌的分佈式追蹤系統，提出的設計原則要求方法增強必須同時滿足應用級透明性和低開銷這兩個關鍵條件：</span></p><ol class="list-paddingleft-1" style="list-style-type: decimal;"><li><p style="margin-bottom: 8px;"><span style="background-color: rgb(255, 255, 255);color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;font-size: 15px;letter-spacing: 1px;text-align: left;white-space-collapse: break-spaces;">應用級透明：開發者不需要修改業務代碼或僅需要極少的修改即可實現埋點，這意味着追蹤邏輯對應用層是不可見或幾乎不可見的。</span></p></li><li><p style="margin-bottom: 8px;"><span style="background-color: rgb(255, 255, 255);color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;font-size: 15px;letter-spacing: 1px;text-align: left;white-space-collapse: break-spaces;">低開銷：埋點操作對系統的性能影響應當儘可能小，以避免追蹤邏輯本身成為系統性能的瓶頸。</span></p></li></ol><p style="margin-bottom: 8px;"><br></p><p style="margin-bottom: 8px;"><span style="color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;">現在，我們來比較阿里巴巴的 EagleEye 與開源項目 SkyWalking 在埋點技術上的不同做法：</span></p><p style="margin-bottom: 8px;"><br></p><span id="OSC_h5_11"></span><h5 data-cangjie-key="248" data-cangjie-leaf-block="true" data-type="heading-5" style="margin-bottom: 8px;"><span style="font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;color: rgb(0, 17, 255);">硬編碼</span></h5><p style="margin-bottom: 8px;"><span style="background-color: rgb(255, 255, 255);color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;font-size: 15px;letter-spacing: 1px;text-align: left;white-space-collapse: break-spaces;"><br></span></p><p style="margin-bottom: 8px;"><span style="background-color: rgb(255, 255, 255);color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;font-size: 15px;letter-spacing: 1px;text-align: left;white-space-collapse: break-spaces;">EagleEye：阿里巴巴的 EagleEye 通過中間件層進行數據採集和追蹤，通常這由集團的中間件團隊負責維護。這種中間件集成方式允許上層應用無需知曉具體的追蹤邏輯，因此在應用級別上保持了較高的透明度。然而，這種方法可能會在中間件升級時需要同步更新埋點邏輯，增加了維護的複雜度。</span></p><h5 data-cangjie-key="254" data-cangjie-leaf-block="true" data-type="heading-5" style="margin-bottom: 8px;"><br></h5><span id="OSC_h5_12"></span><h5 data-cangjie-key="254" data-cangjie-leaf-block="true" data-type="heading-5" style="margin-bottom: 8px;"><span style="font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;color: rgb(0, 17, 255);">字節碼增強</span></h5><p style="margin-bottom: 8px;"><br></p><p style="margin-bottom: 8px;"><span style="background-color: rgb(255, 255, 255);color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;font-size: 15px;letter-spacing: 1px;text-align: left;white-space-collapse: break-spaces;">SkyWalking：SkyWalking 提供了自動插樁的能力，通常通過 Java Agent 技術在運行時不侵入地修改字節碼，插入追蹤代碼。這種方式對業務代碼完全透明，開發者無需修改任何業務邏輯即可實現埋點。同時，SkyWalking 旨在保持低開銷，以減少對應用性能的影響。由於它是一個開源項目，SkyWalking 更容易適應多樣化的技術棧和快速發展的生態。</span></p><p style="margin-bottom: 8px;"><span style="background-color: rgb(255, 255, 255);color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;font-size: 15px;letter-spacing: 1px;text-align: left;white-space-collapse: break-spaces;"><br></span></p><p style="margin-bottom: 8px;"><span style="color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space: break-spaces;background-color: rgb(255, 255, 255);font-size: 15px;letter-spacing: 1px;">兩種方法各有優勢和劣勢，EagleEye 的中間件集成方式適合阿里巴巴這樣擁有統一技術棧和強大內部支持的大型企業環境。而 SkyWalking 的自動插樁技術則提供了靈活性和廣泛的社區支持，更適合多變的技術環境和需要快速適應新技術的公司。選擇哪種埋點方式取決於企業的具體需求、技術棧的複雜性以及維護能力。</span></p><p style="margin-bottom: 8px;"><br></p><p style="margin-bottom: 8px;"><img class="rich_pages wxw-img" data-backh="416" data-backw="578" data-imgfileid="503043781" data-ratio="0.7203703703703703" src="https://oscimg.oschina.net/oscnet/02b0c104-99c2-46b2-af93-d3cc3574ec19.png" data-type="png" data-w="1080" style="width: 100%;height: auto;" referrerpolicy="no-referrer"></p><p style="margin-bottom: 8px;"><br></p><ul class="list-paddingleft-1" style="list-style-type: disc;"><li style="color: rgb(0, 17, 255);"><span id="OSC_h4_13"></span><h4 data-cangjie-key="270" data-cangjie-leaf-block="true" data-type="heading-4" style="margin-bottom: 8px;"><span style="background-color: rgb(255, 255, 255);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;font-size: 15px;letter-spacing: 1px;text-align: left;white-space-collapse: break-spaces;color: rgb(0, 17, 255);">跨線程傳遞</span></h4></li></ul><p style="margin-bottom: 8px;"><br></p><p style="margin-bottom: 8px;"><span style="background-color: rgb(255, 255, 255);color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;font-size: 15px;letter-spacing: 1px;text-align: left;white-space-collapse: break-spaces;">在多線程併發調用環境下的數據鏈路埋點也是一個值得關注問題，當一個服務考慮性能問題可能會起多個線程同時調用其他不同的模塊。鏈路系統如何保證這些調用還是符合 openTrace 規範，保證 traceId 和 spanId 有序。</span></p><p style="margin-bottom: 8px;"><span style="background-color: rgb(255, 255, 255);color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;font-size: 15px;letter-spacing: 1px;text-align: left;white-space-collapse: break-spaces;"><br></span></p><p style="margin-bottom: 8px;"><span style="background-color: rgb(255, 255, 255);color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;font-size: 15px;letter-spacing: 1px;text-align: left;white-space-collapse: break-spaces;">目前 Java 生態下，普遍的思路是用父線程的 ThreadLocal 中拿到保存的 trace 信息，然後作為參數傳遞給子線程，子線程在初始化的時候設置 trace 信息來避免丟失。</span></p><p style="margin-bottom: 8px;"><span style="background-color: rgb(255, 255, 255);color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;font-size: 15px;letter-spacing: 1px;text-align: left;white-space-collapse: break-spaces;"><br></span></p><p style="margin-bottom: 8px;"><span style="background-color: rgb(255, 255, 255);color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;font-size: 15px;letter-spacing: 1px;text-align: left;white-space-collapse: break-spaces;">值得關注的是，集團提供了 InheritableThreadLocals 的子類 TransmittableThreadLocal，解決了 InheritableThreadLocal 只能再 new Thread 的時候傳遞本地變量，無法應用到線程池的問題。可以應用來作鏈路追蹤，傳遞變量等用途。美團也實現了類似的子類 TransmissibleThreadLocal。</span></p><p style="margin-bottom: 8px;"><span style="background-color: rgb(255, 255, 255);color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;font-size: 15px;letter-spacing: 1px;text-align: left;white-space-collapse: break-spaces;"><br></span></p><p style="margin-bottom: 8px;text-align: center;"><span style="background-color: rgb(255, 255, 255);color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;font-size: 15px;letter-spacing: 1px;text-align: left;white-space-collapse: break-spaces;"><img class="rich_pages wxw-img" data-backh="139" data-backw="578" data-imgfileid="503043783" data-ratio="0.23981481481481481" src="https://oscimg.oschina.net/oscnet/2250df53-b8a1-467b-87b6-5df0f2ef006b.png" data-type="png" data-w="1080" style="width: 100%;height: auto;" referrerpolicy="no-referrer"></span></p><p style="margin-bottom: 8px;"><br></p><p style="margin-bottom: 0px;outline: 0px;font-family: system-ui, -apple-system, &quot;system-ui&quot;, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;text-align: center;visibility: visible;color: rgb(34, 34, 34);background-color: rgb(255, 255, 255);line-height: normal;"><img class="rich_pages wxw-img" data-imgfileid="503043779" data-ratio="0.3056872037914692" data-s="300,640" src="https://oscimg.oschina.net/oscnet/511961a3-41a2-4016-a594-ca4ac7e67ed0.png" data-type="png" data-w="422" style="outline: 0px;letter-spacing: 0.544px;font-size: 14px;visibility: visible !important;width: 117px !important;" referrerpolicy="no-referrer"></p><p style="margin-bottom: 0px;outline: 0px;font-family: system-ui, -apple-system, &quot;system-ui&quot;, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;text-align: center;background-color: rgb(255, 255, 255);color: rgb(100, 99, 99);font-size: 15px;line-height: normal;"><span style="outline: 0px;font-family: -apple-system, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 18px;color: rgb(0, 17, 255);letter-spacing: 1px;">日誌收集和分析</span></p><p style="margin-bottom: 8px;"><br></p><p style="margin-bottom: 8px;"><span style="background-color: rgb(255, 255, 255);color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;font-size: 15px;letter-spacing: 1px;text-align: left;white-space-collapse: break-spaces;">日誌用來記錄系統運行期間發生過的離散事件，在目前複雜的分佈式系統中，很難只依靠 tail、grep、awk 來從單台機器的日誌中挖掘信息了，往往還要有專門的全局查詢和可視化功能。此時，從打印日誌到分析查詢之間，還隔着收集、緩衝、聚合、加工、索引、存儲等若干個步驟，如下圖所示：</span></p><p style="margin-bottom: 8px;text-align: center;"><span style="background-color: rgb(255, 255, 255);color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;font-size: 15px;letter-spacing: 1px;text-align: left;white-space-collapse: break-spaces;"><img class="rich_pages wxw-img" data-backh="109" data-backw="578" data-imgfileid="503043780" data-ratio="0.18915801614763553" src="https://oscimg.oschina.net/oscnet/6b1e302e-c499-4621-8887-2ad847d858dd.png" data-type="png" data-w="867" style="width: 100%;height: auto;" referrerpolicy="no-referrer"></span></p><p style="margin-bottom: 8px;"><br></p><p style="margin-bottom: 8px;"><span style="background-color: rgb(255, 255, 255);color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;font-size: 15px;letter-spacing: 1px;text-align: left;white-space-collapse: break-spaces;">提到日誌實時分析，大部分人第一想到是社區很火 ELK Stack。ELK 方案上手難度小、開源材料眾多、在社區中有大量的使用案例。於此同時，阿里巴巴集團也推出了對日誌場景的解決方案產品日誌服務 (SLS/Log) 。下面將先後介紹這兩種框架並分析優劣。</span></p><p style="margin-bottom: 8px;"><br></p><span id="OSC_h4_14"></span><h4 data-lake-id="ca6fa186228ff7efaa653334195896c8" data-wording="true" style="margin-top: 8px;margin-bottom: 8px;outline: 0px;letter-spacing: 0.544px;text-wrap: wrap;color: rgb(34, 34, 34);background-color: rgb(255, 255, 255);font-family: -apple-system-font, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;visibility: visible;line-height: 1.75em;"><span style="outline: 0px;visibility: visible;letter-spacing: 1px;color: rgb(0, 17, 255);"><strong style="outline: 0px;visibility: visible;"><span style="outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">▐</span></strong><strong style="outline: 0px;visibility: visible;"><span style="outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">&nbsp;&nbsp;</span></strong><strong style="outline: 0px;visibility: visible;"><span style="color: rgb(0, 17, 255);outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">開源的 ELK 方案</span></strong></span></h4><section style="margin-bottom: 8px;"><span style="background-color: rgb(255, 255, 255);color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;font-size: 15px;letter-spacing: 1px;text-align: left;white-space-collapse: break-spaces;"><br></span></section><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="background-color: rgb(255, 255, 255);color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;font-size: 15px;letter-spacing: 1px;text-align: left;white-space-collapse: break-spaces;">ELK Stack 是一個縮略詞，用來描述由三個常見項目組成的堆棧：Elasticsearch、Logstash 和 Kibana。ELK Stack 通常被稱為 Elasticsearch，作用是聚合來自所有系統和應用程序的日誌，分析這些日誌，並創建可視化來進行應</span><span style="background-color: rgb(255, 255, 255);color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space-collapse: break-spaces;font-size: 15px;letter-spacing: 1px;">用程序和基礎設施監控、更快的故障排除、安全分析等。</span></p><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="background-color: rgb(255, 255, 255);color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space-collapse: break-spaces;font-size: 15px;letter-spacing: 1px;"><br></span></p><span id="OSC_h5_15"></span><h5 data-cangjie-key="311" data-cangjie-leaf-block="true" data-type="heading-5" style="box-sizing: inherit;font-weight: 700;color: rgb(34, 35, 40);font-size: 11pt;font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;letter-spacing: normal;white-space: pre-wrap;background-color: rgb(255, 255, 255);text-align: left;margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;">E = Elasticsearch&nbsp;</span></h5><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;">Elasticsearch 是在 Apache Lucene 上構建的分佈式搜索和分析引擎。對各種語言、高性能和無架構 JSON 文檔的支持使 Elasticsearch 成為各種日誌分析和搜索使用案例的理想選擇。&nbsp;</span></p><h5 data-cangjie-key="317" data-cangjie-leaf-block="true" data-type="heading-5" style="box-sizing: inherit;font-weight: 700;color: rgb(34, 35, 40);font-size: 11pt;font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;letter-spacing: normal;white-space: pre-wrap;background-color: rgb(255, 255, 255);text-align: left;margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;"><br></span></h5><span id="OSC_h5_16"></span><h5 data-cangjie-key="317" data-cangjie-leaf-block="true" data-type="heading-5" style="box-sizing: inherit;font-weight: 700;color: rgb(34, 35, 40);font-size: 11pt;font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;letter-spacing: normal;white-space: pre-wrap;background-color: rgb(255, 255, 255);text-align: left;margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;">L = Logstash</span></h5><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;">Logstash 是一個開源數據攝取工具，允許從各種來源收集數據，轉換數據，並將數據發送到希望的目標。</span></p><h5 data-cangjie-key="323" data-cangjie-leaf-block="true" data-type="heading-5" style="box-sizing: inherit;font-weight: 700;color: rgb(34, 35, 40);font-size: 11pt;font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;letter-spacing: normal;white-space: pre-wrap;background-color: rgb(255, 255, 255);text-align: left;margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;"><br></span></h5><span id="OSC_h5_17"></span><h5 data-cangjie-key="323" data-cangjie-leaf-block="true" data-type="heading-5" style="box-sizing: inherit;font-weight: 700;color: rgb(34, 35, 40);font-size: 11pt;font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;letter-spacing: normal;white-space: pre-wrap;background-color: rgb(255, 255, 255);text-align: left;margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;">K = Kibana</span></h5><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;">Kibana 是一種數據可視化和挖掘工具，可以用於日誌和時間序列分析、應用程序監控和運營智能使用案例。</span></p><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><br></p><ul class="list-paddingleft-1" style="list-style-type: disc;"><li style="color: rgb(0, 17, 255);"><span id="OSC_h4_18"></span><h4 data-cangjie-key="329" data-cangjie-leaf-block="true" data-type="heading-4" style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="background-color: rgb(255, 255, 255);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;font-size: 15px;letter-spacing: 1px;text-align: left;white-space-collapse: break-spaces;color: rgb(0, 17, 255);">收集與緩衝</span></h4></li></ul><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><br></p><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="background-color: rgb(255, 255, 255);color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;font-size: 15px;letter-spacing: 1px;text-align: left;white-space-collapse: break-spaces;">寫日誌是在服務節點中進行的，但我們不可能在每個節點都單獨建設日誌查詢功能。這不是資源或工作量的問題，而是分佈式系統處理一個請求要跨越多個服務節點，為了能看到跨節點的全部日誌，就要有能覆蓋整個鏈路的全局日誌系統。這個需求決定了每個節點輸出日誌到文件後，必須將日誌文件統一收集起來集中存儲、索引，由此便催生了專門的日誌收集器。</span></p><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="background-color: rgb(255, 255, 255);color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;font-size: 15px;letter-spacing: 1px;text-align: left;white-space-collapse: break-spaces;"><br></span></p><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="background-color: rgb(255, 255, 255);color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;font-size: 15px;letter-spacing: 1px;text-align: left;white-space-collapse: break-spaces;">最初，ELK 中日誌收集與下一節要講的加工聚合的職責都是由 Logstash 來承擔的，Logstash 除了部署在各個節點中作為收集的客户端（Shipper）以外，它還同時設有獨立部署的節點，扮演歸集轉換日誌的服務端（Master）角色。Logstash 有良好的插件化設計，收集、轉換、輸出都支持插件化定製，應對多重角色本身並沒有什麼困難。但是 Logstash 與它的插件是基於 JRuby 編寫的，要跑在單獨的 Java 虛擬機進程上，而且 Logstash 的默認的堆大小就到了 1GB。對於歸集部分（Master）這種消耗並不是什麼問題，但作為每個節點都要部署的日誌收集器就顯得太過負重了。後來，Elastic.co 公司將所有需要在服務節點中處理的工作整理成以 Libbeat 為核心的 Beats 框架，並使用 Golang 重寫了一個功能較少，卻更輕量高效的日誌收集器 Filebeat。</span></p><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="background-color: rgb(255, 255, 255);color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;font-size: 15px;letter-spacing: 1px;text-align: left;white-space-collapse: break-spaces;"><br></span></p><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="background-color: rgb(255, 255, 255);color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;font-size: 15px;letter-spacing: 1px;text-align: left;white-space-collapse: break-spaces;">日誌不追求絕對的完整精確，只追求在代價可承受的範圍內保證儘可能地保證較高的數據質量。一種最常用的緩解壓力的做法是將日誌接收者從 Logstash 和 Elasticsearch 轉移至抗壓能力更強的隊列緩存，譬如在 Logstash 之前架設一個 Kafka 或者 Redis 作為緩衝層，面對突發流量，Logstash 或 Elasticsearch 處理能力出現瓶頸時自動削峯填谷，甚至當它們短時間停頓，也不會丟失日誌數據。</span></p><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><br></p><ul class="list-paddingleft-1" style="list-style-type: disc;"><li style="color: rgb(0, 17, 255);"><span id="OSC_h4_19"></span><h4 data-cangjie-key="341" data-cangjie-leaf-block="true" data-type="heading-4" style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="background-color: rgb(255, 255, 255);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;font-size: 15px;letter-spacing: 1px;text-align: left;white-space-collapse: break-spaces;color: rgb(0, 17, 255);">加工與聚合</span></h4></li></ul><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><br></p><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="background-color: rgb(255, 255, 255);color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;font-size: 15px;letter-spacing: 1px;text-align: left;white-space-collapse: break-spaces;">將日誌集中收集之後，存入 Elasticsearch 之前，一般還要對它們進行加工轉換和聚合處理。這是因為日誌是非結構化數據，一行日誌中通常會包含多項信息，如果不做處理，那在 Elasticsearch 就只能以全文檢索的原始方式去使用日誌，既不利於統計對比，也不利於條件過濾。</span></p><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="background-color: rgb(255, 255, 255);color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;font-size: 15px;letter-spacing: 1px;text-align: left;white-space-collapse: break-spaces;"><br></span></p><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="background-color: rgb(255, 255, 255);color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;font-size: 15px;letter-spacing: 1px;text-align: left;white-space-collapse: break-spaces;">Logstash 的基本職能是把日誌行中的非結構化數據，通過 Grok 表達式語法轉換為上面表格那樣的結構化數據，進行結構化的同時，還可能會根據需要，調用其他插件來完成時間處理（統一時間格式）、類型轉換（如字符串、數值的轉換）、查詢歸類（譬如將 IP 地址根據地理信息庫按省市歸類）等額外處理工作，然後以 JSON 格式輸出到 Elasticsearch 中（這是最普遍的輸出形式，Logstash 輸出也有很多插件可以具體定製不同的格式）。有了這些經過 Logstash 轉換，已經結構化的日誌，Elasticsearch 便可針對不同的數據項來建立索引，進行條件查詢、統計、聚合等操作的了。</span></p><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><br></section><ul class="list-paddingleft-1" style="list-style-type: disc;"><li style="color: rgb(0, 17, 255);"><span id="OSC_h4_20"></span><h4 data-cangjie-key="350" data-cangjie-leaf-block="true" data-type="heading-4" style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="background-color: rgb(255, 255, 255);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;font-size: 15px;letter-spacing: 1px;text-align: left;white-space-collapse: break-spaces;color: rgb(0, 17, 255);">存儲與查詢</span></h4></li></ul><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><br></section><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="background-color: rgb(255, 255, 255);color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;font-size: 15px;letter-spacing: 1px;text-align: left;white-space-collapse: break-spaces;">Elasticsearch 是整個 Elastic Stack 技術棧的核心，其他步驟的工具，如 Filebeat、Logstash、Kibana 都有替代品，有自由選擇的餘地，唯獨 Elasticsearch 在日誌分析這方面完全沒有什麼值得一提的競爭者，幾乎就是解決此問題的唯一答案。核心原因是 Elasticsearch 的優勢正好與日誌分析的需求完美契合：</span></section><ol class="list-paddingleft-1" style="list-style-type: decimal;"><li><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">數據特徵的角度看，日誌是典型的基於時間的數據流。日誌雖然增長速度很快，但已寫入的數據幾乎沒有再發生變動的可能。以按日索引為例，由於你能準確地預知明天、後天的日期，因此全部索引都可以預先創建，這免去了動態創建的尋找節點、創建分片、在集羣中廣播變動信息等開銷</span></section></li><li><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">從數據價值的角度看，日誌基本上只會以最近的數據為檢索目標，隨着時間推移，早期的數據將逐漸失去價值。這點決定了可以很容易區分出冷數據和熱數據，進而對不同數據採用不一樣的硬件策略。</span></section></li><li><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">從數據使用的角度看，分析日誌很依賴全文檢索和即席查詢，對實時性的要求是處於實時與離線兩者之間的「近實時」，即不強求日誌產生後立刻能查到，但也不能接受日誌產生之後按小時甚至按天的頻率來更新，這些檢索能力和近實時性，也正好都是 Elasticsearch 的強項。</span></section></li></ol><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><br></section><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;">Elasticsearch 只提供了 API 層面的查詢能力，它通常搭配同樣出自 Elastic.co 公司的 Kibana 一起使用，可以將 Kibana 視為 Elastic Stack 的 GUI 部分。Kibana 儘管只負責圖形界面和展示，但它提供的能力遠不止讓你能在界面上執行 Elasticsearch 的查詢那麼簡單。Kibana 宣傳的核心能力是「探索數據並可視化」，即把存儲在 Elasticsearch 中的數據被檢索、聚合、統計後，定製形成各種圖形、表格、指標、統計，以此觀察系統的運行狀態，找出日誌事件中潛藏的規律和隱患。</span></section><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><br></section><span id="OSC_h4_21"></span><h4 data-lake-id="ca6fa186228ff7efaa653334195896c8" data-wording="true" style="margin-top: 8px;margin-bottom: 8px;outline: 0px;letter-spacing: 0.544px;text-wrap: wrap;color: rgb(34, 34, 34);background-color: rgb(255, 255, 255);font-family: -apple-system-font, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;visibility: visible;line-height: 1.75em;"><span style="outline: 0px;visibility: visible;letter-spacing: 1px;color: rgb(0, 17, 255);"><strong style="outline: 0px;visibility: visible;"><span style="outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">▐</span></strong><strong style="outline: 0px;visibility: visible;"><span style="outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">&nbsp;&nbsp;</span></strong><strong style="outline: 0px;visibility: visible;"><span style="color: rgb(0, 17, 255);outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">阿里的 SLS 方案</span></strong></span></h4><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><br></p><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;">阿里雲日誌服務 SLS 基於阿里雲自研靈活索引的一站式雲原生可觀測數據分析平台。為 Log/Metric/Trace 等數據提供大規模、低成本、實時平台化服務。一站式提供數據採集、加工、分析、告警可視化與投遞功能。</span></section><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><br></section><ul class="list-paddingleft-1" style="list-style-type: disc;"><li style="color: rgb(0, 17, 255);"><span id="OSC_h4_22"></span><h4 data-cangjie-key="374" data-cangjie-leaf-block="true" data-type="heading-4" style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;font-size: 15px;letter-spacing: 1px;color: rgb(0, 17, 255);">收集與緩存</span></h4></li></ul><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><br></section><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;">Logtail 是集團雲提供的日誌服務（SLS）的一個組件，它作為日誌採集客户端，提供了一種高效且易於配置的方式來接入日誌數據。由於 Logtail 是用 C++語言編寫的，它具有較高的性能和較低的資源消耗，適合在各種環境下運行，包括資源受限的環境。</span></section><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;"><br></span></section><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;">Logtail 的主要功能包括：</span></section><ol class="list-paddingleft-1" style="list-style-type: decimal;"><li><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">無侵入式採集：Logtail 能夠監視指定的日誌文件，實時採集更新的日誌數據，而無需修改現有的應用程序代碼。</span></section></li><li><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">多種日誌格式支持：除了採集標準的文本日誌文件，Logtail 還能夠採集其他類型的日誌，如 MySQL 的二進制日誌（binlog）、HTTP 數據、以及容器日誌等。</span></section></li><li><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">容器化環境支持：Logtail 提供對容器友好的支持，無論是標準容器還是處於 Kubernetes 集羣中的容器，Logtail 都能夠靈活地採集日誌數據。</span></section></li><li><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">異常處理：Logtail 有一套完備的機制來處理在日誌採集過程中可能出現的異常，如當遇到網絡故障或服務端異常時，它可以通過主動重試或將數據緩存到本地等方式來確保數據的安全和完整性。</span></section></li></ol><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><br></section><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;">由於 Logtail 的這些特性，它成為了一個非常強大且可靠的日誌採集工具，特別是在需要確保日誌數據不丟失的情況下。它的無侵入性質意味着開發者或運維人員可以在不影響現有應用程序的情況下部署日誌採集，而其對容器和微服務架構的友好支持則使其非常適合現代雲原生應用。</span></section><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;"><br></span></section><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;">Logtail 作為日誌採集客户端，其文件採集流程設計得非常全面，涵蓋了從日誌生成到傳輸的多個關鍵環節。以下是 Logtail 文件採集流程的六個主要步驟：</span></section><ol class="list-paddingleft-1" style="list-style-type: decimal;"><li><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span data-cangjie-key="403:0" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="403:0" style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;box-sizing: inherit;font-weight: bold;color: rgb(0, 0, 0);">文件監聽</span><span data-cangjie-key="403:4" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="403:4" style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;box-sizing: inherit;color: rgb(0, 0, 0);">：Logtail 監控配置中指定的日誌文件或目錄，以便於檢測文件的創建、更新或者刪除事件。這通常通過文件系統的通知機制來實現，如 Linux 上的 inotify。</span></section></li><li><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span data-cangjie-key="406:0" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="406:0" style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;box-sizing: inherit;font-weight: bold;color: rgb(0, 0, 0);">文件讀取</span><span data-cangjie-key="406:4" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="406:4" style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;box-sizing: inherit;color: rgb(0, 0, 0);">：一旦文件發生變化，Logtail 會讀取文件內容。對於更新的文件，Logtail 保持追蹤當前的讀取進度，確保從上次停止的地方繼續讀取，避免重複或遺漏。</span></section></li><li><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span data-cangjie-key="409:0" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="409:0" style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;box-sizing: inherit;font-weight: bold;color: rgb(0, 0, 0);">日誌處理</span><span data-cangjie-key="409:4" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="409:4" style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;box-sizing: inherit;color: rgb(0, 0, 0);">：讀取到的原始日誌數據會經過初步處理，比如分割日誌行、解析字段等，將原始文本轉換為結構化的日誌記錄。</span></section></li><li><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span data-cangjie-key="412:0" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="412:0" style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;box-sizing: inherit;font-weight: bold;color: rgb(0, 0, 0);">日誌過濾</span><span data-cangjie-key="412:4" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="412:4" style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;box-sizing: inherit;color: rgb(0, 0, 0);">：用户可以定義過濾規則，根據日誌內容或屬性決定哪些日誌記錄應該被採集，哪些應該被忽略。這一步可以減少無用數據的傳輸和存儲，優化成本和性能。</span></section></li><li><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span data-cangjie-key="415:0" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="415:0" style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;box-sizing: inherit;font-weight: bold;color: rgb(0, 0, 0);">日誌聚合</span><span data-cangjie-key="415:4" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="415:4" style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;box-sizing: inherit;color: rgb(0, 0, 0);">：在發送之前，Logtail 可以對日誌進行批處理，合併多個日誌記錄為一個數據包，減少網絡請求的次數，提高數據傳輸效率。</span></section></li><li><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span data-cangjie-key="418:0" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="418:0" style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;box-sizing: inherit;font-weight: bold;color: rgb(0, 0, 0);">數據發送</span><span data-cangjie-key="418:4" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="418:4" style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;box-sizing: inherit;color: rgb(0, 0, 0);">：聚合後的日誌數據會被髮送到配置的目標，例如阿里雲日誌服務 SLS 的服務器。數據發送過程中，Logtail 會處理網絡異常等問題，確保數據的可靠傳輸。</span></section></li></ol><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><br></section><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><br></section><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><br></p><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;">以上六個環節構成了 Logtail 文件採集的完整流程，每個步驟都是為了確保日誌數據的準確、高效、可靠採集。在高可用性和高性能的要求下，Logtail 的設計使得日誌數據能夠從源頭到目的地的遷移過程中保持完整性和一致性。</span></p><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;"><br></span></p><section style="margin-top: 8px;line-height: 1.75em;text-align: center;margin-bottom: 8px;"><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;"><img class="rich_pages wxw-img" data-backh="321" data-backw="578" data-imgfileid="503043782" data-ratio="0.5546296296296296" src="https://oscimg.oschina.net/oscnet/181e7309-36bb-4657-bc7b-c7b349b6353e.png" data-type="png" data-w="1080" style="width: 100%;height: auto;" referrerpolicy="no-referrer"></span></section><section style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><br></section><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;">對比開源的 logstash，和 logtail 的對比如下：</span></p><table width="714"><colgroup style="box-sizing: inherit;"><col width="187" style="box-sizing: inherit;"><col width="264" style="box-sizing: inherit;"><col width="263" style="box-sizing: inherit;"></colgroup><tbody style="box-sizing: inherit;"><tr data-cangjie-key="431" data-sticky="false" style="box-sizing: inherit;height: 37px;"><td data-cangjie-key="433" data-type="table-cell" rowspan="1" colspan="1" data-container-block="true" style="box-sizing: inherit;padding: 8px 7px;border-color: rgb(217, 217, 217);background-color: rgb(116, 182, 2);"><p><span style="box-sizing: inherit;color: rgb(250, 250, 250);font-size: 15px;">功能項</span></p></td><td data-cangjie-key="438" data-type="table-cell" rowspan="1" colspan="1" data-container-block="true" style="box-sizing: inherit;padding: 8px 7px;border-color: rgb(217, 217, 217);background-color: rgb(116, 182, 2);"><p><span style="box-sizing: inherit;color: rgb(250, 250, 250);font-size: 15px;">logstash</span></p></td><td data-cangjie-key="443" data-type="table-cell" rowspan="1" colspan="1" data-container-block="true" style="box-sizing: inherit;padding: 8px 7px;border-color: rgb(217, 217, 217);background-color: rgb(116, 182, 2);"><p><span style="box-sizing: inherit;color: rgb(250, 250, 250);font-size: 15px;">logtail</span></p></td></tr><tr data-cangjie-key="448" data-sticky="false" style="box-sizing: inherit;height: 33px;"><td data-cangjie-key="450" data-type="table-cell" rowspan="1" colspan="1" data-container-block="true" style="box-sizing: inherit;padding: 8px 7px;border-color: rgb(217, 217, 217);"><p><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;">日誌讀取</span></p></td><td data-cangjie-key="455" data-type="table-cell" rowspan="1" colspan="1" data-container-block="true" style="box-sizing: inherit;padding: 8px 7px;border-color: rgb(217, 217, 217);"><p><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;">輪詢</span></p></td><td data-cangjie-key="460" data-type="table-cell" rowspan="1" colspan="1" data-container-block="true" style="box-sizing: inherit;padding: 8px 7px;border-color: rgb(217, 217, 217);"><p><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;">事件觸發</span></p></td></tr><tr data-cangjie-key="465" data-sticky="false" style="box-sizing: inherit;height: 33px;"><td data-cangjie-key="467" data-type="table-cell" rowspan="1" colspan="1" data-container-block="true" style="box-sizing: inherit;padding: 8px 7px;border-color: rgb(217, 217, 217);"><p><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;">文件輪轉</span></p></td><td data-cangjie-key="472" data-type="table-cell" rowspan="1" colspan="1" data-container-block="true" style="box-sizing: inherit;padding: 8px 7px;border-color: rgb(217, 217, 217);"><p><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;">支持</span></p></td><td data-cangjie-key="477" data-type="table-cell" rowspan="1" colspan="1" data-container-block="true" style="box-sizing: inherit;padding: 8px 7px;border-color: rgb(217, 217, 217);"><p><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;">支持</span></p></td></tr><tr data-cangjie-key="482" data-sticky="false" style="box-sizing: inherit;height: 43px;"><td data-cangjie-key="484" data-type="table-cell" rowspan="1" colspan="1" data-container-block="true" style="box-sizing: inherit;padding: 8px 7px;border-color: rgb(217, 217, 217);"><p><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;">Failover 處理 (本地 checkpoint)</span></p></td><td data-cangjie-key="489" data-type="table-cell" rowspan="1" colspan="1" data-container-block="true" style="box-sizing: inherit;padding: 8px 7px;border-color: rgb(217, 217, 217);"><p><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;">支持</span></p></td><td data-cangjie-key="494" data-type="table-cell" rowspan="1" colspan="1" data-container-block="true" style="box-sizing: inherit;padding: 8px 7px;border-color: rgb(217, 217, 217);"><p><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;">支持</span></p></td></tr><tr data-cangjie-key="499" data-sticky="false" style="box-sizing: inherit;height: 33px;"><td data-cangjie-key="501" data-type="table-cell" rowspan="1" colspan="1" data-container-block="true" style="box-sizing: inherit;padding: 8px 7px;border-color: rgb(217, 217, 217);"><p><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;">通用日誌解析</span></p></td><td data-cangjie-key="506" data-type="table-cell" rowspan="1" colspan="1" data-container-block="true" style="box-sizing: inherit;padding: 8px 7px;border-color: rgb(217, 217, 217);"><p><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;">支持 grok（基於正則表達式）解析</span></p></td><td data-cangjie-key="511" data-type="table-cell" rowspan="1" colspan="1" data-container-block="true" style="box-sizing: inherit;padding: 8px 7px;border-color: rgb(217, 217, 217);"><p><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;">支持正則表達式解析</span></p></td></tr><tr data-cangjie-key="516" data-sticky="false" style="box-sizing: inherit;height: 47px;"><td data-cangjie-key="518" data-type="table-cell" rowspan="1" colspan="1" data-container-block="true" style="box-sizing: inherit;padding: 8px 7px;border-color: rgb(217, 217, 217);"><p><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;">特定日誌類型</span></p></td><td data-cangjie-key="523" data-type="table-cell" rowspan="1" colspan="1" data-container-block="true" style="box-sizing: inherit;padding: 8px 7px;border-color: rgb(217, 217, 217);"><p><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;">支持 delimiter、key-value、json 等主流格式</span></p></td><td data-cangjie-key="528" data-type="table-cell" rowspan="1" colspan="1" data-container-block="true" style="box-sizing: inherit;padding: 8px 7px;border-color: rgb(217, 217, 217);"><p><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;">支持 key-value 格式</span></p></td></tr><tr data-cangjie-key="533" data-sticky="false" style="box-sizing: inherit;height: 33px;"><td data-cangjie-key="535" data-type="table-cell" rowspan="1" colspan="1" data-container-block="true" style="box-sizing: inherit;padding: 8px 7px;border-color: rgb(217, 217, 217);"><p><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;">數據發送壓縮</span></p></td><td data-cangjie-key="540" data-type="table-cell" rowspan="1" colspan="1" data-container-block="true" style="box-sizing: inherit;padding: 8px 7px;border-color: rgb(217, 217, 217);"><p><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;">插件支持</span></p></td><td data-cangjie-key="545" data-type="table-cell" rowspan="1" colspan="1" data-container-block="true" style="box-sizing: inherit;padding: 8px 7px;border-color: rgb(217, 217, 217);"><p><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;">LZ4</span></p></td></tr><tr data-cangjie-key="550" data-sticky="false" style="box-sizing: inherit;height: 33px;"><td data-cangjie-key="552" data-type="table-cell" rowspan="1" colspan="1" data-container-block="true" style="box-sizing: inherit;padding: 8px 7px;border-color: rgb(217, 217, 217);"><p><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;">數據過濾</span></p></td><td data-cangjie-key="557" data-type="table-cell" rowspan="1" colspan="1" data-container-block="true" style="box-sizing: inherit;padding: 8px 7px;border-color: rgb(217, 217, 217);"><p><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;">支持</span></p></td><td data-cangjie-key="562" data-type="table-cell" rowspan="1" colspan="1" data-container-block="true" style="box-sizing: inherit;padding: 8px 7px;border-color: rgb(217, 217, 217);"><p><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;">支持</span></p></td></tr><tr data-cangjie-key="567" data-sticky="false" style="box-sizing: inherit;height: 33px;"><td data-cangjie-key="569" data-type="table-cell" rowspan="1" colspan="1" data-container-block="true" style="box-sizing: inherit;padding: 8px 7px;border-color: rgb(217, 217, 217);"><p><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;">數據 buffer 發送</span></p></td><td data-cangjie-key="574" data-type="table-cell" rowspan="1" colspan="1" data-container-block="true" style="box-sizing: inherit;padding: 8px 7px;border-color: rgb(217, 217, 217);"><p><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;">插件支持</span></p></td><td data-cangjie-key="579" data-type="table-cell" rowspan="1" colspan="1" data-container-block="true" style="box-sizing: inherit;padding: 8px 7px;border-color: rgb(217, 217, 217);"><p><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;">支持</span></p></td></tr><tr data-cangjie-key="584" data-sticky="false" style="box-sizing: inherit;height: 33px;"><td data-cangjie-key="586" data-type="table-cell" rowspan="1" colspan="1" data-container-block="true" style="box-sizing: inherit;padding: 8px 7px;border-color: rgb(217, 217, 217);"><p><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;">發送異常處理</span></p></td><td data-cangjie-key="591" data-type="table-cell" rowspan="1" colspan="1" data-container-block="true" style="box-sizing: inherit;padding: 8px 7px;border-color: rgb(217, 217, 217);"><p><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;">插件支持</span></p></td><td data-cangjie-key="596" data-type="table-cell" rowspan="1" colspan="1" data-container-block="true" style="box-sizing: inherit;padding: 8px 7px;border-color: rgb(217, 217, 217);"><p><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;">支持</span></p></td></tr><tr data-cangjie-key="601" data-sticky="false" style="box-sizing: inherit;height: 33px;"><td data-cangjie-key="603" data-type="table-cell" rowspan="1" colspan="1" data-container-block="true" style="box-sizing: inherit;padding: 8px 7px;border-color: rgb(217, 217, 217);"><p><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;">運行環境</span></p></td><td data-cangjie-key="608" data-type="table-cell" rowspan="1" colspan="1" data-container-block="true" style="box-sizing: inherit;padding: 8px 7px;border-color: rgb(217, 217, 217);"><p><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;">JRuby 實現，依賴 JVM 環境</span></p></td><td data-cangjie-key="613" data-type="table-cell" rowspan="1" colspan="1" data-container-block="true" style="box-sizing: inherit;padding: 8px 7px;border-color: rgb(217, 217, 217);"><p><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;">C++實現，無特殊要求</span></p></td></tr><tr data-cangjie-key="618" data-sticky="false" style="box-sizing: inherit;height: 33px;"><td data-cangjie-key="620" data-type="table-cell" rowspan="1" colspan="1" data-container-block="true" style="box-sizing: inherit;padding: 8px 7px;border-color: rgb(217, 217, 217);"><p><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;">線程支持</span></p></td><td data-cangjie-key="625" data-type="table-cell" rowspan="1" colspan="1" data-container-block="true" style="box-sizing: inherit;padding: 8px 7px;border-color: rgb(217, 217, 217);"><p><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;">支持多線程</span></p></td><td data-cangjie-key="630" data-type="table-cell" rowspan="1" colspan="1" data-container-block="true" style="box-sizing: inherit;padding: 8px 7px;border-color: rgb(217, 217, 217);"><p><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;">支持多線程</span></p></td></tr><tr data-cangjie-key="635" data-sticky="false" style="box-sizing: inherit;height: 33px;"><td data-cangjie-key="637" data-type="table-cell" rowspan="1" colspan="1" data-container-block="true" style="box-sizing: inherit;padding: 8px 7px;border-color: rgb(217, 217, 217);"><p><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;">熱升級</span></p></td><td data-cangjie-key="642" data-type="table-cell" rowspan="1" colspan="1" data-container-block="true" style="box-sizing: inherit;padding: 8px 7px;border-color: rgb(217, 217, 217);"><p><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;">不支持</span></p></td><td data-cangjie-key="647" data-type="table-cell" rowspan="1" colspan="1" data-container-block="true" style="box-sizing: inherit;padding: 8px 7px;border-color: rgb(217, 217, 217);"><p><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;">支持</span></p></td></tr><tr data-cangjie-key="652" data-sticky="false" style="box-sizing: inherit;height: 33px;"><td data-cangjie-key="654" data-type="table-cell" rowspan="1" colspan="1" data-container-block="true" style="box-sizing: inherit;padding: 8px 7px;border-color: rgb(217, 217, 217);"><p><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;">中心化配置管理</span></p></td><td data-cangjie-key="659" data-type="table-cell" rowspan="1" colspan="1" data-container-block="true" style="box-sizing: inherit;padding: 8px 7px;border-color: rgb(217, 217, 217);"><p><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;">不支持</span></p></td><td data-cangjie-key="664" data-type="table-cell" rowspan="1" colspan="1" data-container-block="true" style="box-sizing: inherit;padding: 8px 7px;border-color: rgb(217, 217, 217);"><p><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;">支持</span></p></td></tr><tr data-cangjie-key="669" data-sticky="false" style="box-sizing: inherit;height: 33px;"><td data-cangjie-key="671" data-type="table-cell" rowspan="1" colspan="1" data-container-block="true" style="box-sizing: inherit;padding: 8px 7px;border-color: rgb(217, 217, 217);"><p><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;">運行狀態自檢</span></p></td><td data-cangjie-key="676" data-type="table-cell" rowspan="1" colspan="1" data-container-block="true" style="box-sizing: inherit;padding: 8px 7px;border-color: rgb(217, 217, 217);"><p><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;">不支持</span></p></td><td data-cangjie-key="681" data-type="table-cell" rowspan="1" colspan="1" data-container-block="true" style="box-sizing: inherit;padding: 8px 7px;border-color: rgb(217, 217, 217);"><p><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;">支持 cpu/內存閾值保</span></p></td></tr></tbody></table><section style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><br></section><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;">總體來説，logstash 支持所有主流日誌類型，插件支持最豐富，可以靈活 DIY，但性能較差，JVM 容易導致內存使用量高。logtail 佔用機器 cpu、內存資源最少，結合阿里雲日誌服務的 E2E 體驗良好，但目前對特定日誌類型解析的支持較弱。</span></p><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 1px;"><br></span></p><ul class="list-paddingleft-1" style="list-style-type: disc;"><li style="color: rgb(0, 17, 255);"><span id="OSC_h4_23"></span><h4 data-cangjie-key="689" data-cangjie-leaf-block="true" data-type="heading-4" style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;font-size: 15px;letter-spacing: 1px;color: rgb(0, 17, 255);">加工與聚合</span></h4></li></ul><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><br></p><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;">阿里雲日誌服務（SLS）提供的數據加工功能是一項強大的特性，使得用户能夠在日誌數據進入存儲和分析階段之前對其進行預處理。這些功能對於數據的清洗、轉換、安全保護和增強都非常關鍵，尤其是在構建複雜的數據處理流水線時。以下是數據加工功能的幾個關鍵點和它們的應用場景。</span></p><ol class="list-paddingleft-1" style="list-style-type: decimal;"><li><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span data-cangjie-key="697:0" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="697:0" style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;box-sizing: inherit;font-weight: bold;color: rgb(0, 0, 0);">數據規整</span><span data-cangjie-key="697:4" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="697:4" style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;box-sizing: inherit;color: rgb(0, 0, 0);">：這個功能允許用户對無結構或半結構化的日誌進行字段提取和格式轉換，從而得到結構化數據。這對於後續的實時處理、分析和數據倉庫計算來説是非常重要的，因為結構化數據更容易進行查詢和分析。</span></p></li><li><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span data-cangjie-key="700:0" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="700:0" style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 1px;box-sizing: inherit;font-weight: bold;color: rgb(0, 0, 0);">數據富化</span><span data-cangjie-key="700:4" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="700:4" style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 1px;box-sizing: inherit;color: rgb(0, 0, 0);">：數據富化功能可以通過字段連接（JOIN）操作，將日誌數據（如訂單日誌）和其他維度數據（如用户信息表）相結合。這樣可以為原始日誌添加更豐富的上下文信息，提高數據分析的深度和準確性。</span><br></p></li><li><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span data-cangjie-key="703:0" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="703:0" style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 1px;box-sizing: inherit;font-weight: bold;color: rgb(0, 0, 0);">數據流轉</span><span data-cangjie-key="703:4" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="703:4" style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 1px;box-sizing: inherit;color: rgb(0, 0, 0);">：流轉功能支持跨地域的數據傳輸，允許用户將數據從一個地域轉移到另一個地域。例如，可以將海外地域的日誌數據傳輸到中心地域，實現日誌的集中化管理和分析。</span><br></p></li><li><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span data-cangjie-key="706:0" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="706:0" style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 1px;box-sizing: inherit;font-weight: bold;color: rgb(0, 0, 0);">數據脱敏</span><span data-cangjie-key="706:4" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="706:4" style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 1px;box-sizing: inherit;color: rgb(0, 0, 0);">：數據脱敏對於符合隱私法規和公司政策是必不可少的。SLS 可以在日誌數據中識別並隱藏或替換敏感信息，比如密碼、手機號或地址等，來保護用户隱私。</span><br></p></li><li><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span data-cangjie-key="709:0" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="709:0" style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 1px;box-sizing: inherit;font-weight: bold;color: rgb(0, 0, 0);">數據過濾</span><span data-cangjie-key="709:4" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="709:4" style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 1px;box-sizing: inherit;color: rgb(0, 0, 0);">：數據過濾允許用户基於特定條件選擇性地提取日誌條目。這可以用來隔離關鍵服務的日誌，以便進行重點監控和分析。</span><br></p></li></ol><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><br></p><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;">應用場景：</span></p><ol class="list-paddingleft-1" style="list-style-type: decimal;"><li><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span data-cangjie-key="715:0" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="715:0" style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;box-sizing: inherit;font-weight: bold;color: rgb(0, 0, 0);">數據規整（一對一）</span><span data-cangjie-key="715:9" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="715:9" style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;box-sizing: inherit;color: rgb(0, 0, 0);">：從單個源 Logstore 讀取數據，經過加工處理後，輸出到單個目標 Logstore，適用於簡單的加工任務。</span></p></li><li><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span data-cangjie-key="718:0" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="718:0" style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 1px;box-sizing: inherit;font-weight: bold;color: rgb(0, 0, 0);">數據分派（一對多）</span><span data-cangjie-key="718:9" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="718:9" style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 1px;box-sizing: inherit;color: rgb(0, 0, 0);">：從單個源 Logstore 讀取數據，根據不同的規則或條件將數據加工後分發到多個目標 Logstore 中，適用於需要將日誌按類型或用途分開處理的場景。</span><br></p></li><li><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span data-cangjie-key="721:0" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="721:0" style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 1px;box-sizing: inherit;font-weight: bold;color: rgb(0, 0, 0);">數據融合（多對一）</span><span data-cangjie-key="721:9" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="721:9" style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 1px;box-sizing: inherit;color: rgb(0, 0, 0);">：從多個源 Logstore 讀取數據，將它們合併或加工後輸出到一個目標 Logstore 中，適用於需要綜合多個數據源進行統一分析的場景。</span><br></p></li></ol><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><br></p><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;">通過這些數據加工功能，SLS 能夠提供靈活、強大的數據處理能力，幫助用户更好地管理和分析日誌數據，同時保護敏感信息。這對於需要實時數據洞察和快速響應的企業來説是非常有價值的。</span></section><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;"><br></span></section><ul class="list-paddingleft-1" style="list-style-type: disc;"><li style="color: rgb(0, 17, 255);"><span id="OSC_h4_24"></span><h4 data-cangjie-key="725" data-cangjie-leaf-block="true" data-type="heading-4" style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;font-size: 15px;letter-spacing: 1px;color: rgb(0, 17, 255);">存儲和查詢</span></h4></li></ul><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><br></section><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;">阿里雲日誌服務（SLS）的存儲引擎專門為處理可觀測數據而設計，包括日誌、指標和追蹤數據。它旨在提供一個統一和高效的解決方案，用以滿足大規模數據存儲和快速查詢的需求。下面是對這個存儲引擎的兩個關鍵特性的進一步解讀：</span></section><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><br></section><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;">統一性（Unified）</span></section><ol class="list-paddingleft-1" style="list-style-type: decimal;"><li><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">多類型數據支持：統一的存儲引擎意味着它能夠存儲和處理多種類型的可觀測數據，無論是結構化的日誌數據、時間序列的指標數據還是分佈式追蹤的信息。這樣的設計減少了需要使用和管理多個存儲系統的複雜性。</span></section></li><li><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">統一查詢接口：有了統一的存儲引擎，用户可以通過一個共同的查詢接口訪問不同類型的數據，這提高了使用效率，並允許跨數據類型的分析和關聯。</span></section></li><li><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">統一的管理和運維：統一存儲引擎也簡化了數據的管理和運維任務，因為它減少了需要學習和監控的工具和接口的數量。</span></section></li></ol><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;"><br></span></section><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;">性能（Fast）</span></section><ol class="list-paddingleft-1" style="list-style-type: decimal;"><li><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">高速寫入：SLS 的存儲引擎針對高速數據寫入進行了優化，以支持大數據量的實時採集。這對於高流量網站、大型分佈式應用和 IoT 設備等場合至關重要。</span></section></li><li><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">高效查詢：SLS 存儲引擎還針對快速查詢進行了優化，確保即使在涉及大規模數據集時，也能夠快速返回結果。</span></section></li><li><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">適應大規模場景：阿里雲天然服務於各種規模的企業，包括那些擁有超大規模數據場景的企業。SLS 的存儲引擎設計考慮了這些場景的需求，保證了擴展性和穩定性。</span></section></li></ol><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;"><br></span></section><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;">總體來説，SLS 的存儲引擎通過統一和快速的寫入與查詢功能，為處理大規模的可觀測數據提供了一個強大、高效且易於管理的解決方案。整體架構如下：</span></section><section style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;text-align: center;"><span style="background-color: rgb(255, 255, 255);color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space-collapse: break-spaces;font-size: 15px;letter-spacing: 1px;"><img class="rich_pages wxw-img" data-backh="156" data-backw="578" data-imgfileid="503043785" data-ratio="0.26944444444444443" src="https://oscimg.oschina.net/oscnet/ec04f6ad-55ed-4b32-af54-fec3c93bd4b7.png" data-type="png" data-w="1080" style="width: 100%;height: auto;" referrerpolicy="no-referrer"></span></section><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="background-color: rgb(255, 255, 255);color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space-collapse: break-spaces;font-size: 15px;letter-spacing: 1px;"><br></span></p><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;">接入層協議支持：</span></p><ol class="list-paddingleft-1" style="list-style-type: decimal;"><li><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">接入層的設計非常靈活，支持多種數據寫入協議，這意味着無論數據來源是什麼（如應用程序、服務器、網絡設備等），都能夠順利與 SLS 集成。</span></p></li><li><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 1px;">寫入的數據首先被放入一個先進先出（FIFO）的管道中，這個管道模型類似於 Apache Kafka 的消息隊列（MQ）模型，提供了高吞吐量和可靠性。</span><br></p></li></ol><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;"><br></span></p><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">管道和數據消費：</span></p><ol class="list-paddingleft-1" style="list-style-type: decimal;"><li><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 1px;">管道不僅存儲數據，還支持數據消費，允許各類下游系統（如實時分析、告警、可視化工具等）接入並處理數據。</span></p></li><li><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">這種設計實現了數據的異步處理，增強了系統的整體擴展性和彈性。</span></p></li></ol><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 1px;"><br></span></p><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 1px;">索引結構和存儲優化：</span></p><ol class="list-paddingleft-1" style="list-style-type: decimal;"><li><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">在管道之上，存儲引擎為不同類型的數據（Traces/Logs 和 Metrics）構建了兩套索引結構。</span></p></li><li><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">利用倒排索引（Inverted Index）、列式存儲（Columnar Storage）以及壓縮（Compaction）等技術，SLS 能夠提供快速的查詢性能，同時優化存儲空間的使用效率。</span></p></li></ol><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><br></p><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">統一的進程架構：</span></p><ol class="list-paddingleft-1" style="list-style-type: decimal;"><li><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">上述所有功能都在一個統一的進程內實現，這意味着可以在單一的系統中處理日誌、指標和追蹤數據，大大簡化了運維和部署的複雜性和成本。</span></p></li></ol><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><br></p><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">純分佈式框架：</span></p><ol class="list-paddingleft-1" style="list-style-type: decimal;"><li><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">SLS 的存儲引擎基於純分佈式架構構建，支持水平擴展，可以隨着數據量的增長而增加更多的存儲節點。</span></p></li><li><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">單個存儲節點（Store）能夠處理極高的數據量，最多支持每天處理 PB 級別的數據寫入，適合大規模的數據中心和雲環境。</span></p></li></ol><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;"><br></span></p><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;">在查詢方面，SLS 的查詢和分析引擎整合了多種查詢語法和分析能力，提供了一個強大的查詢環境：</span></p><ol class="list-paddingleft-1" style="list-style-type: decimal;"><li><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">關鍵詞查詢：</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;">支持對存儲在 SLS 中的日誌數據進行全文搜索，類似於其他日誌管理系統中的關鍵詞查詢功能。這主要用於快速查找特定日誌條目或篩選日誌信息。</span></p></li><li><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 1px;">PromQL 的語法兼容：</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;">PromQL 是 Prometheus 查詢語言，專門用於時間序列數據的查詢。SLS 兼容 PromQL 語法，使得用户能夠利用 PromQL 進行指標數據的查詢和分析。</span></p></li><li><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">SQL 作為頂層分析語言：1、</span><span style="color: rgb(0, 0, 0);font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 1px;">為了實現對可觀測數據的深入分析，SLS 擴展了 SQL 語言的能力，使其能夠支持連接關鍵詞查詢、PromQL 等語法；2、通過 SQL，用户可以執行更復雜的數據操作，如聚合、排序、聯接和子查詢等，這為數據分析提供了極大的靈活性。</span></p></li><li><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">外部數據源和機器學習模型的集成：</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;">SLS 的 SQL 擴展還允許用户連接外部數據庫和機器學習模型。這意味着用户可以將 SLS 中的數據與其他數據源相結合，或使用機器學習算法進行高級分析。</span></p></li><li><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">可觀測數據的融合分析：</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;">SLS 使得日誌、指標和追蹤數據能夠在一個統一的分析環境中進行關聯和分析。這種融合分析能力使用户能夠以多維度來理解和分析系統的行為和性能。</span></p></li></ol><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;"><br></span></p><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;">通過這樣的設計，SLS 提供了一個功能全面的查詢和分析環境，可以滿足從簡單的文本搜索到複雜的數據挖掘和分析的各種需求。對於開發人員、運維人員和數據分析師來説，SLS 的查詢功能極大地提高了他們處理和分析可觀測數據的效率和準確性。</span></p><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;"><br></span></p><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;"><img class="rich_pages wxw-img" data-backh="263" data-backw="578" data-imgfileid="503043786" data-ratio="0.4546296296296296" src="https://oscimg.oschina.net/oscnet/c1a24cd6-e411-47e7-887e-45e5d4a107c2.png" data-type="png" data-w="1080" style="width: 100%;height: auto;" referrerpolicy="no-referrer"></span></p><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="background-color: rgb(255, 255, 255);color: rgb(0, 0, 0);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;text-align: left;white-space-collapse: break-spaces;font-size: 15px;letter-spacing: 1px;"><br></span></p><span id="OSC_h4_25"></span><h4 data-lake-id="ca6fa186228ff7efaa653334195896c8" data-wording="true" style="margin-top: 8px;margin-bottom: 8px;outline: 0px;letter-spacing: 0.544px;text-wrap: wrap;color: rgb(34, 34, 34);background-color: rgb(255, 255, 255);font-family: -apple-system-font, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;visibility: visible;line-height: 1.75em;"><span style="outline: 0px;visibility: visible;letter-spacing: 1px;color: rgb(0, 17, 255);"><strong style="outline: 0px;visibility: visible;"><span style="outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">▐</span></strong><strong style="outline: 0px;visibility: visible;"><span style="outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">&nbsp;&nbsp;</span></strong><strong style="outline: 0px;visibility: visible;"><span style="color: rgb(0, 17, 255);outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">ELK 對比 SLS</span></strong></span></h4><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><br></p><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;">ELK 的核心 ElasticSearch 基於 Lucene 全文索引實現，面向 Document 類型，構建一套完整的可觀測分析平台需要組合多款服務，這其中包括 logstash、Kibana、Kafka、Flink、TSDB、Prometheus 等服務，對於規模、查詢能力等方面存在一定限制，整體成本較高。</span></section><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;"><br></span></section><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;">日誌服務 SLS 基於阿里雲自研靈活索引，支持一站式雲原生可觀測性，多規格多場景支持。</span></section><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;"><br></span></section><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;">詳細對比下兩者在以下方面的差異：</span></section><ol class="list-paddingleft-1" style="list-style-type: decimal;"><li><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">性能：在同樣成本的介質上部署，SLS 能夠提供更低的延時、以及更穩定的查詢性能。</span></section></li><li><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">成本：這裏的成本不光是部署成本，還需要包括使用成本。要維護良好狀態的 ELK 集羣，需要從容量規劃、穩定性保障、性能調優、數據高可用，數據如何在不同系統間關聯等多個方面下功夫。SLS 全託管免運維無需花費額外人力投入。百 TB 規模下，SLS 綜合成本是 ELK 的 44%。</span></section></li><li><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;">易用性：SLS 對開源協議及組件相比 ELK 有更好的兼容性。利用 ELK 構建完整可觀測分析平台需組合多款服務，這其中包括 Logstash、Kibana、Kafka、Flink、TSDB、Prometheus 等。SLS 在這個場景上無需多個組件搭配，支持一站式數據監控分析平台能力。</span></section></li><li><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">互聯互通與二次開發：在可觀測場景中，我們需要跨多個數據源進行關聯分析 SLS 可觀測數據統一存儲支持 log metric trace 數據存儲，打通數據孤島，並且提供開源友好的 API 接口進行使用。</span></section></li><li><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">附加能力（新算子、告警等）：開源 ELK 僅支持指標分析聚合、分桶聚合、管道分析、矩陣分析有限的聚合算法。SLS 針對數據分析場景支持 30+ 聚合計算函數，豐富的機器學習函數以及多渠道數據源，是 ELK 提供操作符的 5 倍，充分發掘數據分析能力。除此之外，SLS 內置告警功能可以快速開箱即用，無需搭建系統。</span></section></li></ol><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><br></section><section style="margin-bottom: 0px;outline: 0px;font-family: system-ui, -apple-system, &quot;system-ui&quot;, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;color: rgb(34, 34, 34);font-size: 15px;background-color: rgb(255, 255, 255);text-align: center;line-height: normal;"><img class="rich_pages wxw-img" data-imgfileid="503043784" data-ratio="0.328125" data-s="300,640" src="https://oscimg.oschina.net/oscnet/2a6f9cf1-ff88-4688-b821-2e2b03f1b26d.png" data-type="png" data-w="256" style="outline: 0px;letter-spacing: 0.544px;font-size: 16px;visibility: visible !important;width: 122px !important;" referrerpolicy="no-referrer"></section><section style="margin-bottom: 0px;outline: 0px;font-family: system-ui, -apple-system, &quot;system-ui&quot;, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;font-size: 15px;background-color: rgb(255, 255, 255);color: rgb(100, 99, 99);text-align: center;line-height: normal;"><span style="outline: 0px;color: rgb(0, 17, 255);font-family: -apple-system, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 18px;letter-spacing: 1px;">參考文章</span></section><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><br></section><ol class="list-paddingleft-1" style="list-style-type: decimal;"><li><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;box-sizing: inherit;font-size: 15px;letter-spacing: 1px;">﻿</span><span style="box-sizing: inherit;font-size: 15px;letter-spacing: 1px;">https://icyfenix.cn/distribution/observability/tracing.html</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;box-sizing: inherit;font-size: 15px;letter-spacing: 1px;">﻿</span></section></li><li><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;box-sizing: inherit;font-size: 15px;letter-spacing: 1px;">﻿</span><span style="box-sizing: inherit;font-size: 15px;letter-spacing: 1px;">https://tech.meituan.com/2023/04/20/traceid-google-dapper-mtrace.html</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;box-sizing: inherit;font-size: 15px;letter-spacing: 1px;">﻿</span></section></li><li><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;box-sizing: inherit;font-size: 15px;letter-spacing: 1px;">﻿</span><span style="box-sizing: inherit;font-size: 15px;letter-spacing: 1px;">https://tech.meituan.com/2022/07/21/visualized-log-tracing.html</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;box-sizing: inherit;font-size: 15px;letter-spacing: 1px;">﻿</span></section></li><li><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;box-sizing: inherit;font-size: 15px;letter-spacing: 1px;">﻿</span><span style="box-sizing: inherit;font-size: 15px;letter-spacing: 1px;">https://developer.aliyun.com/article/1065820#slide-4</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;box-sizing: inherit;font-size: 15px;letter-spacing: 1px;">﻿</span></section></li><li><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;box-sizing: inherit;font-size: 15px;letter-spacing: 1px;">﻿</span><span style="box-sizing: inherit;font-size: 15px;letter-spacing: 1px;">https://aws.amazon.com/cn/what-is/elk-stack/</span></section></li></ol><section style="margin-bottom: 8px;margin-top: 8px;line-height: 1.75em;"><br></section><p style="margin-bottom: 0px;outline: 0px;text-wrap: wrap;background-color: rgb(255, 255, 255);font-size: 11pt;font-family: DengXian;color: rgb(0, 0, 0);letter-spacing: normal;text-align: center;line-height: normal;"><img class="rich_pages wxw-img" data-imgfileid="503043787" data-ratio="0.328125" data-s="300,640" src="https://oscimg.oschina.net/oscnet/e092c0b6-22ea-4620-ad6b-e813098be2a2.png" data-type="png" data-w="256" style="outline: 0px;font-size: 14.6667px;color: rgb(34, 34, 34);font-family: system-ui, -apple-system, &quot;system-ui&quot;, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;visibility: visible !important;width: 133px !important;" referrerpolicy="no-referrer"></p><p style="margin-bottom: 0px;outline: 0px;font-family: system-ui, -apple-system, &quot;system-ui&quot;, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);line-height: 1.75em;text-align: center;"><span style="outline: 0px;box-sizing: inherit;color: rgb(0, 17, 255);font-family: -apple-system, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 18px;letter-spacing: 1px;">團隊介紹</span></p><section style="margin-bottom: 0px;margin-top: 8px;line-height: 1.75em;"><br></section><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">我們來自淘天集團的營銷與平台策略技術。我們支撐大促 （雙 11、618 等）和日銷業務；同時我們也直面競對，深入參與淘寶好價、百億補貼、聚划算等日銷業務的價格心智打造。秉承「簡單、開放、自驅」的技術文化，在使命與責任中互相成就，共同成長，踐行讓業務先贏，技術氛國濃鬱。</span><span style="color: rgb(0, 0, 0);font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 1px;"></span></section><p><br></p><section data-role="outer" label="Powered by 135editor.com" style="margin-bottom: 0px;outline: 0px;letter-spacing: 0.544px;visibility: visible;"><section style="margin-top: 5px;margin-bottom: 8px;outline: 0px;letter-spacing: 0.544px;font-size: 16px;word-break: break-all;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;text-align: center;line-height: 1.75em;"><span style="outline: 0px;color: rgb(0, 17, 255);"><strong style="outline: 0px;">¤</strong></span><span style="outline: 0px;"><strong style="outline: 0px;">&nbsp;拓展閲讀&nbsp;</strong></span><span style="outline: 0px;color: rgb(0, 17, 255);"><strong style="outline: 0px;">¤</strong></span></section><section style="margin-top: 5px;margin-bottom: 5px;outline: 0px;letter-spacing: 0.544px;font-size: 16px;word-break: break-all;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;text-align: center;line-height: 1.75em;"><br></section><section style="margin-top: 8px;margin-bottom: 8px;outline: 0px;font-family: -apple-system, &quot;system-ui&quot;, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 0.544px;text-indent: 0em;text-align: center;line-height: 1.75em;min-height: 24px;clear: both;visibility: visible;"><a target="_blank" href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fappmsgalbum%3F__biz%3DMzAxNDEwNjk5OQ%3D%3D%26action%3Dgetalbum%26album_id%3D2565944923443904512%23wechat_redirect" textvalue="3DXR 技術" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2" style="outline: 0px;color: var(--weui-LINK);cursor: pointer;">3DXR 技術</a>&nbsp;|&nbsp; 
   <a target="_blank" href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fappmsgalbum%3F__biz%3DMzAxNDEwNjk5OQ%3D%3D%26action%3Dgetalbum%26album_id%3D1533906991218294785%23wechat_redirect" textvalue="終端技術" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2" style="outline: 0px;color: var(--weui-LINK);cursor: pointer;">終端技術</a>&nbsp;|&nbsp; 
   <a target="_blank" href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fappmsgalbum%3F__biz%3DMzAxNDEwNjk5OQ%3D%3D%26action%3Dgetalbum%26album_id%3D1592015847500414978%23wechat_redirect" textvalue="音視頻技術" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2" style="outline: 0px;color: var(--weui-LINK);cursor: pointer;">音視頻技術</a></section><p style="margin-top: 8px;margin-bottom: 8px;outline: 0px;min-height: 24px;font-family: -apple-system, &quot;system-ui&quot;, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 0.544px;text-indent: 0em;text-align: center;line-height: 1.75em;visibility: visible;"><a target="_blank" href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fappmsgalbum%3F__biz%3DMzAxNDEwNjk5OQ%3D%3D%26action%3Dgetalbum%26album_id%3D1539610690070642689%23wechat_redirect" textvalue="服務端技術" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2" style="outline: 0px;color: var(--weui-LINK);cursor: pointer;">服務端技術</a><span style="outline: 0px;letter-spacing: 0.544px;">&nbsp;|&nbsp;</span><a target="_blank" href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fappmsgalbum%3F__biz%3DMzAxNDEwNjk5OQ%3D%3D%26action%3Dgetalbum%26album_id%3D2565883875634397185%23wechat_redirect" textvalue="技術質量" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2" style="outline: 0px;color: var(--weui-LINK);cursor: pointer;">技術質量</a>&nbsp;|&nbsp;<a target="_blank" href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fappmsgalbum%3F__biz%3DMzAxNDEwNjk5OQ%3D%3D%26action%3Dgetalbum%26album_id%3D1522425612282494977%23wechat_redirect" textvalue="數據算法" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2" style="outline: 0px;color: var(--weui-LINK);cursor: pointer;">數據算法</a></p><p style="margin-top: 8px;margin-bottom: 8px;outline: 0px;min-height: 24px;font-family: -apple-system, &quot;system-ui&quot;, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 0.544px;text-indent: 0em;text-align: center;line-height: 1.75em;visibility: visible;"><br></p><section class="mp_profile_iframe_wrp" style="margin-bottom: 24px;outline: 0px;"><mp-common-profile class="custom_select_card mp_profile_iframe js_wx_tap_highlight" data-pluginname="mpprofile" data-id="MzAxNDEwNjk5OQ==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/33P2FdAnju8t5nZGhAatCrc4e2iaDfAaoInribRKxc7MOqdTGygfcLqSDxhj0trCHVEh94Sjl7zuWYzwouYtJ0VQ/300?wx_fmt=png&amp;wxfrom=19" data-nickname="大淘寶技術" data-alias="AlibabaMTT" data-signature="大淘寶技術官方賬號" data-from="2" data-index="0" data-origin_num="695" data-isban="0" data-biz_account_status="0" data-weui-theme="light" data-is_biz_ban="0"></mp-common-profile></section></section><section style="line-height: 1.75em;"><section style="display: none;line-height: 1.75em;"><br></section></section><p style="display: none;"><mp-style-type data-value="3"></mp-style-type></p></div><p style="color: #858585; font-size: 13px;">本文分享自微信公眾號 - 大淘寶技術（AlibabaMTT）。<br>如有侵權，請聯繫 support@oschina.cn 刪除。<br>本文參與「<a href="https://www.oschina.net/sharing-plan" target="_blank">OSC 源創計劃</a>」，歡迎正在閲讀的你也加入，一起分享。</p></div>
                                    ]]>
            </description>
            <guid isPermaLink="false">https://my.oschina.net/u/4662964/blog/10984756</guid>
            <link>https://my.oschina.net/u/4662964/blog/10984756</link>
            <author>
                <![CDATA[原創]]>
            </author>
        </item>
    </channel>
</rss>
