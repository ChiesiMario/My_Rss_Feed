<?xml version="1.0" encoding="UTF-8"?>
<rss
    xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"


>
    <channel>
        <title>
            <![CDATA[開源中國-綜合資訊]]>
        </title>
        <link>https://www.oschina.net/news/industry</link>
        <atom:link href="https://rsshub.app/oschina/news/industry" rel="self" type="application/rss+xml" />
        <description>
            <![CDATA[開源中國-綜合資訊 - Made with love by RSSHub(https://github.com/DIYgod/RSSHub)]]>
        </description>
        <generator>RSSHub</generator>
        <webMaster>i@diygod.me (DIYgod)</webMaster>
        <language>zh-cn</language>
        <lastBuildDate>Sun, 18 Feb 2024 04:06:12 GMT</lastBuildDate>
        <ttl>120</ttl>
        <item>
            <title>
                <![CDATA[工商銀行取得「基於 SpringBoot 的 web 系統後端實現方法及裝置」專利]]>
            </title>
            <description>
                <![CDATA[<div class="content"><p><u><a href="https://www.oschina.net/action/GoToLink?url=http%3A%2F%2Fepub.cnipa.gov.cn%2FDxb%2FPatentDetail" target="_blank">據國家知識產權局公告</a></u>，中國工商銀行股份有限公司近日取得一項名為「<strong>基於 SpringBoot 的 web 系統後端實現方法及裝置</strong>「的專利，授權公告號 CN112905176B，申請日期為 2021 年 2 月。</p><p><img src="https://oscimg.oschina.net/oscnet/up-c517204b09e40c8390e687c6f85f1da3004.png" referrerpolicy="no-referrer"></p><p><img alt="" src="https://oscimg.oschina.net/oscnet/up-4c319310d0c88d46dbaeaae98ddfda13249.png" referrerpolicy="no-referrer"></p><p><strong>專利摘要：</strong></p><p>本發明公開了一種基於 SpringBoot 的 web 系統後端實現方法及裝置，其中該方法包括：接收頁面顯示層上送的操作數據；從操作數據中提取操作數據對應的業務 ID 和維護對象 ID；從數據訪問層存儲的業務參數表中，獲取與業務 ID 對應的配置信息，所述配置信息包括不同數據字段各自對應的業務處理邏輯、每個數據字段所在的數據表，以及每個數據字段與數據表中表字段的映射關係；將維護對象 ID 和業務處理邏輯組合為條件表達式；利用所述條件表達式處理所述操作數據。本發明可以減少後端業務層在開發過程中的變動，降低開發成本，同時提升系統的穩定性。</p><p><strong>專利摘要附圖：</strong></p><p><img alt="" src="https://oscimg.oschina.net/oscnet/up-d9c35128bcaa487fc775e62a18eb221ab15.png" referrerpolicy="no-referrer"></p><p><strong>專利説明書：</strong></p><p><img height="1684" src="https://oscimg.oschina.net/oscnet/up-1a9c96dfe9ae983ccc365fc338d875fa1c7.png" width="1236" referrerpolicy="no-referrer"></p><p><img src="https://oscimg.oschina.net/oscnet/up-74400e9352156515f96f943d3d1b0d38f31.png" referrerpolicy="no-referrer"></p><p><img src="https://oscimg.oschina.net/oscnet/up-506b932cba593703d4451b426dc264fa754.png" referrerpolicy="no-referrer"></p><p><img src="https://oscimg.oschina.net/oscnet/up-e294d82482d7164d48096679a54a8c91976.png" referrerpolicy="no-referrer"></p><p><img src="https://oscimg.oschina.net/oscnet/up-e8fa61af87d64ab4c42e04b7fb8441af90b.png" referrerpolicy="no-referrer"></p><p><img src="https://oscimg.oschina.net/oscnet/up-cc869c2cfdfd6e8dd8cf31c892a48280317.png" referrerpolicy="no-referrer"></p><p><img src="https://oscimg.oschina.net/oscnet/up-5f8ebf82699b938e3a3bacba8adb460b928.png" referrerpolicy="no-referrer"></p><hr><p>Spring Boot 是一個用於開發 Java 應用程序的開源框架，它基於 Spring 框架，旨在簡化 Spring 應用程序的開發和部署過程。Spring Boot 提供了一種快速、便捷的方式來構建獨立的、生產級別的 Spring 應用程序。</p><p><img src="https://oscimg.oschina.net/oscnet/up-2f4fd85fe6e77ccca851eede3e41f6b3aaf.png" referrerpolicy="no-referrer"></p></div>
                                    ]]>
            </description>
            <pubDate>Sun, 18 Feb 2024 03:32:09 GMT</pubDate>
            <guid isPermaLink="false">https://www.oschina.net/news/279004</guid>
            <link>https://www.oschina.net/news/279004</link>
            <author>
                <![CDATA[來源: OSCHINA]]>
            </author>
        </item>
        <item>
            <title>
                <![CDATA[Ollama 在 Windows 上推出預覽版]]>
            </title>
            <description>
                <![CDATA[<div class="content"><p>Ollama <a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Follama.com%2Fblog%2Fwindows-preview" target="_blank">宣佈</a>在 Windows 上推出預覽版，從而使得用户可以在全新的本機 Windows 體驗中提取、運行和創建大型語言模型。Windows 上的 Ollama 包括內置 GPU 加速、訪問完整的模型庫以及包括 OpenAI 兼容性在內的 Ollama API。</p><p><strong><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span style="color:var(--tw-prose-headings)"><span><span><span><span><span><span><span><span><span><span><span><span><span><span>硬件加速</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></strong></p><p style="margin-left:0; margin-right:0; text-align:start"><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span style="color:#000000"><span><span><span><span><span><span><span><span><span><span><span><span><span><span>Ollama 使用 NVIDIA GPU 以及現代 CPU 指令集（例如 AVX 和 AVX2（如果可用））加速運行模型。無需配置或虛擬化。</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p style="margin-left:0; margin-right:0; text-align:start"><img height="281" src="https://oscimg.oschina.net/oscnet/up-270f4e1af3d1225dad109d574bb1589d756.png" width="500" referrerpolicy="no-referrer"></p><p style="margin-left:0; margin-right:0; text-align:start"><strong><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span style="color:var(--tw-prose-headings)"><span><span><span><span><span><span><span><span><span><span><span><span><span><span>完全訪問模型庫</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></strong></p><p style="margin-left:0; margin-right:0; text-align:start"><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span style="color:#000000"><span><span><span><span><span><span><span><span><span><span><span><span><span><span>完整的 Ollama&nbsp;<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Follama.com%2Flibrary" target="_blank">模型庫</a>可在 Windows 上運行，包括<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Follama.com%2Fblog%2Fvision-models" target="_blank">視覺模型</a>。<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Follama.com%2Flibrary%2Fllava" target="_blank">運行 LLaVA 1.6</a>等視覺模型時，可以將圖像拖放到<code>ollama run</code>中以將其添加到消息中。</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p style="margin-left:0; margin-right:0; text-align:start"><img height="282" src="https://oscimg.oschina.net/oscnet/up-3100971eb1a9516f720fb135f332fb63ef9.png" width="500" referrerpolicy="no-referrer"></p><p style="margin-left:0; margin-right:0; text-align:start"><strong>Always-on Ollama API</strong></p><p style="margin-left:0; margin-right:0; text-align:start"><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span style="color:#000000"><span><span><span><span><span><span><span><span><span><span><span><span><span><span>Ollama 的 API 自動在後台運行，服務於<code>http://localhost:11434</code>。工具和應用程序無需任何額外設置即可連接到它。</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p style="margin-left:0; margin-right:0; text-align:start"><img height="256" src="https://oscimg.oschina.net/oscnet/up-c2a7b747bb24faeb3fce193754495a7d5b6.png" width="500" referrerpolicy="no-referrer"></p><p style="color:#000000; margin-left:0; margin-right:0; text-align:start">示例：</p><pre><code class="language-powershell">(Invoke-WebRequest -method POST -Body '{"model":"llama2", "prompt":"Why is the sky blue?", "stream": false}' -uri http://localhost:11434/api/generate ).Content | ConvertFrom-json
</code></pre><p style="color:#000000; margin-left:0; margin-right:0; text-align:start">Windows 上的 Ollama 還支持與其他平台上相同的 OpenAI 兼容性，因此可以通過 Ollama 將為 OpenAI 構建的現有工具與本地模型結合使用。</p><p style="color:#000000; margin-left:0; margin-right:0; text-align:start"><strong><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span style="color:var(--tw-prose-headings)"><span><span><span><span><span><span><span><span><span><span><span><span><span><span>開始使用</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></strong></p><ul><li>在 Windows 上<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Follama.com%2Fdownload%2FOllamaSetup.exe" target="_blank">下載</a>&nbsp;Ollama</li><li>雙擊安裝程序，<code>OllamaSetup.exe</code></li><li>安裝後，打開你喜歡的終端並運行<code>ollama run llama2</code>以運行模型</li></ul><p style="margin-left:0; margin-right:0; text-align:start"><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span style="color:#000000"><span><span><span><span><span><span><span><span><span><span><span><span><span><span>當有新版本可用時，Ollama 將提示更新。</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p></div>
                                    ]]>
            </description>
            <pubDate>Sun, 18 Feb 2024 03:08:09 GMT</pubDate>
            <guid isPermaLink="false">https://www.oschina.net/news/279000/ollama-windows-preview</guid>
            <link>https://www.oschina.net/news/279000/ollama-windows-preview</link>
            <author>
                <![CDATA[來源: OSCHINA]]>
            </author>
        </item>
        <item>
            <title>
                <![CDATA[LangChain 完成 2500 萬美元 A 輪融資，正式發佈 LLMOps 產品 LangSmith]]>
            </title>
            <description>
                <![CDATA[<div class="content"><p>LangChain 是用於構建 LLM 應用的開源工具，近日其開發商宣佈完成了由紅杉資本領投的 2500 萬美元 A 輪融資，並正式推出首款付費 LLMOps 產品 LangSmith。</p><blockquote><p><img src="https://oscimg.oschina.net/oscnet/up-b25af7c499d0b428655a1d2252687cedd5c.png" referrerpolicy="no-referrer"><em><u><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Ftwitter.com%2FLangChainAI%2Fstatus%2F1758169569364230542" target="_blank">https://twitter.com/LangChainAI/status/1758169569364230542</a></u></em></p></blockquote><p>LangSmith 旨在成為一站式 LLM 應用開發平台，讓開發者能夠加速他們的 LLM 應用開發流程，包含了從開發、測試到部署及監控的整個項目生命週期。</p><p><img alt="" src="https://oscimg.oschina.net/oscnet/up-13ce0809dadd727d979ea9107ae1c00fd75.png" referrerpolicy="no-referrer"></p><p><em>▲ LangSmith 在 LLM 應用程序生命週期的每個階段支持的工作流</em></p><p>根據介紹，在原型設計階段，使用 LangSmith 的開發者可以全面掌握 LLM 調用的整個流程，並能實時識別錯誤源頭和性能瓶頸，進行調試和迭代優化。他們還可以與領域專家協作，進一步優化應用表現，並且可以添加人工反饋或通過 AI 輔助進行評估，以確保應用的相關性、準確性、安全性和敏感度等。</p><p>一旦確定了原型，這個一站式平台可通過託管的 LangServe 幫助用户部署應用，並提供對生產環境中發生情況的全面視圖，覆蓋從成本和響應時間到異常和錯誤等各個方面，以便企業能夠交付在生產環境中既高質量又具成本效益的 LLM 應用。</p><p>相關鏈接：<em><u><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fventurebeat.com%2Fai%2Flangchain-lands-25m-round-launches-platform-to-support-entire-llm-application-lifecycle%2F" target="_blank">https://venturebeat.com/</a></u></em></p></div>
                                    ]]>
            </description>
            <pubDate>Sun, 18 Feb 2024 02:36:01 GMT</pubDate>
            <guid isPermaLink="false">https://www.oschina.net/news/278995/langsmith-ga</guid>
            <link>https://www.oschina.net/news/278995/langsmith-ga</link>
            <author>
                <![CDATA[來源: OSCHINA]]>
            </author>
        </item>
        <item>
            <title>
                <![CDATA[VALL-E X —— 多語言文本到語音合成與語音克隆]]>
            </title>
            <description>
                <![CDATA[<div class="content"><p><span style="background-color:#ffffff; color:#1f2328">微軟&nbsp;</span>VALL-E X<span style="background-color:#ffffff; color:#1f2328"><span>&nbsp;</span>零樣本語音合成模型的開源實現。</span><strong style="color:#1f2328">預訓練模型現已向公眾開放，供研究或應用使用。</strong></p><p><strong style="color:#1f2328"><img alt="" height="250" src="https://static.oschina.net/uploads/space/2023/0829/142926_34Of_4252687.jpg" width="500" referrerpolicy="no-referrer"></strong></p><p><span style="background-color:#ffffff; color:#1f2328">VALL-E X 是一個強大而創新的多語言文本轉語音（TTS）模型，最初由微軟發佈。雖然微軟最初在他們的研究論文中提出了該概念，但並未發佈任何代碼或預訓練模型。</span></p><p style="text-align:start"><span><span><span style="color:#000000"><span><span><span><span><span><span><span><span><span><span><span><span><span><span>VALL-E X 可以為單語使用者合成另一種語言的個性化語音。以源自源文本和目標文本的音素序列以及源自音頻編解碼器模型的源聲學標記作為提示，VALL-E X 能夠生成目標語言的聲學標記，然後將其解壓縮為目標語言語音波形。得益於強大的上下文學習能力，VALL-E X 不需要同一説話人的跨語言語音數據進行訓練，可以執行各種零樣本跨語言語音生成任務，例如跨語言文本到-語音合成和語音到語音翻譯。</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><h4 style="text-align:start"><strong>功能特點</strong></h4><ol><li><p><strong>多語言 TTS</strong>: 可使用三種語言 - 英語、中文和日語 - 進行自然、富有表現力的語音合成。</p></li><li><p><strong>零樣本語音克隆</strong>: 僅需錄製任意説話人的短短的 3~10 秒錄音，VALL-E X 就能生成個性化、高質量的語音，完美還原他們的聲音。</p></li></ol><ol start="3"><li><strong>語音情感控制</strong>: VALL-E X 可以合成與給定説話人錄音相同情感的語音，為音頻增添更多表現力。</li><li><strong style="color:#1f2328">零樣本跨語言語音合成</strong><span style="background-color:#ffffff; color:#1f2328">: VALL-E X 可以合成與給定説話人母語不同的另一種語言，在不影響口音和流利度的同時，保留該説話人的音色與情感。</span></li><li><strong style="color:#1f2328">口音控制</strong><span style="background-color:#ffffff; color:#1f2328">: VALL-E X 允許您控制所合成音頻的口音，比如説中文帶英語口音或反之。</span></li><li><strong>聲學環境保留</strong>: 當給定説話人的錄音在不同的聲學環境下錄製時，VALL-E X 可以保留該聲學環境，使合成語音聽起來更加自然。</li></ol><p><span style="background-color:#ffffff; color:#1f2328">查看&nbsp;</span><a href="https://plachtaa.github.io/">demo 頁面</a><span style="background-color:#ffffff; color:#1f2328">來瀏覽更多示例。</span></p></div>
                                                                ]]>
            </description>
            <pubDate>Sun, 18 Feb 2024 02:34:01 GMT</pubDate>
            <guid isPermaLink="false">https://www.oschina.net/p/vall-e-x</guid>
            <link>https://www.oschina.net/p/vall-e-x</link>
        </item>
        <item>
            <title>
                <![CDATA[Gitee 推薦 | 輕量且高效的 Excel 讀寫工具 EEC]]>
            </title>
            <description>
                <![CDATA[<h1><a id="user-content-eec 介紹" class="anchor" href="https://gitee.com/wangguanquan/eec#eec%E4%BB%8B%E7%BB%8D"></a>EEC 介紹</h1><p><a href="https://gitee.com/link?target=https%3A%2F%2Fgithub.com%2Fwangguanquan%2Feec%2Freleases"><img src="http://img.shields.io/badge/release-0.5.12-blue.svg?style=flat" alt="Release" referrerpolicy="no-referrer"></a><a href="https://gitee.com/link?target=http%3A%2F%2Fwww.apache.org%2Flicenses%2FLICENSE-2.0"><img src="http://img.shields.io/badge/license-Apache--2-blue.svg?style=flat" alt="License" referrerpolicy="no-referrer"></a></p><p>EEC（Excel Export Core）是一款輕量且高效的 Excel 讀寫工具，它具有包體小、接入代碼量少和運行時消耗資源少等優點</p><p>EEC 的設計初衷是為瞭解決 Apache POI 內存高、速度慢且 API 臃腫的詬病。EEC 的底層並不依賴 POI 包，所有的底層代碼均自己實現，事實上 EEC 僅依賴<code>dom4j</code>和<code>slf4j</code>，前者用於小文件 xml 讀取，後者統一日誌接口。</p><p>EEC 在 JVM 參數<code>-Xmx10m -Xms10m</code>下讀寫 100w 行 x29 列內存使用截圖，下載 <a href="https://gitee.com/link?target=https%3A%2F%2Fgithub.com%2Fwangguanquan%2Feec-benchmark">eec-benchmark</a> 項目進行性能測試</p><p><img src="https://gitee.com/wangguanquan/eec/raw/master/images/write_read_100w.jpg" alt="write_read 100w" referrerpolicy="no-referrer"></p><h2><a id="user-content-現狀" class="anchor" href="https://gitee.com/wangguanquan/eec#%E7%8E%B0%E7%8A%B6"></a>現狀</h2><p>EEC 支持大多數日常應用場景，最擅長的是表格處理，比如轉對象數組、轉 Map 數組、內容檢查等導入/導出常見功能。</p><p>目前已實現 worksheet 類型有六種，也可以繼承已有<a href="https://gitee.com/wangguanquan/eec/blob/master/src/main/java/org/ttzero/excel/entity/Sheet.java">Worksheet</a>來實現自定義數據源</p><ul><li><a href="https://gitee.com/wangguanquan/eec/blob/master/src/main/java/org/ttzero/excel/entity/ListSheet.java">ListSheet</a> // 對象數組</li><li><a href="https://gitee.com/wangguanquan/eec/blob/master/src/main/java/org/ttzero/excel/entity/ListMapSheet.java">ListMapSheet</a> // Map 數組</li><li><a href="https://gitee.com/wangguanquan/eec/blob/master/src/main/java/org/ttzero/excel/entity/StatementSheet.java">StatementSheet</a> // PreparedStatement</li><li><a href="https://gitee.com/wangguanquan/eec/blob/master/src/main/java/org/ttzero/excel/entity/ResultSetSheet.java">ResultSetSheet</a> // ResultSet 支持 (多用於存儲過程)</li><li><a href="https://gitee.com/wangguanquan/eec/blob/master/src/main/java/org/ttzero/excel/entity/EmptySheet.java">EmptySheet</a> // 空 worksheet</li><li><a href="https://gitee.com/wangguanquan/eec/blob/master/src/main/java/org/ttzero/excel/entity/CSVSheet.java">CSVSheet</a> // 支持 csv 與 xlsx 互轉</li></ul><h2><a id="user-content-主要功能" class="anchor" href="https://gitee.com/wangguanquan/eec#%E4%B8%BB%E8%A6%81%E5%8A%9F%E8%83%BD"></a>主要功能</h2><ol><li>支持<strong>大數據量導出</strong>，行數無上限，超過單個 Sheet 上限會自動分頁</li><li><strong>超低內存</strong>，無論是 xlsx 還是 xls 格式，大部分情況下可以在 10MB 以內完成十萬級甚至百萬級行數據讀寫</li><li>支持動態樣式，如導出庫存時將低於預警閾值的行背景標黃顯示</li><li>支持一鍵設置斑馬線，利於閲讀</li><li><strong>自適應列寬對中文更精準</strong></li><li>採用 Stream 流讀文件，按需加載不會將整個文件讀入到內存</li><li>支持 Iterator 和 Stream+Lambda 讀文件，你可以像操作集合類一樣操作 Excel</li><li>支持 csv 與 excel 格式相互轉換</li></ol><h2><a id="user-content-wiki" class="anchor" href="https://gitee.com/wangguanquan/eec#wiki"></a>WIKI</h2><p>閲讀<a href="https://gitee.com/link?target=https%3A%2F%2Fgithub.com%2Fwangguanquan%2Feec%2Fwiki">WIKI</a> 瞭解更多用法</p><h2><a id="user-content-gitee" class="anchor" href="https://gitee.com/wangguanquan/eec#gitee"></a>Gitee</h2><p>國內用户可訪問<a href="https://gitee.com/wangguanquan/eec">Gitee</a>， 在 Gitee 提 issue 開發者也同樣會及時回覆</p><h2><a id="user-content-使用方法" class="anchor" href="https://gitee.com/wangguanquan/eec#%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95"></a>使用方法</h2><p>pom.xml 添加</p><div class="white"><div class="highlight markdown-code-block"><pre><span id="LC1" class="line"><span class="nt">&lt;dependency&gt;</span></span><span id="LC2" class="line"><span class="nt">&lt;groupId&gt;</span>org.ttzero<span class="nt">&lt;/groupId&gt;</span></span><span id="LC3" class="line"><span class="nt">&lt;artifactId&gt;</span>eec<span class="nt">&lt;/artifactId&gt;</span></span><span id="LC4" class="line"><span class="nt">&lt;version&gt;</span>${eec.version}<span class="nt">&lt;/version&gt;</span></span><span id="LC5" class="line"><span class="nt">&lt;/dependency&gt;</span></span></pre><div class="markdown-code-block-copy-btn"></div></div></div><h2><a id="user-content-示例" class="anchor" href="https://gitee.com/wangguanquan/eec#%E7%A4%BA%E4%BE%8B"></a>示例</h2><h4><a id="user-content-1-簡單導出" class="anchor" href="https://gitee.com/wangguanquan/eec#1-%E7%AE%80%E5%8D%95%E5%AF%BC%E5%87%BA"></a>1. 簡單導出</h4><p>對象數組導出時可以在對象上使用註解<code>@ExcelColumn("列名")</code>來設置 excel 頭部信息</p><div class="white"><div class="highlight markdown-code-block"><pre><span id="LC1" class="line"><span class="nd">@ExcelColumn</span><span class="o">(</span><span class="s">"渠道 ID"</span><span class="o">)</span></span><span id="LC2" class="line"><span class="kd">private</span><span class="kt">int</span><span class="n">channelId</span><span class="o">;</span></span><span id="LC3" class="line"></span><span id="LC4" class="line"><span class="nd">@ExcelColumn</span></span><span id="LC5" class="line"><span class="kd">private</span><span class="nc">String</span><span class="n">account</span><span class="o">;</span></span></pre><div class="markdown-code-block-copy-btn"></div></div></div><p>默認情況下導出的列順序與字段在對象中的定義順序一致，可以通過指定<code>colIndex</code>或指定 Column 數組來重置順序。</p><div class="white"><div class="highlight markdown-code-block"><pre><span id="LC1" class="line"><span class="c1">// 創建一個名為"test object"的 excel 文件</span></span><span id="LC2" class="line"><span class="k">new</span><span class="nf">Workbook</span><span class="o">(</span><span class="s">"test object"</span><span class="o">)</span></span><span id="LC3" class="line"></span><span id="LC4" class="line"><span class="c1">// 添加"工作表"並指定導出數據，可以通過 addSheet 添加多個 worksheet</span></span><span id="LC5" class="line"><span class="o">.</span><span class="na">addSheet</span><span class="o">(</span><span class="k">new</span><span class="nc">ListSheet</span><span class="o">&lt;&gt;(</span><span class="s">"學生信息"</span><span class="o">,</span><span class="n">students</span><span class="o">))</span></span><span id="LC6" class="line"></span><span id="LC7" class="line"><span class="c1">// 指定輸出位置，如果做文件導出可以直接輸出到`respone.getOutputStream()`</span></span><span id="LC8" class="line"><span class="o">.</span><span class="na">writeTo</span><span class="o">(</span><span class="nc">Paths</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"f:/excel"</span><span class="o">));</span></span></pre><div class="markdown-code-block-copy-btn"></div></div></div><h4><a id="user-content-2-動態樣式" class="anchor" href="https://gitee.com/wangguanquan/eec#2-%E5%8A%A8%E6%80%81%E6%A0%B7%E5%BC%8F"></a>2. 動態樣式</h4><p>動態樣式和數據轉換都是使用<code>@FunctionalInterface</code>實現，通常用於<strong>突出或高亮</strong>顯示一些重要的單元格或行，下面展示如何將低下 60 分的成績輸出為"不合格"並將整行標為橙色</p><div class="white"><div class="highlight markdown-code-block"><pre><span id="LC1" class="line"><span class="k">new</span><span class="nc">Workbook</span><span class="o">(</span><span class="s">"2021 小五班期未考試成績"</span><span class="o">)</span></span><span id="LC2" class="line"><span class="o">.</span><span class="na">addSheet</span><span class="o">(</span><span class="k">new</span><span class="nc">ListSheet</span><span class="o">&lt;&gt;(</span><span class="s">"期末成績"</span><span class="o">,</span><span class="n">students</span></span><span id="LC3" class="line"><span class="o">,</span><span class="k">new</span><span class="nc">Column</span><span class="o">(</span><span class="s">"學號"</span><span class="o">,</span><span class="s">"id"</span><span class="o">,</span><span class="kt">int</span><span class="o">.</span><span class="na">class</span><span class="o">)</span></span><span id="LC4" class="line"><span class="o">,</span><span class="k">new</span><span class="nc">Column</span><span class="o">(</span><span class="s">"姓名"</span><span class="o">,</span><span class="s">"name"</span><span class="o">,</span><span class="nc">String</span><span class="o">.</span><span class="na">class</span><span class="o">)</span></span><span id="LC5" class="line"><span class="o">,</span><span class="k">new</span><span class="nc">Column</span><span class="o">(</span><span class="s">"成績"</span><span class="o">,</span><span class="s">"score"</span><span class="o">,</span><span class="kt">int</span><span class="o">.</span><span class="na">class</span><span class="o">,</span><span class="n">n</span><span class="o">-&gt;</span><span class="o">(</span><span class="kt">int</span><span class="o">)</span><span class="n">n</span><span class="o">&lt;</span><span class="mi">60</span><span class="o">?</span><span class="s">"不合格"</span><span class="o">:</span><span class="n">n</span><span class="o">)</span></span><span id="LC6" class="line"><span class="o">).</span><span class="na">setStyleProcessor</span><span class="o">((</span><span class="n">o</span><span class="o">,</span><span class="n">style</span><span class="o">,</span><span class="n">sst</span><span class="o">)</span><span class="o">-&gt;</span></span><span id="LC7" class="line"><span class="n">o</span><span class="o">.</span><span class="na">getScore</span><span class="o">()</span><span class="o">&lt;</span><span class="mi">60</span><span class="o">?</span><span class="n">sst</span><span class="o">.</span><span class="na">modifyFill</span><span class="o">(</span><span class="n">style</span><span class="o">,</span><span class="k">new</span><span class="nc">Fill</span><span class="o">(</span><span class="nc">PatternType</span><span class="o">.</span><span class="na">solid</span><span class="o">,</span><span class="nc">Color</span><span class="o">.</span><span class="na">orange</span><span class="o">))</span><span class="o">:</span><span class="n">style</span><span class="o">)</span></span><span id="LC8" class="line"><span class="o">).</span><span class="na">writeTo</span><span class="o">(</span><span class="nc">Paths</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"f:/excel"</span><span class="o">));</span></span></pre><div class="markdown-code-block-copy-btn"></div></div></div><p>效果如下圖</p><p><img src="https://gitee.com/wangguanquan/eec/raw/master/images/dynamic_style.png" alt="期未成績" referrerpolicy="no-referrer"></p><h4><a id="user-content-3-自適應列寬更精準" class="anchor" href="https://gitee.com/wangguanquan/eec#3-%E8%87%AA%E9%80%82%E5%BA%94%E5%88%97%E5%AE%BD%E6%9B%B4%E7%B2%BE%E5%87%86"></a>3. 自適應列寬更精準</h4><div class="white"><div class="highlight markdown-code-block"><pre><span id="LC1" class="line"><span class="c1">// 測試類</span></span><span id="LC2" class="line"><span class="kd">public</span><span class="kd">static</span><span class="kd">class</span><span class="nc">WidthTestItem</span><span class="o">{</span></span><span id="LC3" class="line"><span class="nd">@ExcelColumn</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"整型"</span><span class="o">,</span><span class="n">format</span><span class="o">=</span><span class="s">"#,##0_);[Red]-#,##0_);0_)"</span><span class="o">)</span></span><span id="LC4" class="line"><span class="kd">private</span><span class="nc">Integer</span><span class="n">nv</span><span class="o">;</span></span><span id="LC5" class="line"><span class="nd">@ExcelColumn</span><span class="o">(</span><span class="s">"字符串 (en)"</span><span class="o">)</span></span><span id="LC6" class="line"><span class="kd">private</span><span class="nc">String</span><span class="n">sen</span><span class="o">;</span></span><span id="LC7" class="line"><span class="nd">@ExcelColumn</span><span class="o">(</span><span class="s">"字符串 (中文)"</span><span class="o">)</span></span><span id="LC8" class="line"><span class="kd">private</span><span class="nc">String</span><span class="n">scn</span><span class="o">;</span></span><span id="LC9" class="line"><span class="nd">@ExcelColumn</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"日期時間"</span><span class="o">,</span><span class="n">format</span><span class="o">=</span><span class="s">"yyyy-mm-dd hh:mm:ss"</span><span class="o">)</span></span><span id="LC10" class="line"><span class="kd">private</span><span class="nc">Timestamp</span><span class="n">iv</span><span class="o">;</span></span><span id="LC11" class="line"><span class="o">}</span></span><span id="LC12" class="line"></span><span id="LC13" class="line"><span class="k">new</span><span class="nf">Workbook</span><span class="o">(</span><span class="s">"Auto Width Test"</span><span class="o">)</span></span><span id="LC14" class="line"><span class="o">.</span><span class="na">setAutoSize</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span><span class="c1">// &lt;- 自適應列寬</span></span><span id="LC15" class="line"><span class="o">.</span><span class="na">addSheet</span><span class="o">(</span><span class="k">new</span><span class="nc">ListSheet</span><span class="o">&lt;&gt;(</span><span class="n">randomTestData</span><span class="o">()))</span></span><span id="LC16" class="line"><span class="o">.</span><span class="na">writeTo</span><span class="o">(</span><span class="nc">Paths</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"f:/excel"</span><span class="o">));</span></span></pre><div class="markdown-code-block-copy-btn"></div></div></div><p><img src="https://gitee.com/wangguanquan/eec/raw/master/images/auto_width.png" alt="自動列寬" referrerpolicy="no-referrer"></p><h4><a id="user-content-4-支持多行表頭" class="anchor" href="https://gitee.com/wangguanquan/eec#4-%E6%94%AF%E6%8C%81%E5%A4%9A%E8%A1%8C%E8%A1%A8%E5%A4%B4"></a>4. 支持多行表頭</h4><p>EEC 使用多個 ExcelColumn 註解來實現多級表頭，名稱一樣的行或列將自動合併</p><div class="white"><div class="highlight markdown-code-block"><pre><span id="LC1" class="line"><span class="kd">public</span><span class="kd">static</span><span class="kd">class</span><span class="nc">RepeatableEntry</span><span class="o">{</span></span><span id="LC2" class="line"><span class="nd">@ExcelColumn</span><span class="o">(</span><span class="s">"運單號"</span><span class="o">)</span></span><span id="LC3" class="line"><span class="kd">private</span><span class="nc">String</span><span class="n">orderNo</span><span class="o">;</span></span><span id="LC4" class="line"><span class="nd">@ExcelColumn</span><span class="o">(</span><span class="s">"收件地址"</span><span class="o">)</span></span><span id="LC5" class="line"><span class="nd">@ExcelColumn</span><span class="o">(</span><span class="s">"省"</span><span class="o">)</span></span><span id="LC6" class="line"><span class="kd">private</span><span class="nc">String</span><span class="n">rProvince</span><span class="o">;</span></span><span id="LC7" class="line"><span class="nd">@ExcelColumn</span><span class="o">(</span><span class="s">"收件地址"</span><span class="o">)</span></span><span id="LC8" class="line"><span class="nd">@ExcelColumn</span><span class="o">(</span><span class="s">"市"</span><span class="o">)</span></span><span id="LC9" class="line"><span class="kd">private</span><span class="nc">String</span><span class="n">rCity</span><span class="o">;</span></span><span id="LC10" class="line"><span class="nd">@ExcelColumn</span><span class="o">(</span><span class="s">"收件地址"</span><span class="o">)</span></span><span id="LC11" class="line"><span class="nd">@ExcelColumn</span><span class="o">(</span><span class="s">"詳細地址"</span><span class="o">)</span></span><span id="LC12" class="line"><span class="kd">private</span><span class="nc">String</span><span class="n">rDetail</span><span class="o">;</span></span><span id="LC13" class="line"><span class="nd">@ExcelColumn</span><span class="o">(</span><span class="s">"收件人"</span><span class="o">)</span></span><span id="LC14" class="line"><span class="kd">private</span><span class="nc">String</span><span class="n">recipient</span><span class="o">;</span></span><span id="LC15" class="line"><span class="nd">@ExcelColumn</span><span class="o">(</span><span class="s">"寄件地址"</span><span class="o">)</span></span><span id="LC16" class="line"><span class="nd">@ExcelColumn</span><span class="o">(</span><span class="s">"省"</span><span class="o">)</span></span><span id="LC17" class="line"><span class="kd">private</span><span class="nc">String</span><span class="n">sProvince</span><span class="o">;</span></span><span id="LC18" class="line"><span class="nd">@ExcelColumn</span><span class="o">(</span><span class="s">"寄件地址"</span><span class="o">)</span></span><span id="LC19" class="line"><span class="nd">@ExcelColumn</span><span class="o">(</span><span class="s">"市"</span><span class="o">)</span></span><span id="LC20" class="line"><span class="kd">private</span><span class="nc">String</span><span class="n">sCity</span><span class="o">;</span></span><span id="LC21" class="line"><span class="nd">@ExcelColumn</span><span class="o">(</span><span class="s">"寄件地址"</span><span class="o">)</span></span><span id="LC22" class="line"><span class="nd">@ExcelColumn</span><span class="o">(</span><span class="s">"詳細地址"</span><span class="o">)</span></span><span id="LC23" class="line"><span class="kd">private</span><span class="nc">String</span><span class="n">sDetail</span><span class="o">;</span></span><span id="LC24" class="line"><span class="nd">@ExcelColumn</span><span class="o">(</span><span class="s">"寄件人"</span><span class="o">)</span></span><span id="LC25" class="line"><span class="kd">private</span><span class="nc">String</span><span class="n">sender</span><span class="o">;</span></span><span id="LC26" class="line"><span class="o">}</span></span></pre><div class="markdown-code-block-copy-btn"></div></div></div><p><img src="https://gitee.com/wangguanquan/eec/raw/master/images/multi-headers.png" alt="多行表頭" referrerpolicy="no-referrer"></p><h4><a id="user-content-5-報表輕鬆製作" class="anchor" href="https://gitee.com/wangguanquan/eec#5-%E6%8A%A5%E8%A1%A8%E8%BD%BB%E6%9D%BE%E5%88%B6%E4%BD%9C"></a>5. 報表輕鬆製作</h4><p>現在使用普通的 ListSheet 就可以導出漂亮的報表。示例請跳轉到 <a href="https://gitee.com/link?target=https%3A%2F%2Fgithub.com%2Fwangguanquan%2Feec%2Fwiki%2F%25E6%258A%25A5%25E8%25A1%25A8%25E7%25B1%25BB%25E5%25AF%25BC%25E5%2587%25BA%25E6%25A0%25B7%25E5%25BC%258F%25E7%25A4%25BA%25E4%25BE%258B">WIKI</a></p><p>記帳類</p><p><img src="https://gitee.com/wangguanquan/eec/raw/master/images/report1.png" alt="報表 1" referrerpolicy="no-referrer"></p><p>統計類</p><p><img src="https://gitee.com/wangguanquan/eec/raw/master/images/report3.png" alt="報表 2" referrerpolicy="no-referrer"></p><h4><a id="user-content-6-支持 28 種預設圖片樣式" class="anchor" href="https://gitee.com/wangguanquan/eec#6-%E6%94%AF%E6%8C%8128%E7%A7%8D%E9%A2%84%E8%AE%BE%E5%9B%BE%E7%89%87%E6%A0%B7%E5%BC%8F"></a>6. 支持 28 種預設圖片樣式</h4><p>導出圖片時可以設置圖片樣式使其更美觀，關於圖片樣式請參考<a href="https://gitee.com/link?target=https%3A%2F%2Fgithub.com%2Fwangguanquan%2Feec%2Fwiki%2F1-%25E5%25AF%25BC%25E5%2587%25BAExcel%23%25E5%25AF%25BC%25E5%2587%25BA%25E5%259B%25BE%25E7%2589%2587">1-導出 Excel#導出圖片</a></p><p><img src="https://gitee.com/wangguanquan/eec/raw/master/images/preset_effect.jpg" alt="effect" referrerpolicy="no-referrer"></p><h3><a id="user-content-讀取示例" class="anchor" href="https://gitee.com/wangguanquan/eec#%E8%AF%BB%E5%8F%96%E7%A4%BA%E4%BE%8B"></a>讀取示例</h3><p>EEC 使用<code>ExcelReader#read</code>靜態方法讀文件，因其支持標準 Stream 所以可以直接使用<code>map</code>、<code>filter</code>和<code>collect</code>等 JDK 內置函數，讀取 Excel 就像操作集合類一樣簡單，極大降低學習成本。</p><h4><a id="user-content-1-使用 stream" class="anchor" href="https://gitee.com/wangguanquan/eec#1-%E4%BD%BF%E7%94%A8stream"></a>1. 使用 Stream</h4><div class="white"><div class="highlight markdown-code-block"><pre><span id="LC1" class="line"><span class="k">try</span><span class="o">(</span><span class="nc">ExcelReader</span><span class="n">reader</span><span class="o">=</span><span class="nc">ExcelReader</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="nc">Paths</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"./用户註冊.xlsx"</span><span class="o">)))</span><span class="o">{</span></span><span id="LC2" class="line"><span class="c1">// 讀取所有 worksheet 並輸出</span></span><span id="LC3" class="line"><span class="n">reader</span><span class="o">.</span><span class="na">sheets</span><span class="o">().</span><span class="na">flatMap</span><span class="o">(</span><span class="nl">Sheet:</span><span class="o">:</span><span class="n">rows</span><span class="o">).</span><span class="na">forEach</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">);</span></span><span id="LC4" class="line"><span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="nc">IOException</span><span class="n">e</span><span class="o">)</span><span class="o">{</span></span><span id="LC5" class="line"><span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span></span><span id="LC6" class="line"><span class="o">}</span></span></pre><div class="markdown-code-block-copy-btn"></div></div></div><h4><a id="user-content-2-讀入到數組或 list 中" class="anchor" href="https://gitee.com/wangguanquan/eec#2-%E8%AF%BB%E5%85%A5%E5%88%B0%E6%95%B0%E7%BB%84%E6%88%96list%E4%B8%AD"></a>2. 讀入到數組或 List 中</h4><div class="white"><div class="highlight markdown-code-block"><pre><span id="LC1" class="line"><span class="k">try</span><span class="o">(</span><span class="nc">ExcelReader</span><span class="n">reader</span><span class="o">=</span><span class="nc">ExcelReader</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="nc">Paths</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"./User.xlsx"</span><span class="o">)))</span><span class="o">{</span></span><span id="LC2" class="line"><span class="c1">// 讀取第 1 個 Sheet 頁</span></span><span id="LC3" class="line"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">User</span><span class="o">&gt;</span><span class="n">users</span><span class="o">=</span><span class="n">reader</span><span class="o">.</span><span class="na">sheet</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span></span><span id="LC4" class="line"><span class="c1">// 指定第 6 行為表頭，前 5 行為概要信息</span></span><span id="LC5" class="line"><span class="o">.</span><span class="na">header</span><span class="o">(</span><span class="mi">6</span><span class="o">)</span></span><span id="LC6" class="line"><span class="c1">// 讀取數據行</span></span><span id="LC7" class="line"><span class="o">.</span><span class="na">rows</span><span class="o">()</span></span><span id="LC8" class="line"><span class="c1">// 將每行數據轉換為 User 象</span></span><span id="LC9" class="line"><span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">row</span><span class="o">-&gt;</span><span class="n">row</span><span class="o">.</span><span class="na">to</span><span class="o">(</span><span class="nc">User</span><span class="o">.</span><span class="na">class</span><span class="o">))</span></span><span id="LC10" class="line"><span class="c1">// 收集為 List 或數組進行後續處理</span></span><span id="LC11" class="line"><span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="nc">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span></span><span id="LC12" class="line"><span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="nc">IOException</span><span class="n">e</span><span class="o">)</span><span class="o">{</span></span><span id="LC13" class="line"><span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span></span><span id="LC14" class="line"><span class="o">}</span></span></pre><div class="markdown-code-block-copy-btn"></div></div></div><h4><a id="user-content-3-過濾和聚合" class="anchor" href="https://gitee.com/wangguanquan/eec#3-%E8%BF%87%E6%BB%A4%E5%92%8C%E8%81%9A%E5%90%88"></a>3. 過濾和聚合</h4><p>EEC 支持 Stream 的大部分功能，以下代碼展示過濾平台為"iOS"的註冊用户</p><div class="white"><div class="highlight markdown-code-block"><pre><span id="LC1" class="line"><span class="n">reader</span><span class="o">.</span><span class="na">sheet</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="na">header</span><span class="o">(</span><span class="mi">6</span><span class="o">)</span></span><span id="LC2" class="line"><span class="o">.</span><span class="na">rows</span><span class="o">()</span></span><span id="LC3" class="line"><span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">row</span><span class="o">-&gt;</span><span class="s">"iOS"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">row</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"platform"</span><span class="o">)))</span><span class="c1">// 過濾平台為"iOS"的用户</span></span><span id="LC4" class="line"><span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">row</span><span class="o">-&gt;</span><span class="n">row</span><span class="o">.</span><span class="na">to</span><span class="o">(</span><span class="nc">Regist</span><span class="o">.</span><span class="na">class</span><span class="o">))</span></span><span id="LC5" class="line"><span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="nc">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span></span></pre><div class="markdown-code-block-copy-btn"></div></div></div><h4><a id="user-content-4-多級表頭讀取" class="anchor" href="https://gitee.com/wangguanquan/eec#4-%E5%A4%9A%E7%BA%A7%E8%A1%A8%E5%A4%B4%E8%AF%BB%E5%8F%96"></a>4. 多級表頭讀取</h4><p>多級表頭可以使用<code>header</code>方法來指定表頭所在的多個行號</p><div class="white"><div class="highlight markdown-code-block"><pre><span id="LC1" class="line"><span class="n">reader</span><span class="o">.</span><span class="na">sheet</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span></span><span id="LC2" class="line"><span class="o">.</span><span class="na">header</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">)</span><span class="c1">// &lt;- 指定第 1、2 行均為表頭</span></span><span id="LC3" class="line"><span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="nl">Row:</span><span class="o">:</span><span class="n">toMap</span><span class="o">)</span><span class="c1">// &lt;- Row 轉 Map</span></span><span id="LC4" class="line"><span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">)</span></span></pre><div class="markdown-code-block-copy-btn"></div></div></div><p>多級表頭將以<code>A1:A2:A3</code>這種格式進行縱向拼接，像上面第 4 個示例中的運單數據讀取結果將以<code>運單號</code>，<code>收件地址:省</code>，<code>收件地址:市</code>呈現，這樣就可以解決出現兩個<code>省</code>、<code>市</code>導致錯亂的問題</p><p>更多關於多表頭使用方法可以參考 <a href="https://gitee.com/link?target=https%3A%2F%2Fgithub.com%2Fwangguanquan%2Feec%2Fwiki%2F%25E5%25A6%2582%25E4%25BD%2595%25E8%25AE%25BE%25E7%25BD%25AE%25E5%25A4%259A%25E8%25A1%258C%25E8%25A1%25A8%25E5%25A4%25B4%23%25E8%25AF%25BB%25E5%258F%2596%25E5%25B8%25A6%25E5%25A4%259A%25E8%25A1%258C%25E8%25A1%25A8%25E5%25A4%25B4%25E7%259A%2584%25E6%2596%2587%25E4%25BB%25B6">WIKI</a></p><h3><a id="user-content-xls 格式支持" class="anchor" href="https://gitee.com/wangguanquan/eec#xls%E6%A0%BC%E5%BC%8F%E6%94%AF%E6%8C%81"></a>xls 格式支持</h3><p>pom.xml 添加如下依賴，添加好後即完成了 xls 的兼容，是的！你不需要為 xls 格式添加任何一行代碼。</p><div class="white"><div class="highlight markdown-code-block"><pre><span id="LC1" class="line"><span class="nt">&lt;dependency&gt;</span></span><span id="LC2" class="line"><span class="nt">&lt;groupId&gt;</span>org.ttzero<span class="nt">&lt;/groupId&gt;</span></span><span id="LC3" class="line"><span class="nt">&lt;artifactId&gt;</span>eec-e3-support<span class="nt">&lt;/artifactId&gt;</span></span><span id="LC4" class="line"><span class="nt">&lt;version&gt;</span>${eec-e3-support.version}<span class="nt">&lt;/version&gt;</span></span><span id="LC5" class="line"><span class="nt">&lt;/dependency&gt;</span></span></pre><div class="markdown-code-block-copy-btn"></div></div></div><p>讀取 xls 的方法與 xlsx 完全一樣，外部不需要判斷是哪種格式，EEC 為其提供了完全一樣的接口，內部會根據文件頭去判斷具體類型，這種方式比簡單判斷文件後綴準確得多。</p><p>兩個工具的兼容性 <a href="https://gitee.com/link?target=https%3A%2F%2Fgithub.com%2Fwangguanquan%2Feec%2Fwiki%2FEEC%25E4%25B8%258EE3-support%25E5%2585%25BC%25E5%25AE%25B9%25E6%2580%25A7%25E5%25AF%25B9%25E7%2585%25A7%25E8%25A1%25A8">參考此表</a></p><h3><a id="user-content-csv 與 excel 格式互轉" class="anchor" href="https://gitee.com/wangguanquan/eec#csv%E4%B8%8Eexcel%E6%A0%BC%E5%BC%8F%E4%BA%92%E8%BD%AC"></a>CSV 與 Excel 格式互轉</h3><ul><li>CSV =&gt; Excel：向 Workbook 中添加一個<code>CSVSheet</code>工作表</li><li>Excel =&gt; CSV：讀 Excel 時調用<code>saveAsCSV</code>另存為 csv 格式</li></ul><p>代碼示例</p><div class="white"><div class="highlight markdown-code-block"><pre><span id="LC1" class="line"><span class="c1">// 直接保存為 csv 生成測試文件，對於數據量較多的場合也可以使用#more 方法分批獲取數據</span></span><span id="LC2" class="line"><span class="k">new</span><span class="nf">Workbook</span><span class="o">()</span></span><span id="LC3" class="line"><span class="o">.</span><span class="na">addSheet</span><span class="o">(</span><span class="n">createTestData</span><span class="o">())</span></span><span id="LC4" class="line"><span class="o">.</span><span class="na">saveAsCSV</span><span class="o">()</span><span class="c1">// 指定輸出格式為 csv</span></span><span id="LC5" class="line"><span class="o">.</span><span class="na">writeTo</span><span class="o">(</span><span class="nc">Paths</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"d:\\abc.csv"</span><span class="o">));</span></span><span id="LC6" class="line"></span><span id="LC7" class="line"><span class="c1">// CSV 轉 Excel</span></span><span id="LC8" class="line"><span class="k">new</span><span class="nf">Workbook</span><span class="o">()</span></span><span id="LC9" class="line"><span class="o">.</span><span class="na">addSheet</span><span class="o">(</span><span class="k">new</span><span class="nc">CSVSheet</span><span class="o">(</span><span class="nc">Paths</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"d:\\abc.csv"</span><span class="o">)))</span><span class="c1">// 添加 CSVSheet 並指定 csv 路徑</span></span><span id="LC10" class="line"><span class="o">.</span><span class="na">writeTo</span><span class="o">(</span><span class="nc">Paths</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"d:\\abc.xlsx"</span><span class="o">));</span></span><span id="LC11" class="line"></span><span id="LC12" class="line"><span class="c1">// Excel 轉 CSV</span></span><span id="LC13" class="line"><span class="k">try</span><span class="o">(</span><span class="nc">ExcelReader</span><span class="n">reader</span><span class="o">=</span><span class="nc">ExcelReader</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="nc">Paths</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"d:\\abc.xlsx"</span><span class="o">)))</span><span class="o">{</span></span><span id="LC14" class="line"><span class="c1">// 讀取 Excel 使用 saveAsCSV 保存為 CSV 格式</span></span><span id="LC15" class="line"><span class="n">reader</span><span class="o">.</span><span class="na">sheet</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="na">saveAsCSV</span><span class="o">(</span><span class="nc">Paths</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"./"</span><span class="o">));</span></span><span id="LC16" class="line"><span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="nc">IOException</span><span class="n">e</span><span class="o">)</span><span class="o">{</span></span><span id="LC17" class="line"><span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span></span><span id="LC18" class="line"><span class="o">}</span></span></pre><div class="markdown-code-block-copy-btn"></div></div></div><h2><a id="user-content-changelog" class="anchor" href="https://gitee.com/wangguanquan/eec#changelog"></a>CHANGELOG</h2><h2><a id="user-content-version-0512-2023-11-26" class="anchor" href="https://gitee.com/wangguanquan/eec#version-0512-2023-11-26"></a>Version 0.5.12 (2023-11-26)</h2><ul><li>移除 watch 改用 slf4j 輸出日誌</li><li>新增進度窗口<code>onProgress</code></li><li>優化自適應列寬算法使其支持更多字體和大小</li><li>數據轉換器功能增強，ExcelColumn 增加 converter 屬性以支持導出/導入時雙向數據轉換 (<a href="https://gitee.com/link?target=https%3A%2F%2Fgithub.com%2Fwangguanquan%2Feec%2Fissues%2F362">#362</a>)</li><li>支持讀取 xlsx 格式 wps 的內嵌圖片 (<a href="https://gitee.com/link?target=https%3A%2F%2Fgithub.com%2Fwangguanquan%2Feec%2Fissues%2F363">#363</a>)</li><li>部分類的註釋改為中文，後續會將全部註釋改為中文</li></ul><h2><a id="user-content-version-0511-2023-10-08" class="anchor" href="https://gitee.com/wangguanquan/eec#version-0511-2023-10-08"></a>Version 0.5.11 (2023-10-08)</h2><ul><li>優化 ExcelReader 性能，性能提升 100%~300%</li><li>增加<code>setHeaderColumnReadOption</code>方法提高 ExcelReader 豐富性</li><li>修復讀取 16 進制轉義字符時出現亂碼問題</li><li>修復非法 UTF8 字符導致寫文件異常</li><li>無數據且能獲取表頭信息時正常寫表頭 (<a href="https://gitee.com/link?target=https%3A%2F%2Fgithub.com%2Fwangguanquan%2Feec%2Fissues%2F361">#361</a>)</li><li>屏蔽 JDK17 以上版本使用 ExcelReader 拋異常的問題</li></ul><h2><a id="user-content-version-0510-2023-08-10" class="anchor" href="https://gitee.com/wangguanquan/eec#version-0510-2023-08-10"></a>Version 0.5.10 (2023-08-10)</h2><ul><li>修復單元格長度過長導致內容錯位的異常 (<a href="https://gitee.com/link?target=https%3A%2F%2Fgithub.com%2Fwangguanquan%2Feec%2Fissues%2F354">#354</a>)</li><li>支持導出圖片</li></ul><h2><a id="user-content-version-059-2023-05-10" class="anchor" href="https://gitee.com/wangguanquan/eec#version-059-2023-05-10"></a>Version 0.5.9 (2023-05-10)</h2><ul><li>修復 dom4j 默認構造器容易造成 XXE 安全漏洞</li></ul><p><a href="https://gitee.com/wangguanquan/eec/blob/master/CHANGELOG">更多...</a></p>]]>
            </description>
            <pubDate>Sun, 18 Feb 2024 02:24:01 GMT</pubDate>
            <guid isPermaLink="false">https://gitee.com/wangguanquan/eec</guid>
            <link>https://gitee.com/wangguanquan/eec</link>
        </item>
        <item>
            <title>
                <![CDATA[TIOBE 2 月：Go 首次進入前十、「上古語言」 COBOL 和 Fortran 排名飆升]]>
            </title>
            <description>
                <![CDATA[<div class="content"><p>TIOBE 編程語言排行榜公佈了最新的 2 月榜單：</p><p><img src="https://oscimg.oschina.net/oscnet/up-fd9ae8e26575e48697980ef52fc8c00afe7.png" referrerpolicy="no-referrer"><u><em><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fwww.tiobe.com%2Ftiobe-index%2F" target="_blank">https://www.tiobe.com/tiobe-index/</a></em></u></p><p>2024 年 2 月，Go 進入了 TIOBE 編程語言排行榜前十，<strong>排名第 8 位 —— 這是 Go 有史以來的最高排名</strong>。從其排名趨勢變化圖來看，Go 排名最低是 2015 年的第 122 位。</p><p><img src="https://oscimg.oschina.net/oscnet/up-27511d1c68e8b6a5da03935da9c217514b2.png" referrerpolicy="no-referrer"></p><p>除了 Go 語言，本月的榜單有兩門「上古語言」 罕見地進入了前 20：</p><ul><li>Fortran 從去年同期的第 24 位上升至<strong>第 11 位</strong>，PHP 在其前一位</li><li>COBOL 從去年同期的第 30 位上升至<strong>第 19 位</strong>，緊隨大熱的 Rust 其後</li></ul><p><img src="https://oscimg.oschina.net/oscnet/up-9f78200777a69c335cc272ad90ad8d5ae73.png" referrerpolicy="no-referrer"></p><p><img src="https://oscimg.oschina.net/oscnet/up-c2f9aba372a28a33707322be8cf57463c95.png" referrerpolicy="no-referrer"></p><p>根據這兩門語言排名的趨勢變化，它們的排名於去年中旬突然出現爆發式上升，此後雖然稍有下降，但也比前幾年靠前。</p><p>去年 8 月，IBM <u><a href="https://www.oschina.net/news/255047/ibm-ai-translate-cobol-code-to-java">推出</a></u>了一款生成式 AI 編程助手&nbsp;watsonx，用於將傳統的 COBOL 轉換為企業級 Java 代碼。據稱該工具由 IBM 的 watsonx.ai 代碼模型提供支持。該模型從 1.5 萬億個 tokens 中學習了 115 種編碼語言的知識；擁有 200 億個參數，從而實現「更高效的 COBOL 到 Java 轉換」。</p><p><img alt="" src="https://oscimg.oschina.net/oscnet/up-3ace59bdd3cd97bad8ebebb10969ccc48ed.png" referrerpolicy="no-referrer"></p><p style="color:#333333; margin-left:0; margin-right:0; text-align:left"><span style="color:#000000">COBOL 是最古老的編程語言之一，歷史可以追溯到 1959 年左右；但當下仍被大型組織廣泛用於處理來自重要中央系統的數據，例如賬單、帳户、工資單和客户交易等。2022 年的一項調查指出，92% 的受訪者認為 COBOL 具有戰略意義，日常使用的 COBOL 代碼量顯着增加至 775-8500 億行；大約是先前估計的三倍。</span></p></div>
                                    ]]>
            </description>
            <pubDate>Sat, 17 Feb 2024 11:08:46 GMT</pubDate>
            <guid isPermaLink="false">https://www.oschina.net/news/278954/tiobe-index-202402</guid>
            <link>https://www.oschina.net/news/278954/tiobe-index-202402</link>
            <author>
                <![CDATA[來源: OSCHINA]]>
            </author>
        </item>
        <item>
            <title>
                <![CDATA[IDEA 2024.1：Spring 支持增強、GitHub Action 支持增強、更新 HTTP Client 等]]>
            </title>
            <description>
                <![CDATA[<div class="content"><p>有段時間沒有更新 IDEA 了，早上看到 IntelliJ IDEA 2024.1 EAP 5 發佈的郵件提示，瞄了一眼，發現真的是越來越強了，其中不少功能對我來説還是非常有用的。也許這些能力對關注 DD 的小夥伴也有幫助，所以搞篇博客介紹和推薦一下。</p><h2>Spring、Quarkus 等主流框架的支持增強</h2><ol><li>Search Everywhere 功能中增加<code>Endpoints</code>選項卡</li></ol><p>具體如下圖所示：</p><p><img src="https://oscimg.oschina.net/oscnet/up-0ee7ce6c03e2286e03386a69dcc60e657fd.png" alt="" referrerpolicy="no-referrer"></p><p>開發者可以在這裏直接搜索通過 Spring、Quarkus、Micronaut、Ktor 實現的接口來找到具體的代碼實現位置。這個功能非常實用，尤其是對於接手老項目的開發者來説，可以快速的定位接口實現來完成開發任務或問題排查。</p><ol start="2"><li>增強 Spring Bean 的自動補全和自動裝配</li></ol><p>IntelliJ IDEA 現在為應用程序上下文中的所有 Bean 提供自動補全功能，並自動連接它們。</p><p>如果 bean 通過構造函數具有自動裝配依賴項，則相關字段也會通過構造函數自動裝配。</p><p>同樣，如果通過字段或 Lombok 的 <code>@RequiredArgsConstructor</code> 註釋注入依賴項，則新 bean 會自動通過字段連接。</p><p><img src="https://oscimg.oschina.net/oscnet/up-2b02c90fa6961c0775ece81bee73b6931c0.gif" alt="" referrerpolicy="no-referrer"></p><ol start="3"><li>增強 Spring 模型圖</li></ol><p>在該版本中用户訪問 Spring 模型圖變得更加容易，可以如下圖這樣點擊 Spring 標識的行標記直接跳轉：</p><p><img src="https://oscimg.oschina.net/oscnet/up-1df349276ff95704a5a445e8c8433bdf334.png" alt="" referrerpolicy="no-referrer"></p><p>也可以使用快捷鍵 <code>⌥⏎</code> (MacOS) 或 <code>Alt+Enter</code>（Windows）來生成和跳轉。</p><p>同時，該版本還引入了新的圖標，增強了 Spring 模型圖的可視化內容，如：<code>Components</code>、<code>Controllers</code>、<code>Repositories</code>。此外，您現在可以方便地切換庫中 Bean 的可見性（默認情況下是隱藏的）。</p><p><img src="https://oscimg.oschina.net/oscnet/up-94a11e1d5b4fe45c57c7abadcdc29db4a48.png" alt="" referrerpolicy="no-referrer"></p><h2>HTTP Client 的改進</h2><p>HTTP Client 現在提供更多身份驗證選項，包括 <code>PKCE</code> 授權代碼和設備授予流程。它還支持令牌和身份驗證請求的額外參數。</p><p><img src="https://oscimg.oschina.net/oscnet/up-04caeaa12f92b82571732d63b20e17766f7.png" alt="" referrerpolicy="no-referrer"></p><p>現在它可以自動處理 <code>code_challenge</code> 和 <code>passes code_verifier</code> 的生成，以便在 <code>PKCE</code> 請求中檢索令牌。</p><p><img src="https://oscimg.oschina.net/oscnet/up-245a2f71b9627fe602eefc5b4dbc5c8232e.png" alt="" referrerpolicy="no-referrer"></p><p>這個版本的 HTTP Client 可以使用 Netty 作為其低級網絡庫。通過支持 SSL、代理和 HTTP/2，使我們能夠在 HTTP 客户端中實現 HTTP/2 的支持。</p><p><img src="https://oscimg.oschina.net/oscnet/up-cbf789d87574df3daf100bb7a57dbbee6eb.png" alt="" referrerpolicy="no-referrer"></p><p>此外，HTTP Client 的工具欄外觀，也與新的 UI 風格保持一致，提供更加美觀的用户體驗。</p><p><img src="https://oscimg.oschina.net/oscnet/up-090f4be8d3bca108783edca87a0148b7643.png" alt="" referrerpolicy="no-referrer"></p><h2>GitHub Action 的支持增強</h2><ol><li>Workflow 上下文的支持</li></ol><p>現在可以為各種 GitHub Action 上下文引入了廣泛的自動完成支持，包括<code>github.*</code>、<code>env.*</code>、<code>steps.*</code>和<code>inputs.*</code>。</p><p><img src="https://oscimg.oschina.net/oscnet/up-1481a6bdbd95457c407cb2a94e85503bdea.gif" alt="" referrerpolicy="no-referrer"></p><p>這個優化非常有用，可以有效的降低編寫複雜工作流腳本的過程，開發人員不用再去頻繁的搜索上下文中涉及的參數了。</p><p>該優化在<code>YAML</code>文件配置中也同樣有效：</p><p><img src="https://oscimg.oschina.net/oscnet/up-f7ac4f81dd0f9fdbc03431c0506a1bea7a7.gif" alt="" referrerpolicy="no-referrer"></p><p>在<code>YAML</code>文件中，開發者還可以使用 <code>branding</code> 功能使用特定圖標和顏色指示器自定義 GitHub 上操作的外觀。</p><p>此功能使操作創建者能夠在 GitHub Marketplace 和工作流程中直觀地區分他們的操作，使它們更易於識別和用户友好。通過在 <code>action.yml</code> 文件中指定圖標和顏色，開發人員可以一目瞭然地傳達其操作的目的，從而增強整體用户體驗。這種可視化定製有助於對操作進行分類，並幫助用户快速識別 CI/CD 管道所需的工具。</p><p><img src="https://oscimg.oschina.net/oscnet/up-eddce7b9706dff8a0a99820301742b2d3f8.gif" alt="" referrerpolicy="no-referrer"></p><ol start="2"><li>Docker 鏡像自動補全</li></ol><p>此增強功能在 GitHub 工作流程文件中提供 image 和 tag 建議，從而更輕鬆地將 Docker 容器集成到您的操作中。</p><p><img src="https://oscimg.oschina.net/oscnet/up-c4425bb3fad84e45c548fb87d94f74a7408.gif" alt="" referrerpolicy="no-referrer"></p><ol start="3"><li>JavaScript 文件路徑補全</li></ol><p>文件路徑完成功能會自動建議文件路徑，從而簡化 JavaScript 操作的配置並簡化工作流程執行。</p><p><img src="https://oscimg.oschina.net/oscnet/up-252eb1074583ebd3dde29ffaf1ed1e4c93f.gif" alt="" referrerpolicy="no-referrer"></p><h2>其他更新</h2><ul><li><p>優化 JSON schema 的處理： 優化了 JSON 模式驗證和完成背後的代碼。因此，IDE 現在可以更快地處理此任務並減少內存消耗。在使用 Azure Pipelines 的現實文件中，架構檢查現在速度提高了 10 倍。</p></li><li><p>現在可以在所有常見場景中輕鬆完成 HTTP Header，例如使用 Spring WebClient 和 RestAssured 測試。當遇到預期值時，會自動出現完成彈出窗口。</p></li></ul><p><img src="https://oscimg.oschina.net/oscnet/up-fdc206cbcf2cbcd15b7f663e5aea23148bc.gif" alt="" referrerpolicy="no-referrer"></p><p>另外，DD 最近把博客重新增加了板塊，正在維護幾個有意思的長期連載專欄，其中一個就是<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fwww.didispace.com%2Fidea-tips%2F" target="_blank">《玩轉 IDEA》</a>，這次換了工具，直接採用電子文檔的形式，閲讀體驗更好，​對這些內容感興趣的，可以關注起來！</p><blockquote><p>歡迎關注我的公眾號：程序猿 DD。第一時間瞭解前沿行業消息、分享深度技術乾貨、獲取優質學習資源</p></blockquote></div>
                                    ]]>
            </description>
            <pubDate>Sat, 17 Feb 2024 08:36:00 GMT</pubDate>
            <guid isPermaLink="false">https://my.oschina.net/didispace/blog/11043860</guid>
            <link>https://my.oschina.net/didispace/blog/11043860</link>
            <author>
                <![CDATA[原創]]>
            </author>
        </item>
        <item>
            <title>
                <![CDATA[openEuler 正式加入 LFEU 成為 Associate Member]]>
            </title>
            <description>
                <![CDATA[<div class="content"><p><span style="background-color:#ffffff; color:rgba(0, 0, 0, 0.9)">近期，openEuler 以 Associate Member 的身份加入 Linux Foundation Europe。</span></p><p><img height="278" src="https://oscimg.oschina.net/oscnet/up-587f92e98bc0291b3644a3f5524ac9ea83f.png" width="500" referrerpolicy="no-referrer"></p><p><span style="background-color:#ffffff; color:rgba(0, 0, 0, 0.9)">此次加入 Linux Foundation Europe，意味着 openEuler 在技術及生態影響力方面得到了 LFEU 的認可。</span><span style="background-color:#ffffff; color:rgba(0, 0, 0, 0.9)">未來，openEuler 將與 Linux Foundation 展</span><span style="background-color:#ffffff; color:rgba(0, 0, 0, 0.9)">開進一步合作，共同促進 Linux 技術發展。</span></p></div>
                                    ]]>
            </description>
            <pubDate>Sat, 17 Feb 2024 08:29:00 GMT</pubDate>
            <guid isPermaLink="false">https://www.oschina.net/news/278941</guid>
            <link>https://www.oschina.net/news/278941</link>
            <author>
                <![CDATA[來源: 投稿]]>
            </author>
        </item>
        <item>
            <title>
                <![CDATA[如何正確地理解應用架構並開發]]>
            </title>
            <description>
                <![CDATA[<div class="content"><div class="rich_media_content js_underline_content
                       autoTypeSetting24psection
            " id="js_content"><section style="margin-bottom: 8px;outline: 0px;font-family: system-ui, -apple-system, &quot;system-ui&quot;, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;color: rgb(34, 34, 34);background-color: rgb(255, 255, 255);text-align: center;visibility: visible;" data-mpa-powered-by="yiban.io"><img class="rich_pages wxw-img __bg_gif" data-backh="96" data-backw="578" data-cropselx1="0" data-cropselx2="578" data-cropsely1="0" data-cropsely2="96" data-imgfileid="503042079" data-ratio="0.16666666666666666" src="https://oscimg.oschina.net/oscnet/0c87b415-37eb-440b-8adc-76f3ca02d100.gif" data-type="gif" data-w="636" style="outline: 0px;letter-spacing: 0.544px;font-size: var(--articleFontsize);border-radius: 8px;text-align: justify;width: 100%;visibility: visible !important;background-size: 16px !important;height: auto;" referrerpolicy="no-referrer"><br style="outline: 0px;visibility: visible;"></section><section data-mpa-template="t" data-mpa-template-id="502" data-mpa-category="模板" style="outline: 0px;font-family: system-ui, -apple-system, &quot;system-ui&quot;, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;color: rgb(34, 34, 34);background-color: rgb(255, 255, 255);visibility: visible;"><section data-mpa-category="模板" data-mid="" style="padding-right: 1px;padding-left: 1px;outline: 0px;width: 677px;display: flex;justify-content: flex-start;align-items: center;flex-direction: column;visibility: visible;"><section data-mid="" style="outline: 0px;letter-spacing: 0.544px;width: 675px;display: grid;grid-template-columns: 26px auto;visibility: visible;"><section data-mid="" style="outline: 0px;width: 26px;height: 14px;display: flex;justify-content: center;align-items: center;align-self: center;visibility: visible;"><br style="outline: 0px;visibility: visible;"></section><section data-mid="" style="padding-left: 7px;outline: 0px;display: flex;justify-content: flex-start;align-items: center;visibility: visible;"><section data-mid="" style="margin-right: 7px;outline: 0px;text-align: left;visibility: visible;"><p data-mid="" style="outline: 0px;width: 0px;font-size: 14px;font-family: PingFangSC-Semibold, &quot;PingFang SC&quot;;font-weight: bold;color: rgb(58, 92, 244);line-height: 20px;visibility: visible;"><br style="outline: 0px;visibility: visible;"></p></section><section data-mid="" style="margin-bottom: 4px;outline: 0px;width: 635px;height: 1px;border-top: 1px solid rgb(58, 92, 244);align-self: flex-end;visibility: visible;"><br style="outline: 0px;visibility: visible;"></section></section></section><section data-mid="" style="padding: 7px 14px 9px 19px;outline: 0px;width: 675px;text-align: left;border-bottom: 1px solid rgb(58, 92, 244);visibility: visible;"><p style="margin-top: 8px;outline: 0px;min-height: 24px;letter-spacing: 0.578px;text-align: justify;visibility: visible;line-height: 1.75em;margin-bottom: 8px;"><span style="color: rgba(25, 26, 31, 0.9);letter-spacing: 1px;text-align: left;font-size: 15px;">許多同學或多或少都經歷過這樣的流程：</span></p><ol class="list-paddingleft-1" style="width: 577.422px;letter-spacing: 0.578px;text-wrap: wrap;"><li style="font-size: 15px;"><section style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="color: rgba(25, 26, 31, 0.9);letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;">新同學剛來公司，學習瞭解團隊的一些工程代碼，並瞭解其中的代碼風格</span></section></li><li style="font-size: 15px;"><section style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="color: rgba(25, 26, 31, 0.9);font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 1px;font-size: 15px;">團隊新接手了一些其他團隊的項目，需要了解工程結構以及概念</span></section></li><li style="font-size: 15px;"><section style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="color: rgba(25, 26, 31, 0.9);letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;">如何定義工程項目的工程結構，包目錄結構並達成團隊共識</span></section></li></ol><p style="margin-top: 8px;letter-spacing: 0.578px;text-wrap: wrap;line-height: 1.75em;margin-bottom: 8px;"><span style="box-sizing: inherit;letter-spacing: 1px;color: rgba(25, 26, 31, 0.9);font-size: 15px;">如果你有上述經歷，並對工程應用之中的 Module 劃分及其背後的意義理解上存在一些困擾， 那本文對你或許會有一些幫助。</span></p></section></section></section><section style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><br></section><section style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><strong><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;">理解代碼從理解應用架構開始</span></strong></section><p style="margin-top: 8px;margin-bottom: 8px;outline: 0px;font-family: system-ui, -apple-system, &quot;system-ui&quot;, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);visibility: visible;line-height: 1.75em;"><br></p><section style="margin-bottom: 0px;outline: 0px;box-sizing: inherit;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);color: rgba(25, 26, 31, 0.9);font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 16px;text-align: center;visibility: visible;line-height: 1.75em;"><span style="outline: 0px;visibility: visible;font-size: 15px;letter-spacing: 1px;"><img class="rich_pages wxw-img" data-imgfileid="503042075" data-ratio="0.3161764705882353" data-s="300,640" src="https://oscimg.oschina.net/oscnet/e960db52-4e96-424f-b406-df51c37c742e.png" data-type="png" data-w="408" style="outline: 0px;color: rgb(34, 34, 34);font-family: system-ui, -apple-system, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;visibility: visible !important;width: 113px !important;" referrerpolicy="no-referrer"></span></section><section style="margin-bottom: 0px;outline: 0px;font-family: system-ui, -apple-system, &quot;system-ui&quot;, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);color: rgb(34, 34, 34);text-align: center;visibility: visible;line-height: normal;"><span style="outline: 0px;color: rgb(3, 69, 255);font-family: -apple-system, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 18px;letter-spacing: 1px;visibility: visible;">應用架構</span></section><section style="margin-top: 8px;margin-bottom: 8px;outline: 0px;line-height: 1.75em;visibility: visible;"><br></section><span id="OSC_h4_1"></span><h4 data-lake-id="ca6fa186228ff7efaa653334195896c8" data-wording="true" style="margin-top: 0.5em;margin-bottom: 8px;outline: 0px;letter-spacing: 0.544px;text-wrap: wrap;color: rgb(34, 34, 34);background-color: rgb(255, 255, 255);font-family: -apple-system-font, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;visibility: visible;line-height: 1.75em;"><span style="outline: 0px;visibility: visible;letter-spacing: 1px;color: rgb(0, 17, 255);"><strong style="outline: 0px;visibility: visible;"><span style="outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">▐</span></strong><strong style="outline: 0px;visibility: visible;"><span style="outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">&nbsp;&nbsp;</span></strong><strong style="outline: 0px;visibility: visible;"><span style="color: rgb(0, 17, 255);outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">混亂的應用架構</span></strong></span></h4><section style="margin-top: 8px;margin-bottom: 8px;outline: 0px;line-height: 1.75em;visibility: visible;"><br></section><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;">最近看了一些業務工程的代碼，發現業務系統非常混亂，混亂主要體現在：</span></section><ol class="list-paddingleft-1" style="list-style-type: decimal;"><li><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span data-cangjie-key="30:0" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="30:0" style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);">應用的層次結構混亂：</span><span data-cangjie-key="30:10" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="30:10" style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;box-sizing: inherit;font-weight: bold;color: rgba(25, 26, 31, 0.9);">不知道應用應該如何分層、應該包含哪些組件、組件之間的關係是什麼</span><span data-cangjie-key="30:41" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="30:41" style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);">；</span></section></li><li><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span data-cangjie-key="33:0" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="33:0" style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);">缺少規範的指導和約束：</span><span data-cangjie-key="33:11" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="33:11" style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;box-sizing: inherit;font-weight: bold;color: rgba(25, 26, 31, 0.9);">新加一段業務邏輯不知道放在什麼地方（哪個類，哪個包）、應該起什麼名字比較合適</span><span data-cangjie-key="33:49" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="33:49" style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);">？</span></section></li><li><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span data-cangjie-key="36:0" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="36:0" style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);">每個工程的 Module 數量不一樣，Module 的命名和定義不一樣，不同的 Module 之間的依賴關係混亂（延伸下就是：</span><strong><span data-cangjie-key="36:0" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="36:0" style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);">Module 和 Package 的作用不清晰，不能很好的區分兩者之間的區別</span></strong><span data-cangjie-key="36:93" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="36:93" style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);">）</span></section></li></ol><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><br></section><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 1px;"><span data-cangjie-key="39:0" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="39:0" style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);">但有一個</span><span data-cangjie-key="39:4" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="39:4" style="box-sizing: inherit;font-weight: bold;color: rgba(25, 26, 31, 0.9);">共同點就是都很複雜</span><span data-cangjie-key="39:13" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="39:13" style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);">。導致複雜性的原因有很多，如果從架構的層面看，主要有兩點：</span></span></section><ol class="list-paddingleft-1" style="list-style-type: decimal;"><li><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">架構設計過於複雜，層次太多能把人繞暈。</span></section></li><li><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;">架構簡單，ServiceImpl 作為上帝類包攬一切，一杆捅到 DAO（就簡單場景而言，這種 Transaction Script 也還湊合，至少實現上手都快。</span></section></li></ol><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><br></section><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;font-weight: bold;color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;">這種人為的複雜性導致系統越來越臃腫，越來越難維護，新來的同學，往往要捂着鼻子摳幾天甚至幾個月，才能理清系統和業務脈絡，然後又一頭扎進各種 bug fix，業務修補的惡性循環中，暗無天日！</span></section><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="letter-spacing: 1px;font-size: 15px;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);"><span style="color: rgba(25, 26, 31, 0.9);text-wrap: wrap;">（Transaction Script 地址：</span>https://martinfowler.com/eaaCatalog/transactionScript.html）</span></p><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="letter-spacing: 1px;font-size: 15px;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);"><br></span></p><span id="OSC_h4_2"></span><h4 data-lake-id="ca6fa186228ff7efaa653334195896c8" data-wording="true" style="margin-top: 0.5em;text-wrap: wrap;outline: 0px;letter-spacing: 0.544px;color: rgb(34, 34, 34);background-color: rgb(255, 255, 255);font-family: -apple-system-font, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;visibility: visible;line-height: 1.75em;margin-bottom: 8px;"><span style="outline: 0px;visibility: visible;letter-spacing: 1px;color: rgb(0, 17, 255);"><strong style="outline: 0px;visibility: visible;"><span style="outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">▐</span></strong><strong style="outline: 0px;visibility: visible;"><span style="outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">&nbsp;&nbsp;</span></strong><strong style="outline: 0px;visibility: visible;"><span style="outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">有序的應用架構</span></strong></span></h4><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><br></p><section style="margin-top: 8px;margin-bottom: 8px;letter-spacing: 0.578px;text-wrap: wrap;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;">一個沒有架構的應用系統，就像一堆隨意堆放、雜亂無章的玩具，只有熵值，沒有熵減。而一個有良好架構的應用系統，有章法、有結構，一切都顯得井井有條。</span></section><section style="margin-top: 8px;margin-bottom: 8px;letter-spacing: 0.578px;text-wrap: wrap;line-height: 1.75em;text-align: center;"><span style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;"><img class="rich_pages wxw-img" data-imgfileid="503041985" data-ratio="0.3731481481481482" src="https://oscimg.oschina.net/oscnet/4a4ae94e-2564-4cb0-a399-fe49a3b0e877.jpg" data-type="other" data-w="1080" referrerpolicy="no-referrer"></span></section><section style="margin-top: 8px;margin-bottom: 8px;letter-spacing: 0.578px;text-wrap: wrap;line-height: 1.75em;text-align: justify;"><span style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;"><br></span></section><p style="margin-top: 8px;margin-bottom: 8px;letter-spacing: 0.578px;text-wrap: wrap;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;">好的組織架構會遵循一定的架構模式，大部分的組織都會按職能和業務來設計自己的架構。如果你反其道而行之，硬要把銷售、財務和技術人員放在一個部門，就會顯得很奇怪。</span></p><p style="margin-top: 8px;margin-bottom: 8px;letter-spacing: 0.578px;text-wrap: wrap;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;"><br></span></p><p style="margin-top: 8px;margin-bottom: 8px;letter-spacing: 0.578px;text-wrap: wrap;line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 1px;"><span data-cangjie-key="72:0" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="72:0" style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);">對於應用架構而言，</span><span data-cangjie-key="72:9" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="72:9" style="box-sizing: inherit;font-weight: bold;color: rgba(25, 26, 31, 0.9);">代碼是其核心組成要素，結構就是這些代碼該如何被組織</span><span data-cangjie-key="72:34" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="72:34" style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);">，也就是要如何處理</span></span><span style="box-sizing: inherit;letter-spacing: 1px;font-size: 15px;font-weight: bold;color: rgba(25, 26, 31, 0.9);">模塊（Module）</span><span style="box-sizing: inherit;letter-spacing: 1px;font-size: 15px;color: rgba(25, 26, 31, 0.9);">、</span><span style="box-sizing: inherit;letter-spacing: 1px;font-size: 15px;font-weight: bold;color: rgba(25, 26, 31, 0.9);">包（Package）</span><span style="box-sizing: inherit;letter-spacing: 1px;font-size: 15px;color: rgba(25, 26, 31, 0.9);">和</span><span style="box-sizing: inherit;letter-spacing: 1px;font-size: 15px;font-weight: bold;color: rgba(25, 26, 31, 0.9);">類（Class）</span><span style="font-size: 15px;letter-spacing: 1px;"><span data-cangjie-key="72:74" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="72:74" style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);">之間的關係。簡而言之，</span><span data-cangjie-key="72:85" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="72:85" style="box-sizing: inherit;font-weight: bold;color: rgba(25, 26, 31, 0.9);">應用架構就是要解決代碼要如何被組織的問題。</span></span></p><p style="margin-top: 8px;margin-bottom: 8px;letter-spacing: 0.578px;text-wrap: wrap;line-height: 1.75em;"><span style="box-sizing: inherit;letter-spacing: 1px;font-size: 15px;font-weight: bold;color: rgba(25, 26, 31, 0.9);"><br></span></p><span id="OSC_h4_3"></span><h4 data-lake-id="ca6fa186228ff7efaa653334195896c8" data-wording="true" style="margin-top: 0.5em;margin-bottom: 8px;text-wrap: wrap;outline: 0px;letter-spacing: 0.544px;color: rgb(34, 34, 34);background-color: rgb(255, 255, 255);font-family: -apple-system-font, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;visibility: visible;line-height: 1.75em;"><span style="outline: 0px;visibility: visible;letter-spacing: 1px;color: rgb(0, 17, 255);"><strong style="outline: 0px;visibility: visible;"><span style="outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">▐</span></strong><strong style="outline: 0px;visibility: visible;"><span style="outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">&nbsp;&nbsp;</span></strong><strong style="outline: 0px;visibility: visible;"><span style="outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">包和模塊之間的區別</span></strong></span></h4><p style="margin-top: 8px;margin-bottom: 8px;letter-spacing: 0.578px;text-wrap: wrap;line-height: 1.75em;"><br></p><section style="margin-top: 8px;margin-bottom: 8px;letter-spacing: 0.578px;text-wrap: wrap;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;">包和模塊這兩個概念是比較容易發生混淆的。比如在《實現領域驅動設計》中，作者就説：</span></section><section style="margin-top: 8px;margin-bottom: 8px;letter-spacing: 0.578px;text-wrap: wrap;line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 1px;"><span data-cangjie-key="87:0" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="87:0" style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-style: italic;">If you are using Java or C#, you are already familiar with&nbsp;</span><span data-cangjie-key="87:59" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="87:59" style="box-sizing: inherit;font-weight: bold;color: rgba(25, 26, 31, 0.9);font-style: italic;">Modules</span><span data-cangjie-key="87:66" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="87:66" style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-style: italic;">, though you know them by another name. Java calls them packages. C# calls them namespaces.</span></span></section><section style="margin-top: 8px;margin-bottom: 8px;letter-spacing: 0.578px;text-wrap: wrap;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;">他認為 Module 是 Package，這個定義容易造成混淆。特別是在使用 Maven 的時候，在 Maven 中，Module 是一個 Artifact，通常是一個 Jar 而不是 Package。比如 NBF-Falcon Framework 基礎類型的工程就包括如下 3 個 Module：</span></section><section class="code-snippet__fix code-snippet__js"><pre class="code-snippet__js" data-lang="ruby"><code><span class="code-snippet_outer">&lt;modules&gt;</span></code><code><span class="code-snippet_outer">    &lt;<span class="code-snippet__class"><span class="code-snippet__keyword">module</span>&gt;{應用<span class="code-snippet__title">Code</span>}-<span class="code-snippet__title">api</span>&lt;/<span class="code-snippet__title">module</span>&gt;</span></span></code><code><span class="code-snippet_outer">    &lt;<span class="code-snippet__class"><span class="code-snippet__keyword">module</span>&gt;{應用<span class="code-snippet__title">Code</span>}-<span class="code-snippet__title">service</span>&lt;/<span class="code-snippet__title">module</span>&gt;</span></span></code><code><span class="code-snippet_outer">    &lt;<span class="code-snippet__class"><span class="code-snippet__keyword">module</span>&gt;{應用<span class="code-snippet__title">Code</span>}-<span class="code-snippet__title">start</span>&lt;/<span class="code-snippet__title">module</span>&gt;</span></span></code><code><span class="code-snippet_outer">&lt;<span class="code-snippet__regexp">/modules&gt;</span></span></code></pre></section><section style="margin-top: 8px;margin-bottom: 8px;letter-spacing: 0.578px;text-wrap: wrap;line-height: 1.75em;"><br></section><section style="margin-top: 8px;margin-bottom: 8px;letter-spacing: 0.578px;text-wrap: wrap;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;">的確，Module 和 Component 這兩個概念很相近，很容易造成混淆。比如，在</span><span style="box-sizing: inherit;font-weight: bold;text-decoration: underline;text-underline-position: under;font-size: 15px;letter-spacing: 1px;">StackOverflow 上有一個提問</span><span style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;">，就是問 Module 和 Component 之間區別的。獲得最高讚的答案是通過 Scope 來區分的。</span></section><section style="margin-top: 8px;margin-bottom: 8px;letter-spacing: 0.578px;text-wrap: wrap;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-style: italic;font-size: 15px;letter-spacing: 1px;">The terms are similar. I generally think of a "module" as being larger than a "component". A component is a single part, usually relatively small in scope.</span></section><section style="margin-top: 8px;margin-bottom: 8px;letter-spacing: 0.578px;text-wrap: wrap;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-style: italic;font-size: 15px;letter-spacing: 1px;">「這兩個概念類似，我通常認為「模塊」比「組件」更大。組件是一個單獨的部分，通常範圍相對較小。」</span></section><section style="margin-top: 8px;margin-bottom: 8px;letter-spacing: 0.578px;text-wrap: wrap;line-height: 1.75em;text-align: left;"><span style="box-sizing: inherit;letter-spacing: 1px;font-size: 15px;color: rgba(25, 26, 31, 0.9);">（StackOverflow 地址：https://softwareengineering.stackexchange.com/questions/178927/is-there-a-difference-between-a-component-and-a-module?spm=ata.21736010.0.0.48807536xgth68）</span></section><section style="margin-top: 8px;margin-bottom: 8px;letter-spacing: 0.578px;text-wrap: wrap;line-height: 1.75em;"><br></section><section style="margin-top: 8px;margin-bottom: 8px;letter-spacing: 0.578px;text-wrap: wrap;line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 1px;"><span data-cangjie-key="109:0" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="109:0" style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);">這個回答和我的直覺反應是一致的，即 Module 比 Package 要大。根據以上信息，我在此對 Module 和 Package 進行一下定義説明，在本文中，都會遵照如下的定義。-&nbsp;</span><span data-cangjie-key="109:86" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="109:86" style="box-sizing: inherit;font-weight: bold;color: rgba(25, 26, 31, 0.9);">模塊（Module）</span><span data-cangjie-key="109:96" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="109:96" style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);">：和 Maven 中 Module 定義保持一致，簡單理解就是 Jar。-&nbsp;</span><span data-cangjie-key="109:131" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="109:131" style="box-sizing: inherit;font-weight: bold;color: rgba(25, 26, 31, 0.9);">包（Package）</span><span data-cangjie-key="109:141" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="109:141" style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);">：和 UML 中的定義類似，簡單理解就是一個文件夾。</span></span></section><section style="margin-top: 8px;margin-bottom: 8px;letter-spacing: 0.578px;text-wrap: wrap;line-height: 1.75em;"><span style="box-sizing: inherit;letter-spacing: 1px;font-size: 15px;color: rgba(25, 26, 31, 0.9);"><br></span></section><section style="margin-top: 8px;margin-bottom: 8px;letter-spacing: 0.578px;text-wrap: wrap;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;">一個 Moudle 通常是由多個 Package 組成的，其關係如下圖所示：</span></section><section style="margin-bottom: 8px;letter-spacing: 0.578px;text-wrap: wrap;text-align: center;"><img class="rich_pages wxw-img" data-croporisrc="https://oscimg.oschina.net/oscnet/9c60cd1f-d4bc-498a-b008-b0c947f36489.jpg" data-cropx1="30" data-cropx2="530" data-cropy1="13" data-cropy2="349" data-imgfileid="503042078" data-ratio="0.6686626746506986" src="https://oscimg.oschina.net/oscnet/7bde28db-0d81-4d94-b7a5-48a794f593ed.jpg" data-type="jpeg" data-w="501" style="height: 336px;width: 500px;" referrerpolicy="no-referrer"></section><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><br></p><span id="OSC_h4_4"></span><h4 data-lake-id="ca6fa186228ff7efaa653334195896c8" data-wording="true" style="margin-top: 0.5em;margin-bottom: 8px;outline: 0px;letter-spacing: 0.544px;text-wrap: wrap;color: rgb(34, 34, 34);background-color: rgb(255, 255, 255);font-family: -apple-system-font, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;visibility: visible;line-height: 1.75em;"><span style="outline: 0px;visibility: visible;letter-spacing: 1px;color: rgb(0, 17, 255);"><strong style="outline: 0px;visibility: visible;"><span style="outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">▐</span></strong><strong style="outline: 0px;visibility: visible;"><span style="outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">&nbsp;&nbsp;</span></strong><strong style="outline: 0px;visibility: visible;"><span style="color: rgb(0, 17, 255);outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">典型的業務系統</span></strong></span></h4><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><br></p><p style="margin-top: 8px;margin-bottom: 8px;letter-spacing: 0.578px;text-wrap: wrap;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;">典型的業務系統都需要：</span></p><ol class="list-paddingleft-1" style="width: 577.422px;letter-spacing: 0.578px;text-wrap: wrap;"><li><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">接收 request，響應 response；</span></p></li><li><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">做業務邏輯處理，像校驗參數，狀態流轉，業務計算等等；</span></p></li><li><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">和外部系統有聯動，像數據庫，微服務，搜索引擎等；</span></p></li></ol><p style="margin-top: 8px;margin-bottom: 8px;letter-spacing: 0.578px;text-wrap: wrap;line-height: 1.75em;"><strong><span style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;">如何正確的組織這些業務代碼，讓他們處於自身該存在的位置，就是我們今天要聊的話題。</span></strong></p><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><br></p><section style="margin-bottom: 0px;outline: 0px;box-sizing: inherit;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);color: rgba(25, 26, 31, 0.9);font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 16px;text-align: center;visibility: visible;line-height: normal;"><span style="outline: 0px;font-size: 15px;letter-spacing: 1px;visibility: visible;"><img class="rich_pages wxw-img" data-imgfileid="503042076" data-ratio="0.3056872037914692" data-s="300,640" src="https://oscimg.oschina.net/oscnet/c2180234-fd18-4cab-aab2-7e9f3070e67c.png" data-type="png" data-w="422" style="outline: 0px;color: rgb(34, 34, 34);font-family: system-ui, -apple-system, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;visibility: visible !important;width: 117px !important;" referrerpolicy="no-referrer"></span></section><section style="margin-bottom: 0px;outline: 0px;font-family: system-ui, -apple-system, &quot;system-ui&quot;, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);color: rgb(34, 34, 34);text-align: center;visibility: visible;line-height: normal;"><span style="outline: 0px;font-family: -apple-system, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 18px;letter-spacing: 1px;visibility: visible;color: rgb(0, 17, 255);">常見的工程結構（理論部分）</span></section><section style="margin-bottom: 0px;outline: 0px;font-family: system-ui, -apple-system, &quot;system-ui&quot;, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);color: rgb(34, 34, 34);text-align: center;visibility: visible;line-height: normal;"><br></section><section style="margin-bottom: 0px;outline: 0px;font-family: system-ui, -apple-system, &quot;system-ui&quot;, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);color: rgb(34, 34, 34);text-align: justify;visibility: visible;line-height: normal;"><br></section><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="letter-spacing: 1px;font-size: 15px;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);">同樣，好的應用架構，不管是六邊形架構、洋葱圈架構、整潔架構等,</span><strong><span style="letter-spacing: 1px;font-size: 15px;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);">都提倡以業務為核心，解耦外部依賴，分離業務複雜度和技術複雜度</span></strong><span style="letter-spacing: 1px;font-size: 15px;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);">。</span></section><blockquote style="box-sizing: inherit;margin-top: 0px;margin-bottom: 0px;margin-left: 2px;padding-top: 0px;padding-left: 11px;opacity: 0.5;border-left-width: 4px;border-left-color: rgb(217, 219, 221);color: rgb(64, 64, 64);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;font-size: 14.6667px;letter-spacing: normal;text-align: start;white-space: pre-wrap;background-color: rgb(255, 255, 255);"><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;">簡單理解下業務複雜度和技術複雜度的概念：</span></section></blockquote><blockquote style="box-sizing: inherit;margin-top: 0px;margin-bottom: 0px;margin-left: 2px;padding-top: 0px;padding-left: 11px;opacity: 0.5;border-left-width: 4px;border-left-color: rgb(217, 219, 221);color: rgb(64, 64, 64);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;font-size: 14.6667px;letter-spacing: normal;text-align: start;white-space: pre-wrap;background-color: rgb(255, 255, 255);"><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;">對於一個最簡單的錢包扣錢的 user case 來説</span></section></blockquote><blockquote style="box-sizing: inherit;margin-top: 0px;margin-bottom: 0px;margin-left: 2px;padding-top: 0px;padding-left: 11px;opacity: 0.5;border-left-width: 4px;border-left-color: rgb(217, 219, 221);color: rgb(64, 64, 64);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;font-size: 14.6667px;letter-spacing: normal;text-align: start;white-space: pre-wrap;background-color: rgb(255, 255, 255);"><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;">業務複雜度：錢包扣錢時的規則（eg：不能扣成負值）就是業務複雜度</span></section></blockquote><blockquote style="box-sizing: inherit;margin-top: 0px;margin-bottom: 0px;margin-left: 2px;padding-top: 0px;padding-left: 11px;opacity: 0.5;border-left-width: 4px;border-left-color: rgb(217, 219, 221);color: rgb(64, 64, 64);font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;font-size: 14.6667px;letter-spacing: normal;text-align: start;white-space: pre-wrap;background-color: rgb(255, 255, 255);"><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;">技術複雜度：錢包最終是如何存儲的，是用 mysql 還是 lindorm</span></section></blockquote><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><strong><span style="letter-spacing: 1px;font-size: 15px;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);">應用架構的本質 (核心)</span></strong><span style="letter-spacing: 1px;font-size: 15px;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);">，就是要從繁雜的業務系統中提煉出共性，找到解決業務問題的最佳共同模式，為開發人員提供統一的認知，治理混亂。幫助應用系統「從混亂到有序」，</span><strong><span style="letter-spacing: 1px;font-size: 15px;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);">物流技術部的工程腳手架</span></strong><span style="letter-spacing: 1px;font-size: 15px;box-sizing: inherit;font-weight: bold;color: rgba(25, 26, 31, 0.9);">就是為此而生，其核心職責就是定義良好的應用結構，提供最佳實踐。</span></p><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="letter-spacing: 1px;font-size: 15px;box-sizing: inherit;font-weight: bold;color: rgba(25, 26, 31, 0.9);"><br></span></p><span id="OSC_h4_5"></span><h4 data-lake-id="ca6fa186228ff7efaa653334195896c8" data-wording="true" style="margin-top: 0.5em;margin-bottom: 8px;outline: 0px;letter-spacing: 0.544px;text-wrap: wrap;color: rgb(34, 34, 34);background-color: rgb(255, 255, 255);font-family: -apple-system-font, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;visibility: visible;line-height: 1.75em;"><span style="outline: 0px;visibility: visible;letter-spacing: 1px;color: rgb(0, 17, 255);"><strong style="outline: 0px;visibility: visible;"><span style="outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">▐</span></strong><strong style="outline: 0px;visibility: visible;"><span style="outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">&nbsp;&nbsp;</span></strong><strong style="outline: 0px;visibility: visible;"><span style="color: rgb(0, 17, 255);outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">分層模式</span></strong></span></h4><h4 data-lake-id="ca6fa186228ff7efaa653334195896c8" data-wording="true" style="margin-top: 0.5em;margin-bottom: 8px;outline: 0px;letter-spacing: 0.544px;text-wrap: wrap;color: rgb(34, 34, 34);background-color: rgb(255, 255, 255);font-family: -apple-system-font, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;visibility: visible;line-height: 1.75em;"></h4><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><br></p><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="letter-spacing: 1px;font-size: 15px;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);">分層是一種常見的根據系統中的角色（職責拆分）和組織代碼單元的常規實踐。常見的分層結構如下圖所示：</span></p><p style="margin-top: 8px;line-height: 1.75em;text-align: center;margin-bottom: 8px;"><span style="letter-spacing: 1px;font-size: 15px;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);"><img class="rich_pages wxw-img" data-imgfileid="503041970" data-ratio="1.2418952618453865" src="https://oscimg.oschina.net/oscnet/fdc1f6dc-a414-495a-b875-65bdab468d4e.jpg" data-type="other" data-w="401" referrerpolicy="no-referrer"></span></p><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;"><br></span></p><span id="OSC_h4_6"></span><h4 data-lake-id="ca6fa186228ff7efaa653334195896c8" data-wording="true" style="margin-top: 0.5em;margin-bottom: 8px;outline: 0px;letter-spacing: 0.544px;text-wrap: wrap;color: rgb(34, 34, 34);background-color: rgb(255, 255, 255);font-family: -apple-system-font, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;visibility: visible;line-height: 1.75em;"><span style="outline: 0px;visibility: visible;letter-spacing: 1px;color: rgb(0, 17, 255);"><strong style="outline: 0px;visibility: visible;"><span style="outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">▐</span></strong><strong style="outline: 0px;visibility: visible;"><span style="outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">&nbsp;&nbsp;</span></strong><strong style="outline: 0px;visibility: visible;"><span style="color: rgb(0, 17, 255);outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">CQRS 模式 (命令和查詢責任分離)</span></strong></span></h4><h3 data-cangjie-key="172" data-cangjie-leaf-block="true" data-type="heading-3" style="box-sizing: inherit;margin-top: 16px;margin-bottom: 5px;font-weight: 700;color: rgb(34, 35, 40);font-size: 14pt;line-height: 1.7;font-family: &quot;zh quote&quot;, &quot;Helvetica Neue&quot;, -apple-system, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, STHeiti, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;;letter-spacing: normal;white-space: pre-wrap;background-color: rgb(255, 255, 255);text-align: left;"></h3><h4 data-lake-id="ca6fa186228ff7efaa653334195896c8" data-wording="true" style="margin-top: 0.5em;margin-bottom: 8px;outline: 0px;letter-spacing: 0.544px;text-wrap: wrap;color: rgb(34, 34, 34);background-color: rgb(255, 255, 255);font-family: -apple-system-font, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;visibility: visible;line-height: 1.75em;"></h4><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><br></p><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="letter-spacing: 1px;font-size: 15px;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);">CQRS(Command Query Rsponsibility Segregation，命令查詢分離)</span></p><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="letter-spacing: 1px;font-size: 15px;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);"><br></span></p><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="letter-spacing: 1px;font-size: 15px;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);">其基本思想在於，任何一個對象的方法可以分為兩大類：* 命令 (Command):不返回任何結果 (void)，但會改變對象的狀態。* 查詢 (Query):返回結果，但是不會改變對象的狀態，對系統沒有副作用。</span></p><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="letter-spacing: 1px;font-size: 15px;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);"><br></span></p><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;text-align: center;"><span style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;"><img class="rich_pages wxw-img" data-imgfileid="503041971" data-ratio="0.8719806763285024" src="https://oscimg.oschina.net/oscnet/05ec1d42-e967-428a-88fd-74f9ad2e6c3c.jpg" data-type="other" data-w="828" referrerpolicy="no-referrer"><br></span></p><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;text-align: justify;"><span style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;"><br></span></p><span id="OSC_h4_7"></span><h4 data-lake-id="ca6fa186228ff7efaa653334195896c8" data-wording="true" style="margin-top: 0.5em;margin-bottom: 8px;outline: 0px;letter-spacing: 0.544px;text-wrap: wrap;color: rgb(34, 34, 34);background-color: rgb(255, 255, 255);font-family: -apple-system-font, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;visibility: visible;line-height: 1.75em;"><span style="outline: 0px;visibility: visible;letter-spacing: 1px;color: rgb(0, 17, 255);"><strong style="outline: 0px;visibility: visible;"><span style="outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">▐</span></strong><strong style="outline: 0px;visibility: visible;"><span style="outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">&nbsp;&nbsp;</span></strong><strong style="outline: 0px;visibility: visible;"><span style="color: rgb(0, 17, 255);outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">六邊形架構</span></strong></span></h4><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><br></p><section style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="letter-spacing: 1px;font-size: 15px;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);">六邊形架構是 Alistair Cockburn 在 2005 年提出，解決了傳統的分層結構所帶來的問題，實際上它也是一種分層架構，只不過不是上下，而是變成了內部和外部（如下圖所示）。</span></section><section style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="letter-spacing: 1px;font-size: 15px;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);"><br></span></section><section style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;text-align: center;"><span style="letter-spacing: 1px;font-size: 15px;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);"><img class="rich_pages wxw-img" data-imgfileid="503041978" data-ratio="0.5859613428280773" src="https://oscimg.oschina.net/oscnet/a929931a-4713-46c2-9a7d-5227f819e50c.jpg" data-type="other" data-w="983" referrerpolicy="no-referrer"></span></section><p style="outline: 0px;font-family: system-ui, -apple-system, &quot;system-ui&quot;, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;visibility: visible;color: rgb(34, 34, 34);background-color: rgb(255, 255, 255);text-align: justify;margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><br></p><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;">六邊形架構又稱為端口-適配器架構，這個名字更容器理解。六邊形架構將系統分為內部（內部六邊形）和外部，內部代表了應用的業務邏輯，外部代表應用的驅動邏輯、基礎設施或其他應用。</span></p><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;"><br></span></p><section style="margin-bottom: 8px;line-height: 1.75em;margin-top: 8px;"><span style="font-size: 15px;letter-spacing: 1px;"><span data-cangjie-key="203:0" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="203:0" style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);">適配器分為兩種類型（如下圖所示），左側代表 UI 的適配器被稱為</span><span data-cangjie-key="203:32" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="203:32" style="box-sizing: inherit;font-weight: bold;color: rgba(25, 26, 31, 0.9);">主動適配器（Driving Adapters）</span><span data-cangjie-key="203:55" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="203:55" style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);">，因為是它們發起了對應用的一些操作。而右側表示和後端工具鏈接的適配器，被稱為</span><span data-cangjie-key="203:93" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="203:93" style="box-sizing: inherit;font-weight: bold;color: rgba(25, 26, 31, 0.9);">被動適配器（Driven Adapters）</span><span data-cangjie-key="203:115" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="203:115" style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);">，因為它們只會對主適配器的操作作出響應。</span></span></section><section style="margin-bottom: 8px;line-height: 1.75em;margin-top: 8px;"><span style="letter-spacing: 1px;font-size: 15px;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);"><br></span></section><section style="margin-bottom: 8px;line-height: 1.75em;text-align: center;margin-top: 8px;"><span style="letter-spacing: 1px;font-size: 15px;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);"><img class="rich_pages wxw-img" data-imgfileid="503041979" data-ratio="0.6032863849765259" src="https://oscimg.oschina.net/oscnet/65ea2855-2026-4c61-a8fe-7ed93622262d.jpg" data-type="other" data-w="852" referrerpolicy="no-referrer"></span></section><section style="outline: 0px;font-family: system-ui, -apple-system, &quot;system-ui&quot;, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;visibility: visible;color: rgb(34, 34, 34);background-color: rgb(255, 255, 255);text-align: justify;margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><br></section><span id="OSC_h4_8"></span><h4 data-lake-id="ca6fa186228ff7efaa653334195896c8" data-wording="true" style="margin-top: 0.5em;margin-bottom: 8px;outline: 0px;letter-spacing: 0.544px;text-wrap: wrap;color: rgb(34, 34, 34);background-color: rgb(255, 255, 255);font-family: -apple-system-font, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;visibility: visible;line-height: 1.75em;"><span style="outline: 0px;visibility: visible;letter-spacing: 1px;color: rgb(0, 17, 255);"><strong style="outline: 0px;visibility: visible;"><span style="outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">▐</span></strong><strong style="outline: 0px;visibility: visible;"><span style="outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">&nbsp;&nbsp;</span></strong><strong style="outline: 0px;visibility: visible;"><span style="color: rgb(0, 17, 255);outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">洋葱圈架構</span></strong></span></h4><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><br></p><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;">洋葱架構與六邊形架構有着相同的思路，它們都通過編寫適配器代碼將應用核心從對基礎設施的關注中解放出來，避免基礎設施代碼滲透到應用核心之中。這樣應用使用的工具和傳達機制都可以輕鬆地替換，可以一定程度地避免技術、工具或者供應商鎖定。</span></p><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;"><br></span></p><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;">不同的是洋葱架構還告訴我們，企業應用中存在着不止兩個層次，它在業務邏輯中加入了一些在領域驅動設計的過程中被識別出來的層次（Application，Domain Service，Domain model，Infrastructure 等）</span></p><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;"><br></span></p><section style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;">另外，它還有着脱離真實基礎設施和傳達機制應用仍然可以運行的便利，這樣可以使用 mock 代替它們方便測試。</span></section><section style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;"><br></span></section><section style="margin-top: 8px;line-height: 1.75em;text-align: center;margin-bottom: 8px;"><span style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;"><img class="rich_pages wxw-img" data-imgfileid="503041980" data-ratio="0.7367021276595744" src="https://oscimg.oschina.net/oscnet/49021b5e-1817-4714-a414-96acb32c49ff.jpg" data-type="other" data-w="752" referrerpolicy="no-referrer"></span></section><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><br></p><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;">在洋葱架構中，明確規定了依賴的方向：</span></p><ol class="list-paddingleft-1" style="list-style-type: decimal;"><li><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;">外層依賴內層；</span></p></li><li><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;">內層對外層無感知。</span></p></li></ol><p style="margin-bottom: 0px;outline: 0px;font-family: system-ui, -apple-system, &quot;system-ui&quot;, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;visibility: visible;color: rgb(34, 34, 34);background-color: rgb(255, 255, 255);text-align: justify;margin-top: 8px;line-height: 1.75em;"><br></p><section style="margin-bottom: 0px;text-wrap: wrap;outline: 0px;font-family: system-ui, -apple-system, &quot;system-ui&quot;, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;visibility: visible;color: rgb(34, 34, 34);background-color: rgb(255, 255, 255);text-align: center;line-height: normal;"><img class="rich_pages wxw-img" data-imgfileid="503042077" data-ratio="0.3056872037914692" data-s="300,640" src="https://oscimg.oschina.net/oscnet/f3e8a852-7090-467f-aa4f-7254eb06b14a.png" data-type="png" data-w="422" style="outline: 0px;letter-spacing: 0.544px;font-size: 14px;visibility: visible !important;width: 117px !important;" referrerpolicy="no-referrer"></section><section style="margin-bottom: 0px;outline: 0px;font-family: system-ui, -apple-system, &quot;system-ui&quot;, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);color: rgb(100, 99, 99);font-size: 15px;text-align: center;line-height: normal;"><span style="outline: 0px;font-family: -apple-system, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 1px;font-size: 18px;color: rgb(0, 17, 255);">應用架構的核心</span></section><section style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><br></section><section style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;">縱觀上面介紹的所有應用架構，我們可以發現一個共同點，就是「<strong>核心業務邏輯和技術細節分離</strong>」。</span></section><section style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;"><br></span></section><section style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;text-align: center;"><span style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;"><img class="rich_pages wxw-img" data-croporisrc="https://oscimg.oschina.net/oscnet/459aa1ff-6a4e-4471-aa31-07f2f6966414.jpg" data-cropx1="73.77162629757785" data-cropx2="1016.6089965397924" data-cropy1="39.58477508650519" data-cropy2="662.1453287197232" data-imgfileid="503042080" data-ratio="0.6606574761399788" src="https://oscimg.oschina.net/oscnet/3ebfee95-a24f-47bd-b474-dc96ad4f3a87.jpg" data-type="jpeg" data-w="943" style="width: 524px;height: 346px;" referrerpolicy="no-referrer"></span></section><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><br></p><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="letter-spacing: 1px;font-size: 15px;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);">是的，</span><strong><span style="letter-spacing: 1px;font-size: 15px;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);">六邊形架構、洋葱圈架構的核心職責就是要做核心業務邏輯和技術細節的分離和解耦</span></strong><span style="letter-spacing: 1px;font-size: 15px;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);">。</span></p><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="letter-spacing: 1px;font-size: 15px;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);"><br></span></p><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;">試想一下，業務邏輯和技術細節糅雜在一起的情況，所有的代碼都寫在 ServiceImpl 裏面，前幾行代碼是做 validation 的事，接下來幾行是做 convert 的事，然後是幾行業務處理邏輯的代碼，穿插着，我們需要通過 RPC 或者 DAO 獲取更多的數據，拿到數據後，又是幾行 convert 的代碼，在接上一段業務邏輯代碼，然後還要落庫，發消息.....等等。</span></p><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;"><br></span></p><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;">再簡單的業務，按照上面這種寫代碼的方式，都會變得複雜，難維護。</span></p><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;"><br></span></p><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="letter-spacing: 1px;font-size: 15px;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);">因此，我認為應用架構的核心使命就是要</span><strong><span style="letter-spacing: 1px;font-size: 15px;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);">分離業務邏輯和技術細節</span></strong><span style="letter-spacing: 1px;font-size: 15px;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);">。</span><strong><span style="letter-spacing: 1px;font-size: 15px;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);">讓核心業務邏輯可以反映領域模型和領域應用</span></strong><span style="letter-spacing: 1px;font-size: 15px;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);">，可以複用，可以很容易被看懂。</span><strong><span style="letter-spacing: 1px;font-size: 15px;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);">讓技術細節在輔助實現業務功能的同時，可以被替換</span></strong><span style="letter-spacing: 1px;font-size: 15px;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);">。</span></p><section style="margin-top: 8px;margin-bottom: 8px;letter-spacing: 0.578px;text-wrap: wrap;line-height: 1.75em;"><br></section><section style="margin-bottom: 0px;text-wrap: wrap;outline: 0px;font-family: system-ui, -apple-system, &quot;system-ui&quot;, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;color: rgb(34, 34, 34);background-color: rgb(255, 255, 255);text-align: center;line-height: normal;"><img class="rich_pages wxw-img" data-imgfileid="503042084" data-ratio="0.328125" data-s="300,640" data-type="png" data-w="256" src="https://oscimg.oschina.net/oscnet/d423be6a-24b5-4179-bfb2-a4fc1aa1748b.png" style="outline: 0px;letter-spacing: 0.544px;font-size: 16px;visibility: visible !important;width: 122px !important;" referrerpolicy="no-referrer"></section><section style="margin-bottom: 0px;text-wrap: wrap;outline: 0px;font-family: system-ui, -apple-system, &quot;system-ui&quot;, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);color: rgb(100, 99, 99);font-size: 15px;text-align: center;line-height: normal;"><span style="outline: 0px;color: rgb(0, 17, 255);font-family: -apple-system, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 18px;letter-spacing: 1px;text-align: center;text-wrap: wrap;background-color: rgb(255, 255, 255);">如何正確的進行工程劃分？</span></section><section style="margin-bottom: 0px;text-wrap: wrap;outline: 0px;font-family: system-ui, -apple-system, &quot;system-ui&quot;, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;visibility: visible;color: rgb(34, 34, 34);background-color: rgb(255, 255, 255);line-height: 1.75em;margin-top: 8px;"><br></section><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;">這些應用架構思想雖然很好，但我們很多同學還是「<strong>不講 Co 德，明白了很多道理，可還是過不好這一生</strong>」。</span></p><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;"><br></span></p><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;">所以我們接下來聊聊這個偏工程實踐的話題。</span></p><section style="margin-bottom: 0px;text-wrap: wrap;outline: 0px;font-family: system-ui, -apple-system, &quot;system-ui&quot;, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;visibility: visible;color: rgb(34, 34, 34);background-color: rgb(255, 255, 255);line-height: 1.75em;margin-top: 8px;"><br></section><span id="OSC_h4_9"></span><h4 data-lake-id="ca6fa186228ff7efaa653334195896c8" data-wording="true" style="margin-top: 0.5em;margin-bottom: 8px;outline: 0px;letter-spacing: 0.544px;text-wrap: wrap;color: rgb(34, 34, 34);background-color: rgb(255, 255, 255);font-family: -apple-system-font, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;visibility: visible;line-height: 1.75em;"><span style="outline: 0px;visibility: visible;letter-spacing: 1px;color: rgb(0, 17, 255);"><strong style="outline: 0px;visibility: visible;"><span style="outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">▐</span></strong><strong style="outline: 0px;visibility: visible;"><span style="outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">&nbsp;&nbsp;</span></strong><strong style="outline: 0px;visibility: visible;"><span style="color: rgb(0, 17, 255);outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">業務工程中最基本的 Module 劃分</span></strong></span></h4><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;"><br></span></p><section style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">上文提到了 Moudle 和包之間的關係，我們有個基本共識，Module 比 Package（包）要大一些。那我們基本的分層結構又應該是怎麼樣的呢，這裏列兩種業務工程中最常見的 Module 之間的依賴關係：</span><br></section><section style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><br></section><ul class="list-paddingleft-1" style="list-style-type: disc;"><li style="color: rgb(0, 17, 255);"><span id="OSC_h4_10"></span><h4 data-cangjie-key="273" data-cangjie-leaf-block="true" data-type="heading-4" style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;color: rgb(0, 17, 255);">非依賴倒置下的 Module 分層</span></h4></li></ul><section style="text-align: center;margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;"><img class="rich_pages wxw-img" data-imgfileid="503041991" data-ratio="1.1523046092184368" src="https://oscimg.oschina.net/oscnet/749413df-dbfc-4d07-b658-1fc03b2dafdd.jpg" data-type="other" data-w="499" referrerpolicy="no-referrer"></span></section><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;"><br></span></section><ul class="list-paddingleft-1" style="list-style-type: disc;"><li style="color: rgb(0, 17, 255);"><span id="OSC_h4_11"></span><h4 data-cangjie-key="286" data-cangjie-leaf-block="true" data-type="heading-4" style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;color: rgb(0, 17, 255);">依賴倒置（DIP）下的 Module 分層（推薦）</span></h4></li></ul><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;text-align: center;"><span style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;"><img class="rich_pages wxw-img" data-imgfileid="503042001" data-ratio="1.2995594713656389" src="https://oscimg.oschina.net/oscnet/d3163f4a-3913-4082-bc7d-6b28aad6c6e6.jpg" data-type="other" data-w="454" referrerpolicy="no-referrer"></span></section><section style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><br></section><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">依賴倒置（DIP）:</span></p><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">簡單説依賴倒置就是你不要直接依賴我，你和我都同時依賴一個接口（所以有時候也叫面向接口的編程），這樣我們之間就解耦了，依賴和被依賴方都可以自由改動了。</span></p><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;"><br></span></p><ul class="list-paddingleft-1" style="list-style-type: disc;"><li style="color: rgb(0, 17, 255);"><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;font-size: 15px;letter-spacing: 1px;color: rgb(0, 17, 255);">依賴倒置下的 Module 分層的好處</span></p></li></ul><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span data-cangjie-key="310:0" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="310:0" style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;box-sizing: inherit;font-weight: bold;color: rgba(25, 26, 31, 0.9);"><br></span></p><ol class="list-paddingleft-1" style="list-style-type: decimal;"><li><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span data-cangjie-key="310:0" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="310:0" style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;box-sizing: inherit;font-weight: bold;color: rgba(25, 26, 31, 0.9);">Domain 層會變得更加純粹，完全擺脱了對技術細節</span><span data-cangjie-key="310:25" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="310:25" style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);">（以及技術細節帶來的複雜度）的依賴，只需要安心處理業務邏輯就好（我們經常説的<strong>核心業務邏輯</strong>穩定其實就是 Domain 層的穩定，上文中的 Domain 層完全依賴於接口和內部的模型，屏蔽了技術細節，如果我們更換技術組件，也只需要更換技術細節的實現即可）</span></p></li><li><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span data-cangjie-key="316:0" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="316:0" style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 1px;box-sizing: inherit;font-weight: bold;color: rgba(25, 26, 31, 0.9);">並行開發</span><span data-cangjie-key="316:4" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="316:4" style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 1px;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);">：只要在 Domain 和 Infrastructure 約定好接口，可以有兩個同學並行編寫 Domain 和 Infrastructure 的代碼</span><br></p></li><li><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span data-cangjie-key="319:0" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="319:0" style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 1px;box-sizing: inherit;font-weight: bold;color: rgba(25, 26, 31, 0.9);">可測試性</span><span data-cangjie-key="319:4" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="319:4" style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 1px;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);">：沒有任何依賴的 Domain 裏面都是 POJO 的類，單元測試將會變得非常方便，也非常適合 TDD 的開發。</span><br></p></li></ol><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><br></p><span id="OSC_h5_12"></span><h5 data-cangjie-key="320" data-cangjie-leaf-block="true" data-type="heading-5" style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">分層職責</span></h5><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;display: inline-block;margin-right: 11.7656px;line-height: 1.4;font-size: 15px;letter-spacing: 1px;font-family: Arial !important;">1.</span><span data-cangjie-key="325:0" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="325:0" style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);">適配層（Adapter Layer）：負責對前端展示（web，wireless，wap）的路由和適配，對於傳統 B/S 系統而言，<strong>adapter 就相當於 MVC 中的 controller</strong>；</span></p><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;display: inline-block;margin-right: 8px;line-height: 1.4;transform: translateY(-4.5%);font-size: 15px;letter-spacing: 1px;font-family: Arial !important;">○</span><span data-cangjie-key="325:0" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="325:0" style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);"><strong>用户展現信息以及解釋用户命令</strong></span></p><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;display: inline-block;margin-right: 8px;line-height: 1.4;transform: translateY(-4.5%);font-size: 15px;letter-spacing: 1px;font-family: Arial !important;">○</span><span data-cangjie-key="325:0" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="325:0" style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);"><strong>大部分工程為 start 模塊</strong></span></p><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;display: inline-block;margin-right: 11.7656px;line-height: 1.4;font-size: 15px;letter-spacing: 1px;font-family: Arial !important;">2.</span><span style="color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">應用層/應用服務層（Application Layer）：主要負責獲取輸入，組裝上下文，參數校驗，調用領域層做業務處理，如果需要的話，發送消息通知等。層次是開放的</span></p><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;display: inline-block;margin-right: 8px;line-height: 1.4;transform: translateY(-4.5%);font-size: 15px;letter-spacing: 1px;font-family: Arial !important;">○</span><span data-cangjie-key="325:0" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="325:0" style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);"><strong>應用層也可以繞過領域層，直接訪問基礎實施層 (CQRS 模式中對於查詢的説法就是可以繞過 DomainModel 之間查詢數據)</strong>；</span></p><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;display: inline-block;margin-right: 8px;line-height: 1.4;transform: translateY(-4.5%);font-size: 15px;letter-spacing: 1px;font-family: Arial !important;">○</span><span style="color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">很薄的一層，用來協調應用的活動。它不包含業務邏輯</span></p><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;display: inline-block;margin-right: 8px;line-height: 1.4;transform: translateY(-4.5%);font-size: 15px;letter-spacing: 1px;font-family: Arial !important;">○</span><span data-cangjie-key="325:0" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="325:0" style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);"><strong>同樣的一個 Service 應可被不同的 Adapter（Web、遠程調用、異步消息）複用）</strong>。</span></p><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;display: inline-block;margin-right: 8px;line-height: 1.4;transform: translateY(-4.5%);font-size: 15px;letter-spacing: 1px;font-family: Arial !important;">○</span><span data-cangjie-key="325:0" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="325:0" style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);"><strong>適合處理事務、高層次日誌 (oplog)、安全（權限）</strong></span></p><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;display: inline-block;margin-right: 11.7656px;line-height: 1.4;font-size: 15px;letter-spacing: 1px;font-family: Arial !important;">3.</span><span style="color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">領域層（Domain Layer）：主要是封裝了核心業務邏輯，並通過領域服務（Domain Service）和領域對象（Domain Entity）的方法對 App 層提供業務實體和業務邏輯計算。</span></p><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;display: inline-block;margin-right: 8px;line-height: 1.4;transform: translateY(-4.5%);font-size: 15px;letter-spacing: 1px;font-family: Arial !important;">○</span><span data-cangjie-key="325:0" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="325:0" style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);"><strong>領域是應用的核心，不依賴任何其他層次</strong></span></p><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;display: inline-block;margin-right: 8px;line-height: 1.4;transform: translateY(-4.5%);font-size: 15px;letter-spacing: 1px;font-family: Arial !important;">○</span><span style="color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">通常每一個聚合（aggregate）一個 package。聚合包含實體（entity），值對象（value object），領域事件（domain event），資源庫（repository，僅接口）接口和一些工廠（Factory）。</span></p><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;display: inline-block;margin-right: 11.7656px;line-height: 1.4;font-size: 15px;letter-spacing: 1px;font-family: Arial !important;">4.</span><span style="color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">基礎實施層（Infrastructure Layer）：主要負責技術細節問題的處理，比如數據庫的 CRUD、搜索引擎、文件系統、分佈式服務的 RPC 等。此外，領域防腐的重任也落在這裏，外部依賴需要通過防腐層（Anti-Corruption） 實現的轉義處理，才能被上面的 App 層和 Domain 層使用。</span></p><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;"><br></span></p><span id="OSC_h4_13"></span><h4 data-lake-id="ca6fa186228ff7efaa653334195896c8" data-wording="true" style="margin-top: 0.5em;margin-bottom: 8px;outline: 0px;letter-spacing: 0.544px;text-wrap: wrap;color: rgb(34, 34, 34);background-color: rgb(255, 255, 255);font-family: -apple-system-font, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;visibility: visible;line-height: 1.75em;"><span style="outline: 0px;visibility: visible;letter-spacing: 1px;color: rgb(0, 17, 255);"><strong style="outline: 0px;visibility: visible;"><span style="outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">▐</span></strong><strong style="outline: 0px;visibility: visible;"><span style="outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">&nbsp;&nbsp;</span></strong><strong style="outline: 0px;visibility: visible;"><span style="color: rgb(0, 17, 255);outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">如果我要提供一個 SDK 對外提供服務怎麼辦？</span></strong></span></h4><section style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><br></section><section style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;text-align: center;"><span style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;"><img class="rich_pages wxw-img" data-imgfileid="503042002" data-ratio="0.9544764795144158" src="https://oscimg.oschina.net/oscnet/78d059c9-4ae5-4089-aca0-5f8422ee37f4.jpg" data-type="other" data-w="659" referrerpolicy="no-referrer"></span></section><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">Module 的定義應該遵循自身業務需求<strong>（如無必要勿增實體）</strong></span></p><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">上文中如果需要一個 api 包則增加一個 API Module 包即可</span></p><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><strong><span style="color: rgba(25, 26, 31, 0.9);font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 1px;caret-color: transparent;">這裏的 client 包不要依賴 Domain,這會引入大量無關依賴，對包的使用者造成困擾</span></strong></p><section style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;"><br></span></section><span id="OSC_h4_14"></span><h4 data-lake-id="ca6fa186228ff7efaa653334195896c8" data-wording="true" style="margin-top: 0.5em;outline: 0px;letter-spacing: 0.544px;text-wrap: wrap;color: rgb(34, 34, 34);background-color: rgb(255, 255, 255);font-family: -apple-system-font, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;visibility: visible;line-height: 1.75em;margin-bottom: 8px;"><span style="outline: 0px;visibility: visible;letter-spacing: 1px;color: rgb(0, 17, 255);"><strong style="outline: 0px;visibility: visible;"><span style="outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">▐</span></strong><strong style="outline: 0px;visibility: visible;"><span style="outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">&nbsp;&nbsp;</span></strong><strong style="outline: 0px;visibility: visible;"><span style="color: rgb(0, 17, 255);outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">包結構的劃分</span></strong></span></h4><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><br></p><section style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;">分層是屬於大粒度的職責劃分，太粗，我們有必要往下再 down 一層，細化到包結構的粒度，才能更好的指導我們的工作。</span></section><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;"><br></span></p><section style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="font-size: 15px;letter-spacing: 1px;"><span data-cangjie-key="386:0" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="386:0" style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);">還是拿一堆玩具舉例子，分層類似於拿來了一個架子，分包類似於在每一層架子上又放置了多個收納盒。</span><span data-cangjie-key="386:46" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="386:46" style="box-sizing: inherit;font-weight: bold;color: rgba(25, 26, 31, 0.9);">所謂的內聚，就是把功能類似的玩具放在一個盒子裏，這樣可以讓應用結構清晰，極大的降低系統的認知成本和維護成本</span><span data-cangjie-key="386:99" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="386:99" style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);">。</span></span></section><section style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;"><br></span></section><section style="margin-top: 8px;line-height: 1.75em;text-align: center;margin-bottom: 8px;"><span style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;"><img class="rich_pages wxw-img" data-imgfileid="503042003" data-ratio="0.2898148148148148" src="https://oscimg.oschina.net/oscnet/d538f5d3-154d-43a4-a169-3328b83b9ff5.jpg" data-type="other" data-w="1080" referrerpolicy="no-referrer"></span></section><section style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><br></section><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="letter-spacing: 1px;font-size: 15px;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);">那麼，對於一個後端應用來説，應該需要哪些收納盒。</span></p><p style="margin-top: 8px;line-height: 1.75em;text-align: center;margin-bottom: 8px;"><span style="letter-spacing: 1px;font-size: 15px;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);"><img class="rich_pages wxw-img" data-croporisrc="https://oscimg.oschina.net/oscnet/86cfb0f7-2701-4827-ad31-6c79eaf3d889.jpg" data-cropx1="29.420415224913498" data-cropx2="870.2249134948097" data-cropy1="80.51903114186851" data-cropy2="551.2456747404843" data-imgfileid="503042081" data-ratio="0.5600475624256838" src="https://oscimg.oschina.net/oscnet/50319171-c58a-43c5-bd57-181b256d2a91.jpg" data-type="jpeg" data-w="841" style="width: 543px;height: 304px;" referrerpolicy="no-referrer"></span></p><section style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><br></section><section style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="letter-spacing: 1px;font-size: 15px;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);">各個包結構的簡要功能描述，如下表所示：</span></section><section style="text-align: center;margin-bottom: 8px;margin-top: 8px;line-height: 1.75em;"><img class="rich_pages wxw-img" data-galleryid="" data-imgfileid="503042083" data-ratio="1.103305785123967" data-s="300,640" src="https://oscimg.oschina.net/oscnet/76aa5bfd-ee6e-4774-8761-982379ec70f0.png" data-type="png" data-w="726" style="" referrerpolicy="no-referrer"></section><section style="margin-bottom: 8px;margin-top: 8px;line-height: 1.75em;"><br></section><ul class="list-paddingleft-1" style="list-style-type: disc;"><li style="color: rgb(0, 17, 255);"><span id="OSC_h4_15"></span><h4 data-cangjie-key="874" data-cangjie-leaf-block="true" data-type="heading-4" style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="letter-spacing: 1px;font-size: 15px;box-sizing: inherit;color: rgb(0, 17, 255);">你可能會有疑問，為什麼 Domain 的 model 是可選的？</span><span style="letter-spacing: 1px;font-size: 15px;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);"></span></h4></li></ul><section style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><br></section><section style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="letter-spacing: 1px;font-size: 15px;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);">因為是應用架構，不是 DDD 架構。對於應用架構來説：<strong>無有必要勿增實體</strong>。領域模型對設計能力要求很高，沒把握用好，一個錯誤的抽象還不如不抽象，寧可不要用，也不要濫用，<strong>不要為了 DDD 而 DDD</strong>。</span></section><section style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="letter-spacing: 1px;font-size: 15px;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);"><br></span></section><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="letter-spacing: 1px;font-size: 15px;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);">問題的關鍵是要看，新增的模型沒有給你帶來收益。比如<strong>有沒有幫助系統解耦，有沒有提升業務語義表達能力的提升，有沒有提升系統的可維護性和可測性等等</strong>。</span></p><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><br></p><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="letter-spacing: 1px;font-size: 15px;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);">模型雖然可選，但 DDD 的思想是一定要去學習和貫徹的，特別是統一語言、邊界上下文、<strong>防腐層的思想</strong>，值得深入學習，仔細體會。實際上，應用架構裏面的很多設計思想都來自於 DDD。其中就包括領域包的設計。</span></p><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="letter-spacing: 1px;font-size: 15px;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);"><br></span></p><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="letter-spacing: 1px;font-size: 15px;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);">前面的包定義，都是功能維度的定義。為了兼顧領域維度的內聚性，我們有必要對包結構進行一下微調，即<strong>頂層包結構應該是按照領域劃分，讓領域內聚</strong>。</span></p><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="letter-spacing: 1px;font-size: 15px;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);"><br></span></p><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="letter-spacing: 1px;font-size: 15px;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);">也就是説，我們要綜合考慮功能和領域兩個維度包結構定義。<strong>按照領域和功能兩個維度分包策略</strong>，最後呈現出來的，是如下圖所示的頂層包節點是領域名稱，領域之下，再按功能劃分包</span></p><p style="margin-bottom: 8px;margin-top: 8px;line-height: 1.75em;"><span style="font-size: 15px;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);letter-spacing: 1px;"><br></span></p><p style="margin-bottom: 8px;margin-top: 8px;line-height: 1.75em;text-align: center;"><span style="font-size: 15px;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);letter-spacing: 1px;"><img class="rich_pages wxw-img" data-croporisrc="https://oscimg.oschina.net/oscnet/32124086-f1bd-4c9c-9c9c-2bbe4c3b78e7.jpg" data-cropx1="0" data-cropx2="1116" data-cropy1="90.74740484429066" data-cropy2="843.7577854671281" data-imgfileid="503042082" data-ratio="0.6759259259259259" src="https://oscimg.oschina.net/oscnet/73ed6593-5145-4565-a5a4-c747195ebd23.jpg" data-type="jpeg" data-w="1080" style="width: 578px;height: 390px;" referrerpolicy="no-referrer"><br></span></p><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><br></p><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="letter-spacing: 1px;font-size: 15px;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);">下圖是一個例子，按照分包策略，我們在每一個 Module 下面首先按照領域做一個頂層劃分，然後在領域內，再按照功能進行分包。</span></p><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="letter-spacing: 1px;font-size: 15px;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);"><br></span></p><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;text-align: center;"><span style="letter-spacing: 1px;font-size: 15px;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);"><img class="rich_pages wxw-img" data-imgfileid="503042009" data-ratio="0.5" src="https://oscimg.oschina.net/oscnet/41867f9b-46b8-49e0-9564-3eb91352c744.jpg" data-type="other" data-w="1080" referrerpolicy="no-referrer"></span></p><p style="margin-bottom: 8px;margin-top: 8px;line-height: 1.75em;"><br></p><p style="margin: 0px;text-wrap: wrap;outline: 0px;background-color: rgb(255, 255, 255);font-size: 11pt;font-family: DengXian;color: rgb(0, 0, 0);letter-spacing: normal;text-align: center;line-height: normal;"><img class="rich_pages wxw-img" data-imgfileid="503042085" data-ratio="0.328125" data-s="300,640" src="https://oscimg.oschina.net/oscnet/57d84e5a-add9-4bf6-8b90-09f999aec8bc.png" data-type="png" data-w="256" style="outline: 0px;color: rgb(34, 34, 34);font-family: system-ui, -apple-system, &quot;system-ui&quot;, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;visibility: visible !important;width: 133px !important;" referrerpolicy="no-referrer"></p><p style="line-height: 1.75em;text-align: center;margin: 0px;"><span style="box-sizing: inherit;color: rgb(0, 17, 255);font-family: -apple-system, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 18px;letter-spacing: 1px;text-align: center;text-wrap: wrap;background-color: rgb(255, 255, 255);">如何解決應用架構中的問題</span></p><section style="margin-top: 8px;line-height: 1.75em;text-align: justify;margin-bottom: 8px;"><br></section><span id="OSC_h4_16"></span><h4 data-lake-id="ca6fa186228ff7efaa653334195896c8" data-wording="true" style="margin-top: 0.5em;margin-bottom: 8px;text-wrap: wrap;outline: 0px;letter-spacing: 0.544px;color: rgb(34, 34, 34);background-color: rgb(255, 255, 255);font-family: -apple-system-font, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;visibility: visible;line-height: 1.75em;"><span style="outline: 0px;visibility: visible;letter-spacing: 1px;color: rgb(0, 17, 255);"><strong style="outline: 0px;visibility: visible;"><span style="outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">▐</span></strong><strong style="outline: 0px;visibility: visible;"><span style="outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">&nbsp;&nbsp;</span></strong><strong style="outline: 0px;visibility: visible;"><span style="color: rgb(0, 17, 255);outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">應用架構中如何處理解耦問題</span></strong></span></h4><h4 data-lake-id="ca6fa186228ff7efaa653334195896c8" data-wording="true" style="margin-top: 0.5em;margin-bottom: 8px;text-wrap: wrap;outline: 0px;letter-spacing: 0.544px;color: rgb(34, 34, 34);background-color: rgb(255, 255, 255);font-family: -apple-system-font, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;visibility: visible;line-height: 1.75em;"></h4><section style="margin-top: 8px;line-height: 1.75em;text-align: justify;margin-bottom: 8px;"><br></section><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="letter-spacing: 1px;font-size: 15px;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);">「<strong>高內聚，低耦合</strong>」這句話，你工作的越久，就越會覺得其有道理。</span></p><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><br></p><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><strong><span style="letter-spacing: 1px;font-size: 15px;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);">所謂耦合就是聯繫的緊密程度，只要有依賴就會有耦合，不管是進程內的依賴，還是跨進程的 RPC 依賴，都會產生耦合。</span></strong><span style="letter-spacing: 1px;font-size: 15px;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);">依賴不可消除，同樣，耦合也不可避免。我們所能做的不是消除耦合，而是把耦合降低到可以接受的程度。在軟件設計中，有大量的設計模式，設計原則都是為瞭解耦這一目的。</span></p><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="letter-spacing: 1px;font-size: 15px;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);"><br></span></p><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="letter-spacing: 1px;font-size: 15px;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);">在 DDD 中有一個很棒的解耦設計思想——防腐層（Anti-Corruption），簡單説，就是應用不要直接依賴外域的信息，要把外域的信息轉換成自己領域上下文（Context）的實體再去使用，從而實現本域和外部依賴的解耦。</span></p><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><br></p><ul class="list-paddingleft-1" style="list-style-type: disc;"><li style="color: rgb(0, 17, 255);"><span id="OSC_h4_17"></span><h4 data-lake-id="ca6fa186228ff7efaa653334195896c8" data-wording="true" style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="letter-spacing: 1px;font-size: 15px;box-sizing: inherit;color: rgb(0, 17, 255);">防腐層設計在應用架構中的應用</span></h4></li></ul><section style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><br></section><section style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="letter-spacing: 1px;font-size: 15px;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);">我們把防腐層（Anti-Corruption）這個概念進行泛化，將數據庫、搜索引擎等數據存儲都列為外部依賴的範疇。利用依賴倒置，統一使用防腐層（Anti-Corruption）/Repository 等接口來實現業務領域和外部依賴的解耦。</span></section><section style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="letter-spacing: 1px;font-size: 15px;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);"><br></span></section><section style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="letter-spacing: 1px;font-size: 15px;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);">其實現方式如下圖所示，主要是在 Domain 層定義防腐層（Anti-Corruption）/Repository 等接口，然後在 Infrastructure 提供防腐層（Anti-Corruption） 接口的實現。</span></section><section style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;text-align: center;"><span style="letter-spacing: 1px;font-size: 15px;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);"><img class="rich_pages wxw-img" data-croporisrc="https://oscimg.oschina.net/oscnet/0062cf11-1b19-435b-a846-fc07d501a2ec.jpg" data-cropx1="32.77162629757785" data-cropx2="1683.2698961937717" data-cropy1="32.77162629757785" data-cropy2="723.955017301038" data-imgfileid="503042087" data-ratio="0.41944444444444445" src="https://oscimg.oschina.net/oscnet/dc7e6e5c-a869-4f07-a24a-8693b7e2b068.jpg" data-type="jpeg" data-w="1080" style="width: 554px;height: 232px;" referrerpolicy="no-referrer"></span></section><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><br></section><ul class="list-paddingleft-1" style="list-style-type: disc;"><li style="color: rgb(0, 17, 255);"><span id="OSC_h4_18"></span><h4 data-lake-id="ca6fa186228ff7efaa653334195896c8" data-wording="true" style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;font-size: 15px;letter-spacing: 1px;color: rgb(0, 17, 255);">高內聚低耦合在包劃分中的體現</span></h4></li></ul><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><br></section><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;">剛剛我們提到了在包劃分的過程中，推薦先按照領域分包，這其實就是一種高內聚低耦合，這樣做的好處有以下幾方面：</span></section><ol class="list-paddingleft-1" style="list-style-type: decimal;"><li><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">明確這個包下面提供的類和功能應該放在一起考慮</span></section></li><li><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">通過包的可見性現在自身領域服務 (功能) 對外的可見性（重點）</span></section></li></ol><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">a.寫 java 的同學經常會給領域模型 DomainModel 上直接加上 Setter 方法，這樣會比較方便構造領域對象，但是這樣的做法其實違反了開閉原則，意味着你的領域對象中的所有屬性對外都是暴露的，可以直接通過 set 的方式而不是通過領域對象提供的方法來進行變更，這對領域對象的穩定性來説很不友好</span></section><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;display: inline-block;margin-right: 11.7656px;line-height: 1.4;font-size: 15px;letter-spacing: 1px;font-family: Arial !important;">b.</span><span style="color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">通過包的可見性來暴露自身想暴露的能力</span></section><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;">這裏推薦一種比較好的做法:</span></section><ol class="list-paddingleft-1" style="list-style-type: decimal;"><li><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">對於 setter 方法以及內部調用的方法設置為</span><strong><span style="color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">包可見（package private）</span></strong><span style="color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;"></span></section></li><li><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">通過構造函數/Factory(複雜的聚合根) 創建領域對象</span></section></li></ol><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;"><br></span></section><span id="OSC_h4_19"></span><h4 data-lake-id="ca6fa186228ff7efaa653334195896c8" data-wording="true" style="margin-top: 0.5em;margin-bottom: 8px;text-wrap: wrap;outline: 0px;letter-spacing: 0.544px;color: rgb(34, 34, 34);background-color: rgb(255, 255, 255);font-family: -apple-system-font, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;visibility: visible;line-height: 1.75em;"><span style="outline: 0px;visibility: visible;letter-spacing: 1px;color: rgb(0, 17, 255);"><strong style="outline: 0px;visibility: visible;"><span style="outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">▐</span></strong><strong style="outline: 0px;visibility: visible;"><span style="outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">&nbsp;&nbsp;</span></strong><strong style="outline: 0px;visibility: visible;"><span style="color: rgb(0, 17, 255);outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">如何對齊文中的概念和實際業務中的 Module?</span></strong></span></h4><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><br></section><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;">由於各個團隊之間自身規範的問題以及建項目的同學自身對應用架構的理解不同，你可能會發現如下幾種情況：</span></p><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;"><br></span></p><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-size: 15px;font-weight: bold;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">業務系統中的 Module 層數和文中描述的不同</span></p><ol class="list-paddingleft-1" style="list-style-type: decimal;"><li><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">業務複雜度決定了包的層級，對於簡單的 web 系統，單 module 其實更能降低架構複雜度</span></p></li><li><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span data-cangjie-key="972:0" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="972:0" style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;box-sizing: inherit;color: rgb(0, 0, 0);">拆分粒度不同，有些工程可能會拆分出類似 Infrastruct-client(</span><strong><span data-cangjie-key="972:0" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="972:0" style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;box-sizing: inherit;color: rgb(0, 0, 0);">對應上文中的防腐層（Anti-Corruption</span></strong><span data-cangjie-key="972:0" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="972:0" style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;box-sizing: inherit;color: rgb(0, 0, 0);">）Interface) 這樣的 Module</span></p></li><li><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;">業務訴求不同：有些業務系統並不需要提供 API，而是通過 DTS/Controller 驅動業務，自然也就不需要 API Module</span></p></li></ol><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;display: inline-block;margin-right: 11.7656px;line-height: 1.4;font-size: 15px;letter-spacing: 1px;font-family: Arial !important;"><br></span></p><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;font-weight: bold;color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;">業務系統中的 Module 命名和文中描述不同</span></p><ol class="list-paddingleft-1" style="list-style-type: decimal;"><li><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">每個人對 module 的命名問題，實際還是要看這個 module 承載的業務職責</span></p></li><li><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span data-cangjie-key="984:0" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="984:0" style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;box-sizing: inherit;color: rgb(0, 0, 0);">模塊的職責不同，比方説</span><span style="box-sizing: inherit;font-weight: bold;color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;">對外提供的富客户端一般以 Client 命名，接口包一般就叫 API</span><span data-cangjie-key="984:42" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="984:42" style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;box-sizing: inherit;color: rgb(0, 0, 0);">了</span></p></li></ol><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><br></p><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-size: 15px;font-weight: bold;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">業務系統中 Module 的依賴關係和文中不同</span></p><ol class="list-paddingleft-1" style="list-style-type: decimal;"><li><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">有沒有可能是分層太多倒置後來的同學也搞不清楚該怎麼依賴了，導致的錯誤依賴</span></p></li><li><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">文中也提供了好幾種依賴，就像地心説和日心説一樣，對於應用結構的認識是有一個過程的</span></p></li></ol><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;display: inline-block;margin-right: 11.7656px;line-height: 1.4;font-size: 15px;letter-spacing: 1px;font-family: Arial !important;"><br></span></p><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;font-weight: bold;color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;">業務系統中的包劃分和文中不同</span></p><ol class="list-paddingleft-1" style="list-style-type: decimal;"><li><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">很多業務系統直接按照功能分包了，比如 repository 放一起 (我認為對於實現來説是 ok 的，對於領域模型來説還是要有領域的概念)</span></p></li></ol><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><br></p><ul class="list-paddingleft-1" style="list-style-type: disc;"><li style="color: rgb(0, 17, 255);"><span id="OSC_h3_20"></span><h3 data-cangjie-key="1000" data-cangjie-leaf-block="true" data-type="heading-3" style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;font-size: 15px;letter-spacing: 1px;color: rgb(0, 17, 255);">那麼如何找到這個工程目前的工程規範呢？</span></h3></li></ul><h3 data-cangjie-key="1000" data-cangjie-leaf-block="true" data-type="heading-3" style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><br></h3><ol class="list-paddingleft-1" style="list-style-type: decimal;"><li><span id="OSC_h3_21"></span><h3 data-cangjie-key="1000" data-cangjie-leaf-block="true" data-type="heading-3" style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;">如果有工程結構的文檔，優先閲讀（省時間）</h3></li><li><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">找一個 Use Case，從入口側去看文中的業務開發中涉及到的業務邏輯寫在了哪個包中</span></p></li></ol><section style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">注：Use Case 是《架構整潔之道》裏面的術語，簡單理解就是響應一個 Request 的處理過程</span></section><section style="margin-bottom: 8px;"><span data-cangjie-key="1014:0" data-cangjie-leaf="true" data-testid="1014:0" style="box-sizing: inherit;"><br></span></section><span id="OSC_h4_22"></span><h4 data-lake-id="ca6fa186228ff7efaa653334195896c8" data-wording="true" style="margin-top: 0.5em;outline: 0px;letter-spacing: 0.544px;text-wrap: wrap;color: rgb(34, 34, 34);background-color: rgb(255, 255, 255);font-family: -apple-system-font, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;visibility: visible;line-height: 1.75em;margin-bottom: 8px;"><span style="outline: 0px;visibility: visible;letter-spacing: 1px;color: rgb(0, 17, 255);"><strong style="outline: 0px;visibility: visible;"><span style="outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">▐</span></strong><strong style="outline: 0px;visibility: visible;"><span style="outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">&nbsp;&nbsp;</span></strong><strong style="outline: 0px;visibility: visible;"><span style="color: rgb(0, 17, 255);outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">如果業務代碼中的應用架構不合理，你有自己的想法怎麼辦？</span></strong></span></h4><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-weight: bold;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 1px;"><br></span></p><ol class="list-paddingleft-1" style="list-style-type: decimal;"><li><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-weight: bold;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 1px;">工程剛開始搭建階段：</span><span style="color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">大家團隊內進行討論，併產出應用架構圖，統一領域語言：module 分佈、包命名規範、類命名規範等，再進行開發</span></p></li><li><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-weight: bold;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 1px;">工程不復雜，且大家都認可新的應用架構：</span><span style="color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">拉分支修改，改造後進行功能的迴歸測試，組內 review 完沒問題將變更合併入主幹分支</span></p></li><li><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-weight: bold;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 1px;">工程比較複雜或者你只是想讓你這部分代碼符合你的規範：</span><span style="color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">並不建議這樣做，對於一個應用工程來説，不同代碼風格往往比合理的工程架構更致命，會導致工程結構混亂，大家理解困難，一個統一的工程規範遠比合理更重要</span></p></li></ol><section style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><br></section><section style="margin-bottom: 0px;outline: 0px;font-family: system-ui, -apple-system, &quot;system-ui&quot;, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;color: rgb(34, 34, 34);background-color: rgb(255, 255, 255);text-align: center;line-height: normal;"><img class="rich_pages wxw-img" data-imgfileid="503042086" data-ratio="0.328125" data-s="300,640" src="https://oscimg.oschina.net/oscnet/cb72549b-6a33-43ff-9174-1575cd6b8307.png" data-type="png" data-w="256" style="outline: 0px;color: rgb(51, 51, 51);font-size: 20px;font-weight: bold;letter-spacing: 0.578px;visibility: visible !important;width: 134px !important;" referrerpolicy="no-referrer"></section><section style="margin-bottom: 0px;outline: 0px;font-family: system-ui, -apple-system, &quot;system-ui&quot;, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);color: rgb(100, 99, 99);font-size: 15px;text-align: center;line-height: normal;"><span style="outline: 0px;font-family: -apple-system, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 1px;font-size: 18px;color: rgb(0, 17, 255);">如何編寫業務代碼？</span></section><p style="margin-top: 8px;outline: 0px;line-height: 1.75em;margin-bottom: 8px;"><br></p><span id="OSC_h4_23"></span><h4 data-lake-id="ca6fa186228ff7efaa653334195896c8" data-wording="true" style="margin-top: 0.5em;margin-bottom: 8px;outline: 0px;letter-spacing: 0.544px;text-wrap: wrap;color: rgb(34, 34, 34);background-color: rgb(255, 255, 255);font-family: -apple-system-font, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;visibility: visible;line-height: 1.75em;"><span style="outline: 0px;visibility: visible;letter-spacing: 1px;color: rgb(0, 17, 255);"><strong style="outline: 0px;visibility: visible;"><span style="outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">▐</span></strong><strong style="outline: 0px;visibility: visible;"><span style="outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">&nbsp;&nbsp;</span></strong><strong style="outline: 0px;visibility: visible;"><span style="color: rgb(0, 17, 255);outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">DDD 下業務代碼的組織方式</span></strong></span></h4><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;"><br></span></p><ul class="list-paddingleft-1" style="list-style-type: disc;"><li style="color: rgb(0, 17, 255);"><span id="OSC_h4_24"></span><h4 data-cangjie-key="1052" data-cangjie-leaf-block="true" data-type="heading-4" style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;color: rgb(0, 17, 255);">「寫操作」在 DDD 中的實現 3 種場景，分別是</span></h4></li></ul><section style="margin-bottom: 8px;text-align: justify;"><span style="box-sizing: inherit;color: rgb(51, 51, 51);font-size: 15px;letter-spacing: 1px;"><br></span></section><ol class="list-paddingleft-1" style="list-style-type: decimal;"><li><span id="OSC_h4_25"></span><h4 data-cangjie-key="1052" data-cangjie-leaf-block="true" data-type="heading-4" style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;text-align: justify;"><span style="color: rgb(51, 51, 51);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">通過聚合根完成業務請求，這是 DDD 完成業務請求的典型方式</span></h4></li><li><section style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;text-align: justify;"><span style="color: rgb(51, 51, 51);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">通過 Factory 完成聚合根的創建</span></section></li><li><p style="margin-top: 8px;line-height: 1.75em;text-align: justify;margin-bottom: 8px;"><span style="color: rgb(51, 51, 51);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">通過 DomainService 完成業務請求</span></p></li></ol><section style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="letter-spacing: 1px;font-size: 15px;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);"><br></span></section><section style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="letter-spacing: 1px;font-size: 15px;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);"><img class="rich_pages wxw-img" data-backh="288" data-backw="578" data-imgfileid="503042088" data-ratio="0.49722222222222223" src="https://oscimg.oschina.net/oscnet/8939ad18-3832-4d6d-a27f-74a94709eb8b.jpg" data-type="other" data-w="1080" style="width: 100%;height: auto;" referrerpolicy="no-referrer"></span></section><section style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><br></section><ul class="list-paddingleft-1" style="list-style-type: disc;"><li style="color: rgb(0, 17, 255);"><span id="OSC_h4_26"></span><h4 data-cangjie-key="1071" data-cangjie-leaf-block="true" data-type="heading-4" style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;color: rgb(0, 17, 255);">讀操作，同樣給出了 3 種方式</span></h4></li></ul><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><br></p><ol class="list-paddingleft-1" style="list-style-type: decimal;"><li><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="color: rgb(0, 0, 0);font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 1px;">基於領域模型的讀操作 (讀寫操作糅合在了一起，不推薦)</span></p></li><li><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="color: rgb(0, 0, 0);font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 1px;">基於數據模型的讀操作 (繞過聚合根和資源庫，直接返回數據，推薦)</span></p></li><li><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="color: rgb(0, 0, 0);font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 1px;">CQRS(讀寫操作分別使用不同的數據庫，比較重)</span></p></li></ol><section style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="color: rgb(0, 0, 0);font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">（圖中的 ReadModel 可以理解為 DTO）</span></section><p style="margin-top: 8px;line-height: 1.75em;text-align: center;margin-bottom: 8px;"><span style="letter-spacing: 1px;font-size: 15px;box-sizing: inherit;color: rgba(25, 26, 31, 0.9);"><img class="rich_pages wxw-img" data-imgfileid="503042089" data-ratio="0.6407407407407407" src="https://oscimg.oschina.net/oscnet/19fe59c6-305f-47e9-ab18-3b7054b9190f.jpg" data-type="other" data-w="1080" referrerpolicy="no-referrer"></span></p><section style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><br></section><ul class="list-paddingleft-1" style="list-style-type: disc;"><li style="color: rgb(0, 17, 255);"><span id="OSC_h3_27"></span><h3 data-cangjie-key="1093" data-cangjie-leaf-block="true" data-type="heading-3" style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;color: rgb(0, 17, 255);">對於業務代碼來説，怎麼提煉出業務邏輯和技術細節？</span></h3></li></ul><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><br></p><ol class="list-paddingleft-1" style="list-style-type: decimal;"><li><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="color: rgb(0, 0, 0);font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 1px;">對 Use Case 進行過程分解</span></p></li><li><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="color: rgb(0, 0, 0);font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 1px;">對象模型建設</span></p></li></ol><section style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><br></section><section style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;text-align: center;"><img class="rich_pages wxw-img" data-backh="289" data-backw="578" data-imgfileid="503042090" data-ratio="0.5" src="https://oscimg.oschina.net/oscnet/7e7560a4-ca89-42f8-9c49-bbf2685d179a.jpg" data-type="other" data-w="1080" style="width: 100%;height: auto;" referrerpolicy="no-referrer"></section><section style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><br></section><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="color: rgb(0, 0, 0);letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;">舉個例子，在上架過程中，有一個校驗是檢查庫存的，其中對於組合品（CombineBackOffer）其庫存的處理會和普通品不一樣。原來的代碼是這麼寫的：</span></p><section class="code-snippet__fix code-snippet__js"><pre class="code-snippet__js" data-lang="typescript"><code><span class="code-snippet_outer">boolean isCombineProduct = supplierItem.getSign().isCombProductQuote();</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">// supplier.usc warehouse needn't check</span></code><code><span class="code-snippet_outer">if (WarehouseTypeEnum.isAliWarehouse(supplierItem.getWarehouseType())) {</span></code><code><span class="code-snippet_outer">// quote warehosue check</span></code><code><span class="code-snippet_outer">if (CollectionUtil.isEmpty(supplierItem.getWarehouseIdList()) &amp;&amp; !isCombineProduct) {</span></code><code><span class="code-snippet_outer">    throw ExceptionFactory.makeFault(ServiceExceptionCode.SYSTEM_ERROR, "親，不能發佈 Offer，請聯繫倉配運營人員，建立品倉關係！");</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer">// inventory amount check</span></code><code><span class="code-snippet_outer">Long sellableAmount = 0L;</span></code><code><span class="code-snippet_outer">if (!isCombineProduct) {</span></code><code><span class="code-snippet_outer">    sellableAmount = normalBiz.acquireSellableAmount(supplierItem.getBackOfferId(), supplierItem.getWarehouseIdList());</span></code><code><span class="code-snippet_outer">} else {</span></code><code><span class="code-snippet_outer">    //組套商品</span></code><code><span class="code-snippet_outer">    OfferModel backOffer = backOfferQueryService.getBackOffer(supplierItem.getBackOfferId());</span></code><code><span class="code-snippet_outer">    if (backOffer != null) {</span></code><code><span class="code-snippet_outer">        sellableAmount = backOffer.getOffer().getTradeModel().getTradeCondition().getAmountOnSale();</span></code><code><span class="code-snippet_outer">    }</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer">if (sellableAmount &lt; 1) {</span></code><code><span class="code-snippet_outer">    throw ExceptionFactory.makeFault(ServiceExceptionCode.SYSTEM_ERROR, "親，實倉庫存必須大於 0 才能發佈，請確認已補貨.\r[id:" + supplierItem.getId() + "]");</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer">}</span></code></pre></section><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><br></p><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="color: rgb(0, 0, 0);letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;">然而，如果我們在系統中引入領域模型之後，其代碼會簡化為如下：</span><span style="color: rgb(0, 0, 0);font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 1px;">﻿</span></p><section class="code-snippet__fix code-snippet__js"><pre class="code-snippet__js" data-lang="javascript"><code><span class="code-snippet_outer">if(backOffer.isCloudWarehouse()){</span></code><code><span class="code-snippet_outer">    return;</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">if (backOffer.isNonInWarehouse()){</span></code><code><span class="code-snippet_outer">    throw new BizException("親，不能發佈 Offer，請聯繫倉配運營人員，建立品倉關係！");</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">if (backOffer.getStockAmount() &lt; 1){</span></code><code><span class="code-snippet_outer">    throw new BizException("親，實倉庫存必須大於 0 才能發佈，請確認已補貨.\r[id:" + backOffer.getSupplierItem().getCspuCode() + "]");</span></code><code><span class="code-snippet_outer">}</span></code></pre></section><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><br></p><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 1px;">有沒有發現，使用模型的表達要清晰易懂很多，而且也不需要做關於組合品的判斷了，因為我們在系統中引入了更加貼近現實的對象模型（CombineBackOffer 繼承 BackOffer），通過對象的多態可以消除我們代碼中的大部分的 if-else<span style="color: rgb(0, 0, 0);font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">﻿</span></span></section><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;"><br></span></section><section style="margin-bottom: 0px;outline: 0px;font-family: system-ui, -apple-system, &quot;system-ui&quot;, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);color: rgb(34, 34, 34);text-align: center;line-height: normal;"><img class="rich_pages wxw-img" data-imgfileid="503042091" data-ratio="0.328125" data-s="300,640" src="https://oscimg.oschina.net/oscnet/f5175d58-58b3-4bdb-b562-642dcc9ac95c.png" data-type="png" data-w="256" style="outline: 0px;letter-spacing: 0.544px;visibility: visible !important;width: 136px !important;" referrerpolicy="no-referrer"></section><section style="margin-bottom: 0px;outline: 0px;font-family: system-ui, -apple-system, &quot;system-ui&quot;, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);color: rgb(100, 99, 99);font-size: 15px;text-align: center;line-height: normal;"><span style="outline: 0px;font-family: -apple-system, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 1px;font-size: 18px;color: rgb(0, 17, 255);">常見問題</span></section><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><br></p><span id="OSC_h4_28"></span><h4 data-lake-id="ca6fa186228ff7efaa653334195896c8" data-wording="true" style="margin-top: 0.5em;margin-bottom: 8px;text-wrap: wrap;outline: 0px;letter-spacing: 0.544px;color: rgb(34, 34, 34);background-color: rgb(255, 255, 255);font-family: -apple-system-font, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;visibility: visible;line-height: 1.75em;"><span style="outline: 0px;visibility: visible;letter-spacing: 1px;color: rgb(0, 17, 255);"><strong style="outline: 0px;visibility: visible;"><span style="outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">▐</span></strong><strong style="outline: 0px;visibility: visible;"><span style="outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">&nbsp;&nbsp;</span></strong><strong style="outline: 0px;visibility: visible;"><span style="color: rgb(0, 17, 255);outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">API 層</span></strong></span></h4><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;"><br></span></p><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">API 包一般放什麼內容？</span></p><ol class="list-paddingleft-1" style="list-style-type: decimal;"><li><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">對外暴露接口：直接代理外界需要訪問的領域服務。</span></p></li><li><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">Facade 模式：對 Domain 層的能力，基於易用性的目的，進行一定的重組；比如多個領域服務合一個 API、一個領域服務拆多個 API</span></p></li><li><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">對於一些通用的判斷方法可以放在裏面</span></p></li><li><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">通用的異常類型</span></p></li><li><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">通用的枚舉</span></p></li></ol><section style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;"><br></span></section><span id="OSC_h4_29"></span><h4 data-lake-id="ca6fa186228ff7efaa653334195896c8" data-wording="true" style="margin-top: 0.5em;text-wrap: wrap;outline: 0px;letter-spacing: 0.544px;color: rgb(34, 34, 34);background-color: rgb(255, 255, 255);font-family: -apple-system-font, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;visibility: visible;line-height: 1.75em;margin-bottom: 8px;"><span style="outline: 0px;visibility: visible;letter-spacing: 1px;color: rgb(0, 17, 255);"><strong style="outline: 0px;visibility: visible;"><span style="outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">▐</span></strong><strong style="outline: 0px;visibility: visible;"><span style="outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">&nbsp;&nbsp;</span></strong><strong style="outline: 0px;visibility: visible;"><span style="color: rgb(0, 17, 255);outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">Application 層</span></strong></span></h4><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;"><br></span></p><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="font-size: 15px;font-weight: bold;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">Application 層即 API 的設計要劃分領域嗎？</span></p><ol class="list-paddingleft-1" style="list-style-type: decimal;"><li><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">需要劃分領域，細節可能和 Domain 層存在一些差異,由於屬於頂層服務</span></section></li></ol><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><br></section><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="font-size: 15px;font-weight: bold;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">API 和 Domain Service 都是接口，它們的區別是什麼？</span></section><ol class="list-paddingleft-1" style="list-style-type: decimal;"><li><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">API 是暴露給外部系統，希望外部系統感知的能力；領域服務的能力僅暴露在系統內部。</span></section></li><li><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">API 暴露的能力一般比領域服務少，因為領域服務還要給 JobProcessor、MessageListener 或其它領域服務提供服務。</span></section></li></ol><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><br></section><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="font-size: 15px;font-weight: bold;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">分層原則（也是任何分層分域的一般準則）</span></section><ol class="list-paddingleft-1" style="list-style-type: decimal;"><li><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">架構解決的是變化的問題。根據子系統變化的快慢，對子系統進行分層，從而隔離變化。例如上面的基礎域變化慢，業務域變化快，分開。</span></section></li></ol><section style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;"><br></span></section><span id="OSC_h4_30"></span><h4 data-lake-id="ca6fa186228ff7efaa653334195896c8" data-wording="true" style="margin-top: 0.5em;margin-bottom: 8px;text-wrap: wrap;outline: 0px;letter-spacing: 0.544px;color: rgb(34, 34, 34);background-color: rgb(255, 255, 255);font-family: -apple-system-font, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;visibility: visible;line-height: 1.75em;"><span style="outline: 0px;visibility: visible;letter-spacing: 1px;color: rgb(0, 17, 255);"><strong style="outline: 0px;visibility: visible;"><span style="outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">▐</span></strong><strong style="outline: 0px;visibility: visible;"><span style="outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">&nbsp;&nbsp;</span></strong><strong style="outline: 0px;visibility: visible;"><span style="color: rgb(0, 17, 255);outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">Domain</span></strong></span></h4><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><br></section><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="font-weight: bold;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 1px;">為什麼 Domain 層和 Infrastructure 層要依賴倒置？</span></section><ol class="list-paddingleft-1" style="list-style-type: decimal;"><li><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">通過依賴倒置，消除 Domain 層的外部依賴，完全隔離外部變化，實現自洽。</span></p></li></ol><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><br></p><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;font-weight: bold;letter-spacing: 1px;">Repository 和防腐層（Anti-Corruption）是什麼？</span></p><ol class="list-paddingleft-1" style="list-style-type: decimal;"><li><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 1px;">Repository 就是 DDD 裏的領域倉庫，負責領域實體的生命週期管理（可以簡單理解為增刪改查）</span></p></li><li><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span data-cangjie-key="1204:0" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="1204:0" style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;box-sizing: inherit;font-weight: bold;">防腐層（Anti-Corruption）</span><span data-cangjie-key="1204:20" data-cangjie-leaf="true" data-cangjie-mark="true" data-testid="1204:20" style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;box-sizing: inherit;">是為了隔離變化而抽象出來的概念，負責和外部系統打交道。</span></section></li></ol><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">﻿</span><br></section><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="font-size: 15px;font-weight: bold;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">Repository 和防腐層（Anti-Corruption）的區別是什麼？</span></section><ol class="list-paddingleft-1" style="list-style-type: decimal;"><li><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">從代碼結構上來看是一樣的。如果按設計模式來解讀，本質上都是 Adaptor。其中，本領域充當 Adaptor 中的 client 角色。即 Repository 和防腐層（Anti-Corruption）的接口簽名是基於本領域的需求而設計（而不是基於外部系統的簽名來設計）。這也是為什麼 Repository 和防腐層（Anti-Corruption）要按域來組織，而不是按外部系統來組織。</span></section></li><li><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">從語義上來講，Repository 偏數據，防腐層（Anti-Corruption）偏功能。這種語義區分能提升系統可維護性。</span></section></li></ol><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;"><br></span></p><span id="OSC_h4_31"></span><h4 data-lake-id="ca6fa186228ff7efaa653334195896c8" data-wording="true" style="margin-top: 0.5em;margin-bottom: 8px;text-wrap: wrap;outline: 0px;letter-spacing: 0.544px;color: rgb(34, 34, 34);background-color: rgb(255, 255, 255);font-family: -apple-system-font, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;visibility: visible;line-height: 1.75em;"><span style="outline: 0px;visibility: visible;letter-spacing: 1px;color: rgb(0, 17, 255);"><strong style="outline: 0px;visibility: visible;"><span style="outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">▐</span></strong><strong style="outline: 0px;visibility: visible;"><span style="outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">&nbsp;&nbsp;</span></strong><strong style="outline: 0px;visibility: visible;"><span style="color: rgb(0, 17, 255);outline: 0px;font-family: Optima-Regular, PingFangTC-light;visibility: visible;">Infrastructure</span></strong></span></h4><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="font-weight: bold;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 1px;"><br></span></section><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="font-weight: bold;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 1px;">什麼決定了是放 Domain 層還是 Infrastructure 層？</span></section><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">約定：</span><span style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">訪問中間件/外部系統的，放基礎設施層。</span><span style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">領域層只放領域邏輯，從而隔離變化。</span></section><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;font-weight: bold;letter-spacing: 1px;"><br></span></section><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;font-weight: bold;letter-spacing: 1px;">基礎設施從字面上看偏基礎，為什麼把中間件、外部系統放這裏？</span></section><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">按照洋葱圈架構的説法，這些其實都是適配器，都應該屬於外部依賴的範疇</span></section><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;font-weight: bold;letter-spacing: 1px;"><br></span></section><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;font-weight: bold;letter-spacing: 1px;">Utils 放哪裏，是不是基礎設施的一部分？</span></section><ol class="list-paddingleft-1" style="list-style-type: decimal;"><li><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">不建議：</span><span style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">如果認為工具是基礎設施的一部分，則 Domain 層甚至 API 層將感知 Infrastructure 層，破壞了依賴單向性。</span></section></li><li><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 1px;"><span style="font-family:Arial;">建議</span></span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 1px;">基礎工具抽到單獨的二方包；</span><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 1px;">業務工具放到對應的 Module。</span></section></li></ol><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;"></span></section><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;font-size: 15px;letter-spacing: 1px;">﻿</span></section><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><span style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;">回顧下整篇文章，咱們對於應用架構的混亂問題進行了總結與歸納，並給出了一些重點需要理解的內容，希望能對大家的日常開發有一些幫助。</span></section><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;"><br></span></p><section style="margin-bottom: 0px;outline: 0px;font-family: system-ui, -apple-system, &quot;system-ui&quot;, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);text-align: center;line-height: normal;"><span style="outline: 0px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 1px;"><img class="rich_pages wxw-img" data-imgfileid="503042092" data-ratio="0.328125" data-s="300,640" src="https://oscimg.oschina.net/oscnet/ae8026bc-c1cd-4833-a97a-d6baf9d29317.png" data-type="png" data-w="256" style="outline: 0px;font-family: system-ui, -apple-system, &quot;system-ui&quot;, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;visibility: visible !important;width: 140px !important;" referrerpolicy="no-referrer"></span></section><section style="margin-bottom: 0px;outline: 0px;font-family: system-ui, -apple-system, &quot;system-ui&quot;, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);color: rgb(100, 99, 99);font-size: 15px;text-align: center;line-height: normal;"><span style="outline: 0px;font-family: -apple-system, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 18px;color: rgb(0, 17, 255);letter-spacing: 1px;">附錄</span></section><section style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;"><br></section><ol class="list-paddingleft-1" style="list-style-type: decimal;"><li><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;text-align: left;"><span style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;">﻿後端開發實踐系列——領域驅動設計 (DDD) 編碼實踐 - Thoughtworks 洞見（地址：https://insights.thoughtworks.cn/backend-development-ddd/）﻿</span></p></li><li><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;text-align: left;"><span style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;">﻿實現領域驅動設計（地址：https://book.douban.com/subject/25844633//）﻿</span></p></li><li><p style="margin-top: 8px;margin-bottom: 8px;line-height: 1.75em;text-align: left;"><span style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;">﻿Cola-阿里巴巴開源應用架構（地址：https://github.com/alibaba/COLA）</span></p></li></ol><p style="line-height: 1.75em;text-align: justify;margin-bottom: 0px;margin-top: 0px;"><span style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;"></span></p><section style="text-align: center;margin-top: 0px;margin-bottom: 0px;line-height: normal;"><img class="rich_pages wxw-img" data-imgfileid="503042093" data-ratio="0.3425196850393701" data-s="300,640" src="https://oscimg.oschina.net/oscnet/346aecb5-6194-4248-960e-bc26e019a878.png" data-type="png" data-w="254" style="outline: 0px;font-family: system-ui, -apple-system, &quot;system-ui&quot;, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-wrap: wrap;background-color: rgb(255, 255, 255);width: 134px;visibility: visible !important;height: 46px;" referrerpolicy="no-referrer"></section><section style="text-align: center;margin-top: 0px;margin-bottom: 0px;line-height: normal;"><span style="color: rgb(0, 17, 255);font-family: -apple-system, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 18px;letter-spacing: 1px;text-align: center;text-wrap: wrap;background-color: rgb(255, 255, 255);">團隊介紹</span></section><section style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><br></section><p style="margin-top: 8px;line-height: 1.75em;margin-bottom: 8px;"><span style="box-sizing: inherit;color: rgba(25, 26, 31, 0.9);font-size: 15px;letter-spacing: 1px;">我們是淘天集團物流技術團隊，服務淘天物流部及零售行業的產技團隊，一直深耕在物流及供應鏈的數字化協同與運營領域：為零售業務提供靈活多樣的經營模式管理方案及可以快速適配市場變化的經營策略數宇化管理工具；為商家提供高效低成本的物流及供應鏈解決方案，加快資金效率，提升協同效率；為消費者提供即時便捷的購物體驗。</span></p><section style="margin-bottom: 8px;"><br></section><section data-role="outer" label="Powered by 135editor.com" style="margin-bottom: 0px;outline: 0px;letter-spacing: 0.544px;visibility: visible;"><section style="margin-top: 5px;outline: 0px;letter-spacing: 0.544px;font-size: 16px;word-break: break-all;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;text-align: center;line-height: 1.75em;margin-bottom: 8px;"><span style="outline: 0px;color: rgb(0, 17, 255);"><strong style="outline: 0px;">¤</strong></span><span style="outline: 0px;"><strong style="outline: 0px;">&nbsp;拓展閲讀&nbsp;</strong></span><span style="outline: 0px;color: rgb(0, 17, 255);"><strong style="outline: 0px;">¤</strong></span></section><section style="margin-top: 5px;margin-bottom: 5px;outline: 0px;letter-spacing: 0.544px;font-size: 16px;word-break: break-all;color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;text-align: center;line-height: 1.75em;"><br style="outline: 0px;"></section><section style="margin-top: 8px;margin-bottom: 8px;outline: 0px;font-family: -apple-system, &quot;system-ui&quot;, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 0.544px;text-indent: 0em;text-align: center;line-height: 1.75em;min-height: 24px;clear: both;visibility: visible;"><a target="_blank" href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fappmsgalbum%3F__biz%3DMzAxNDEwNjk5OQ%3D%3D%26action%3Dgetalbum%26album_id%3D2565944923443904512%23wechat_redirect" textvalue="3DXR 技術" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2" style="outline: 0px;color: var(--weui-LINK);-webkit-user-drag: none;cursor: pointer;">3DXR 技術</a>&nbsp;|&nbsp; 
   <a target="_blank" href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fappmsgalbum%3F__biz%3DMzAxNDEwNjk5OQ%3D%3D%26action%3Dgetalbum%26album_id%3D1533906991218294785%23wechat_redirect" textvalue="終端技術" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2" style="outline: 0px;color: var(--weui-LINK);-webkit-user-drag: none;cursor: pointer;">終端技術</a>&nbsp;|&nbsp; 
   <a target="_blank" href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fappmsgalbum%3F__biz%3DMzAxNDEwNjk5OQ%3D%3D%26action%3Dgetalbum%26album_id%3D1592015847500414978%23wechat_redirect" textvalue="音視頻技術" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2" style="outline: 0px;color: var(--weui-LINK);-webkit-user-drag: none;cursor: pointer;">音視頻技術</a></section><p style="margin-top: 8px;margin-bottom: 8px;outline: 0px;min-height: 24px;font-family: -apple-system, &quot;system-ui&quot;, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 0.544px;text-indent: 0em;text-align: center;line-height: 1.75em;visibility: visible;"><a target="_blank" href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fappmsgalbum%3F__biz%3DMzAxNDEwNjk5OQ%3D%3D%26action%3Dgetalbum%26album_id%3D1539610690070642689%23wechat_redirect" textvalue="服務端技術" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2" style="outline: 0px;color: var(--weui-LINK);-webkit-user-drag: none;cursor: pointer;">服務端技術</a><span style="outline: 0px;letter-spacing: 0.544px;">&nbsp;|&nbsp;</span><a target="_blank" href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fappmsgalbum%3F__biz%3DMzAxNDEwNjk5OQ%3D%3D%26action%3Dgetalbum%26album_id%3D2565883875634397185%23wechat_redirect" textvalue="技術質量" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2" style="outline: 0px;color: var(--weui-LINK);-webkit-user-drag: none;cursor: pointer;">技術質量</a>&nbsp;|&nbsp;<a target="_blank" href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fappmsgalbum%3F__biz%3DMzAxNDEwNjk5OQ%3D%3D%26action%3Dgetalbum%26album_id%3D1522425612282494977%23wechat_redirect" textvalue="數據算法" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2" style="outline: 0px;color: var(--weui-LINK);-webkit-user-drag: none;cursor: pointer;">數據算法</a></p><p style="margin-top: 8px;margin-bottom: 8px;outline: 0px;min-height: 24px;font-family: -apple-system, &quot;system-ui&quot;, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 0.544px;text-indent: 0em;text-align: center;line-height: 1.75em;visibility: visible;"><br style="outline: 0px;"></p><section class="mp_profile_iframe_wrp" style="margin-bottom: 24px;outline: 0px;"><mp-common-profile class="custom_select_card mp_profile_iframe js_wx_tap_highlight" data-pluginname="mpprofile" data-id="MzAxNDEwNjk5OQ==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/33P2FdAnju8t5nZGhAatCrc4e2iaDfAaoInribRKxc7MOqdTGygfcLqSDxhj0trCHVEh94Sjl7zuWYzwouYtJ0VQ/300?wx_fmt=png&amp;wxfrom=19" data-nickname="大淘寶技術" data-alias="AlibabaMTT" data-signature="大淘寶技術官方賬號" data-from="2" data-index="0" data-origin_num="689" data-isban="0" data-biz_account_status="0" data-weui-theme="light" data-is_biz_ban="0"></mp-common-profile></section></section><p style="display: none;"><mp-style-type data-value="3"></mp-style-type></p></div><p style="color: #858585; font-size: 13px;">本文分享自微信公眾號 - 大淘寶技術（AlibabaMTT）。<br>如有侵權，請聯繫 support@oschina.cn 刪除。<br>本文參與「<a href="https://www.oschina.net/sharing-plan" target="_blank">OSC 源創計劃</a>」，歡迎正在閲讀的你也加入，一起分享。</p></div>
                                    ]]>
            </description>
            <pubDate>Sat, 17 Feb 2024 08:15:41 GMT</pubDate>
            <guid isPermaLink="false">https://my.oschina.net/u/4662964/blog/10751229</guid>
            <link>https://my.oschina.net/u/4662964/blog/10751229</link>
            <author>
                <![CDATA[原創]]>
            </author>
        </item>
        <item>
            <title>
                <![CDATA[谷歌建議舊版 Windows 10 PC 用户遷移到 ChromeOS Flex]]>
            </title>
            <description>
                <![CDATA[<div class="content"><p>微軟將於 2025 年 10 月 14 日停止為 Windows 10 提供官方支持，由於缺乏免費的安全更新和技術支持，這可能導致消費者和企業的 2.4 億台 PC 被淘汰。</p><p>此外，由於許多運行 Windows 10 系統的設備過於老舊，不滿足運行 Windows 11 的要求，許多用户將不得不向微軟支付延期支持費用或購買新電腦。有些人可能想保留現有機器而不向微軟付費，但這樣做會因缺乏安全更新而帶來危險。</p><p><img alt="" src="https://oscimg.oschina.net/oscnet/up-316aa08dcd289eb3c3a832b2e231a7bd87b.png" referrerpolicy="no-referrer"></p><p>谷歌為這些用户<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fwww.tomshardware.com%2Fsoftware%2Foperating-systems%2Fgoogle-proposes-users-of-older-windows-10-pcs-to-migrate-to-chromeos-flex-600-devices-certified" target="_blank">提出</a>瞭解決方案 —— 通過 ChromeOS Flex 提供"自動更新"硬件兼容性。</p><p>ChromeOS 商業產品主管寫道：「微軟 Windows 10 即將進入報廢狀態，這可能會對環境產生重大影響。數百萬台完全能夠運行 Windows 10 但與 Windows 11 不兼容的電腦可能最終被填埋。」</p><blockquote><p><img src="https://oscimg.oschina.net/oscnet/up-e30c3cdf91fd4c11ad29cb8337d074e8ef2.png" referrerpolicy="no-referrer"></p><p><em><u><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fcloud.google.com%2Fblog%2Fproducts%2Fchrome-enterprise%2F11-ways-you-win-with-chromeos-flex" target="_blank">https://cloud.google.com/blog/products/chrome-enterprise/11-ways-you-win-with-chromeos-flex</a></u></em></p></blockquote><p>因此谷歌建議為搭載 Windows 10 的舊電腦安裝 ChromeOS Flex，從而轉換為雲電腦，以延長其使用壽命。有了 ChromeOS Flex，公司和消費者就可以安裝一個新的操作系統，即使在 Windows 10 於明年年底停止提供安全補丁後，該系統仍會自動更新，提供未來數年的安全補丁。</p><p>谷歌表示 Flex 是專為傳統 PC 硬件設計的 ChromeOS 分支，是 Windows 或 macOS 等傳統操作系統的理想替代品，並列舉了其基於雲的現代操作系統成為 Windows 10 優秀替代品的 11 種方式。</p><p><img alt="" src="https://oscimg.oschina.net/oscnet/up-770d2dc5bed7dfe03e07f3f19937d88ec0d.png" referrerpolicy="no-referrer"></p><p>ChromeOS Flex 非常安全，它具有數據加密、自動更新和應用程序沙箱等功能，可以保護用户免受惡意軟件和其他網絡威脅的侵害。谷歌聲稱，勒索軟件攻擊者從未入侵過這款輕量級操作系統。</p><p>ChromeOS Flex 易於使用，特別是對於熟悉 Chrome 瀏覽器或 Google 工作空間的人來説。該操作系統啓動速度快，不會出現一直困擾 Windows 的運行速度變慢（臃腫）問題，從而提高了工作效率。藉助 Google 管理控制枱，該系統還易於遠程管理。</p><p>ChromeOS Flex 非常"靈活"，經認證可在近 600 種 OEM 品牌設備上運行，這意味着該雲操作系統幾乎可以在企業組織部署的任何設備上運行。</p><p>ChromeOS Flex 可降低 IT 支持和硬件成本，防止 Windows 10 機器成為電子垃圾，而且高效節能。該操作系統適用於大型或小型企業。</p><p>ChromeOS Flex 還支持第三方業務應用程序，至少在基於網絡的服務方面是如此。得益於虛擬應用交付技術，"傳統"Windows 應用程序和微軟 Office 等生產力套件可以從互聯網流式傳輸，實現"無縫"集成。</p><p>然而 ChromeOS 並不是一個特別受歡迎的替代操作系統。根據 StatCounter.com 的數據，截至 2024 年 1 月，ChromeOS 在全球 PC 操作系統市場中僅佔據 1.78% 的份額，遠遠落後於 Windows 佔主導地位的 73% 和 macOS 的 16.11% 市場份額。</p><p>延伸閲讀：<strong><em><u><a href="https://www.oschina.net/news/238374/pirg-chromebook-churn" target="news">電子垃圾 Chromebook</a></u></em></strong></p></div>
                                    ]]>
            </description>
            <pubDate>Sat, 17 Feb 2024 04:15:00 GMT</pubDate>
            <guid isPermaLink="false">https://www.oschina.net/news/278904</guid>
            <link>https://www.oschina.net/news/278904</link>
            <author>
                <![CDATA[來源: 投稿]]>
            </author>
        </item>
        <item>
            <title>
                <![CDATA[谷歌發佈 Gemini 1.5，最高支持百萬級 token 上下文]]>
            </title>
            <description>
                <![CDATA[<div class="content"><p>在推出號稱最強大的<a href="https://www.oschina.net/news/278397/bard-gemini-advanced-app"> Gemini Ultra </a>模型一週後，谷歌今天發佈了擁有最長上下文窗口的下一代大模型<strong>&nbsp;Gemini 1.5&nbsp;</strong>—— 最高支持&nbsp;<span>100 萬 token 的上下文長度。</span></p><blockquote><p><img alt="" src="https://oscimg.oschina.net/oscnet/up-a51e6f59a5c0b7d4a14179ec0b37415c657.png" referrerpolicy="no-referrer"></p><p><em><u><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fblog.google%2Ftechnology%2Fai%2Fgoogle-gemini-next-generation-model-february-2024" target="_blank">https://blog.google/technology/ai/google-gemini-next-generation-model-february-2024</a></u></em></p></blockquote><p>谷歌首席科學家 Jeff Dean <a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Ftwitter.com%2FJeffDean%2Fstatus%2F1758146022726041615" target="_blank">表示</a>，Gemini 1.5 的上下文理解能力可支持百萬級 token 的多模態輸入，讓用户能夠使用該模型與數十萬字的超長文檔、擁有數百個文件的數十萬行代碼庫、一部完整的電影等進行交互。</p><p><img src="https://oscimg.oschina.net/oscnet/up-8a4bdc73436da787fcfab9be022109f6e7d.gif" referrerpolicy="no-referrer"></p><p>Gemini 1.5 介紹</p><ol><li>性能提升：Gemini 1.5 在多個維度上展現出顯著的性能提升，特別是在處理長上下文信息的能力上實現了重大突破，可以連續處理高達 100 萬個標記（tokens），擁有迄今為止所有大型基礎模型中最長的上下文窗口。</li><li>高效架構：Gemini 1.5 採用了新的 Mixture-of-Experts（MoE）架構，使模型更高效地進行訓練和服務，同時在維持類似於 1.0 Ultra 模型的質量的同時，減少了計算需求。</li><li>長上下文窗口：這一特點允許 Gemini 1.5 處理並分析大量信息，比如 1 小時的視頻、11 小時的音頻、超過 30,000 行代碼的代碼庫或超過 700,000 字的文本。</li><li>跨模態理解和推理：Gemini 1.5 能夠對不同模態的內容（包括文本、代碼、圖像、音頻和視頻）進行高度複雜的理解和推理，例如，分析 44 分鐘的默片並準確捕捉情節要點和細節。</li><li>增強性能：在文本、代碼、圖像、音頻和視頻評估的綜合面板上測試時，Gemini 1.5 Pro 在用於開發我們的大型語言模型（LLMs）的 87% 的基準測試中表現優於 1.0 Pro，並且與 1.0 Ultra 在同樣的基準測試中表現大致相當。</li></ol><p>Gemini 1.5 技術報告：<em><u><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fstorage.googleapis.com%2Fdeepmind-media%2Fgemini%2Fgemini_v1_5_report.pdf" target="_blank">https://storage.googleapis.com/deepmind-media/gemini/gemini_v1_5_report.pdf</a></u></em></p></div>
                                    ]]>
            </description>
            <pubDate>Fri, 16 Feb 2024 08:00:00 GMT</pubDate>
            <guid isPermaLink="false">https://www.oschina.net/news/278829/google-gemini-1-5-next-generation-model</guid>
            <link>https://www.oschina.net/news/278829/google-gemini-1-5-next-generation-model</link>
            <author>
                <![CDATA[來源: 投稿]]>
            </author>
        </item>
        <item>
            <title>
                <![CDATA[OpenAI 發佈文本生成視頻模型 Sora]]>
            </title>
            <description>
                <![CDATA[<div class="content"><p>OpenAI 今天凌晨發佈了其首個視頻生成模型 Sora。</p><blockquote><p><img src="https://oscimg.oschina.net/oscnet/up-80cdbef18c0af0f443e5c577f0b8b7d9f0d.png" referrerpolicy="no-referrer"></p><p><em><u><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fopenai.com%2Fsora" target="_blank">https://openai.com/sora</a></u></em></p></blockquote><p>Sora 可根據文本描述生成長達 60 秒的視頻，其中包含精細複雜的場景、生動的角色表情以及複雜的鏡頭運動。</p><p><img src="https://oscimg.oschina.net/oscnet/up-76a85f538720e72217484164ce80b7b5532.png" referrerpolicy="no-referrer"></p><p>目前，Sora 已對網絡安全的紅隊成員開放，以評估其可能存在的風險或潛在傷害。同時，OpenAI 也邀請了視覺藝術家、設計師和電影製作人使用 Sora，收集他們的反饋，以使模型更好地服務於創意行業。</p><p>OpenAI 在技術報告介紹道，<strong>他們將 Sora 視頻生成模型視作世界模擬器</strong>。具體來説就是通過跨越不同持續時間、寬高比和分辨率的視頻和圖像，從而生成最高可達一分鐘的高清視頻。</p><blockquote><p><img src="https://oscimg.oschina.net/oscnet/up-0710069f6fe95eaeadb0508d60ddd79f7b4.png" referrerpolicy="no-referrer"></p><p><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fopenai.com%2Fresearch%2Fvideo-generation-models-as-world-simulators" target="_blank">https://openai.com/research/video-generation-models-as-world-simulators</a></p></blockquote><p>Sora 使用了一種特殊的深度學習模型（即 Transformer）來處理視頻和圖像數據。這種處理方式首先將視頻和圖像編碼成潛在代碼，然後將這些代碼分解成包含時間和空間信息的小塊（即時空補丁），最後利用 Transformer 模型在這些補丁上進行操作。</p><p>這樣的處理方法能夠有效地捕捉和生成視頻和圖像數據中的複雜時空動態，為生成高質量的視頻和圖像提供了一種強大的方法。</p></div>
                                    ]]>
            </description>
            <pubDate>Fri, 16 Feb 2024 04:47:35 GMT</pubDate>
            <guid isPermaLink="false">https://www.oschina.net/news/278821/openai-text-to-video-sora</guid>
            <link>https://www.oschina.net/news/278821/openai-text-to-video-sora</link>
            <author>
                <![CDATA[來源: OSCHINA]]>
            </author>
        </item>
        <item>
            <title>
                <![CDATA[與 F5 產生分歧，核心 Nginx 開發者創建新分支 Freenginx]]>
            </title>
            <description>
                <![CDATA[<div class="content"><p>作為 Nginx Web 服務器的長期核心開發人員之一，Maxim Dounin&nbsp;宣佈創建該項目的一個新分支，名為 Freenginx。</p><p><img height="203" src="https://oscimg.oschina.net/oscnet/up-000ebc1841ce52b742123227a39fe25f18d.png" width="500" referrerpolicy="no-referrer"></p><p>Maxim Dounin 決定分叉 Nginx 是因為與 F5 發生了分歧，F5 於 2019 年收購了 Nginx 公司。Dounin 在<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fmailman.nginx.org%2Fpipermail%2Fnginx-devel%2F2024-February%2FK5IC6VYO2PB7N4HRP2FUQIBIBCGP4WAU.html" target="_blank">宣佈 Freenginx</a>&nbsp;時解釋道：</p><blockquote>
 大家可能都知道，F5 於 2022 年關閉了莫斯科辦事處，從那時起我就不再為 F5 工作了。不過，我們已經達成協議，我將繼續作為志願者參與 nginx 開發。近兩年來，我一直致力於改進 nginx，免費為大家提供更好的服務。
 <br><br> 不幸的是，F5 的一些新的非技術管理層最近認為，他們要更瞭解如何運行開源項目。特別是，他們決定干涉 nginx 多年來使用的安全策略，無視策略和開發人員的立場。
 <br><br> 這是可以理解的：他們擁有該項目，並且可以用它做任何事情，包括以營銷為目的，無視開發者的立場和社區。儘管如此，這還是違背了我們的協議。更重要的是，我再也無法控制 F5 內部對 nginx 的修改，也不再將 nginx 視為一個為公眾利益而開發和維護的免費開源項目。
 <br><br> 因此，從今天起，我將不再參與由 F5 負責的 nginx 開發。取而代之的是，我將啓動另一個項目，由開發人員而非公司實體來運行：
 <br><br><a href="https://www.oschina.net/action/GoToLink?url=http%3A%2F%2Ffreenginx.org%2F" target="_blank">http://freenginx.org/</a><br><br> 我們的目標是使 nginx 開發免受任意公司行為的影響。歡迎提供幫助和貢獻。希望大家都能從中受益。&nbsp;
</blockquote></div>
                                    ]]>
            </description>
            <pubDate>Fri, 16 Feb 2024 04:33:35 GMT</pubDate>
            <guid isPermaLink="false">https://www.oschina.net/news/278819/nginx-forked-freenginx</guid>
            <link>https://www.oschina.net/news/278819/nginx-forked-freenginx</link>
            <author>
                <![CDATA[來源: 投稿]]>
            </author>
        </item>
        <item>
            <title>
                <![CDATA[【店滴雲】智能設備為民宿行業帶來的機遇]]>
            </title>
            <description>
                <![CDATA[<div class="content"><h2>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 智能設備為民宿行業帶來的機遇</h2><p>隨着科技的快速發展，智能設備正逐漸滲透到各個行業，民宿行業也不例外。這些智能設備給民宿業主帶來了許多機遇，從提升客户體驗到優化營運管理，為民宿行業帶來了許多新的可能性。</p><p><img alt="" height="600" src="https://oscimg.oschina.net/oscnet/up-103eb081257839c03f3de3899694bd4d880.png" width="1920" referrerpolicy="no-referrer"></p><h3>提升客户體驗</h3><p>通過使用智能設備，民宿業主可以為客户提供更好的住宿體驗。一些智能家居設備，例如智能門鎖和智能照明系統，使客户能夠方便地使用手機或卡片進行房間進出和燈光控制，提供了更便捷的入住體驗。智能音響和智能電視等設備也可以提供更豐富的娛樂選擇，使客户在民宿中度過愉快的時光。</p><p>另外，通過智能設備的連接，民宿業主可以提供個性化服務。根據客户的喜好和需求，可以調整房間温度、音樂播放和照明效果等，從而營造出獨特的住宿體驗。這種個性化服務能夠幫助民宿業主吸引更多的客户，建立良好的口碑。</p><h3>優化營運管理</h3><p>智能設備不僅提供了更好的客户體驗，還可以優化民宿的營運管理。例如，智能預訂系統可以自動化處理客户的預訂和入住手續，提高管理效率，避免了繁瑣的人工操作。智能能源管理系統可以監控電力、水務等資源的使用情況，達到節能減排的目的，降低經營成本。</p><p>智能監控系統是民宿行業中另一個重要的應用。通過安裝監控攝像頭和傳感器，民宿業主可以實時監測房間、公共區域和周邊環境的情況，確保客户的安全和舒適。此外，智能監控系統還可以提供數據分析，幫助民宿業主瞭解客户偏好和行為習慣，優化產品和服務。</p><h3>面臨的挑戰</h3><p>儘管智能設備為民宿行業帶來了許多機遇，但也面臨一些挑戰。首先，智能設備的成本可能會成為一項累贅，尤其對於小型民宿業主來説。其次，隨着智能設備的普及，網絡安全和隱私保護成為重要的問題。民宿業主需要確保客户的個人信息和居住安全不受侵犯。</p><p>此外，對於一些傳統型的民宿業主來説，接受和適應新的科技可能是一項挑戰。他們需要學習和熟悉新的技術，並將其應用到日常的經營管理中。</p><h3>未來發展趨勢</h3><p>隨着智能設備技術的進一步發展，民宿行業將面臨更多的機遇和挑戰。未來，預測分析、人工智能和物聯網等技術將進一步滲透到民宿行業中，為業主提供更全面、個性化的服務。</p><p>例如，智能家居系統通過預測客户的喜好和需求，自動調整房間的温度、濕度和照明效果，為客户提供更舒適的住宿體驗。人工智能技術還可以幫助業主自動化客户服務和運營管理，提高工作效率。</p><p>總體而言，智能設備給民宿行業帶來了許多機遇。通過提升客户體驗和優化營運管理，民宿業主可以在激烈的競爭中脱穎而出。然而，要充分利用智能設備的潛力，民宿業主需要密切關注技術的發展和行業的變化，不斷學習和創新。</p></div>
                                    ]]>
            </description>
            <pubDate>Fri, 16 Feb 2024 01:37:00 GMT</pubDate>
            <guid isPermaLink="false">https://www.oschina.net/news/278811</guid>
            <link>https://www.oschina.net/news/278811</link>
            <author>
                <![CDATA[來源: 投稿]]>
            </author>
        </item>
        <item>
            <title>
                <![CDATA[Altman 稱 AI 潛在風險會讓人「徹夜難眠」，呼籲建立國際機構監督 AI 發展]]>
            </title>
            <description>
                <![CDATA[<div class="content"><p style="color:#252a2d; margin-left:0; margin-right:0; text-align:justify">2 月 14 日消息，當地時間週二，OpenAI CEO 阿爾特曼在迪拜舉行的世界政府峯會上通過視頻電話致辭，其呼籲建立一個國際性的機構（類似國際原子能機構）來監督 AI 發展。</p><p style="color:#252a2d; margin-left:0; margin-right:0; text-align:justify">「我經常以國際原子能機構為例，將其作為處理最強大人工智能系統影響的典範。在部署超級智能或通用人工智能（注：AGI）之前，建立審計和安全措施至關重要。」</p><p style="color:#252a2d; margin-left:0; margin-right:0; text-align:justify">阿爾特曼還提到，一個非常微妙的「社會失衡」就能給 AI 系統帶來嚴重破壞，自己曾為此徹夜難眠。「我對機器人在街上行走的想法不太感興趣，我更關心非常微妙的社會失衡，即在社會中擁有這些系統，沒有特別的邪惡意圖，事情卻出了大問題。」</p><p style="color:#252a2d; margin-left:0; margin-right:0; text-align:justify">然而他還強調，OpenAI 公司這樣的人工智能行業不應在制定管理涉及 AI 行業的法規時處於領先地位。「我認為我們仍處於需要進行健康辯論的階段。」</p><p style="color:#252a2d; margin-left:0; margin-right:0; text-align:justify">他認為，AI 將會廣泛普及，且價格低廉，成為人類「創造未來的工具」。但與此同時，AI 的全面進步和發展仍需要時間與耐心，「就像手機從原始的移動電話發展到如今的 iPhone 一樣。」</p><p style="color:#252a2d; margin-left:0; margin-right:0; text-align:justify">此外，阿爾特曼還稱當前的世界仍處於 AI 早期階段，「我們從未見過世界發生很大的變化，我認為原因在於我們目前擁有的技術就像黑白電視一樣，還有很長的路要走。</p></div>
                                    ]]>
            </description>
            <pubDate>Thu, 15 Feb 2024 12:25:31 GMT</pubDate>
            <guid isPermaLink="false">https://www.oschina.net/news/278781</guid>
            <link>https://www.oschina.net/news/278781</link>
            <author>
                <![CDATA[來源: 投稿]]>
            </author>
        </item>
        <item>
            <title>
                <![CDATA[雲計算 - 負載均衡 SLB 方案全解與實戰]]>
            </title>
            <description>
                <![CDATA[<div class="content"><blockquote><p>雲計算 - 負載均衡 SLB 方案全解與實戰，介紹 SLB 的核心技術、用户最佳實踐、阿里雲 SLB 產品舉例、應用場景。</p></blockquote><blockquote><p>關注【TechLeadCloud】，分享互聯網架構、雲服務技術的全維度知識。作者擁有 10+年互聯網服務架構、AI 產品研發經驗、團隊管理經驗，同濟本復旦碩，復旦機器人智能實驗室成員，阿里雲認證的資深架構師，項目管理專業人士，上億營收 AI 產品研發負責人。</p></blockquote><p><img src="https://oscimg.oschina.net/oscnet/up-5da5d794e329cfd040f4842da9b8aae7da2.png" alt="file" referrerpolicy="no-referrer"></p><h1>一、引言</h1><p>雲計算作為現代信息技術的基石，正在以前所未有的速度推動着各行各業的數字化進程。其中，負載均衡（Server Load Balancer, SLB）技術是保證雲服務高效、穩定運行的重要組成部分。它通過分配網絡或應用流量到多個服務器，確保了服務的高可用性和高性能。在本篇引言中，我們將探討雲計算與負載均衡的關係以及 SLB 的重要性，並通過實際的例子來揭示其背後的技術原理。</p><h2>雲計算與負載均衡的關係</h2><p>雲計算提供了一種靈活、可擴展的服務運行環境，使得企業和開發者能夠快速響應市場變化，優化資源配置。而負載均衡技術在其中起到了至關重要的作用。</p><p>例如，假設一個電子商務網站在黑色星期五這一天迎來了巨大的流量激增。如果沒有負載均衡技術，單一的服務器可能會因為超負荷而崩潰，導致用户無法訪問網站，從而造成嚴重的經濟損失。而有了負載均衡技術，網絡流量會被均勻分配到多個服務器上，確保每個服務器的負載都保持在一個可接受的範圍內，從而保證了網站的正常運行和用户的訪問體驗。</p><h2>SLB 的重要性</h2><p>SLB 作為負載均衡技術在雲計算環境中的具體實現，它不僅能夠保證服務的高可用性，還能通過優化資源分配，提升服務的響應速度和處理能力。</p><p>以一個在線視頻平台為例，平台需要保證無論用户數量多少，視頻的播放都要流暢無卡頓。通過 SLB，平台可以將用户的請求分配到不同的服務器上，確保每個服務器的負載都在可控範圍內，從而為用户提供高質量的觀看體驗。同時，當某個服務器發生故障時，SLB 能夠自動將流量重新分配到其他健康的服務器上，保證了服務的持續可用。</p><p>通過以上兩個實際的例子，我們可以看到負載均衡技術和 SLB 在雲計算環境中的重要作用。它們為企業和開發者提供了強大的工具，以應對網絡流量的波動和系統負載的變化，是實現高效、穩定雲服務的關鍵。</p><hr><h1>二、SLB 核心技術解析</h1><p>Server Load Balancer (SLB) 是一種負載均衡技術，它在雲計算環境中扮演着至關重要的角色。通過 SLB，可以將網絡流量和請求有效地分配到多個服務器上，從而保證了應用的高可用性和高性能。在本節中，我們將深入解析 SLB 的核心技術，包括負載均衡算法、會話保持技術以及健康檢查。</p><h2>2.1 負載均衡算法</h2><p>負載均衡算法是 SLB 的核心，它決定了如何將流量分配到不同的服務器上。常見的負載均衡算法有輪詢法、最少連接法和 IP Hash 法。</p><h3>2.1.1 輪詢法</h3><p>輪詢法是最簡單也最直接的負載均衡算法，它將每個新的請求按照順序分配到服務器列表中的服務器上。</p><p>例如，假設有三個服務器 A、B 和 C，輪詢法會依次將請求分配給 A、B、C、A、B、C，如此循環。這種方法簡單公平，但可能不適用於服務器性能不均的場景。</p><h3>2.1.2 最少連接法</h3><p>最少連接法是一種動態的負載均衡算法，它會將新的請求分配給當前連接數最少的服務器。</p><p>舉例來説，假設在一個購物網站的高峯期，服務器 A 已經有 30 個連接，而服務器 B 只有 10 個連接，最少連接法會將新的請求分配給服務器 B，從而儘量保持服務器之間的負載均衡。</p><h3>2.1.3 IP Hash 法</h3><p>IP Hash 法根據客户端的 IP 地址計算一個哈希值，然後根據哈希值將請求分配給特定的服務器。</p><p>這種方法能夠保證來自同一 IP 的請求總是被分配到同一個服務器，有助於保持會話的一致性。例如，在一個在線遊戲場景中，玩家的所有請求需要被髮送到同一個服務器以保證遊戲狀態的一致。</p><h2>2.2 會話保持技術</h2><p>會話保持是負載均衡中的另一個重要概念，它能保證一個用户的多個請求被髮送到同一個服務器。</p><h3>2.2.1 Cookie 保持</h3><p>通過在 HTTP 響應中設置特定的 Cookie，SLB 可以識別來自同一用户的請求，並將它們路由到同一服務器。這對於保持用户登錄狀態和購物車信息等非常重要。</p><h3>2.2.2 IP 綁定</h3><p>IP 綁定是另一種會話保持技術，它根據用户的 IP 地址將所有請求路由到同一服務器。與 IP Hash 法類似，這種方法適用於需要保持會話狀態的應用。</p><h2>2.3 健康檢查</h2><p>健康檢查是 SLB 中用於監控服務器狀態的機制。通過定期檢查服務器的響應，SLB 能夠判斷服務器是否健康，從而確保流量只被路由到健康的服務器。</p><h3>2.3.1 TCP 健康檢查</h3><p>通過發送 TCP 探測包來檢查服務器的可達性和響應時間，是判斷服務器健康狀態的一種簡單有效的方法。</p><h3>2.3.2 HTTP 健康檢查</h3><p>HTTP 健康檢查則通過發送 HTTP 請求，並檢查 HTTP 響應的狀態碼和內容，來判斷服務器的健康狀態。</p><p>例如，在一個在線訂餐平台中，通過 HTTP 健康檢查，SLB 能夠實時監控每個服務器的狀態，一旦發現某個服務器的響應時間超過預設的閾值或返回錯誤碼，SLB 會將該服務器標記為不健康，從而避免用户請求被路由到出現問題的服務器，保證了服務的高可用性和用户體驗。</p><p>通過以上深入的技術解析和實際例子，我們可以更清晰地理解 SLB 的核心技術和其在雲計算環境中的重要作用。</p><hr><h1>三、SLB 用户最佳實踐</h1><p>在實際的雲計算環境中，有效地使用 Server Load Balancer (SLB) 是確保應用高可用性和高性能的關鍵。本節將為讀者展示一些 SLB 的用户最佳實踐，包括 SLB 的配置和優化，以及如何應對常見的問題和挑戰。</p><h2>3.1 部署與配置 SLB</h2><p>部署和配置 SLB 是最基本也是最重要的步驟。正確的配置能確保流量得到有效分配，同時保證應用的穩定運行。</p><h3>3.1.1 選擇合適的負載均衡算法</h3><p>不同的負載均衡算法適用於不同的場景。例如，對於請求處理時間相對固定的應用，輪詢法可能是一個合適的選擇。而對於處理時間波動較大的應用，最少連接法可能更為合適。</p><p>舉例來説，在一個在線視頻處理服務中，由於視頻文件大小和編碼複雜度的不同，處理時間可能會有很大的波動。在這種情況下，最少連接法能夠保證新的請求更可能被分配到當前負載較低的服務器，從而實現更好的負載均衡。</p><h3>3.1.2 設置合理的會話保持</h3><p>會話保持對於需要保持用户狀態的應用非常重要。通過配置合理的會話保持，可以確保用户的連續請求被髮送到同一服務器，從而保持應用的狀態一致。</p><p>例如，在一個在線購物平台中，用户的購物車信息需要在多個請求之間保持一致。通過使用 Cookie 保持或 IP 綁定，可以保證用户的所有請求都被路由到同一服務器，從而保持購物車狀態的一致。</p><h2>3.2 優化 SLB 性能</h2><p>SLB 的性能直接影響到應用的響應時間和用户體驗。通過一些優化措施，可以進一步提升 SLB 的性能。</p><h3>3.2.1 調優負載均衡算法</h3><p>根據應用的實際負載和服務器性能，調整負載均衡算法的參數，以實現更好的負載均衡效果。</p><h3>3.2.2 優化健康檢查配置</h3><p>合理的健康檢查配置能夠及時發現服務器的故障，同時避免對服務器造成額外的負擔。例如，可以通過調整健康檢查的間隔和超時時間，來平衡健康檢查的準確性和資源消耗。</p><h3>3.2.3 使用高效的會話保持機制</h3><p>選擇高效的會話保持機制，如使用 Cookie 保持而非 IP 綁定，可以減少服務器的負擔，同時保證應用的狀態一致。</p><h2>3.3 處理常見問題</h2><p>在實際使用 SLB 時，可能會遇到一些常見的問題和挑戰，如服務器故障、流量激增等。通過一些預防和應對措施，可以減少這些問題對應用的影響。</p><p>例如，在遭遇流量激增時，可以通過預先擴展服務器資源，或使用自動擴展功能，來應對可能的服務器超負荷問題。同時，通過合理的流量控制和優先級設置，可以保證關鍵服務的可用性和性能。</p><p>通過以上的最佳實踐，用户可以更有效地利用 SLB，提升雲應用的可用性和性能，同時應對實際運營中可能遇到的各種問題和挑戰。</p><hr><h1>四、阿里雲 SLB 多種規格舉例</h1><p><img src="https://oscimg.oschina.net/oscnet/up-135c5f9e2fa4270648b02351e71d04ee5c3.png" alt="file" referrerpolicy="no-referrer"><img src="https://oscimg.oschina.net/oscnet/up-c06ba677661c1157b2788ebccc51ee7db6a.png" alt="file" referrerpolicy="no-referrer"></p><hr><h1>五、應用場景</h1><p><img src="https://oscimg.oschina.net/oscnet/up-0d9060a5c0eb4b3aee77921b3593c4ea83a.png" alt="file" referrerpolicy="no-referrer"><img src="https://oscimg.oschina.net/oscnet/up-dfbf500e869785bf734a386e1c86320519a.png" alt="file" referrerpolicy="no-referrer"><img src="https://oscimg.oschina.net/oscnet/up-0ed01d7e27b70bcbab145e0edc7289156e0.png" alt="file" referrerpolicy="no-referrer"><img src="https://oscimg.oschina.net/oscnet/up-de11d78c80025ba2523ce4fd2201169dfbb.png" alt="file" referrerpolicy="no-referrer"></p><blockquote><p>關注【TechLeadCloud】，分享互聯網架構、雲服務技術的全維度知識。作者擁有 10+年互聯網服務架構、AI 產品研發經驗、團隊管理經驗，同濟本復旦碩，復旦機器人智能實驗室成員，阿里雲認證的資深架構師，項目管理專業人士，上億營收 AI 產品研發負責人。 如有幫助，請多關注 TeahLead KrisChang，10+年的互聯網和人工智能從業經驗，10 年+技術和業務團隊管理經驗，同濟軟件工程本科，復旦工程管理碩士，阿里雲認證雲服務資深架構師，上億營收 AI 產品業務負責人。</p></blockquote></div>
                                    ]]>
            </description>
            <pubDate>Thu, 15 Feb 2024 12:22:31 GMT</pubDate>
            <guid isPermaLink="false">https://my.oschina.net/u/6723965/blog/11043804</guid>
            <link>https://my.oschina.net/u/6723965/blog/11043804</link>
            <author>
                <![CDATA[原創]]>
            </author>
        </item>
        <item>
            <title>
                <![CDATA[華為工程師提交 Linux 內核補丁——添加「沙盒模式」 (SBM)]]>
            </title>
            <description>
                <![CDATA[<div class="content"><p>華為工程師 Petr Tesarik 向 Linux 內核提交了添加「沙盒模式」(SandBox Mode, SBM) 的新補丁——用於提升內存安全性。</p><blockquote><p><img src="https://oscimg.oschina.net/oscnet/up-69b0075c015343103fb4626bc5e726f044c.png" referrerpolicy="no-referrer"><em><u><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Flore.kernel.org%2Flkml%2F20240214113035.2117-1-petrtesarik%40huaweicloud.com%2F" target="_blank">https://lore.kernel.org/lkml/20240214113035.2117-1-petrtesarik@huaweicloud.com/</a></u></em></p></blockquote><p>Petr Tesarik 在郵件寫道：</p><blockquote><p>沙盒模式的最終目標是<strong>在只允許訪問預定義地址內存的環境中執行本地內核代碼</strong>，因此潛在漏洞無法被利用，或不會對內核的其他部分產生影響。</p><p>該補丁為內核添加了沙盒模式的 API 和獨立於操作系統的基礎架構。它在所有輸入和輸出數據的 vmalloc() 副本上運行目標函數。由於有了保護頁，僅此一項就能防止一些越界訪問。</p></blockquote><p><u><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Flore.kernel.org%2Flkml%2F20240214113035.2117-6-petrtesarik%40huaweicloud.com%2F" target="_blank">根據文檔的描述</a></u>，沙盒模式的主要目標是通過分解內核來減少內核代碼中潛在內存安全錯誤的影響。SBM API 支持在隔離的執行環境中運行每個組件，特別是用作輸入的內存區域和 / 或輸出與內核的其餘部分隔離，並被保護頁包圍。</p><p>在實現必要的 arch hook 的架構上，沙盒模式利用硬件分頁設施和 CPU 特權級別來強制僅使用這些預定義的內存區域。有了 arch 的支持，SBM 還可以從 protection violation 進行恢復。這意味着 SBM 可強制終止沙盒，並向調用者返回錯誤代碼（例如<code>-EFAULT</code>），以便執行可以繼續。這種實現提供了強隔離機制。</p></div>
                                    ]]>
            </description>
            <pubDate>Thu, 15 Feb 2024 11:29:58 GMT</pubDate>
            <guid isPermaLink="false">https://www.oschina.net/news/278775</guid>
            <link>https://www.oschina.net/news/278775</link>
            <author>
                <![CDATA[來源: OSCHINA]]>
            </author>
        </item>
        <item>
            <title>
                <![CDATA[Mozilla 裁員 60 人，提升 Firefox Mobile 優先級]]>
            </title>
            <description>
                <![CDATA[<div class="content"><p style="color:#000000; text-align:start">在任命 Laura Chambers 擔任臨時 CEO 不到一週後，Mozilla 宣佈裁員約 60 人並縮減多項產品的投資。</p><p style="color:#000000; text-align:start">Mozilla 將縮減 VPN、Relay 和 Online Footprint Scrubber 等的投資，關閉 2018 年推出的 3D 虛擬世界 Hubs，縮減對 Mastodon 實例 mozilla.social 的投資。和今天的很多科技公司類似，Mozilla 將專注於將可信賴的 AI 引入到 Firefox。</p><p style="color:#000000; text-align:start">Mozilla 在一份聲明中寫道：「我們正在縮減對某些產品的投資，以便將重點放在我們認為最有可能取得成功的領域。我們打算將資源重新優先用於 Firefox Mobile 等產品，因為這些產品有很大的發展機會，並能為業界建立更好的模式。」</p><p style="color:#000000; text-align:start">相關鏈接：<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Ftechcrunch.com%2F2024%2F02%2F13%2Fmozilla-downsizes-as-it-refocuses-on-firefox-and-ai-read-the-memo%2F" target="_blank">https://techcrunch.com/2024/02/13/mozilla-downsizes-as-it-refocuses-on-firefox-and-ai-read-the-memo</a></p></div>
                                    ]]>
            </description>
            <pubDate>Thu, 15 Feb 2024 02:24:18 GMT</pubDate>
            <guid isPermaLink="false">https://www.oschina.net/news/278738/firefox-maker-mozilla-cutting-60</guid>
            <link>https://www.oschina.net/news/278738/firefox-maker-mozilla-cutting-60</link>
            <author>
                <![CDATA[來源: 投稿]]>
            </author>
        </item>
        <item>
            <title>
                <![CDATA[Socket.D 開源輸傳協議的集羣轉發特性]]>
            </title>
            <description>
                <![CDATA[<div class="content"><h3>1、簡介</h3><p style="color:#24292e; text-align:start">Socket.D 是基於"事件"和"語義消息""流"的網絡應用層協議。底層可以依賴 TCP、UDP、KCP、WebSocket 等傳輸層協議。其開發背後的動機是用開銷更少的協議取代超文本傳輸協議 (HTTP)，HTTP 協議對於許多任務 (如微服務通信) 來説效率低下。</p><h3>2、Socket.D 的集羣應用</h3><p style="color:#24292e; text-align:start">在 Socket.D 的集羣故事裏，會有三個角色：</p><ul><li>請求者</li><li>經理人（或者中間人）</li><li>響應者</li></ul><p style="color:#24292e; text-align:start">客户端通過 url 連接經理人後，就會成為集羣的一部分。它可以是請求者，也可以是響應者。</p><pre><code class="language-php">sd:tcp:<em>//127.0.0.1:8602?@=demoapp</em></code></pre><p style="color:#24292e; text-align:start">url 會包括：</p><ul><li>協議頭（sd 表示 socket.d 協議，tcp 表示傳輸方案）</li><li>地址與端口</li><li>路徑</li><li>還有<code>@</code>參數，這個參數會申明自己的應用名字。連接經理人時，也相當於完成身份註冊了。</li></ul><p style="color:#24292e; text-align:start">在集羣內部，相互間通過<span>&nbsp;</span><code>At</code><span>&nbsp;</span>進行發起向「響應者」的請求。就像：</p><pre><code class="language-java">session.send(<span style="color:#50a14f">"test"</span>, <span style="color:#a626a4">new</span><span style="color:#c18401">StringEntity</span>(<span style="color:#50a14f">"hello"</span>).at(<span style="color:#50a14f">"demoapp"</span>));
</code></pre><h3>3、集羣的四種轉發</h3><p style="color:#24292e; text-align:start">在集羣的活動中，請求者會發消息給經理人，經理人根據 at name 再轉發給相應的響應者。</p><ul><li>四種轉發方式（單播，單播!，組播，廣播）：</li></ul><table cellspacing="0" style="-webkit-text-stroke-width:0px; background-color:#ffffff; border-collapse:collapse; border-spacing:0px; box-sizing:border-box; color:#24292e; display:block; font-family:-apple-system,&quot;system-ui&quot;,&quot;Segoe UI&quot;,Helvetica,Arial,sans-serif,&quot;Apple Color Emoji&quot;,&quot;Segoe UI Emoji&quot;,&quot;Segoe UI Symbol&quot;; font-size:16px; font-style:normal; font-variant-caps:normal; font-variant-ligatures:normal; font-weight:400; letter-spacing:normal; margin-bottom:16px; margin-top:0px; orphans:2; overflow:auto; text-align:start; text-decoration-color:initial; text-decoration-style:initial; text-decoration-thickness:initial; text-transform:none; white-space:normal; widows:2; width:960px; word-spacing:0px"><tbody><tr><th>at</th><th>描述</th><th>備註</th></tr></tbody><tbody><tr><td style="border-color:#dfe2e5; border-style:solid; border-width:1px"><code>demoapp</code></td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">單播</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">給叫這個名的其中一個會話發（使用，平均輪詢 「負載均衡」策略）</td></tr><tr><td style="border-color:#dfe2e5; border-style:solid; border-width:1px"><code>demoapp!</code></td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">單播!</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">給叫這個名的其中一個會話發（使用 ip_hash 「負載均衡」策略）</td></tr><tr><td style="border-color:#dfe2e5; border-style:solid; border-width:1px"><code>demoapp*</code></td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">組播</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">給叫這個名的整組會話發（如果自己也叫這個名，則自己除外）</td></tr><tr><td style="border-color:#dfe2e5; border-style:solid; border-width:1px"><code>*</code></td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">廣播</td><td style="border-color:#dfe2e5; border-style:solid; border-width:1px">給集羣裏的全部會話發（自己除外）</td></tr></tbody></table><ul><li>通過 at 方式進行轉發，示例：</li></ul><pre><code class="language-java">session.send(<span style="color:#50a14f">"test"</span>, <span style="color:#a626a4">new</span><span style="color:#c18401">StringEntity</span>(<span style="color:#50a14f">"hello"</span>).at(<span style="color:#50a14f">"demoapp"</span>));
session.send(<span style="color:#50a14f">"test"</span>, <span style="color:#a626a4">new</span><span style="color:#c18401">StringEntity</span>(<span style="color:#50a14f">"hello"</span>).at(<span style="color:#50a14f">"demoapp!"</span>));
session.send(<span style="color:#50a14f">"test"</span>, <span style="color:#a626a4">new</span><span style="color:#c18401">StringEntity</span>(<span style="color:#50a14f">"hello"</span>).at(<span style="color:#50a14f">"demoapp*"</span>));
session.send(<span style="color:#50a14f">"test"</span>, <span style="color:#a626a4">new</span><span style="color:#c18401">StringEntity</span>(<span style="color:#50a14f">"hello"</span>).at(<span style="color:#50a14f">"*"</span>));
</code></pre><h3>4、演示</h3><p style="color:#24292e; text-align:start">假設經理人（或者中間人） 的服務地址為：127.0.0.1:8602。下面以 Java 語言展示效果：</p><ul><li>創建經理人</li></ul><pre><code class="language-java"><span style="color:#a626a4">public</span><span style="color:#a626a4">class</span><span style="color:#c18401">BrokerDemo</span> {
    <span style="color:#a626a4">public</span><span style="color:#a626a4">static</span><span style="color:#a626a4">void</span><span style="color:#4078f2">main</span><span>(String[] args)</span><span style="color:#a626a4">throws</span> Exception {
        SocketD.createServer(<span style="color:#50a14f">"sd:tcp"</span>)
                .config(c -&gt; c.port(<span style="color:#986801">8602</span>).fragmentHandler(<span style="color:#a626a4">new</span><span style="color:#c18401">BrokerFragmentHandler</span>()))
                .listen(<span style="color:#a626a4">new</span><span style="color:#c18401">BrokerListener</span>())
                .start();
    }
}
</code></pre><ul><li>創建響應者（自己不需要端口啓動，連接經理人後即可提供服務）</li></ul><pre><code class="language-java"><span style="color:#a626a4">public</span><span style="color:#a626a4">class</span><span style="color:#c18401">ResponderDemo</span> {
    <span style="color:#a626a4">public</span><span style="color:#a626a4">static</span><span style="color:#a626a4">void</span><span style="color:#4078f2">main</span><span>(String[] args)</span><span style="color:#a626a4">throws</span> Exception {
        <em>//連接到 broker ，並給自己命名為：demoapp</em><span style="color:#986801">ClientSession</span><span style="color:#986801">session</span><span>=</span> SocketD.createClient(<span style="color:#50a14f">"sd:tcp://127.0.0.1:8602?@=demoapp"</span>)
                .listen(<span style="color:#a626a4">new</span><span style="color:#c18401">EventListener</span>().doOn(<span style="color:#50a14f">"/hello"</span>, (s,m)-&gt;{
                    <em>//監聽 "/hello" 事件，如果是請求則答覆</em><span style="color:#a626a4">if</span>(m.isRequest()){
                        s.reply(m, <span style="color:#a626a4">new</span><span style="color:#c18401">StringEntity</span>(<span style="color:#50a14f">"me too!"</span>));
                    }
                }))
                .open();
    }
}
</code></pre><ul><li>創建請求者</li></ul><pre><code class="language-java"><span style="color:#a626a4">public</span><span style="color:#a626a4">class</span><span style="color:#c18401">RequesterDemo</span> {
    <span style="color:#a626a4">public</span><span style="color:#a626a4">static</span><span style="color:#a626a4">void</span><span style="color:#4078f2">main</span><span>(String[] args)</span><span style="color:#a626a4">throws</span> Exception {
        <em>//連接到 broker ，並給自己命名為：demotester</em><span style="color:#986801">ClientSession</span><span style="color:#986801">session</span><span>=</span> SocketD.createClient(<span style="color:#50a14f">"sd:tcp://127.0.0.1:8602?@=demotester"</span>)
                .open();

        <em>//發送消息，並要求轉發給 "demoapp"</em>
        session.sendAndRequest(<span style="color:#50a14f">"/hello"</span>, <span style="color:#a626a4">new</span><span style="color:#c18401">StringEntity</span>(<span style="color:#50a14f">""</span>).at(<span style="color:#50a14f">"demoapp"</span>)).thenReply(r-&gt;{
            <em>//收到答覆後，打印結果</em>
            print(r.dataAsString());
        });
    }
}</code></pre><p>&nbsp;</p></div>
                                    ]]>
            </description>
            <pubDate>Wed, 14 Feb 2024 10:48:00 GMT</pubDate>
            <guid isPermaLink="false">https://www.oschina.net/news/278694</guid>
            <link>https://www.oschina.net/news/278694</link>
            <author>
                <![CDATA[來源: 投稿]]>
            </author>
        </item>
        <item>
            <title>
                <![CDATA[安卓動態鏈接庫文件體積優化探索實踐]]>
            </title>
            <description>
                <![CDATA[<div class="content"><h1>背景介紹</h1><p>應用安裝包的體積影響着用户下載量、安裝時長、用户磁盤佔用量等多個方面，據<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fmedium.com%2Fgoogleplaydev%2Fshrinking-apks-growing-installs-5d3fcba23ce2" target="_blank">Google Play 統計</a>，應用體積每增加 6MB，安裝的轉化率將下降 1%。</p><p><img src="https://static001.geekbang.org/resource/image/f8/68/f8a5e264dee4ee6879cd6c30d4bbf368.png?wh=1838*1002" alt="" referrerpolicy="no-referrer"></p><p>安裝包的體積受諸多方面影響，針對 dex、資源文件、so 文件都有不同的優化策略，在此不做一一展開，本文主要記錄了在研發時針對動態鏈接庫的文件體積裁剪優化方案。</p><p>我開發的鏈接庫使用 rust 語言開發，通過安卓 jni 接口實現 java 層和 native 層之間的相互調用。為什麼使用 rust 主要有以下幾個方面的考慮：</p><p>1.穩。安卓的 JNI 接口調用複雜，又涉及到 native 層的內存管理，隨着代碼量的增加，代碼的安全穩定性會受到很大的挑戰。使用 rust 開發，開發者幾乎不需要考慮 GC 的問題，只要開發的時候按照規範老老實實寫代碼並且通過了編譯器的檢查，基本上就很難把程序寫崩，這一點在代碼上線後也確實得到了驗證。</p><p>2.安全。傳統使用 C、C++開發的代碼編譯完成以後，如果不加保護，很容易使用反彙編工具破解，市面上比較成熟的工具如 IDA、ghidra 等都可以將彙編代碼還原到高級語言。使用 rust 編譯的產物，內部函數間的調用規約和傳統都不一樣，目前市面上還沒有相對完善的反編譯工具，軟件的防破解能力直接上升一個數量級。</p><p>但是使用 rust 有一個非常明顯的缺點就是編譯產物<strong>體積過大</strong>。在不修改默認的 rust 編譯選項的情況下，僅開啓 strip 的情況下，我的動態庫體積達到了<strong>495k</strong>。</p><h1>優化方案</h1><p>參考網上前人的經驗，依次進行了以下優化方式。</p><h2>調整優化等級</h2><p>默認的編譯優化等級是 O3，該優化的目的提高代碼的運行速度，但是與此同時會對部分循環進行展開，體積造成膨脹。在此我們以縮減體積為目標，將優化選項改為 z，表示生成最小二進制體積：</p><pre><code>[profile.release]
opt-level = 'z'
</code></pre><p>優化後前後體積變化</p><p>| 編譯選項 | 體積 | | strip | 495k | | strip + opt-level = 'z' | 437k |</p><h2>開啓 LTO</h2><p>LTO（Link Time Optimization）可以在鏈接時消除冗餘代碼，減小二進制體積——代價是更長的鏈接時間。</p><pre><code>Cargo.toml
[profile.release]
opt-level = 'z'
lto = true
</code></pre><p>優化後前後體積變化</p><p>| 編譯選項 | 體積 | | strip | 495k | | strip + opt-level = 'z' | 437k | | strip + opt-level = 'z' + lto | 436k |</p><p>優化效果非常不明顯，聊勝於無。</p><h2>Panic 立刻終止</h2><p>rust 默認的 panic 會在崩潰時進行棧回溯，方便定位問題。然而會帶來額外的體積增加，將這一功能使用 abort 替代。</p><pre><code>[profile.release]
opt-level = 'z'
lto = true
panic = 'abort'
</code></pre><p>優化後前後體積變化</p><p>| 編譯選項 | 體積 | | strip | 495k | | strip + opt-level = 'z' | 437k | | strip + opt-level = 'z' + lto | 436k | | strip + opt-level = 'z' + lto + panic = 'abort' | 366K |</p><p>到目前為止，常規的優化手段已經用完了，後續優化需要配合一些代碼的額外變動。</p><p>使用 rust 分析工具 bloat 對產物進行分析，結果如下：</p><pre><code>File  .text     Size Crate
4.1%  69.0% 192.7KiB std
1.0%  16.8%  46.9KiB jdmp
0.5%   8.1%  22.7KiB [Unknown]
0.2%   3.8%  10.5KiB jni
0.0%   0.5%   1.5KiB cesu8
0.0%   0.4%   1.1KiB adler32
0.0%   0.3%     904B bytes
0.0%   0.2%     640B aho_corasick
0.0%   0.2%     588B regex_syntax
0.0%   0.2%     572B regex_automata
0.0%   0.2%     440B log
0.0%   0.1%     304B memchr
0.0%   0.0%      52B combine
0.0%   0.0%       8B jni_sys
</code></pre><p>讓我感到驚訝的是我的核心代碼 jdmp 模塊只佔了 46.9k，為此要額外引入幾百 k 的額外開銷！</p><h2>移除一些無用字符串</h2><p>在引入的第三方依賴裏，開發者自己添加了很多字符串信息，大部分是用來完善提供運行時報錯信息。通過修改、精簡這些依賴庫，刪除無用代碼，又可以省出一部分空間來。</p><p>同時，上面的優化儘管使用 abort 替代了 panic，rust 編譯器仍然會生出一些格式化的字符串，使用 panic_immediate_abort 這個編譯選項禁用這個行為。</p><pre><code>.cargo/config.toml
[unstable]
build-std-features = ["panic_immediate_abort"]
build-std = ["std","panic_abort"]
</code></pre><p>優化後前後體積變化</p><p>| 編譯選項 | 體積 | | strip | 495k | | strip + opt-level = 'z' | 437k | | strip + opt-level = 'z' + lto | 436k | | strip + opt-level = 'z' + lto + panic = 'abort' + 代碼裁減 + panic_immediate_abort | 135k |</p><p>再次分析，整個文件的體積已經降到了 135k，自己開發的核心代碼佔總代碼量的 52%，基本符合預期。</p><pre><code> File  .text    Size Crate
14.2%  52.0% 41.3KiB jdmp
 3.2%  11.7%  9.3KiB core
 3.1%  11.4%  9.1KiB jni
 3.0%  11.0%  8.8KiB [Unknown]
 1.9%   6.8%  5.4KiB std
 0.9%   3.3%  2.6KiB alloc
 0.3%   1.1%    936B cesu8
 0.3%   1.0%    792B adler32
 0.1%   0.5%    372B aho_corasick
 0.1%   0.4%    316B regex_automata
 0.1%   0.3%    220B log
 0.1%   0.3%    216B hashbrown
 0.0%   0.1%    108B bytes
 0.0%   0.1%     44B combine
 0.0%   0.1%     44B rustc_demangle
 0.0%   0.0%      8B compiler_builtins
 0.0%   0.0%      8B jni_sys
</code></pre><h2>優化 linker script</h2><p>儘管目前文件體積已經相比一開始優化了不少，但是還沒有達到接入要求。通過 readelf 進一步分析 ELF 文件的各個 section，我找到了一些額外的優化空間。</p><pre><code>$ aarch64-linux-gnu-readelf -S target/aarch64-linux-android/release/libjdmp.so
There are 24 section headers, starting at offset 0x21738:

Section Headers:
  [Nr] Name              Type             Address           Offset
       Size              EntSize          Flags  Link  Info  Align
  [ 0]                   NULL             0000000000000000  00000000
       0000000000000000  0000000000000000           0     0     0
  [ 1] .note.android.ide NOTE             0000000000000270  00000270
       0000000000000098  0000000000000000   A       0     0     4
  [ 2] .dynsym           DYNSYM           0000000000000308  00000308
       00000000000002e8  0000000000000018   A       7     1     8
  [ 3] .gnu.version      VERSYM           00000000000005f0  000005f0
       000000000000003e  0000000000000002   A       2     0     2
  [ 4] .gnu.version_r    VERNEED          0000000000000630  00000630
       0000000000000040  0000000000000000   A       7     2     4
  [ 5] .gnu.hash         GNU_HASH         0000000000000670  00000670
       0000000000000024  0000000000000000   A       2     0     8
  [ 6] .hash             HASH             0000000000000694  00000694
       0000000000000100  0000000000000004   A       2     0     4
  [ 7] .dynstr           STRTAB           0000000000000794  00000794
       000000000000014d  0000000000000000   A       0     0     1
  [ 8] .rela.dyn         RELA             00000000000008e8  000008e8
       00000000000007f8  0000000000000018   A       2     0     8
  [ 9] .rela.plt         RELA             00000000000010e0  000010e0
       00000000000002a0  0000000000000018  AI       2    19     8
  [10] .rodata           PROGBITS         0000000000001380  00001380
       0000000000001d83  0000000000000000  AM       0     0     8
  [11] .eh_frame_hdr     PROGBITS         0000000000003104  00003104
       0000000000002494  0000000000000000   A       0     0     4
  [12] .eh_frame         PROGBITS         0000000000005598  00005598
       00000000000078cc  0000000000000000   A       0     0     8
  [13] .text             PROGBITS         000000000000de64  0000ce64
       0000000000013e0c  0000000000000000  AX       0     0     4
  [14] .plt              PROGBITS         0000000000021c70  00020c70
       00000000000001e0  0000000000000000  AX       0     0     16
  [15] .data.rel.ro      PROGBITS         0000000000022e50  00020e50
       0000000000000430  0000000000000000  WA       0     0     8
  [16] .fini_array       FINI_ARRAY       0000000000023280  00021280
       0000000000000010  0000000000000008  WA       0     0     8
  [17] .dynamic          DYNAMIC          0000000000023290  00021290
       0000000000000180  0000000000000010  WA       7     0     8
  [18] .got              PROGBITS         0000000000023410  00021410
       0000000000000048  0000000000000000  WA       0     0     8
  [19] .got.plt          PROGBITS         0000000000023458  00021458
       00000000000000f8  0000000000000000  WA       0     0     8
  [20] .data             PROGBITS         0000000000024550  00021550
       0000000000000060  0000000000000000  WA       0     0     8
  [21] .bss              NOBITS           00000000000245b0  000215b0
       0000000000000101  0000000000000000  WA       0     0     8
  [22] .comment          PROGBITS         0000000000000000  000215b0
       00000000000000b2  0000000000000001  MS       0     0     1
  [23] .shstrtab         STRTAB           0000000000000000  00021662
       00000000000000d3  0000000000000000           0     0     1
</code></pre><p>在對這些 section 進行優化時，有必要搞清楚每個 section 在程序運行的作用。</p><p>| section | 作用 | | .text | 代碼段 | | .data .rodata .bss | 數據段 | | .plt .got .dynamic .dynsym .rela.dyn .rela.plt .shstrtab | 運行時被動態鏈接庫解析，用於動態鏈接。 | | .eh_frame .eh_frame_hdr | 用於保存函數的棧幀偏移，方便棧回溯 | | .gnu.hash .gnu.version .gnu.version_r .hash | 保存編譯文件元信息 |</p><p>程序在正常運行時，代碼段、數據段必不可少，同時需要保留動態鏈接需要的 section。剩餘的 section 可以移除，可以進一步優化文件體積。值得注意到是，刪除.eh_frame .eh_frame_hdr 後，在程序崩潰時只能得到一個崩潰地址，無法進行棧回溯。</p><p>創建一個 linker script，只保留程序運行最小依賴的 section。</p><pre><code>PHDRS
{
  headers PT_PHDR PHDRS ;
  text PT_LOAD FILEHDR PHDRS ;
  data PT_LOAD ;
  dynamic PT_DYNAMIC ;
}
ENTRY(Reset);
EXTERN(RESET_VECTOR); 
SECTIONS
{
  . = SIZEOF_HEADERS;
  .text : { *(.text .text.*) } :text
  .rodata : { *(.rodata .rodata.*) } :text

  . = . + 0x1000;
  .data : { *(.data .data.*) *(.fini_array .fini_array.*) *(.got .got.*) *(.got.plt .got.plt.*) } : data
  .bss : {*(.bss .bss.*)} : data
  .dynamic : { *(.dynamic .dynamic.*)  } :data :dynamic

  /DISCARD/ :
  {
    *(.ARM.exidx .ARM.exidx.*);
    *(.gnu.version .gnu.version.*);
    *(.gnu.version_r .gnu.version_r.*);
    *(.eh_frame_hdr .eh_frame .eh_frame_hdr.* .eh_frame.* );
    *(.note.android.ident .note.android.ident.*);
    *(.comment .comment.*);
  }
}
</code></pre><p>修改編譯參數，替換默認的 linker script</p><pre><code>.cargo/config.toml

[build]
target = ["aarch64-linux-android","armv7-linux-androideabi"]

[unstable]
build-std-features = ["panic_immediate_abort"]
build-std = ["std","panic_abort"]

[target.aarch64-linux-android]
rustflags = ["-C", "link-arg=-Tlinker.lds"]

[target.armv7-linux-androideabi]
rustflags = ["-C", "link-arg=-Tlinker.lds"]
</code></pre><p>經過一番操作，程序的體積最終裁減到了 95k！完美符合要求。</p><h1>總結</h1><p>| 編譯選項 | 體積 | | strip | 495k | | strip + opt-level = 'z' | 437k | | strip + opt-level = 'z' + lto | 436k | | strip + opt-level = 'z' + lto + panic = 'abort' + 代碼裁減 + panic_immediate_abort | 135k | | strip + opt-level = 'z' + lto + panic = 'abort' + 代碼裁減 + panic_immediate_abort + 移除 section | 95k |</p><p>本文記錄了我進行編譯體積優化的各種操作，其中的一些策略在使用 C、C++語言開發中仍具有一定的通用性。</p><p>作者：尚紅澤</p><p>來源：京東雲開發者社區，轉載請註明來源</p></div>
                                    ]]>
            </description>
            <pubDate>Mon, 05 Feb 2024 02:09:00 GMT</pubDate>
            <guid isPermaLink="false">https://my.oschina.net/u/4090830/blog/11030168</guid>
            <link>https://my.oschina.net/u/4090830/blog/11030168</link>
            <author>
                <![CDATA[京東雲開發者]]>
            </author>
        </item>
    </channel>
</rss>
